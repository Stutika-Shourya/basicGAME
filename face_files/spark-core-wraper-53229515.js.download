(window.webpackJsonp=window.webpackJsonp||[]).push([["spark-core-wraper",18,19],{1600:function(e,t,r){"use strict";var o=r(1),n=r.n(o),i=r(10),a=r.n(i),s=r(19);t.a={authFetch:function(e){var t=(new Error).stack;return a.a.requiresAuth().then((function(){return a.a.getAccessToken().then((function(r){var o=n.a.defer();s.SparkPerformanceTracker.measurePromise("StorageLoader.fetch:".concat(e.uri),o.promise);var i=Object.assign({},e.headers);i=Object.assign(i,{"x-access-token":r});try{window.fetch(e.uri,{method:e.method||"GET",headers:new window.Headers(i),body:e.body}).then((function(r){if(200===r.status||204===r.status)o.resolve(r);else if(401===r.status)o.reject(new Error("Request auth failed; errorCode:"+r.status+"; errorText:"+r.statusText)),a.a.clearScope(),window.marvel.events.trigger("spark-auth-failed");else{window.marvel.logger.info("[Client:Storage] authFetch failed more info",{errorCode:r.status,outerStack:t,uri:e.uri});var n=new Error("Request failed; errorCode:"+r.status+"; errorText:"+r.statusText);n.statusCode=r.status,o.reject(n)}}),(function(t){window.marvel.logger.error("[Client:Storage] authFetch rejected promise during window.fetch call",{error:t,uri:e.uri}),o.reject(t)})).catch((function(t){window.marvel.logger.error("[Client:Storage] authFetch threw an exception during window.fetch call",{error:t,uri:e.uri}),o.reject(t)}))}catch(c){window.marvel.logger.info("[Client:Storage] authFetch window.fetch throws",{error:c}),o.reject(c)}return o.promise}))}))},authFetchJSON:function(e){var t;return e.body instanceof String?t=e:(t=Object.assign({},e),t=Object.assign(t,{body:JSON.stringify(e.body)})),t.headers?t.headers["content-type"]||(t.headers["content-type"]="application/json"):t.headers={"content-type":"application/json"},this.authFetch(t).then((function(e){var t=n.a.defer();return e.json().then((function(e){t.resolve(e)})).catch((function(e){t.reject(e)})),t.promise}))}}},39:function(e,t,r){var o,n;o=[r(2),r(6),r(1),r(4),r(10),r(21),r(0),r(59),r(134)],void 0===(n=function(e,t,o,n,i,a,s,c,l){"use strict";var d=new n.default({color:"#0000ff",name:"storage"});return new(t.Model.extend({WATCH_INTERVAL:12e4,MODE_SYNC_GROUP:"sync-group",MODE_EDITOR:"sync-editor",MODE_DISABLED:"sync-disabled",MODE_HOME:"sync-home",syncMode:"sync-group",syncDoc:null,dcx:null,dcxService:null,dcxSession:null,syncCount:0,syncGroups:{},storageEnabled:!1,enabledDefer:o.defer(),initialize:function(){this.logger=d,this._loadDefer=o.defer(),this.syncNow=this.syncNow.bind(this)},_listenForSyncMode:function(){this._listeningForSyncMode||(this._listeningForSyncMode=!0,window.marvel.events.on("set-sync-mode",this._onSyncModeSet.bind(this)))},syncEnter:function(){0==this.syncCount++&&marvel.events.trigger("sync-start",!0)},syncLeave:function(){0==--this.syncCount&&marvel.events.trigger("sync-stop",!0)},storageReady:function(){return this._loadDefer.promise},_mixin:function(t){e.each(t,function(e,t){this[t]=e.bind(this)}.bind(this))},ensureSyncGroup:function(e){return o.resolve({getComposite:function(t){return i.ajax({type:"HEAD",url:"https://"+s.ss+"/assets/"+e+"/"+t,headers:{"x-api-key":s.key},contentType:"application/json; charset=utf-8"}).then((function(e,t,r){var o=r.getResponseHeader("X-Resource-URN");return l.load().then((function(e){return e.ACPSparkController.getCompositeDoc(o)}))}))}})},enableStorage:function(e){this.storageServer=e,this._storageInit||(this._storageInit=!0,l.load(),this._listenForSyncMode(),this.syncEnter(),Promise.all([r.e("vendors~m-storage"),r.e("brand-kit-chooser-view~m-storage~user-profile-view"),r.e("m-storage")]).then(function(e){const{AdobeCommunityPlatform:t,AdobeDCX:o,AdobeDCXBranch:n,AdobeDCXComponent:a,AdobeDCXComposite:s,AdobeDCXCompositeXfer:c,AdobeDCXElement:d,AdobeDCXError:u,AdobeDCXNode:h,AdobeDCXUtil:g,AdobeStorageSession:f,createUploadResults:m,createUploadRecord:v}=r(713);this.AdobeCommunityPlatform=t,this.AdobeDCX=o,this.AdobeDCXBranch=n,this.AdobeDCXComponent=a,this.AdobeDCXComposite=s,this.AdobeDCXCompositeXfer=c,this.AdobeDCXElement=d,this.AdobeDCXError=u,this.AdobeDCXNode=h,this.AdobeDCXUtil=g,this.AdobeStorageSession=f,this.createUploadResults=m,this.createUploadRecord=v,this._mixin(r(715)),this._mixin(r(716)),this._mixin(r(717)),this.installDCX3Shim(),this.getCompositeDoc=function(e,t,r){return l.load().then((function(r){return r.ACPSparkController.getCompositeDoc(e,!!t)}))}.bind(this),this.syncLeave(),i.isValid().then(function(){this.initializeStorage().then(function(){this._loadDefer.resolve()}.bind(this)).done()}.bind(this),function(e){marvel.events.on("auth-loaded",function(e){this.initializeStorage().then(function(){this._loadDefer.resolve()}.bind(this)).done()}.bind(this))}.bind(this)),marvel.events.on("auth-token-set",this.resetAuthToken.bind(this))}.bind(this).bind(null,r)).catch(r.oe))},resetAuthToken:function(e,t){this.dcxService&&this.dcxService.setAuthToken(e)},newCompositeAsCopyOf:function(e,t){return this.dcx.newCompositeAsCopyOf(e,void 0,t)},_onSyncModeSet:function(t){var r=t.mode,o=t.doc,n=this.syncMode===this.MODE_EDITOR&&r===this.MODE_SYNC_GROUP;this.syncMode=r,this.syncDoc=o,n&&(a.hasFeature("enable-spark-storage-server")||a.hasFeature("enable-odb")||(window.marvel.events.trigger("left-editing-session",{}),e.defer(this.syncNow.bind(this))))},setSyncMode:function(e,t){window.marvel.events.trigger("set-sync-mode",{mode:e,doc:t})},syncNow:function(e){console.warn("WARNING: muiStorage.syncNow() is deprecated and doesn't do anything.",{stack:(new Error).stack})},onceEnabled:function(e){this.storageEnabled?e():this.enabledDefer.promise.done((function(){e()}))},getSharedCloudCollectionId:function(e){if(e.assetId)return o.resolve(e.assetId.replace(/^.*:([^:]*):([^:]*)$/,"$1/$2"));var t=e.href;-1===t.search(/^https\?\:\/\//)&&(t="https://"+t);var r=o.defer();return i.ajax(t+"?api_key="+s.key).then((function(e){r.resolve(e.id)})),r.promise},_parseLinkHeader:function(e){for(var t,r=new RegExp(/\s*<([^>]+)>\s*;\s*([^<]+)/,"g"),o={};null!==(t=r.exec(e));){var n=t[2],i=n.match(/rel=\"([^\"]+)\"/),a=i&&i[1]||"unknown-rel",s=n.match(/templated=\"([a-zA-Z]+)\"/),c=s&&s[1]||"";o[a]={uriReference:t[1],templated:"true"===c.toLowerCase()}}return o},urnToCCStoragePath:function(e){var t=o.defer();return i.ajax({url:"https://"+s.ss+"/id/"+e,type:"HEAD",headers:{"x-api-key":s.key},contentType:"application/json; charset=utf-8"}).then(function(e,r,o){var n=this._parseLinkHeader(o.getResponseHeader("Link"))["http://ns.adobe.com/ccapi/path"].uriReference.split("/"),i=n[n.length-2],a=c.getAppBySyncGroupName(i),s={guid:n[n.length-1],syncGroup:i,appType:a?a.typeName:void 0};t.resolve(s)}.bind(this)).fail(function(e){t.reject(e)}.bind(this)),t.promise}}))}.apply(t,o))||(e.exports=n)},734:function(e,t,r){"use strict";r.r(t);var o=r(41),n=r.n(o),i=r(146),a=r.n(i),s=r(11),c=r.n(s),l=r(8),d=r.n(l),u=r(241),h=r.n(u),g=r(1),f=r.n(g),m=r(10),v=r.n(m),p=r(21),y=r.n(p),C=r(134),_=r.n(C),w=r(1600),S=r(102),k=r.n(S),b=r(183),P=r.n(b),x=r(39),j=r.n(x),F=r(59),D=r.n(F),I=r(443),L=r.n(I),O=r(19),A=r(1276),T=r(982),E=r(976),M=r(1043),B=new(function(){function e(){c()(this,e),this._handlePreloaderReadyEvent=this._handlePreloaderReadyEvent.bind(this),this.reset(),window.marvel.events.on("document-collaboration-changed",this._handleProjectCollabChange.bind(this)),window.marvel.events.off("remove-authoring-context"),window.marvel.events.on("remove-authoring-context",this._handleRemoveAuthoringContext.bind(this)),window.marvel.events.off("insert-authoring-context"),window.marvel.events.on("insert-authoring-context",this._handleInsertAuthoringContext.bind(this)),window.marvel.events.on("push-composite-start push-component-start",this._handlePushEvent.bind(this))}return d()(e,[{key:"reset",value:function(){this._folderPromises={},this._foldersLocal={},this._projectsLocal={},this._currentSpecKey="",this._authoringContextsLocal={},this._authoringContextsCache=null,this._compositeDocsLocal={},this._compositeDocPromises={},this._brandsCachePromise=null}},{key:"addCompositeDocLocal",value:function(e,t){this._compositeDocsLocal[e]&&window.marvel.logger.warn("SparkStorageLoader adding local doc that already exists"),this._compositeDocsLocal[e]=t}},{key:"removeCompositeDocLocal",value:function(e){this._compositeDocsLocal[e]&&delete this._compositeDocsLocal[e]}},{key:"getCompositeDoc",value:function(e){return this.getCompositeDocWithMetadata(e)}},{key:"getCompositeDocWithMetadata",value:function(e,t){var r=this;if(!this._compositeDocsLocal[e]){if(this._compositeDocPromises[e])return this._compositeDocPromises[e];var o;o=t?f.a.resolve(t):this.discoverDocumentMetadataById(e);var n=this.createComposite(e,null);return this._compositeDocPromises[e]=f.a.allSettled([n,o]).spread((function(t,o){var n=t.value,i=o.value,a=D.a.getAppByDocType(n.type);if(!a)return window.marvel.logger.warn("SparkStorageLoader failed to find app for document type",{type:n.type,id:n.id}),f.a.reject(new Error("SparkStorageLoader failed to find app for document type"));var s=new L.a({name:n.current.name,id:n.id,modified:void 0,syncGroupName:a.getSetting("syncGroup"),compositeObj:n});return s.setCollaboration(i.collaboration),delete r._compositeDocPromises[e],r._compositeDocsLocal[e]=s,s})).catch((function(t){delete r._compositeDocPromises[e],window.marvel.logger.warn("SparkStorageLoader failed to create composite within getCompositeDocWithMetadata",{error:t,compositeURN:e})})),this._compositeDocPromises[e]}return f.a.resolve(this._compositeDocsLocal[e])}},{key:"createComposite",value:function(e,t,r){var o=this;return j.a.storageReady().then((function(){var r=j.a.dcx.newCompositeWithAssetId(e);return O.SparkPerformanceTracker.measurePromise("Storage.pullComposite(".concat(e,")"),o._doPullComposite(r,t))}))}},{key:"_doPullComposite",value:function(e,t){return j.a.pullComposite(e).then((function(t){return e})).fail((function(e){if("NO_COMPOSITE"===e.code){var t=e.underlyingError&&e.underlyingError.response||{},r={responseStatusCode:t.statusCode,responseStatusText:t.statusText};window.marvel.logger.warn("AUDIT SyncGroup cleaning up deadend composite reference",r)}return f.a.reject(e)}))}},{key:"_doACCacheInvalidate",value:function(e){try{var t,r=v.a.getProfile().userId,o=window.localStorage.getItem(r+"aclistcache2");if(o){var n=JSON.parse(o);if(e)for(t=0;t<n.brands.length;t++)n.brands[t].urn===e&&n.brands.splice(t--,1);else n.etag=null;window.localStorage.setItem(r+"aclistcache2",JSON.stringify(n))}}catch(i){window.marvel.logger.warn("[Core:ClientStorage] exception invalidating brand cache",{error:i})}}},{key:"discoverDocumentMetadataById",value:function(e){var t=f.a.defer();return v.a.ajax({type:"GET",url:"https://"+window.marvel.settings.ss+"/id/"+e+"/:metadata",headers:{"x-api-key":window.marvel.settings.key}}).then((function(e,r,o){t.resolve(e)})).fail((function(e){t.reject(e)})),O.SparkPerformanceTracker.measurePromise("Storage.discoverDocumentMetadataById(".concat(e,")"),t.promise)}},{key:"invalidateAuthoringContextCache",value:function(e){var t=this;return this._brandsCachePromise?this._brandsCachePromise.then((function(){t._doACCacheInvalidate(e)})):(this._doACCacheInvalidate(e),f.a.resolve())}},{key:"flushLocalAuthoringContext",value:function(e){var t=this;return this.invalidateAuthoringContextCache(e).then((function(){t._authoringContextsLocal[e]&&delete t._authoringContextsLocal[e]}))}},{key:"_handleRemoveAuthoringContext",value:function(e){var t=this;this._authoringContextsLocal[e]&&delete this._authoringContextsLocal[e],this._authoringContextsCache&&this._authoringContextsCache.forEach((function(r,o){r.getURN()===e&&t._authoringContextsCache.splice(o,1)}))}},{key:"_handleInsertAuthoringContext",value:function(e){this._authoringContextsCache&&this._authoringContextsCache.push(e)}},{key:"_handlePushEvent",value:function(e){Object.values(this._foldersLocal).forEach((function(e){return e.getDiscoveryContext().setEtagBundle("")})),this._lastLatest&&(this._lastLatest.etagBundle="")}},{key:"fetchBrandsList",value:function(e,t,r){var o=this,n=window.marvel.features.userData&&window.marvel.features.userData.defaultBrandId,i=t||f.a.defer(),a=r?"&start=".concat(r):"",s="https://".concat(window.marvel.settings.ss,"/assets/").concat("adobe-spark-authoring-contexts","?orderby=modified&order=desc").concat(a),c={headers:{"x-api-key":window.marvel.settings.key}},l={brands:e||[]};return v.a.ajax(s,c).then((function(e){var t=e.children||[],r=t[t.length-1];l.etag=e.etag,l.total_children=e.total_children;var a=t.map((function(e){return Object.assign(e,{isDefault:e.name===n})}));l.brands=l.brands.concat(a),l.brands.length<l.total_children&&r?o.fetchBrandsList(l.brands,i,r.modified):i.resolve(l)})).fail((function(e){404===e.status?(window.marvel.logger.info("[Core:ClientStorage] fetch brands did not find sync group",{error:e}),i.resolve({brands:[],total_children:0,etag:""})):(window.marvel.logger.error("[Core:ClientStorage] error while fetching brands",{error:e}),i.reject(e))})),i.promise}},{key:"getLocalAuthoringContextList",value:function(e){var t=this;if(this._brandsCachePromise)return this._brandsCachePromise;if(this._brandCacheTime&&this._authoringContextsCache&&(new Date).getTime()-this._brandCacheTime<12e4)return f()(this._authoringContextsCache);try{v.a.getProfile().userId,y.a.getUserProperty("defaultBrandId");return O.SparkPerformanceTracker.mark("Storage.getLocalAuthoringContextList"),this._brandsCachePromise=this.fetchBrandsList().then((function(r){var o={},n=[];return r.brands.forEach((function(r){if(o[r.urn]=!0,t._authoringContextsLocal[r.urn])n.push(t._authoringContextsLocal[r.urn].createPromise.then((function(){t._authoringContextsLocal[r.urn].compositeDoc.setCollaboration(r.collaboration)})));else{var i=f.a.defer(),a={info:r,createPromise:i.promise};t._authoringContextsLocal[r.urn]=a,n.push(t.createComposite(a.info.urn,a.info.modified).then((function(t){return a.composite=t,a.compositeDoc=new L.a({name:t.current.name,id:t.assetId,modified:a.info.modified,syncGroupName:"adobe-spark-authoring-contexts",compositeObj:t}),a.compositeDoc.setIsMounted(!0),a.compositeDoc.setCollaboration(a.info.collaboration),a.authoringContext=e(a.compositeDoc,r.isDefault),i.resolve(),!0})).catch((function(e){window.marvel.logger.error("[Core:ClientStorage] exception creating brand composite for cache",{error:e,compositeURN:a.info.urn,compositeModified:a.info.modified}),i.reject(e)})))}})),Object.keys(t._authoringContextsLocal).forEach((function(e){o[e]||delete t._authoringContextsLocal[e]})),O.SparkPerformanceTracker.measure("Storage.getLocalAuthoringContextList:end","Storage.getLocalAuthoringContextList"),f.a.allSettled(n).then((function(e){t._brandsCachePromise=null,t._brandCacheTime=(new Date).getTime();var r=[];return Object.entries(t._authoringContextsLocal).forEach((function(e){var t=k()(e,2),o=t[0],n=t[1];n.authoringContext?r.push(n.authoringContext):window.marvel.logger.warn("[Core:ClientStorage] authoringContext is missing while processing _authoringContextsLocal:acInfo",{urn:o})})),t._authoringContextsCache=r,r}))})),this._brandsCachePromise}catch(r){return window.marvel.logger.error("[Core:ClientStorage] unexpected exception listing brands",{error:r}),f.a.reject(r)}}},{key:"getOrganizerIndexingWorking",value:function(){return this._organizerIndexBackgroundWorking}},{key:"getOrganizerIndexingPromise",value:function(){return this._organizerIndexBackgroundPromise||f.a.resolve()}},{key:"addLocalProject",value:function(e){this._projectsLocal[e.id]=e}},{key:"getLocalProjectById",value:function(e){return this._projectsLocal[e]}},{key:"flushProjectWithId",value:function(e){var t=this._projectsLocal[e];Object.entries(this._foldersLocal).forEach((function(e){var r=k()(e,2),o=(r[0],r[1]);o&&o.getDiscoveryContext().removeProjectLocal(t)})),delete this._projectsLocal[e]}},{key:"getLocalFolderById",value:function(e){return this._foldersLocal[e]}},{key:"flushFolderWithId",value:function(e){var t=this._foldersLocal[e];Object.entries(this._foldersLocal).forEach((function(e){var r=k()(e,2),o=(r[0],r[1]);o&&o.getDiscoveryContext().removeFolderLocal(t)})),delete this._foldersLocal[e]}},{key:"folderFactory",value:function(e,t){var r;if(e.discoverySpec)r=e.discoverySpec.getFolderId();else{if(!e.id)throw new Error("Unkown folder model factory ",e);r=e.id}var o=this._foldersLocal[r];return o?e.discoverySpec&&o.setSpec(e.discoverySpec):(o=new E.a(e,this._controller),this._foldersLocal[o.id]=o),t&&(o.parentFolder=t),P()(o.name)&&"root"!==o.id&&(o.name=e.name),o}},{key:"loadFolder",value:function(e){var t=this,r=this.folderFactory({discoverySpec:e});if(!this._folderPromises[e.getKey()]){var o=r.getDiscoveryContext();this._folderPromises[e.getKey()]=this.loadMoreProjects(o).then((function(){if(r.name=o.folderName,"root"!==e.getFolderId()&&!r.parentFolder){if(!o.folderParentId)throw new Error("SparkStorageLoader requires parentFolderId to load folder");var n=t.folderFactory({name:o.folderParentName,discoverySpec:new T.a({filter:null,incomingCollabOnly:"none",sort:null,sortDirection:null,folderId:o.folderParentId})});r.parentFolder=n}return r}))}return this._folderPromises[e.getKey()]}},{key:"projectFactory",value:function(e){var t=new M.a(e,this._controller);return this._projectsLocal[e.id]=t,e.parentFolder&&e.parentFolder.getDiscoveryContext().addProjectLocal(t),t}},{key:"_reportEtagAnalytics",value:function(e,t,r){this._lastRequest=this._lastRequest||{};var o=this._lastRequest[e],n={context:e,category:"?",reqCount:o?o.reqCount+1:1},i=r&&r.etagBundle;if(r)if(r.noChanges)i=o&&o.etagBundle,n.category=r.optimized?"matched-on-server-optimized":"matched-on-server";else if(""===t)n.category="cache-invalidated";else if(o&&o.etagBundle&&t)if(r.etagBundle){var a=o.etagBundle.split("|"),s=r.etagBundle.split("|");if(a.length!==s.length)n.category="length-mismatch",n.len1=a.length,n.len2=s.length;else{var c=[];a.forEach((function(e,t){e!==s[t]&&c.push(t)})),0===c.length?n.category="match":(n.category="mismatch",n.indices=c.join(" "))}}else n.category="no-new";else n.category=i?"no-prev":"no-prev-or-new";else n.category="no-response";this._lastRequest[e]={etagBundle:i,reqCount:n.reqCount},window.marvel.logger.info("[Core:Folders] etagBundle",n)}},{key:"getLatestProjects",value:function(e){var t=this,r=4;e>0&&(r=Math.min(e,8));var o="/sp-storage/flat/root/all/all/modified/desc/";return this._lastLatest&&this._lastLatest.etagBundle&&(o="".concat(o,"?etagBundle=").concat(this._lastLatest.etagBundle)),w.a.authFetchJSON({uri:o}).then((function(e){var o;if(t._reportEtagAnalytics("getLatestProjects",t._lastLatest&&t._lastLatest.etagBundle,e),e.noChanges)o=t._lastLatest.projects;else{o=e.folderProjects;var n=e.etagBundle;t._lastLatest=n?{etagBundle:n,projects:o}:null}return o.slice(0,r).map((function(e){var r=t._projectsLocal[e.id];return r?r.thumbnail!==e.thumbnail&&(r.thumbnail=e.thumbnail):r=t.projectFactory(e),r}))}))}},{key:"refreshOrganizer",value:function(e){var t=this;return _.a.load().then((function(r){return r.ACPSparkController.discoverFolder(e).then((function(o){return r.ActionController.execAction({title:"Refresh organizer",do:function(n){if(!r.ACPSparkController.isSpecCurrent(e.getKey()))return f.a.resolve();var i=o.getDiscoveryContext(),a=i.getEtagBundle(),s=Math.max(i.projectsDesired||i.projectsFetchedCount,i.projects.length),c=e.getBasePath();y.a.hasFeature("enable-odb")||(c="flat");var l="/sp-storage/"+c+"/"+e.getFolderId()+"/"+e.getFilter()+"/"+e.getIncomingCollabOnly()+"/"+e.getSort()+"/"+e.getSortDirection()+"?stopCount="+s+"&etagBundle="+a;return w.a.authFetchJSON({uri:l}).then((function(n){if(t._reportEtagAnalytics("refreshOrganizer",a,n),!r.ACPSparkController.isSpecCurrent(e.getKey()))return f.a.resolve();if(!t._organizerIndexBackgroundWorking&&(n.rebuildIndexRequired||n.moreIndexingRequired))return t._handleOdbIndexingBackground(n.rebuildIndexRequired,i).then((function(){return t.refreshOrganizer(e)}));if(n.noChanges)return f.a.resolve();i.setEtagBundle(n.etagBundle);var s={},c={added:[],updated:[],removed:[]};n.folderProjects.forEach((function(e){var r=t._projectsLocal[e.id];s[e.id]=!0,r?r.refreshInfo(e)&&c.updated.push(r):(e.parentFolder=o,r=t.projectFactory(e),c.added.push(r))})),Object.entries(t._projectsLocal).forEach((function(e){var r=k()(e,2),n=r[0],i=r[1];i.parentFolder&&i.parentFolder.id===o.id&&(s[i.id]||(t.flushProjectWithId(n),c.removed.push(i)))})),i.totalProjects=n.totalProjects,c.removed.length&&i.setSgLastTimestampMap(n.sgLastTimestampMap),(c.added.length||c.removed.length||c.updated.length)&&(o.getDiscoveryContext().sortProjects(),window.marvel.events.trigger("odb-projects-changed",c),window.marvel.events.trigger("organizer-reload-datasource"));var l={added:[],removed:[],updated:[]},d={};return n.folders&&n.folders.forEach((function(e){d[e.id]=!0;var r=t._foldersLocal[e.id];r?r.refreshInfo(e)&&l.updated.push(r):(r=t.folderFactory(e,o),i.addFolderLocal(r),l.added.push(r))})),Object.entries(t._foldersLocal).forEach((function(e){var r=k()(e,2),n=r[0],i=r[1];i&&!d[n]&&"root"!==n&&o.id===i.parentFolder.id&&(t.flushFolderWithId(n),l.removed.push(i))})),(l.added.length||l.removed.length||l.updated.length)&&(window.marvel.events.trigger("odb-folders-changed",l),window.marvel.events.trigger("organizer-reload-datasource")),f.a.resolve()}))}})}))}))}},{key:"loadMoreProjects",value:function(e,t,r,o){var n=this;if(this._organizerIndexBackgroundWorking)return window.marvel.logger.info("[Core:Folders] loadMoreProjects while indexing a large account"),this._organizerIndexBackgroundPromise;var i=e.getSpec(),a=i.getBasePath();y.a.hasFeature("enable-odb")||(a="flat");var s="";if(e instanceof A.a){var c=e.getSgLastTimestampMap();s=this._getTimestampQueryParams(c)}"flat"===a||P()(t)||(s=this._getTimestampQueryParams(t)+"&processingMore=true");var l="/sp-storage/"+a+"/"+i.getFolderId()+"/"+i.getFilter()+"/"+i.getIncomingCollabOnly()+"/"+i.getSort()+"/"+i.getSortDirection()+"/"+e.getPagingToken()+s;return w.a.authFetchJSON({uri:l}).then((function(t){return n._reportEtagAnalytics("loadMoreProjects",null,t),n._initWithJSON(t,e,r||"loadMoreProjects",o)}))}},{key:"_getTimestampQueryParams",value:function(e){var t=e?Object.keys(e):[],r="";return t.forEach((function(t){r+="&".concat(t,"=").concat(e[t])})),r.replace("&","?")}},{key:"_rerequestPreloader",value:function(){return v.a.requiresAuth().then((function(){var e=document.createElement("script");e.type="text/javascript",e.src="/sp-storage/organizer?u="+String(Math.round(1e3*Math.random())),document.getElementsByTagName("head")[0].appendChild(e)})).catch((function(e){window.marvel.logger.error("[Client:Storage] unexpected error awaiting auth before reloading preloader",e)}))}},{key:"_initWithPreloader",value:function(){var e=window._sgPreload||{};return e.folderProjects&&e.incomingCollabOnly&&(h()(e.folderProjects,(function(e){e.name=decodeURIComponent(e.name)})),e.incomingCollabOnly=decodeURIComponent(e.incomingCollabOnly)),this._initWithJSON(e,null,"preloader")}},{key:"_processAuthoringContextData",value:function(e){if(e.brands){if(window.localStorage){var t=v.a.getProfile().userId,r=JSON.parse(window.localStorage.getItem(t+"aclistcache2")||"{}");r&&r.etag&&r.etag===e.brandsEtag||(r.cacheTime=(new Date).getTime(),r.etag=e.brandsEtag,r.brands=e.brands,r.brandsToRetry=e.brandsToRetry,window.localStorage.setItem(t+"aclistcache2",JSON.stringify(r)))}}}},{key:"_initWithJSON",value:function(e,t,r,o){var n,i=this,a=t,s=o||[];if(e.noChanges)return f.a.resolve();if(this._processAuthoringContextData(e),void 0===e.folderProjects)return this._controller.setAllProjectsCount(e.allProjectsCount||0),this._controller.setSgProjectsCount(e.sgCounts||{}),f.a.resolve();if(a)n=this.folderFactory({discoverySpec:a.getSpec()});else{var c=new T.a({folderId:e.folderId||"root",incomingCollabOnly:e.incomingCollabOnly||"none",filter:e.filter||"all",sort:e.sort||"modified",sortDirection:e.sortDirection||"desc",useFlatApi:!1===e.foldersEnabled||e.useFlat});n=this.folderFactory({discoverySpec:c}),a=n.getDiscoveryContext(),this._folderPromises[c.getKey()]=f.a.resolve(n)}if(!this._organizerIndexBackgroundWorking&&(e.rebuildIndexRequired||e.moreIndexingRequired))return window.marvel.logger.info("[Core:Folders] initiate indexing in the background"),this._handleOdbIndexingBackground(e.rebuildIndexRequired,a).then((function(){return i.loadMoreProjects(a)}));var l="".concat(e.folderId).concat(e.filter).concat(e.incomingCollabOnly).concat(e.sort).concat(e.sortDirection);if("preloader"!==r&&this._currentSpecKey!==l)return f.a.resolve();if(a.folderName=e.folderName,a.folderParentId=e.folderParentId,a.folderParentName=e.folderParentName,a.projectsFetchedCount=e.projectsFetchedCount,a.firstTimeODBUser=e.firstTimeODBUser,a.indexCompletion=e.indexCompletion,a.projectsInAnyFolderTotal=e.projectsInAnyFolderTotal,a.hasMore=e.hasMore,a.setEtagBundle(e.etagBundle),s=s.concat(e.folderProjects),"preloader"!==r&&e.needsMoreProcessing){var d=Object.assign({},e.sgLastTimestampMap,e.moreSgTimeStamp);return window.marvel.logger.info("[Core:Folders] storage result needs more processing, loading more projects",{moreSgTimeStamp:e.moreSgTimeStamp,mergedTimestamps:d,initContext:r,discoveryCtxt:t,projectsWorkingList:s}),this.loadMoreProjects(a,d,"moreProcessing",s)}s.forEach((function(e,t){var r;e.parentFolder=n,i._projectsLocal[e.id]&&(r=i._projectsLocal[e.id]).refreshInfo(e),r?a.addProjectLocal(r):r=i.projectFactory(e)}));var u={};h()(this._projectsLocal,(function(e){u[e._sg]=e.contentModified})),a.totalProjects=e.totalProjects,a.setSgLastTimestampMap(u),this._controller.setAllProjectsCount(e.allProjectsCount),this._controller.setSgProjectsCount(e.sgCounts);var g=e.folders||[];return g.forEach((function(e){var t=i.folderFactory(e,n);a.addFolderLocal(t)})),a.totalFolders=g.length,e.breadCrumbs instanceof Array&&(a.breadCrumbs=e.breadCrumbs),a.sortProjects(),f.a.resolve()}},{key:"_handleOdbIndexingBackground",value:function(e,t){var r=this;if(this._organizerIndexBackgroundWorking)return window.marvel.logger.warn("[Core:Folders] unexpected duplicate request to index in the background",{stack:(new Error).stack}),this._organizerIndexBackgroundPromise||f.a.resolve();this._organizerIndexBackgroundWorking=!0;var o="pageIndex";e&&(o="rebuildIndex");var n=_.a.load().then((function(e){return e.ACPSparkController.organizerIndexNext(o).then((function(e){return r._organizerIndexBackgroundWorking=!1,e.indexCompletion<1&&e.indexProcessedCount>0?(window.marvel.logger.info("[Core:Folders] handleOdbIndexingBackground continues "+e.indexCompletion,e),r._handleOdbIndexingBackground(e.rebuildIndexRequired,t)):(window.marvel.logger.info("[Core:Folders] handleOdbIndexingBackground indexing complete",e),r._organizerIndexBackgroundPromise=null,f.a.resolve())}))})).catch((function(e){r._organizerIndexBackgroundWorking=!1,r._organizerIndexBackgroundPromise=null,window.marvel.logger.error("[Core:Folders] handleOdbIndexingBackground failed.",e)}));return this._organizerIndexBackgroundPromise||(this._organizerIndexBackgroundPromise=n),n}},{key:"_detach",value:function(){this._attachDefer=null,window.marvel.events.off("sg-preload-ready",this._handlePreloaderReadyEvent)}},{key:"_handlePreloaderReadyEvent",value:function(){var e=this;window._sgPreloadUnauth&&!window._sgPreloaderUnauthRetry?(window._sgPreloaderUnauthRetry=!0,window._sgPreloadUnauth=!1,this._rerequestPreloader()):this._initWithPreloader().then((function(){e._attachDefer.resolve()}),(function(t){e._attachDefer.reject(t)}))}},{key:"_handleProjectCollabChange",value:function(e){var t=e.composite,r=e.collab,o=this._projectsLocal[t.id];if(o){var n=o.getCollaboration();0===r.collaborators.length?o.setCollaboration(void 0):n||o.setCollaboration("OUTGOING")}}},{key:"attach",value:function(e){var t=this;return this._controller=e,this._attachDefer||(this._attachDefer=f.a.defer(),O.SparkPerformanceTracker.measurePromise("StorageLoader.attach",this._attachDefer.promise),window._sgPreloadUnauth&&(window._sgPreloadUnauth=!1,this._rerequestPreloader()),window._sgPreload?this._initWithPreloader().then((function(){t._attachDefer.resolve()}),(function(e){t._attachDefer.reject(e)})):window.marvel.events.on("sg-preload-ready",this._handlePreloaderReadyEvent)),this._attachDefer.promise}},{key:"setCurrentSpec",value:function(e){this._currentSpecKey=e.getKey()}}]),e}()),R=new(function(){function e(){c()(this,e),this._onSyncModeSet=this._onSyncModeSet.bind(this),this._onSyncTimer=this._onSyncTimer.bind(this),this._handleStorageSyncNow=this._handleStorageSyncNow.bind(this)}var t;return d()(e,[{key:"_handleSparkAssetUpdated",value:(t=a()(n.a.mark((function e(t,r){var o,i,a,s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=this.getLocalProjectById(t.get("id")))){e.next=5;break}o.name=t.get("name"),e.next=17;break;case 5:if(i=this.getCurrentFolder(),!(a=r&&r.hostInfo?r.hostInfo.appName:null)||!i||"root"!==i.id){e.next=16;break}if(!(s=i.getDiscoveryContext().folders.find((function(e){return e.name===a})))){e.next=13;break}i=s,e.next=16;break;case 13:return e.next=15,this.createFolder(a,i);case 15:i=e.sent;case 16:this.createProject(t,i).then((function(e){}));case 17:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"attach",value:function(){return this._isListening||(this._isListening=!0,window.marvel.events.on("set-sync-mode",this._onSyncModeSet),window.marvel.events.on("storage-sync-now",this._handleStorageSyncNow),this._handleSparkAssetUpdated=this._handleSparkAssetUpdated.bind(this),window.marvel.events.on("folder-document-updated",this._handleSparkAssetUpdated)),B.attach(this)}},{key:"_detach",value:function(){this._isListening&&(this._isListening=!1,this._syncInProgressKey=null,this._syncTimer=null,this._syncInProgress=null,this._currentFolderSpec=null,window.marvel.events.off("set-sync-mode",this._onSyncModeSet))}},{key:"isSpecCurrent",value:function(e){return e&&this._currentFolderSpec&&e===this._currentFolderSpec.getKey()}},{key:"_handleStorageSyncNow",value:function(){this._clearSyncTimer(),this._onSyncTimer()}},{key:"_onSyncTimer",value:function(e){var t=this,r=e||0;if(!this.isSpecCurrent(this._syncInProgressKey)){this._currentFolderSpec||(this._currentFolderSpec=new T.a);var o=this._currentFolderSpec.getKey();this._syncInProgressKey=o,this._syncInProgress=B.refreshOrganizer(this._currentFolderSpec).then((function(){t.isSpecCurrent(o)&&(t._syncInProgressKey=null,t._syncTimer=null,t._setSyncTimer())}),(function(e){t._syncInProgressKey=null;var o=0;r>1&&(o=500*Math.pow(2,r)),o>3e5?(window.marvel.logger.error("[Core:Folders] ACPSparkController abandoning refresh after "+r+" attempts, notifying user"),window.marvel.events.trigger("service-borked")):window.setTimeout((function(){t._onSyncTimer(r+1)}),o)})).done()}}},{key:"_setSyncTimer",value:function(){this._syncTimer||(this._syncTimer=window.setTimeout(this._onSyncTimer,12e4))}},{key:"_clearSyncTimer",value:function(){this._syncTimer&&(window.clearTimeout(this._syncTimer),this._syncTimer=null)}},{key:"isEditorOpen",value:function(){return"sync-editor"===this._syncMode}},{key:"_onSyncModeSet",value:function(e){e&&("sync-group"===e.mode&&"sync-group"!==this._syncMode&&(this._clearSyncTimer(),e.folderSpec&&(this._currentFolderSpec=e.folderSpec),this._onSyncTimer(),"sync-home"!==this._syncMode&&window.marvel.events.trigger("left-editing-session",{})),"sync-home"===e.mode?("sync-editor"===this._syncMode&&this._onSyncTimer(),this._clearSyncTimer(),e.previousFolderCallback&&e.previousFolderCallback(this._currentFolderSpec),e.folderSpec&&(this._currentFolderSpec=e.folderSpec)):"sync-group"===e.mode?(e.folderSpec&&(this._currentFolderSpec&&this._currentFolderSpec.getKey()===e.folderSpec.getKey()||this._clearSyncTimer(),this._currentFolderSpec=e.folderSpec),this._setSyncTimer()):"sync-editor"!==e.mode&&"sync-disabled"!==e.mode||this._clearSyncTimer(),this._syncMode=e.mode)}},{key:"_resetODB",value:function(){v.a.getAccessToken().then((function(e){window.fetch("/sp-storage/folders",{method:"DELETE",headers:new window.Headers({"x-access-token":e})}).then((function(e){marvel.navigate("/",{trigger:!0}),window.location.reload()})).catch((function(e){window.marvel.logger.warn("[Core:Folders] ACPSparkController failed to reset ODB",e)}))}))}},{key:"getCurrentFolder",value:function(){return this._currentFolderSpec?this.getLocalFolderById(this._currentFolderSpec.getFolderId()):null}},{key:"getLocalFolderById",value:function(e){return B.getLocalFolderById(e)}},{key:"getLocalProjectById",value:function(e){return B.getLocalProjectById(e)}},{key:"discoverFolder",value:function(e){return B.setCurrentSpec(e),B.attach(this).then((function(){return B.loadFolder(e)}))}},{key:"getLatestProjects",value:function(e){return B.attach(this).then((function(){return B.getLatestProjects(e)}))}},{key:"loadMoreProjects",value:function(e){return B.loadMoreProjects(e)}},{key:"getCompositeDocWithMetadata",value:function(e,t){return B.getCompositeDocWithMetadata(e,t)}},{key:"createFolderLocal",value:function(e,t){var r=t.getDiscoveryContext(),o=B.folderFactory(e,t);return r.addFolderLocal(o),o}},{key:"deleteFolderLocal",value:function(e){e.parentFolder.getDiscoveryContext().removeFolderLocal(e)}},{key:"createFolder",value:function(e,t){var r=this;return _.a.load().then((function(o){return o.ActionController.execAction({title:"Create Folder: "+e,do:function(o){return w.a.authFetchJSON({method:"POST",uri:"/sp-storage/folders",body:{parentFolderId:t.id,name:e}}).then((function(o){var n=r.createFolderLocal({id:o.id,name:e},t);return window.marvel.events.trigger("odb-folders-changed",{added:[n]}),window.marvel.logger.info('[Core:Folders] Created new folder "'+e+'" in folder id: '+t.id),n}))},retry:function(r,o){return window.marvel.logger.warn('[Core:Folders] Retrying to create new folder "'+e+'" in folder id: '+t.id),r.retryConflicts(o,1)}})}))}},{key:"deleteSubfolder",value:function(e,t){return _.a.load().then((function(r){return r.ActionController.execAction({title:"Delete Folder",do:function(r){return B.flushFolderWithId(t),window.marvel.logger.info("[Core:Folders] Deleting folder id: "+t+" from folder id: "+e.id),w.a.authFetch({method:"DELETE",uri:"/sp-storage/folders/"+e.id+"/"+t})},retry:function(r,o){return window.marvel.logger.warn("[Core:Folders] Retrying to delete folder id: "+t+" from folder id: "+e.id),r.retryConflicts(o,1)}})}))}},{key:"renameFolder",value:function(e,t){var r=e.name;return e.setName(t),_.a.load().then((function(o){return o.ActionController.execAction({title:"Rename folder to "+t,do:function(o){return w.a.authFetchJSON({method:"POST",uri:"/sp-storage/patch-folder/"+e.id,body:{name:t}}).then((function(o){window.marvel.logger.info("[Core:Folders] Folder "+e.id+' renamed from "'+r+'" to "'+t+'"')})).catch((function(t){e.setName(r),window.marvel.logger.warn("[Core:Folders] ACPSparkController failed to rename folder",t)}))},retry:function(o,n){return window.marvel.logger.warn("[Core:Folders] Retrying to rename folder id: "+e.id+' from "'+r+'" to "'+t+'"'),o.retryConflicts(n,1)}})}))}},{key:"removeProjectFromParentFolder",value:function(e){var t=e.parentFolder,r=t.name||"ROOT",o=[];return e.id?(o.push(e.id),_.a.load().then((function(n){return n.ActionController.execAction({title:"Remove project "+e.name+" from "+r,do:function(n){return w.a.authFetchJSON({method:"POST",uri:"/sp-storage/patch-folder-remove/"+t.id,body:{projects:o}}).then((function(o){window.marvel.logger.info("[Core:Folders] Removed project "+e.name+" from "+r),t.getDiscoveryContext().removeProjectLocal(e)}))},retry:function(t,o){return window.marvel.logger.warn("[Core:Folders] Retrying to remove project "+e.name+" from "+r),t.retryConflicts(o,1)}})}))):(window.marvl.logger.warn("[Core:Folders] removeProjectFromParentFolder received invalid object."),f.a.reject())}},{key:"removeProjectFromMetaParentFolder",value:function(e){var t=e.metaFolder,r=t&&t.name||"ROOT",o=t&&t.id||"root",n=[];return e.id?(n.push(e.id),_.a.load().then((function(t){return t.ActionController.execAction({title:"Remove project "+e.name+" from "+r,do:function(t){return w.a.authFetchJSON({method:"POST",uri:"/sp-storage/patch-folder-remove/"+o,body:{projects:n}}).then((function(t){window.marvel.logger.info("[Core:Folders] Removed project "+e.name+" via meta from "+r)}))},retry:function(t,o){return window.marvel.logger.warn("[Core:Folders] Retrying to remove project "+e.name+" via meta from "+r),t.retryConflicts(o,1)}})}))):(window.marvl.logger.warn("[Core:Folders] removeProjectFromMetaParentFolder received invalid object."),f.a.reject())}},{key:"deleteProjectLocal",value:function(e){e.parentFolder.getDiscoveryContext().removeProjectLocal(e)}},{key:"createProject",value:function(e,t,r){var o=this,n=[e.getMyPrimaryApp().isBranded(e),e.getURN(),e.getImageRendition()];return f.a.allSettled(n).spread((function(n,i,a){var s=B.projectFactory({id:e.id,assetId:i.value,parentFolder:t,metaFolder:r,name:e.getProjectName(),type:e.getDCXComposite().type,modified:e.getContentModifiedDate().toISOString(),thumbnail:a.value||"",eTag:e.getContentModEtag(),isPublished:e.isPublished(),collaboration:e.getCollaboration(),isBranded:n.value,ccpath:e.getStoragePath()});return t&&"root"===t.id?(t.getDiscoveryContext().addProjectLocal(s,!0),s):t?o.move([s],t).then((function(){return s})):s}))}},{key:"_applyMovesToModel",value:function(e,t){h()(e,(function(e){e instanceof E.a?(e.parentFolder&&e.parentFolder.getDiscoveryContext().removeFolderLocal(e),t.getDiscoveryContext().addFolderLocal(e)):(e.parentFolder&&e.parentFolder.getDiscoveryContext().removeProjectLocal(e),t.getDiscoveryContext().addProjectLocal(e,!0)),e.parentFolder=t,e.metaFolder={id:t.id,name:"root"!==t.id&&t.name||null}}))}},{key:"move",value:function(e,t){var r=this;return _.a.load().then((function(o){return o.ActionController.execAction({title:"Move item(s)",do:function(o){var n=[];return e.forEach((function(e){var r={};e.parentFolder?r.oldFolderId=e.parentFolder.id:r.oldFolderId="root",r.newFolderId=t.id,e instanceof E.a?r.folderId=e.id:r.projectId=e.id,n.push(r)})),w.a.authFetchJSON({method:"POST",uri:"/sp-storage/patch-folders",body:{updates:n}}).then((function(){r._applyMovesToModel(e,t);var o=t.name||"Root";return window.marvel.logger.info("[Core:Folders] Moved "+e.length+" project(s) to "+o),t}))},retry:function(r,o){return!(o&&String(o).indexOf("errorCode:412")>=0)&&(window.marvel.logger.warn("[Core:Folders] Retrying to move "+e.length+' items to folder "'+t.name+'"'),r.retryConflicts(o,1))}})}))}},{key:"reset",value:function(){B.reset()}},{key:"getCompositeDoc",value:function(e){return B.getCompositeDoc(e)}},{key:"addCompositeDocLocal",value:function(e,t){return B.addCompositeDocLocal(e,t)}},{key:"organizerIndexNext",value:function(e){var t,r;switch(e){case"rebuildIndex":r=!0;break;case"pageIndex":t=!0;break;default:window.marvel.logger.error("[Core:Folders] Unsupported indexMode "+e)}return _.a.load().then((function(e){var o={usePageToken:t,forceRebuild:r};return w.a.authFetchJSON({method:"POST",uri:"/sp-storage/index",body:{params:o}}).then((function(e){return window.marvel.logger.info("[Core:Folders] ODB Index Next request completed",e),e}))}))}},{key:"listAuthoringContexts",value:function(e,t){return this.attach().then((function(){return B.getLocalAuthoringContextList(e).then((function(e){return e}))}))}},{key:"setAllProjectsCount",value:function(e){this._allProjectsCountDefer&&(this._allProjectsCountDefer.resolve(e),this._allProjectsCountDefer=null),this._allProjectsCount=e}},{key:"getAllProjectsCount",value:function(){return this._allProjectsCountDefer||void 0!==this._allProjectsCount?f.a.resolve(this._allProjectsCount):(this._allProjectsCountDefer=f.a.defer(),this._allProjectsCountDefer.promise)}},{key:"getSgProjectsCount",value:function(){return this._sgProjectsCountDefer||void 0!==this._sgProjectsCount?f.a.resolve(this._sgProjectsCount):(this._sgProjectsCountDefer=f.a.defer(),this._sgProjectsCountDefer.promise)}},{key:"setSgProjectsCount",value:function(e){this._sgProjectsCountDefer&&(this._sgProjectsCountDefer.resolve(e),this._sgProjectsCountDefer=null),this._sgProjectsCount=e}},{key:"isOrganizerIndexing",value:function(){return B.getOrganizerIndexingWorking()}},{key:"getOrganizerIndexingPromise",value:function(){return B.getOrganizerIndexingPromise()}}]),e}()),N=function(){function e(t){c()(this,e),this.title=t.title,this.fnDo=t.do,this.fnRetry=t.retry,this.defer=f.a.defer(),this._tried=0}return d()(e,[{key:"do",value:function(){return this._tried++,this.fnDo(this)}},{key:"retry",value:function(e){return!!this.fnRetry&&this.fnRetry(this,e)}},{key:"retryDelay",value:function(){var e=this._tried-1;return e>0?500*Math.pow(e,2):0}},{key:"retryConflicts",value:function(e,t){return!!(e&&String(e).indexOf("errorCode:409")>=0&&this._tried<=t)}}]),e}();N.COMPONENT_NAME="spark-action";var z=N,U=function(){function e(){c()(this,e),this._actionQueue=[],this._currentIndex=0,this._actionOutstanding=null}return d()(e,[{key:"busy",value:function(){return!!this._actionOutstanding}},{key:"_nextAction",value:function(){this._actionOutstanding=null,this._currentIndex++,this._action()}},{key:"_handleOnlineError",value:function(e){var t=this;this._actionOutstanding.retry(e)?window.setTimeout((function(){window.marvel.logger.debug("retrying action "+t._actionOutstanding.title),t._actionOutstanding=null,t._action()}),this._actionOutstanding.retryDelay()):(this._actionOutstanding.defer.reject(e),this._nextAction())}},{key:"_action",value:function(){var e=this;!this._actionOutstanding&&this._actionQueue[this._currentIndex]&&(this._actionOutstanding=this._actionQueue[this._currentIndex],this._actionOutstanding.do().then((function(t){e._actionOutstanding.defer.resolve(t),e._nextAction()}),(function(t){v.a.checkIsOffline().then((function(r){r?window.marvel.logger.warn("suspending action processing due to being offline"):e._handleOnlineError(t)}))})).done())}},{key:"execAction",value:function(e){var t=new z(e);return this._actionQueue[this._actionQueue.length]=t,this._action(),t.defer.promise}}]),e}();U.COMPONENT_NAME="action-controller";var W=U;R.attach();t.default={ACPSparkController:R,ActionController:new W,SparkFolderDiscoverySpec:T.a,SparkStorageLoader:B}}}]);
//# sourceMappingURL=spark-core-wraper-53229515.js.map