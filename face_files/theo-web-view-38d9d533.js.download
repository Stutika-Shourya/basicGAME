(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[28],{"B/1X":function(e,t,o){},Yzgm:function(e,t,o){var n,i;n=[o("YLtl"),o("UFvF"),o("hcqx"),o("7mGH"),o("bgEM"),o("MGCh"),o("bBG2")],void 0===(i=function(e,t,n,i,r,s,a){const d=s.channel("theo-publish-impl"),p=a.default,{getPostController:c}=r;return new function(){this.community=window.marvel.settings.theoc,this.communityCategory="theos",this.previewPath="preview.jpg";const r=this;let s=0;this.doPublish=function(e,o,n){r.sendPublishProgress(5);const i=c();return t(i.getDownloadImageBlobPromise(e,"image/jpeg")).then(e=>(r.sendPublishProgress(15),"function"==typeof e.arrayBuffer?e.arrayBuffer():new t.Promise((t,o)=>{const n=new FileReader;n.addEventListener("load",()=>{t(n.result)}),n.addEventListener("error",()=>{o(n.error)}),n.readAsArrayBuffer(e)}))).then(t=>{r.sendPublishProgress(20);const o={};o["preview.jpg"]={content:new Uint8Array(t),contentType:"image/jpeg"};const n=e.getDCXComposite(),i={"manifest-format-version":6,name:n.name,type:n.type,state:"unmodified",id:n.id,components:[{id:"preview",type:"image/jpeg",rel:"rendition",name:"preview.jpg",path:"preview.jpg",state:"unmodified",length:t.length}]};return o.manifest={raw:i,content:JSON.stringify(i),contentType:"application/vnd.adobe.dcx-manifest+json"},r.sendPublishProgress(30),o})},this.resourceUploadReport=function(e,t,o){if(d.info(`uploaded ${t} version ${o.version}`),"preview.jpg"===t){const t=e.manifest.raw;t.components[0].etag=o.etag,t.components[0].version=o.version,e.manifest.content=JSON.stringify(t),r.sendPublishProgress(75)}else"manifest"===t?r.sendPublishProgress(90):d.error("got unexpected upload report for "+t)},this.reviseDoPublishAfterFilesUpdate=function(o,n){const i=o.manifest.raw,r={};e.each(n,(function(e){e.track_version&&""!==e.version&&(r[e.destination]=e.version)})),e.each(i.components,(function(t){e.isUndefined(r[t.path])||(t.version=r[t.path])}));return c().hasAnimationStyle()&&this.videoPubInfo&&i.components.push({id:"videoRendition",type:"video/mp4",rel:"rendition",name:"videoRendition",path:"videoRendition.mp4",state:"unmodified",height:this.videoPubInfo.height,width:this.videoPubInfo.width,length:this.videoPubInfo.videoLength,etag:this.videoPubInfo.video_resource_data.etag,version:this.videoPubInfo.video_resource_data.version}),o.manifest.content=JSON.stringify(i),t.resolve(o)},this.getUseProgressEvents=function(){return!0},this.trigger=function(e,t){"progress"===e&&this.videoProgress?(this.videoProgress.copyPct=t,this.sendVideoAndCopyProgress()):n.Model.prototype.trigger.apply(this,arguments)},this.updateSnapiProgress=function(e,t,o){"progress"===e&&this.videoProgress&&o===this.videoProgress.progressId&&(this.videoProgress.videoPct=t,this.sendVideoAndCopyProgress())},this.sendVideoAndCopyProgress=function(){this.sendPublishProgress(s)},this.sendPublishProgress=function(e){s=e;let t=s;const o=c();if(o.webAnimationEnabled()&&o.hasAnimationStyle()){let e=0;this.videoProgress&&(e=this.videoProgress.videoPct+this.videoProgress.copyPct),t=Math.ceil((s+e)/2)}n.Model.prototype.trigger.apply(this,["progress",t])},this.getFilesDataToCopyFromServerData=function(e,n,i){const r=n.getDCXComposite().current,s=[],a=e.id;if(this.videoProgress=null,i.showAvatar&&""!==i.authorAvatarUrl){const e=r.getComponentWithAbsolutePath(n.getMyApp().getStorageImpl().avatarComponentPath);e&&s.push({source:a+"/"+e.id,content_type:e.type,destination:e.path})}const u=c();if(u.webAnimationEnabled()&&u.hasAnimationStyle()){const e=n.getMyApp().getStorageImpl().currentDoc.id,r=n.getMyApp().getCPProjectId(n);let a=null;try{a=u.getPgmGraphForPublish()}catch(e){return d.error("PGM graph error: "+e),t.resolve(s)}const c=o("1geK").default;var l=c.getPublishRequestBody(i);l.pgmGraph=a.encode();var h=a.bounds.aspectRatio,g=h<1?1280:Math.round(1280/h),m=h<1?Math.round(1280*h):1280;l.renderOptions={videoHeight:g,videoWidth:m,scaleType:0};var v={},f={files:s,additionalCopyDefer:t.defer()};this.videoProgress={videoPct:0,copyPct:0,progressId:e};var w=new Date;return p.publish("publish:mp4:started",{projectId:e}),c.sendPgmPublishRequestForUpload(e,r,l,v,this.updateSnapiProgress.bind(this)).then(function(t){p.publish("publish:mp4:succeeded",{projectId:e,requestId:v.value,timeSpent:new Date-w+"ms"}),this.videoPubInfo=t,this.updateSnapiProgress("progress",100,e),f.additionalCopyDefer.resolve(t)}.bind(this)).catch((function(t){p.publish("publish:mp4:failed",{projectId:e,requestId:v.value,timeSpent:new Date-w+"ms",error:JSON.stringify(t,null,2)}),f.additionalCopyDefer.reject(t)})),t.resolve(f)}return this.videoPubInfo=null,t.resolve(s)},this.getData=function(e,t){if(!t)return void console.error("no doc for getData");let o=t.getMyApp().getStorageImpl().getData(e,t,"shareData");if(void 0===o){const t=c();"publishTitle"===e?o=t.getCurrentDocumentSynthesizedName():"description"===e&&(o=t.getCurrentDocumentDescription())}return o},this.setData=function(e,t,o){if(!o)return void console.error("no doc for setData");return o.getMyApp().getStorageImpl().setData(e,t,o,"shareData")},this.getDocumentCredits=function(e){return""},this.getDocumentDefaultCredits=function(e){return""},this.getDownloadUrl=function(e){const o=t.defer(),n=i.hasFeature("post-download-zip-of-pngs")?"application/zip":"image/jpeg",r=this.getDownloadFileName(e);return c().getDownloadImageBlobPromise(e,n).then((function(e){o.resolve((function(){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(e,r);else{const t=window.URL.createObjectURL(e),o=document.createElement("a");document.body.appendChild(o),o.setAttribute("href",t),o.setAttribute("download",r),o.click(),window.URL.revokeObjectURL(t),document.body.removeChild(o)}}))})),o.promise},this.getDownloadFileName=function(e){return e.getProjectName()+(i.hasFeature("post-download-zip-of-pngs")?".zip":".jpg")},this.augmentMetaData=function(t){const o=c();t.custom=e.merge(t.custom||{},o.getDocumentSize()),e.assign(t,{description:o.getCurrentDocumentDescription()}),e.assign(t,{machine_tags:o.getRemixAncestorsIntoMachineTags(t.machine_tags)})},this.getPublishingSetup=function(){return{supportsDownload:!1,publishingSavesData:!1,assetType:"application/vnd.adobe.theo.document+dcx",supportedFields:["publishTitle","authorFull","showAuthor","authorAvatarUrl","isPublic","category"]}}}}.apply(t,n))||(e.exports=i)},etvg:function(e,t,o){var n=o("LboF"),i=o("B/1X");"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};n(i,r);e.exports=i.locals||{}},qtK1:function(e,t,o){var n,i;n=[o("UFvF"),o("4pbt")],void 0===(i=function(e,t){var o={getCoreWrapperPromise:function(o){var n,i=e.defer();return isNaN(o)&&(o=1e4),n=window.setTimeout((function(){i.reject(new Error("Timed out waiting for coreWrapper to become available"))}),o),t.getCoreWrapperPromise().then((function(e){clearTimeout(n),i&&i.resolve(e)})).catch((function(e){clearTimeout(n),i.reject(e)})),i},getSelectedFormaPromise:function(t,n){var i=e.defer();return o.getCoreWrapperPromise(t).then((function(e){i.resolve(e.getSelectedForma())})).catch((function(e){i.reject(e)})),i.promise}};return o}.apply(t,n))||(e.exports=i)},zvPW:function(e,t,o){var n,i;n=[o("xeH2"),o("YLtl"),o("hcqx"),o("UFvF"),o("Uwho"),o("2ofD"),o("7mGH"),o("oWUw"),o("bgEM"),o("chD/")],void 0===(i=function(e,t,n,i,r,s,a,d,p,c){return n.View.extend({events:{"click .theo-share-button":"handleShareButton"},initialize(){window.PIXI&&!window.ADOBE_POST_PIXI&&(window.ADOBE_POST_PIXI=window.PIXI),window.PIXI=window.ADOBE_POST_PIXI,e("body").addClass("post-app"),t.bindAll(this,"doRender"),this._setupTestHook()},_setupTestHook(){a.hasFeature("post-expose-model-to-ui-tests")&&(window._TheoBrowserTestUtils=o("qtK1"))},doRender(){const e=t.merge({},this.appConfig,function(){const e=n.history.getFragment().split("?")[1],t={};if(e){const o=e.split("&");for(let e=0;e<o.length;e++){const n=o[e].split("=");n[0]&&n[1]?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):n[0]&&(t[decodeURIComponent(n[0])]="")}}return t}());a.hasFeature("post-debug-dump-manifest-on-load")&&console.info(JSON.stringify(s.currentDoc.attributes.compositeObj._current._data)),this.addAnalyticsContextData(e),"remix"===this.appConfig.operation&&"function"==typeof s.currentDoc.triggerProjectCreatedAnalytics&&s.currentDoc.triggerProjectCreatedAnalytics(),p.getPostController().enable(this.el,e)},addAnalyticsContextData(e){e.contextString&&c.addContextData({contextString:e.contextString}),e.remixableAssetId&&c.addContextData({remixableAssetId:e.remixableAssetId})},render(){if("Chrome"===d.name&&d.majorVersion<=45)return window.alert("Sorry, you're using an older version of the Chrome browser that is not supported by Spark Post. Please update your browser to the latest version and try again."),window.marvel.events.trigger("hide-interstitial"),void marvel.navigate("/",{trigger:!0});marvel.events.on("designview-rendersubview-doc-loaded",this.doRender)},handleShareButton(){window.marvel.events.trigger("share-workflow-current-doc")},beforeUnload(){window.zE&&window.zE.hide&&window.zE.hide();const t=i.defer(),o=p.getPostController();return o&&!1!==o.enabled?(c.removeContextData(["contextString","remixableAssetId"]),window.marvel.isSaving?(e("body").removeClass("post-app"),o.disable(),t.resolve()):o.handleUnload().then((function(){e("body").removeClass("post-app"),o.disable(),t.resolve()})).catch((function(e){t.reject(e)})).done(),marvel.events.off("designview-rendersubview-doc-loaded",this.doRender),t.promise):(t.resolve(),t.promise)}})}.apply(t,n))||(e.exports=i)}}]);
//# sourceMappingURL=theo-web-view-38d9d533.js.map