(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[2],{"+IES":function(e,t,n){var r=t,o=n("oAGj");r.MotionLogic=o.defineProtocol("MotionLogic",{apply:"(Forma, Array<KeyFrame>, Dictionary<String>) -> Void"})},"+qi7":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("tGKA"),s=n("JO5d"),l=n("Zifs"),u=n("djAF"),c=n("35Q0"),d=n("oKlP"),h=n("sIWg");o.FormaCalloutUtils=(r=function(){},i.defineClass({name:"FormaCalloutUtils",ctor:r,props:{applyLockupHighlightBox:function(e){var t;(t=e.root)&&(this.applyLockupHighlightBoxTriangle(e,t),this.applyLockupHighlightBoxRectangle(e,t))},removeLockupHighlightBox:function(e){var t;if(t=e.root)for(var n=i.clone(t.filterWithCallback((function(e){return"temp-struct-vis"==e.intent}))),r=i.iter(n);!r.done;r.next())(e=r.value).removeFromParent()},applyLockupHighlightBoxTriangle:function(e,t){var n=t.page.createFormaWithController(u.ShapeForma.KIND,s.ShapeController.KIND);t.appendChild(n),n.intent="temp-struct-vis",c.ShapeLibrary.applyToShapeForma(n,"tri"),n.style.colors.fieldPrimary=new l.SolidColor(1,0,0,1),n.style.opacity=.9;var r=i.clone(e.totalPlacement.transformPoints(e.bounds.points));if(r[0].x<250){var o=(r[2].y+r[3].y)/2,p=r[3].y-r[2].y,f=o-.25*(T=r[3].y-r[2].y<200?Math.max(p,70):200),m=o+.25*T,g=r[2].x,y=r[2].x+.5*T,_=h.TheoRect.fromPoints(new d.TheoPoint(y,f),new d.TheoPoint(g,m));n.controller.fit(_),n.placement=new a.Matrix2D(0,-1,1,0,0,0),n.moveCenterToPoint(_.center)}else{o=(r[1].y+r[0].y)/2;var T,v=r[1].y-r[0].y;f=o-.25*(T=r[1].y-r[0].y<200?Math.max(v,70):200),m=o+.25*T,g=r[0].x,y=r[0].x-.5*T,_=h.TheoRect.fromPoints(new d.TheoPoint(y,f),new d.TheoPoint(g,m)),n.controller.fit(_),n.placement=new a.Matrix2D(0,1,-1,0,0,0),n.moveCenterToPoint(_.center)}},applyLockupHighlightBoxRectangle:function(e,t){var n=t.page.createFormaWithController(u.ShapeForma.KIND,s.ShapeController.KIND);t.appendChild(n),n.intent="temp-struct-vis",c.ShapeLibrary.applyToShapeForma(n,"square_001"),n.style.colors.fieldPrimary=new l.SolidColor(1,0,0,1),n.style.opacity=.9;var r,o=i.clone(e.totalPlacement.transformPoints(e.bounds.points));if(o[0].x<250){var a=(o[3].y+o[2].y)/2,p=o[3].y-o[2].y,f=a-.1*(T=o[3].y-o[2].y<200?Math.max(p,70):200),m=a+.1*T,g=.5*T,y=o[2].x+g,_=o[2].x+(g+100);r=h.TheoRect.fromPoints(new d.TheoPoint(_,f),new d.TheoPoint(y,m))}else{a=(o[1].y+o[0].y)/2;var T,v=o[1].y-o[0].y;f=a-.1*(T=o[1].y-o[0].y<200?Math.max(v,70):200),m=a+.1*T,g=.5*T,y=o[0].x-g,_=o[0].x-(g+100),r=h.TheoRect.fromPoints(new d.TheoPoint(_,f),new d.TheoPoint(y,m))}n.controller.fit(r)}}}),r)},"/9Bx":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("2bF5");o.MoaColorMap=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"MoaColorMap",ctor:r,superName:"CoreObject",statics:{createIdentityColorMap:function(){for(var e=[],t=i.iter(i.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!t.done;t.next()){var n=t.value;e.push(i.toDouble(n))}return e},createBrightnessColorMap:function(e){var t=Math.max(-100,Math.min(100,e))/100*85;return r.createColorMapFromListOfYValues(0,255,[42.5+.6*t,127.5+t,212.5+.5*t],3)},createContrastColorMap:function(e){var t=Math.max(-100,Math.min(100,e)),n=63.75*(e<0?t/200:t/100);return r.createColorMapFromListOfYValues(0,255,[63.75-n,191.25+n],2)},createExposureColorMap:function(e){var t=Math.max(-100,Math.min(100,e));return t=t<0?-e*e/100:e*e/100,r.createColorMapFromListOfYValues(e,255+e,[],0)},createShadowsColorMap:function(e){if(0!=e){var t=Math.max(-100,Math.min(100,e))/100;t<0&&(t*=1.25);var n=25.5*t;return r.createColorMapFromListOfYValues(n,255,[25.5+n,76.5+.75*n,127.5,178.5,229.5],5)}return r.createIdentityColorMap()},createHighlightsColorMap:function(e){if(0!=e){var t=Math.max(-100,Math.min(100,e))/100;t>0&&(t*=1.25);var n=25.5*t;return r.createColorMapFromListOfYValues(0,255+.75*n,[25.5,76.5,127.5,178.5+n,229.5+n],5)}return r.createIdentityColorMap()},createFadeColorMap:function(e){var t,n=Math.max(-100,Math.min(100,e))/100;return r.createColorMapFromListOfYValues(t=n<0?128*n:72*n,255-.5*t,[63.75,191.25],2)},createWarmthColorMaps:function(e){var t,n,o,a=i.repeat(i.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),3),l=Math.max(-100,Math.min(100,e))/100;if(l<-.6)t=-15*(1-(u=-(l+.6)/.4))+-90*u,n=5*(1-u)+-10*u,o=60*(1-u)+100*u;else if(l<0)t=-15*(u=-l/.6),n=5*u,o=60*u;else if(l>.6)t=30*(1-(u=(l-.6)/.4))+65*u,n=10*(1-u)+-5*u,o=-30*(1-u)+-127.5*u;else{var u;t=30*(u=l/.6),n=10*u,o=-30*u}var c=[127.5+t],d=[127.5+n],h=[127.5+o],p=.35*t,f=.35*n,m=.35*o,g=t<0?255+t:255+.5*t,y=n<0?255+n:255+.5*n,_=o<0?255+o:255+.5*o;return a[0]=i.clone(r.createColorMapFromListOfYValues(p,g,c,1)),a[1]=i.clone(r.createColorMapFromListOfYValues(f,y,d,1)),a[2]=i.clone(r.createColorMapFromListOfYValues(m,_,h,1)),a},createTintColorMaps:function(e){var t,n,o,a=i.repeat(i.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),3),l=Math.max(-100,Math.min(100,e))/100;if(l<-.6)t=-10*(1-(u=-(l+.6)/.4))+-90*u,n=45*(1-u)+40*u,o=-20*(1-u)+-70*u;else if(l<0)t=-10*(u=-l/.6),n=45*u,o=-20*u;else if(l>.6)t=15*(1-(u=(l-.6)/.4))+45*u,n=-15*(1-u)+-75*u,o=25*(1-u)+45*u;else{var u;t=15*(u=l/.6),n=-15*u,o=25*u}var c=[127.5+t],d=[127.5+n],h=[127.5+o],p=.35*t,f=.35*n,m=.35*o,g=t<0?255+t:255+.5*t,y=n<0?255+n:255+.5*n,_=o<0?255+o:255+.5*o;return a[0]=i.clone(r.createColorMapFromListOfYValues(p,g,c,1)),a[1]=i.clone(r.createColorMapFromListOfYValues(f,y,d,1)),a[2]=i.clone(r.createColorMapFromListOfYValues(m,_,h,1)),a},createColorMapFromListOfYValues:function(e,t,n,o){if(o<1)return r.createColorMapForTwoYVals(e,t);var a=i.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),l=(i.toDouble(s.MoaConstants.kMoaColorMapSizeRGB)-1)/i.toDouble(o),u=0;if(1==o){for(var c=e,d=n[0],h=t,p=i.iter(i.range(0,s.MoaConstants.kMoaColorMapSizeRGB-1,!1));!p.done;p.next()){var f=p.value,m=(T=1-(_=i.toDouble(f)/(i.toDouble(s.MoaConstants.kMoaColorMapSizeRGB)-1)))*T*c+2*T*_*d+_*_*h;a[f]=r.MoaColorClamp(m)}return a[0]=r.MoaColorClamp(e),a[s.MoaConstants.kMoaColorMapSizeRGB-1]=r.MoaColorClamp(t),a}var g=0,y=l;for(c=e,d=n[u],h=.5*(n[u]+n[u+1]),f=0;f<=i.toInt(l)&&f<s.MoaConstants.kMoaColorMapSizeRGB;)m=(T=1-(_=i.toDouble(f)/l))*T*c+2*T*_*d+_*_*h,a[f]=r.MoaColorClamp(m),f+=1;for(;u<o-2;)for(u+=1,g=i.toDouble(u)*l,y+=l,c=.5*(n[u-1]+n[u]),d=n[u],h=.5*(n[u]+n[u+1]);f<=i.toInt(y)&&f<s.MoaConstants.kMoaColorMapSizeRGB;)m=(T=1-(_=(i.toDouble(f)-g)/l))*T*c+2*T*_*d+_*_*h,a[f]=r.MoaColorClamp(m),f+=1;for(g=(i.toDouble(u)+1)*l,c=.5*(n[u]+n[u+1]),d=n[u+1],h=t;f<s.MoaConstants.kMoaColorMapSizeRGB-1;){var _,T;m=(T=1-(_=(i.toDouble(f)-g)/l))*T*c+2*T*_*d+_*_*h,a[f]=r.MoaColorClamp(m),f+=1}return a[0]=r.MoaColorClamp(e),a[s.MoaConstants.kMoaColorMapSizeRGB-1]=r.MoaColorClamp(t),a},createColorMapForTwoYVals:function(e,t){for(var n=i.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),r=i.iter(i.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!r.done;r.next()){var o=r.value,a=i.toDouble(o)/i.toDouble(s.MoaConstants.kMoaColorMapSizeRGB),l=1-a;n[o]=a*t+l*e}return n},combineColorMaps:function(e,t){for(var n=i.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),r=s.MoaConstants.kMoaColorMapSizeRGB-1,o=i.iter(i.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!o.done;o.next()){var a=o.value,l=e[a];if(l<=0)n[a]=t[0];else if(l>=i.toDouble(r))n[a]=t[r];else{var u=i.toInt(l),c=l-i.toDouble(u);n[a]=(1-c)*t[u]+c*t[u+1]}}return n},MoaColorClamp:function(e){return e>255?255:e<0?0:e},roundColorMap:function(e){for(var t=i.iter(i.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!t.done;t.next()){var n=t.value;e[n]=Math.round(e[n])}}}}),r)},"/afT":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("cZuM"),s=n("gXiO"),l=n("FNB+"),u=n("9Lk3"),c=n("ZK0l"),d=n("pnSN"),h=n("NkBu"),p=n("fdtz"),f=n("fNpk"),m=n("tGKA"),g=n("K0Rh"),y=n("T6jX"),_=n("oKlP"),T=n("sIWg");o.GroupDetector=(r=function(){s.CoreObject.call(this)},i.defineClass({name:"GroupDetector",ctor:r,superName:"CoreObject",statics:{Y_DISTANCE_THRESHOLD:150,X_DISTANCE_THRESHOLD:0,mergeFormaGroups:function(e,t){if(t>=e.length)return f.LegacyCoreAssert.fail("can't merge if the target is greater or equal than the number of groups",void 0,"GroupDetector.mergeFormaGroups","GroupDetector.swift",33),e;for(var n=e.concat();n.length>1&&n.length>t;){for(var r=1/0,o=null,a=null,s=i.iter(i.range(0,n.length,!1));!s.done;s.next()){var l,u=s.value;if(l=y.TheoDocumentUtils.unionFinalFrame(n[u]))for(var c=i.iter(i.range(0,n.length,!1));!c.done;c.next()){var d,h;u!=(d=c.value)&&(h=y.TheoDocumentUtils.unionFinalFrame(n[d]))&&l.L1Distance(h)<=r&&(o=u,a=d,r=l.L1Distance(h))}}if(null==(u=o)||null==(d=a))break;n[u]=n[u].concat(n[d]),n.splice(d,1)}return n},splitFormaGroups:function(e,t){for(var n=0,o=i.iter(e);!o.done;o.next())n+=o.value.length;for(var a=e.concat();a.length<n&&a.length<t;){for(var s=-1,l=null,u=i.iter(i.range(0,a.length,!1));!u.done;u.next()){var c=u.value;if(a[c].length>1){var d=r.groupFrame(a[c]);(null==l||d.area>l.area)&&(s=c,l=d)}}if(null==l){f.LegacyCoreAssert.fail("should have found a group to split",void 0,"GroupDetector.splitFormaGroups","GroupDetector.swift",111);break}var h=r.splitGroup(a[s]),p=h[0],m=h[1];a[s]=i.clone(p),a.splice(s+1,0,m)}return a},groupFrame:function(e){if(0==e.length)return T.TheoRect.Zero;for(var t=e[0].finalFrame,n=i.iter(e);!n.done;n.next()){var r=n.value;t=t.unionWith(r.finalFrame)}return t},splitGroup:function(e){if(e.length<=1)return f.LegacyCoreAssert.fail("should have found a group to split",void 0,"GroupDetector.splitGroup","GroupDetector.swift",142),[e,[]];for(var t=e[0].finalFrame,n=i.iter(e);!n.done;n.next()){var r=n.value;t=t.unionWith(r.finalFrame)}for(var o=0,a=0,s=i.iter(e);!s.done;s.next()){r=s.value;for(var u=i.iter(e);!u.done;u.next()){var c,d,h=u.value;i.eq(l._equality_Forma_Forma,r,h)||(c=r.finalFrame)&&(d=h.finalFrame)&&(o+=c.xDistance(d),a+=c.yDistance(d))}}var p=o>.01&&a<.01,m=i.sort(e,(function(e,t){var n,r;return(n=e.finalFrame)&&(r=t.finalFrame)?p?n.center.x<r.center.x:n.center.y<r.center.y:(f.LegacyCoreAssert.fail("nil frames when splitting groups",void 0,"GroupDetector.splitGroup","GroupDetector.swift",178),!1)})),g=[],y=[],_=0,T=m.length-1,v=m[_].finalFrame,C=m[T].finalFrame;for(g.push(m[_]),y.push(m[T]);_<T-1;){var P=v.area<C.area;m[_+1].finalFrame.intersects(v)&&(P=!0),m[T-1].finalFrame.intersects(C)&&(P=!1),P?(_+=1,g.push(m[_]),v=v.unionWith(m[_].finalFrame)):(T-=1,y.push(m[T]),C=C.unionWith(m[T].finalFrame))}return f.LegacyCoreAssert.isTrue(g.length+y.length==m.length,"counts don't match",void 0,"GroupDetector.splitGroup","GroupDetector.swift",221),[g,y]},shareVisualParent:function(e,t){var n=r.getVisualParent(e).finalFrame,o=r.getVisualParent(t).finalFrame;return r.visualParentFramesOverlap(n,o)},visualParentFramesOverlap:function(e,t){var n;return!!(n=e.intersectionWith(t))&&n.area/Math.max(t.area,e.area)>.95},detectOverlapGroups:function(e){var t=[],n=i.sort(e,(function(e,t){return e.finalFrame.area>t.finalFrame.area}));if(n.length<=1)return t;for(var r=[],o=i.iter(i.range(0,n.length-1,!1));!o.done;o.next()){var a=o.value;if(!i.containsEq(r,n[a],l._equality_Forma_Forma)){for(var s=[n[a]],u=i.iter(i.range(a+1,n.length,!1));!u.done;u.next()){var c,d=u.value;(c=n[a].finalFrame.intersectionWith(n[d].finalFrame))&&!i.containsEq(r,n[d],l._equality_Forma_Forma)&&c.area/n[d].finalFrame.area>.5&&s.push(n[d])}if(s.length>1){for(var h=i.iter(s);!h.done;h.next()){var p=h.value;r.push(p)}t.push(s)}}}for(var f=[],m=i.iter(t);!m.done;m.next()){var g=m.value,y=i.sort(g,(function(e,t){var n,r;return null!=(n=i.opt(e.parent,(function(t){return t.indexOfChild(e)})))&&null!=(r=i.opt(t.parent,(function(e){return e.indexOfChild(t)})))&&n<r}));f.push(y)}return f},detectProximityGroups:function(e,t,n){if(void 0===t&&(t=null),void 0===n&&(n=!1),0==e.length)return[];var o=null!=t?t:r.Y_DISTANCE_THRESHOLD,s=e.concat();i.sortInPlace(s,(function(e,t){return e.finalFrame.center.distanceTo(_.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(_.TheoPoint.ZERO)}));var u,c=[],d=s.concat(),h=1,p=i.first(s);(u=i.opt(i.opt(p,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))&&(h=Math.sqrt(Math.abs(u.determinant)));for(var f=i.iter(s);!f.done;f.next()){var m=f.value,g=[];if(n){var y=a.AlignmentDetector.DISTANCE_THRESHOLD/h,T=a.AlignmentDetector.init_a00d(m);g=i.clone(T.detectFormaAlignments(y))}if(i.containsEq(d,m,l._equality_Forma_Forma)){var v=[];v.push(m);var C=m.finalFrame;if(null==C)continue;for(var P=!0;P;){P=!1;for(var S=i.iter(d);!S.done;S.next()){var D,A=S.value;if(!i.eq(l._equality_Forma_Forma,A,m)&&(D=A.finalFrame)){var E=D.xDistance(C),R=D.yDistance(C),F=o;if(n){for(var b=!1,I=i.iter(g);!I.done;I.next()){var O=I.value;i.eq(l._equality_Forma_Forma,O.forma,A)&&(b=!0)}if(!b)continue}R<=F&&E<=F&&(C=C.unionWith(D),P=!0,v.push(A))}}for(var k=i.iter(v);!k.done;k.next())A=k.value,i.remove(d,A)}c.push(v)}}return c},shareVisualParent0:function(e,t){for(var n=i.clone(e.root.filterWithCallback((function(e){return e.isGraphic()}))),r=null,o=null,a=e.finalFrame,s=t.finalFrame,u=i.iter(n);!u.done;u.next()){var c,d,h=u.value;h.kind==p.ImageForma.KIND||h.isDescendent(e)||h.isDescendent(t)||(c=h.finalFrame)&&((d=c.intersectionWith(a))&&d.area/a.area>.75&&(r=h),(d=c.intersectionWith(s))&&d.area/s.area>.75&&(o=h))}return i.eq(l._equality_Forma_Forma,r,o)},getVisualParent:function(e){var t=e.finalFrame;return r.getVisualParentHelper(e,t)},getGroupVisualParent:function(e){var t=e.childrenFinalFrame;return r.getVisualParentHelper(e,t)},getVisualParentHelper:function(e,t){for(var n=e.root,r=i.clone(e.root.filterWithCallback((function(t){var n=t.isDescendent(e);return!(i.eq(l._equality_Forma_Forma,t,e)||n||null==t.controller||t.controller.kind==h.ImageController.KIND||t.controller.kind==u.GridController.KIND||!t.isBackgroundImage()&&t.hasIntent(l.Forma.INTENT_ICON)&&t.kind!=g.RootForma.KIND)}))),o=i.iter(r);!o.done;o.next()){var a,s=o.value;(a=s.finalFrame)&&a.contains(t)&&a.area<=n.finalFrame.area&&(n=s)}return n},detectVerticalAlignmentGroups:function(e){var t=[];if(0==e.length)return t;for(var n=e.concat();n.length>0;){var r,o=n[0],s=null,u=a.AlignmentDetector.init_a00d(o),c=[o];i.remove(n,o);for(var d=i.iter(u.detectFormaAlignments(a.AlignmentDetector.DISTANCE_THRESHOLD));!d.done;d.next()){var h=d.value;u.isVerticalAlignment(h.line.type)&&null!=h.forma&&i.containsEq(n,h.forma,l._equality_Forma_Forma)&&(s!=h.line.type&&null!=s||(s=h.line.type,i.containsEq(c,h.forma,l._equality_Forma_Forma)||(c.push(h.forma),i.remove(n,h.forma))))}null==s&&(s=null!=(r=i.opt(c[0].controller,(function(e){return e.preferredXAlignment})))?r:a.AlignmentType.CenterX),t.push({alignment:s,formae:c})}return t},flattenInferredGroups:function(e){for(var t=i.iter(e.visitAsArray(l.FormaTraversal.JustChildren));!t.done;t.next()){var n=t.value;if(n.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)){for(var r=i.iter(n.visitAsArray(l.FormaTraversal.JustChildren));!r.done;r.next()){var o=r.value;e.appendChild(o,!0)}n.removeFromParent(),i.opt(i.as(e.controller,u.GridController),(function(e){return e.inferGridCellAssignment()}))}}},inferVisualParentGroup:function(e,t){for(var n=t.finalFrame,r=i.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}),l.FormaTraversal.JustChildren)),o=[],a=i.iter(r);!a.done;a.next()){var s,u,h=a.value;i.eq(l._equality_Forma_Forma,h,t)||(s=h.finalFrame)&&(u=n.intersectionWith(s))&&u.area/s.area>.75&&o.push(h)}if(o.length>0){var p=t.page.createFormaWithController(d.GroupForma.KIND,c.GroupController.KIND);p.allowUserMove=!0,p.intent=l.Forma.INTENT_INFERRED_TEMP_GROUP,e.appendChild(p),p.placement=m.Matrix2D.translationXY(n.minX,n.minY),p.bounds=T.TheoRect.fromSize(n.size);for(var f=i.iter(o);!f.done;f.next()){var g=f.value;p.appendChild(g,!0)}return p}return null},createOverlapGroups:function(e){for(var t=i.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.kind!=p.ImageForma.KIND&&e.controller.floating&&!e.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)}),l.FormaTraversal.JustChildren)),n=[],o=i.iter(r.detectOverlapGroups(t));!o.done;o.next()){var a=o.value,s=e.page.createFormaWithController(d.GroupForma.KIND,c.GroupController.KIND);s.allowUserMove=!0,s.intent=l.Forma.INTENT_INFERRED_TEMP_GROUP,e.appendChild(s);for(var u=a[0].frame,h=i.iter(a);!h.done;h.next()){var f=h.value;u=u.unionWith(f.frame)}var g=u;s.placement=m.Matrix2D.translationXY(g.minX,g.minY),s.bounds=T.TheoRect.fromSize(g.size);for(var y=i.iter(a);!y.done;y.next())f=y.value,s.appendChild(f,!0);n.push(s)}return n},inferVisualGroups:function(e){return[]}}}),r)},"0wFF":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.AnalyticsConstants=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"AnalyticsConstants",ctor:r,superName:"CoreObject",statics:{kAllowAnalyticsKey:"shareuser_preference",kAnalyticsDataRegistrationStart:"Signup Start",kAnalyticsDataRegistrationSuccess:"Signup Success",kAnalyticsDataRegistrationFailure:"Signup Failure",kAnalyticsDataLoginStart:"Login Start",kAnalyticsDataLoginAttempt:"Login Attempt",kAnalyticsDataLoginSuccess:"Login Success",kAnalyticsDataLoginCancel:"Login Cancel",kAnalyticsDataLogoutAttempted:"Logout Attempted",kAnalyticsDataLogoutCancel:"Logout Cancel",kAnalyticsDataRegistrationStep:"Registration Step",kAnalyticsDataAuthStep:"Auth Step",kAnalyticsDataLoginMethod:"method",kAnalyticsValueLoginFacebook:"facebook",kAnalyticsValueLoginGoogle:"google",kAnalyticsValueLoginApple:"apple",kAnalyticsValueLoginAdobeID:"AdobeID",kAnalyticsValueLoginKeychain:"keychain",kAnalyticsDataLowMemoryWarning:"lowMemoryWarning",kAnalyticsDataAuthStatusLoggedInOnline:"Logged In : Online",kAnalyticsDataAuthStatusLoggedInOffline:"Logged In : Offline",kAnalyticsDataAuthStatusLoggedOutOnline:"Logged Out : Online",kAnalyticsDataAuthStatusLoggedOutOffline:"Logged Out : Offline",kAnalyticsDataGeneric1:"contextualData1",kAnalyticsDataGeneric2:"contextualData2",kAnalyticsDataGeneric3:"contextualData3",kAnalyticsDataGeneric4:"contextualData4",kAnalyticsDataGeneric5:"contextualData5",kAnalyticsDataGeneric6:"contextualData6",kAnalyticsDataGeneric7:"contextualData7",kAnalyticsDataGeneric8:"contextualData8",kAnalyticsDataGeneric9:"contextualData9",kAnalyticsDataGeneric10:"contextualData10",kAnalyticsDataGeneric11:"contextualData11",kAnalyticsDataGeneric12:"contextualData12",kAnalyticsDataGeneric13:"contextualData13",kAnalyticsDataGeneric14:"contextualData14",kAnalyticsDataGeneric15:"contextualData15",kAnalyticsDataGeneric16:"contextualData16",kAnalyticsDataGeneric18:"contextualData18",kAnalyticsDataGeneric19:"contextualData19",kAnalyticsDataGeneric20:"contextualData20",kAnalyticsDataGeneric26:"contextualData26",kAnalyticsDataGeneric27:"contextualData27",kAnalyticsDataGeneric28:"contextualData28",kAnalyticsLabelAdobeEventName:"adb.event.eventInfo.eventName",kAnalyticsLabelAdobeEventAction:"adb.event.eventInfo.eventAction",kAnalyticsLabelTrackingID:"mobile.theo.trackingId",kAnalyticsLabelPlatformName:"adb.page.pageInfo.platform",kAnalyticsValuePlatformiOS:"ios",kAnalyticsValuePlatformAndroid:"android",kAnalyticsLabelProductCategory:"adb.page.pageInfo.productCategory",kAnalyticsValueProductCategory:"mobile",kAnalyticsLabelNamespace:"adb.page.pageInfo.namespace",kAnalyticsValueNamespace:"theo",kAnalyticsLabelUserAuthStatus:"adb.user.profile.attributes.authStatus",kAnalyticsLabelUserProfileID:"adb.user.profile.profileId",kAnalyticsLabelUserAuthId:"authId",kAnalyticsLabelSDKsUsed:"adb.page.pageInfo.isSDKUtilized",kAnalyticsValueCreativeSDK:"Creative SDK",kAnalyticsLabelDeviceUsed:"device",kAnalyticsLabelPageName:"adb.page.pageInfo.pageName",kAnalyticsLabelProductVersion:"adb.page.pageInfo.productVersion",kAnalyticsLabelAdobeEventInfo:"adb.event.eventInfo.type",kAnalyticsEventDooploSearched:"dooploSearched",kAnalyticsEventLowMemoryWarning:"lowMemoryWarning",kAnalyticsDataImageSearchTerm:"searchTerm",kAnalyticsDooploImageUnavailableError:"Dooplo Image Unavailable Error",kAnalyticsLabelDooploImageURL:"mobile.theo.DooploImageURL",kAnalyticsEventGiphySearched:"giphySearched",kAnalyticsEventAdobeStockSearched:"adobeStockSearched",kAnalyticsEventAdobeStockLicenseImageClicked:"license_adobe_stock_image_clicked",kAnalyticsEventAdobeStockLicenseImageConfirmed:"license_adobe_stock_image_confirmed",kAnalyticsEventAdobeStockLicenseImageCanceled:"license_adobe_stock_image_canceled",kAnalyticsEventAdobeStockLicenseImageSucceed:"license_adobe_stock_image_Succeed",kAnalyticsEventAdobeStockLicenseImageFailed:"license_adobe_stock_image_Failed",kAnalyticsEventAdobeStockLicenseImageNoSubscription:"license_adobe_stock_image_no_subscription",kAnalyticsDataClipboardCopy:"Clipboard Copy",kAnalyticsDataGeneralError:"General Error",kAnalyticsDataSharingAction:"Sharing Action",kAnalyticsBaseEvent:"mobile.theo.event",kAnalyticsDataRegistrationCancel:"Signup Cancel",kAnalyticsDataLogoutSuccess:"Logout Success",kAnalyticsDataLogoutFailure:"Logout Failure",kAnalyticsDataCreateNewAttempt:"projectworkFlow:createProjectAttempt",kAnalyticsDataCreateNewCancel:"projecWorkFlow:createProjectCancel",kAnalyticsDataProjectCreated:"projectCreated",kAnalyticsDataProjectOpened:"projectOpened",kAnalyticsDataViewedMerchandising:"viewedMerchandising",kAnalyticsMerchandisingTriggerBrandify:"brandify",kAnalyticsMerchandisingTriggerWatermark:"watermark",kAnalyticsMerchandisingTriggerResize:"resize",kAnalyticsMerchandisingTriggerLogo:"logo",kAnalyticsMerchandisingTriggerFont:"fontPicker",kAnalyticsMerchandisingTriggerResubscribe:"resubscribe",kAnalyticsMerchandisingTriggerPremiumTemplate:"messagingModalPremiumTemplateUpgrade",kAnalyticsMerchandisingTriggerCCLEmptyState:"cclEmptyState",kAnalyticsDataMerchandisingTriggerUseLibraryAssets:"messagingModalMerchLibraryUseAssets",kAnalyticsMerchandisingTriggerShare:"shareSheet",kAnalyticsMerchandisingTriggerMerchandisingBar:"merchandisingBar",kAnalyticsMerchandisingClickedCTA:"clickedMerchandisingCTA",kAnalyticsMerchandisingClickedMaybeLater:"clickedMerchandisingMaybeLater",kAnalyticsMerchandisingShowPopover:"showPopOver",kAnalyticsEventAddedBrandingToProject:"addedBrandingToProject",kAnalyticsDataKeyProjectID:"projectID",kAnalyticsDataViewedOnboarding:"viewedOnboarding",kAnalyticsDataOnboardingTriggerColorPicker:"colorPickerOnboarding",kAnalyticsDataOnboardingTriggerPartialBrand:"partialBrandOnboarding",kAnalyticsDataOnboardingTriggerIncompleteBrandify:"incompleteBrandifyOnboarding",kAnalyticsDataOnboardingTriggerAddLogoPartialBrandkit:"addLogoPartialBrandkitOnboarding",kAnalyticsLabelTrigger:"trigger",kAnalyticsLabelPremiumEntitled:"premiumEntitled",kAnalyticsLabelDeviceLanguage:"deviceLanguage",kAnalyticsLabelDisplayedLanguage:"displayedLanguage",kAnalyticsDataEditDesign:"projectWorkFlow:editDesign",kAnalyticsDataDeleteDesign:"projectWorkFlow:deleteDesign",kAnalyticsDataDuplicateDesign:"projectWorkFlow:duplicateDesign",kDidEditDocumentPalette:"editor:colorEditor:didEditDocumentPalette",kDidEditSelectionColor:"editor:colorEditor:didEditSelectionColor",kDidSampleHSVColor:"editor:colorEditor:didSampleHSVColor",kDidSampleDocumentColor:"editor:colorEditor:didSampleDocumentColor",kDidChooseSwatchColor:"editor:colorEditor:didChooseSwatchColor",kDidVisitHexPicker:"editor:colorEditor:didVisitHexPicker",kDidCopyHexColor:"editor:colorEditor:didCopyHexColor",kDidPasteHexColor:"editor:colorEditor:didPasteHexColor",kAnalyticsDataUndo:"project:undoPressed",kAnalyticsDataRedo:"project:redoPressed",kAnalyticsDataActionPerformed:"project:actionPerformed",kAnalyticsDataActionDescription:"actionDescription",kAnalyticsDataAddPressed:"editor:addPressed",kAnalyticsDataAddTextPressed:"editor:addTextPressed",kAnalyticsDataAddImagePressed:"editor:addImagePressed",kAnalyticsDataImageLayerPressed:"editor:imageLayerPressed",kAnalyticsDataProjectCreateTypeScratch:"projectCreateType:scratch",kAnalyticsDataProjectCreateTypeTemplate:"projectCreateType:templates",kAnalyticsDataVideoTypeVideo:"videoType:video",kAnalyticsDataVideoTypeLivePhoto:"videoType:livePhoto",kAnalyticsDataActionTypeSuccess:"actionType:success",kAnalyticsDataAddLogoPressed:"editor:addLogoPressed",kAnalyticsDataAddIconPressed:"editor:addIconPressed",kAnalyticsDataDesignFilterPressed:"editor:designFilterPressed",kAnalyticsDataStickersPressed:"editor:stickersPressed",kAnalyticsDataAddButtonSelected:"editor:addButtonSelected",kAnalyticsDataAddTextSelected:"editor:addTextSelected",kAnalyticsDataAddImageSelected:"editor:addImageSelected",kAnalyticsDataAddLogoSelected:"editor:addLogoSelected",kAnalyticsDataAddIconSelected:"editor:addIconSelected",kAnalyticsDataAddStickerSelected:"editor:addStickerSelected",kAnalyticsDataColorSelect:"editor:colorSelected",kAnalyticsDataLayoutSelect:"editor:layoutSelected",kAnalyticsDataResizeSelect:"editor:resizeSelected",kAnalyticsDataBrandSelect:"editor:brandSelected",kAnalyticsDataViewFeaturedPosters:"lobby:viewFeaturedPosters",kAnalyticsDataViewMyDesigns:"lobby:viewMyDesigns",kAnalyticsDataAnimationEffectsPressed:"editor:effectsPressed",kAnalyticsDataAnimationEffectsViewed:"editor:effectsViewed",kAnalyticsMerchandisingTriggerEnterDesign:"postEnterDesign",kAnalyticsMerchandisingTriggerEditPost:"postEditPost",kAnalyticsDataAddVideoPressed:"editor:addVideoPressed",kAnalyticsDataImageAdded:"editor:imageAdded",kAnalyticsDataImageWithAlphaAdded:"editor:imageWithAlphaAdded",kAnalyticsDataLogoAdded:"editor:logoAdded",kAnalyticsDataTextAdded:"editor:textAdded",kAnalyticsDataIconAdded:"editor:iconAdded",kAnalyticsDataStickerAdded:"editor:stickerAdded",kAnalyticsDataBrandedTemplateUsed:"editor:brandedTemplateUsed",kAnalyticsDataAddBrandPressed:"editor:addBrandPressed",kAnalyticsDataBrandSwitchPressed:"editor:brandSwitchPressed",kAnalyticsDataNewBrandApplied:"editor:newBrandApplied",kAnalyticsDataBrandifyUsed:"editor:brandifyUsed",kAnalyticsDataCustomThemePressed:"brand:customThemePressed",kAnalyticsDataFreeBrandMerchandisingViewed:"editor:freeBrandMerchandisingViewed",kAnalyticsDataNoBrandMerchandisingViewed:"editor:noBrandMerchandisingViewed",kAnalyticsDataOneBrandMerchandisingViewed:"editor:oneBrandMerchandisingViewed",kAnalyticsDesignViewNetworkInfo:"editor:networkInfo",kAnalyticsDataThemeSelect:"editor:themeSelected",kAnalyticsDataColorPressed:"editor:colorPressed",kAnalyticsDataLayoutPressed:"editor:layoutPressed",kAnalyticsDataResizePressed:"editor:resizePressed",kAnalyticsDataBrandPressed:"editor:brandPressed",kAnalyticsDataCutoutSelect:"editor:cutout:selected",kAnalyticsDataEffectsFilterSelect:"editor:effects:filterSelected",kAnalyticsDataEffectsEnhanceSelect:"editor:effects:enhanceSelected",kAnalyticsDataEffectsAnimationSelect:"editor:effects:animationSelected",kAnalyticsDataLayoutLayoutSelect:"editor:layout:layoutSelected",kAnalyticsDataLayoutSpacingSelect:"editor:layout:spacingSelected",kAnalyticsDataLayoutBackgroundSelect:"editor:layout:bgColorSelected",kAnalyticsDataBackgroundColorSelect:"editor:bgColorSelected",kAnalyticsDataTextSelected:"editor:text:selected",kAnalyticsDataImageSelected:"editor:image:selected",kAnalyticsDataShapeSelected:"editor:shape:selected",kAnalyticsDataLogoSelected:"editor:logo:selected",kAnalyticsDataMultiSelected:"editor:multi:selected",kAnalyticsDataBackgroundSelected:"editor:background:selected",kAnalyticsDataAlignmentGroupSelected:"editor:alignmentGroup:selected",kAnalyticsDataTextDeleted:"editor:text:deleted",kAnalyticsDataImageDeleted:"editor:image:deleted",kAnalyticsDataCellDeleted:"editor:cell:deleted",kAnalyticsDataShapeDeleted:"editor:shape:deleted",kAnalyticsDataStickerDeleted:"editor:sticker:deleted",kAnalyticsDataGroupDeleted:"editor:group:deleted",kAnalyticsDataImageFlipped:"editor:image:flipped",kAnalyticsDataShapeFlipped:"editor:shape:flipped",kAnalyticsDataIconFlippedVertical:"editor:icon:verticalFlipPressed",kAnalyticsDataIconFlippedHorizontal:"editor:icon:horizontalFlipPressed",kAnalyticsDataTextFlipped:"editor:text:flipped",kAnalyticsDataImageNudged:"editor:image:nudged",kAnalyticsDataShapeNudged:"editor:shape:nudged",kAnalyticsDataTextNudged:"editor:text:nudged",kAnalyticsDataMultipleNudged:"editor:multi:nudged",kAnalyticsDataImageRotated:"editor:image:rotated",kAnalyticsDataShapeRotated:"editor:shape:rotated",kAnalyticsDataTextRotated:"editor:text:rotated",kAnalyticsDataMultiRotated:"editor:multi:rotated",kAnalyticsDataImageResized:"editor:image:resized",kAnalyticsDataShapeResized:"editor:shape:resized",kAnalyticsDataTextResized:"editor:text:resized",kAnalyticsDataMultiResized:"editor:multi:resized",kAnalyticsDataTextDuplicated:"editor:text:duplicated",kAnalyticsDataImageDuplicated:"editor:image:duplicated",kAnalyticsDataIconDuplicated:"editor:icon:duplicated",kAnalyticsDataShapeDuplicated:"editor:shape:duplicated",kAnalyticsIconAdded:"core:iconAdded",kAnalyticsIconReplaced:"core:iconReplaced",kAnalyticsIconDeleted:"core:iconDeleted",kAnalyticsFormaeAligned:"core:formaeAligned",kAnalyticsFormaeDistributed:"core:formaeDistributed",kAnalyticsFormaeArranged:"core:formaeArranged",kAnalyticsFormaeDragged:"core:formaeDragged",kAnalyticsDataColorOpen:"Preview Color",kAnalyticsDataThemeOpen:"Preview Theme",kAnalyticsDataFilterOpen:"Preview Filter",kAnalyticsImageAddedToFrame:"core:imageAddedToFrame",kAnalyticsImageReplaced:"core:imageReplaced",kAnalyticsVideoTrimmed:"editVideo:videoTrimmed",kAnalyticsVideoAudioAdjusted:"editVideo:audioAdjusted",kAnalyticsVideoAudioAdjustedDefault:"audioLevel:default",kAnalyticsVideoAudioAdjustedLow:"audioLevel:low",kAnalyticsVideoAudioAdjustedMute:"audioLevel:mute",kAnalyticsDataColorCellConfirm:"editor:colorConfirmed",kAnalyticsDataThemeCellConfirm:"editor:themeConfirmed",kAnalyticsDataFilterCellConfirm:"editor:filterConfirmed",kAnalyticsDataCutoutCellConfirm:"editor:cutoutConfirmed",kAnalyticsDataEnhanceConfirm:"editor:enhanceConfirmed",kAnalyticsDataLayoutConfirm:"editor:layoutConfirmed",kAnalyticsDataBrandConfirm:"editor:brandConfirmed",kAnalyticsDataLayoutLayoutConfirm:"editor:layout:layoutConfirmed",kAnalyticsDataLayoutSpacingConfirm:"editor:layout:spacingConfirmed",kAnalyticsDataLayoutSizeConfirm:"editor:layout:sizeConfirmed",kAnalyticsDataLayoutBackgroundColorConfirm:"editor:layout:bgColorConfirmed",kAnalyticsDataBackgroundColorCellConfirm:"editor:bgColorConfirmed",kAnalyticsDataColorCellCancel:"editor:colorCancelled",kAnalyticsDataThemeCellCancel:"editor:themeCancelled",kAnalyticsDataFilterCellCancel:"editor:filterCancelled",kAnalyticsDataCutoutCellCancel:"editor:cutoutCancelled",kAnalyticsDataEnhanceCancel:"editor:enhanceCancelled",kAnalyticsDataLayoutCancel:"editor:layoutCancelled",kAnalyticsDataBrandCancel:"editor:brandCancelled",kAnalyticsDataGlobalEffectCancel:"editor:globalEffectCancelled",kAnalyticsDataAddStickerCancel:"editor:addStickerCancelled",kAnalyticsDataLayoutLayoutCancel:"editor:layout:layoutCancelled",kAnalyticsDataLayoutSpacingCancel:"editor:layout:spacingCancelled",kAnalyticsDataLayoutSizeCancel:"editor:layout:sizeCancelled",kAnalyticsDataLayoutBackgroundColorCancel:"editor:layout:bgColorCancelled",kAnalyticsDataBackgroundColorCellCancel:"editor:bgColorCancelled",kAnalyticsDataColorCellChanged:"editor:colorChanged",kAnalyticsDataThemeCellChanged:"editor:themeChanged",kAnalyticsDataFilterCellChanged:"editor:image:filtersApplied",kAnalyticsDataCutoutCellChanged:"editor:cutoutChanged",kAnalyticsDataLayoutChanged:"editor:layoutChanged",kAnalyticsDataLayoutLayoutChanged:"editor:layout:layoutChanged",kAnalyticsDataLayoutSpacingChanged:"editor:layout:spacingChanged",kAnalyticsDataLayoutSizeChanged:"editor:layout:sizeChanged",kAnalyticsDataLayoutBackgroundColorChanged:"editor:layout:bgColorChanged",kAnalyticsDataLayoutCustomSizeSelected:"editor:layout:customSizeSelected",kAnalyticsDataLayoutCustomSizeDidConfirmed:"editor:layout:customSizeDidConfirmed",kAnalyticsDataLayoutCustomSizeDidCanceled:"editor:layout:customSizeDidCanceled",kAnalyticsDataBackgroundColorCellChanged:"editor:bgColorChanged",kAnalyticsDataWheelChoice:"editor:wheelSelected",kAnalyticsDataWheelDone:"editor:wheelSelectionConfirmed",kAnalyticsDataWheelCancel:"editor:wheelSelectionCanceled",kAnalyticsDataBackingOpen:"editor:backingSelected",kAnalyticsDataBackingConfirm:"editor:backingConfirmed",kAnalyticsDataBackingCancel:"editor:backingCancelled",kAnalyticsDataDuotoneOpen:"editor:duotoneSelected",kAnalyticsDataDuotoneConfirm:"editor:duotoneConfirmed",kAnalyticsDataDuotoneCancel:"editor:duotoneCancelled",kAnalyticsDataFilterName:"filterName",kAnalyticsDataFilterType:"filterUsed",kAnalyticsDataDuotoneCustom:"Custom",kAnalyticsDataDuotonePreset:"Preset",kAnalyticsDataDuotoneSwap:"Swap",kAnalyticsDataDuotoneDefault:"Default",kAnalyticsDataFontOpen:"launchedFontPicker",kAnalyticsDataFontConfirm:"pickedFont",kAnalyticsDataFontCancel:"canceledFontPicker",kAnalyticsDataFontChanged:"changedFont",kAnalyticsDataAddFontsPressed:"fontPicker:addFontsPressed",kAnalyticsDataFontMode:"pickerMode",kAnalyticsDataFontModeFace:"face",kAnalyticsDataFontModeHeadline:"headline",kAnalyticsDataFontModeBody:"body",kAnalyticsDataFontModeCard:"card",kAnalyticsDataOpacityOpen:"editor:opacitySelected",kAnalyticsDataOpacityConfirm:"editor:opacityConfirmed",kAnalyticsDataOpacityCancel:"editor:opacityCancelled",kAnalyticsDataAdjustOpen:"editor:adjustSelected",kAnalyticsDataAdjustConfirm:"editor:adjustConfirmed",kAnalyticsDataAdjustCancel:"editor:adjustCancelled",kAnalyticsDataEditFormaOpen:"editor:editFormaSelected",kAnalyticsDataEditFormaConfirm:"editor:editFormaConfirmed",kAnalyticsDataEditFormaCancel:"editor:editFormaCancelled",kAnalyticsDataAlignFormaeOpen:"editor:alignFormaeSelected",kAnalyticsDataAlignFormaeConfirm:"editor:alignFormaeConfirmed",kAnalyticsDataAlignFormaeCancel:"editor:alignFormaeCancelled",kAnalyticsDataDistributeFormaeOpen:"editor:distributeFormaeSelected",kAnalyticsDataDistributeFormaeConfirm:"editor:distributeFormaeConfirmed",kAnalyticsDataDistributeFormaeCancel:"editor:distributeFormaeCancelled",kAnalyticsDataAdjustNudgeOpen:"editor:adjustNudgeSelected",kAnalyticsDataAdjustNudgeConfirm:"editor:adjustNudgeConfirmed",kAnalyticsDataAdjustNudgeCancel:"editor:adjustNudgeCancelled",kAnalyticsDataAdjustRotateOpen:"editor:adjustRotateSelected",kAnalyticsDataAdjustRotateConfirm:"editor:adjustRotateConfirmed",kAnalyticsDataAdjustRotateCancel:"editor:adjustRotateCancelled",kAnalyticsDataAdjustRotateButtonSelected:"editor:adjustRotateButtonSelected",kAnalyticsDataAdjustScaleOpen:"editor:adjustScaleSelected",kAnalyticsDataAdjustScaleConfirm:"editor:adjustScaleConfirmed",kAnalyticsDataAdjustScaleCancel:"editor:adjustScaleCancelled",kAnalyticsDataAdjustFlipOpen:"editor:adjustFlipSelected",kAnalyticsDataAdjustFlipConfirm:"editor:adjustFlipConfirmed",kAnalyticsDataAdjustFlipCancel:"editor:adjustFlipCancelled",kAnalyticsDataAdjustFlipH:"editor:adjustFlippedH",kAnalyticsDataAdjustFlipV:"editor:adjustFlippedV",kAnalyticsDataEditMultiselect:"editor:editMultiselect",kAnalyticsDataEditDeselect:"editor:editDeselect",kAnalyticsDataEditDelete:"editor:editDelete",kAnalyticsDataEditDuplicate:"editor:editDuplicate",kAnalyticsDataEditGroup:"editor:editGroup",kAnalyticsDataEditUngroup:"editor:editUngroup",kAnalyticsDataEditLicense:"editor:editLicense",kAnalyticsDataEditReplaceImage:"editor:replaceImage",kAnalyticsDataEditTextEdit:"editor:textEdit",kAnalyticsDataEditMultistyleText:"editor:multistyleText",kAnalyticsDataEditImageCrop:"editImage:cropPressed",kAnalyticsDataEditImageCropRatioSelected:"editImage:cropRatioSelected",kAnalyticsDataEditImageCropShapeSelected:"editImage:cropShapeSelected",kAnalyticsDataEditImageCropRasterMaskSelected:"editImage:cropRasterMaskSelected",kAnalyticsDataEditImageCropCompleted:"editImage:cropCompleted",kAnalyticsDataEditImageCropImageAdjusted:"editImage:cropImageAdjusted",kAnalyticsDataEditImageLayerSelected:"editImage:layerSelected",kAnalyticsDataEditImageRemoveBackgroundApplied:"editor:backgroundRemoveApplied",kAnalyticsDataEditImageRestoreBackgroundApplied:"editor:backgroundRestoreApplied",kAnalyticsDataEditImageRemoveBackgroundPressed:"editImage:removeBackgroundPressed",kAnalyticsDataEditImageReturnBackgroundPressed:"editImage:returnBackgroundPressed",kAnalyticsDataEditImageRemoveBackgroundLimitedTimePopupDismissed:"editor:limitedTimePopupDismissed",kAnalyticsDataGroupPressed:"editor:multiselect:groupPressed",kAnalyticsDataGroupUngroupPressed:"editor:group:ungroupPressed",kAnalyticsDataMultiselectUngroupPressed:"editor:multiselect:ungroupPressed",kAnalyticsDataEditSound:"editor:sound",kAnalyticsDataZoomEntered:"zoomEntered",kAnalyticsDataZoomChanged:"zoomChanged",kAnalyticsDataZoomExited:"zoomExited",kAnalyticsDataZoomIn:"in",kAnalyticsDataZoomOut:"out",kAnalyticsDataZoomNone:"none",kAnalyticsDataZoomPan:"pan",kAnalyticsDataZoomButton:"button",kAnalyticsDataZoomGesture:"gesture",kAnalyticsDataObjectDeselected:"objectDeselected",kAnalyticsDataCancelButton:"cancel",kAnalyticsDataDoneButton:"done",kAnalyticsDataCheckButton:"check",kAnalyticsDataDeselectTap:"deselect",kAnalyticsDataSelectionDeselectAll:"editor:selectionDeselectAll",kAnalyticsDataSelectionSelectAll:"editor:selectionSelectAll",kAnalyticsDataSelectionTouchEnd:"editor:selectionTouchEnd",kAnalyticsDataSelectionConfirm:"editor:selectionConfirm",kAnalyticsDataSelectionMarqueeSelect:"editor:selectionMarqueeSelect",kAnalyticsDataSelectionMultiple:"editor:selectionMultiple",kAnalyticsDataLayerOpen:"editor:layerSelected",kAnalyticsDataLayerConfirm:"editor:layerConfirmed",kAnalyticsDataLayerCancel:"editor:layerCancelled",kAnalyticsDataTextFrameEdited:"editor:textFrameEdited",kAnalyticsDataTextSpacingOpen:"editor:textSpacingSelected",kAnalyticsDataTextSpacingConfirm:"editor:textSpacingConfirmed",kAnalyticsDataTextSpacingCancel:"editor:textSpacingCancelled",kAnalyticsDataTextSpacingChanged:"editor:textSpacingChanged",kAnalyticsDataTextPaddingChanged:"editor:text:shapeSizeValueChanged",kAnalyticsDataTextLineHeightChanged:"editor:text:lineSpacingValueChanged",kAnalyticsDataTextTrackingChanged:"editor:text:letterSpacingValueChanged",kAnalyticsDataTextAlignmentOpen:"editor:alignmentSelected",kAnalyticsDataTextAlignmentConfirm:"editor:alignmentConfirmed",kAnalyticsDataTextAlignmentCancel:"editor:alignmentCancelled",kAnalyticsDataTextAlignmentChanged:"editor:alignmentChanged",kAnalyticsDataTextLayoutSelected:"editor:textLayoutSelected",kAnalyticsDataTextHighlightOpen:"editor:highlightSelected",kAnalyticsDataTextHighlightConfirm:"editor:highlightConfirmed",kAnalyticsDataTextHighlightCancel:"editor:highlightCancelled",kAnalyticsDataTextEffectsOpen:"editor:effectsSelected",kAnalyticsDataTextEffectsConfirm:"editor:effectsConfirmed",kAnalyticsDataTextEffectsCancel:"editor:effectsCancelled",kAnalyticsDataTextOpacityOpen:"editor:textOpacitySelected",kAnalyticsDataTextOpacityConfirm:"editor:textOpacityConfirmed",kAnalyticsDataTextOpacityCancel:"editor:textOpacityCancelled",kAnalyticsDataTextOutlineOpen:"editor:outlineSelected",kAnalyticsDataTextOutlineConfirm:"editor:outlineConfirmed",kAnalyticsDataTextOutlineCancel:"editor:outlineCancelled",kAnalyticsDataTextShadowOpen:"editor:shadowSelected",kAnalyticsDataTextShadowConfirm:"editor:shadowConfirmed",kAnalyticsDataTextShadowCancel:"editor:shadowCancelled",kAnalyticsDataTextColorOpen:"editor:textColorSelected",kAnalyticsDataTextColorConfirm:"editor:textColorConfirmed",kAnalyticsDataTextColorCancel:"editor:textColorCancelled",kAnalyticsDataTextShapeEnabled:"editor:text:shapeEnabled",kAnalyticsDataTextShapeDisabled:"editor:text:shapeDisabled",kAnalyticsDataTextShadowEnabled:"editor:text:shadowEnabled",kAnalyticsDataTextShadowDisabled:"editor:text:shadowDisabled",kAnalyticsDataTextOutlineEnabled:"editor:text:outlineEnabled",kAnalyticsDataTextOutlineDisabled:"editor:text:outlineDisabled",kAnalyticsDataTextShapeMaskEnabled:"editor:text:shapeMaskEnabled",kAnalyticsDataTextShapeMaskDisabled:"editor:text:shapeMaskDisabled",kAnalyticsDataTextOutlineOnlyEnabled:"editor:text:outlineOnlyEnabled",kAnalyticsDataTextOutlineOnlyDisabled:"editor:text:outlineOnlyDisabled",kAnalyticsDataTextOutlineThicknessChanged:"editor:text:outlineThicknessValueChanged",kAnalyticsDataTextShadowDistanceChanged:"editor:text:shadowDistanceValueChanged",kAnalyticsDataTextShadowDirectionChanged:"editor:text:shadowDirectionValueChanged",kAnalyticsDataTextShapeOpacityChanged:"editor:text:shapeOpacityValueChanged",kAnalyticsDataTextOpacityChanged:"editor:text:opacityValueChanged",kAnalyticsDataTextFillColorSelected:"editor:text:fillColorSelected",kAnalyticsDataTextShapeColorSelected:"editor:text:shapeColorSelected",kAnalyticsDataTextShadowColorSelected:"editor:text:shadowColorSelected",kAnalyticsDataTextOutlineColorSelected:"editor:text:outlineColorSelected",kAnalyticsDataTextShuffleColorSelected:"editor:text:shuffleColorSelected",kAnalyticsDataTextShapeSelected:"editor:text:shapeSelected",kAnalyticsDataTextInspectorConfirm:"editor:textInspectorConfirm",kAnalyticsDataTextInspectorCancel:"editor:textInspectorCancel",kAnalyticsDataTextTopBarEnterTextEditor:"editor:topBarEnterTextEditor",kAnalyticsDataTextDoubleTapEnterTextEditor:"editor:textEditStarted",kAnalyticsDataTextTopBarEnterCharacterStyleMode:"editor:topBarEnterCharStyleMode",kAnalyticsDataTextEditPaneEnterCharacterStyleMode:"editor:editPaneEnterCharStyleMode",kAnalyticsDataTextOnObjectEnterCharacterStyleMode:"editor:onObjectEnterCharStyleMode",kAnalyticsDataTextLongPressEnterCharacterStyleMode:"editor:longPressEnterCharStyleMode",kAnalyticsDataTextInCharacterStyleModePostfix:":inCharStyleMode",kAnalyticsDataTextEditorDone:"editor:textEditDone",kAnalyticsDataTextEditorCancel:"editor:textEditCancel",kAnalyticsDataSizeOpen:"editor:sizeSelected",kAnalyticsDataSizeConfirm:"editor:sizeConfirmed",kAnalyticsDataSizeCancel:"editor:sizeCancelled",kAnalyticsDataImageAdjustBlurOpen:"editor:imageEffectBlurSelected",kAnalyticsDataImageAdjustBlurConfirm:"editor:imageEffectBlurConfirmed",kAnalyticsDataImageAdjustBlurCancel:"editor:imageEffectBlurCancelled",kAnalyticsDataImageAdjustSharpenOpen:"editor:imageAdjustSharpenSelected",kAnalyticsDataImageAdjustSharpenConfirm:"editor:imageAdjustSharpenConfirmed",kAnalyticsDataImageAdjustSharpenCancel:"editor:imageAdjustSharpenCancelled",kAnalyticsDataImageAdjustContrastOpen:"editor:imageAdjustContrastSelected",kAnalyticsDataImageAdjustContrastConfirm:"editor:imageAdjustContrastConfirmed",kAnalyticsDataImageAdjustContrastCancel:"editor:imageAdjustContrastCancelled",kAnalyticsDataImageAdjustBrightnessOpen:"editor:imageAdjustBrightnessSelected",kAnalyticsDataImageAdjustBrightnessConfirm:"editor:imageAdjustBrightnessConfirmed",kAnalyticsDataImageAdjustBrightnessCancel:"editor:imageAdjustBrightnessCancelled",kAnalyticsDataImageAdjustSaturationOpen:"editor:imageAdjustSaturationSelected",kAnalyticsDataImageAdjustSaturationConfirm:"editor:imageAdjustSaturationConfirmed",kAnalyticsDataImageAdjustSaturationCancel:"editor:imageAdjustSaturationCancelled",kAnalyticsDataImageAdjustWarmthOpen:"editor:imageAdjustWarmthSelected",kAnalyticsDataImageAdjustWarmthConfirm:"editor:imageAdjustWarmthConfirmed",kAnalyticsDataImageAdjustWarmthCancel:"editor:imageAdjustWarmthCancelled",kAnalyticsDataImageAdjusted:"editor:imageAdjusted",kAnalyticsDataTypekitMetricsFailed:"typekit:metrics:failed",kAnalyticsDataTypekitInstalled:"typekit:installed",kAnalyticsDataTypekitPickerLaunch:"typekit:pickerLaunch",kAnalyticsDataTypekitBrowserLaunch:"typekit:browserLaunch",kAnalyticsDataTypekitApplyFontSDKPicker:"typekit:applyFontSDKPicker",kAnalyticsDataTypekitApplyFont:"typekit:applyFont",kAnalyticsDataExportFontUsage:"exportFontUsage",kAnalyticsDataWatermarkSelectedPerProject:"editor:watermarkSelected_perProject",kAnalyticsDataWatermarkSelectedShareToRemove:"editor:watermarkSelected_shareToRemove",kAnalyticsDataWatermarkRemovedPerProject:"editor:watermarkRemoved_perProject",kAnalyticsDataWatermarkRemovedShareToRemove:"editor:watermarkRemoved_shareToRemove",kAnalyticsDataWatermarkRemoveCancelledPerProject:"editor:watermarkRemoveCancelled_perProject",kAnalyticsDataWatermarkRemoveCancelledShareToRemove:"editor:watermarkRemoveCancelled_shareToRemove",kAnalyticsDataWatermarkShownPerProject:"editor:watermarkShown_perProject",kAnalyticsDataWatermarkShownShareToRemove:"editor:watermarkShown_shareToRemove",kAnalyticsDataWatermarkPerProjectCohort:"editor:perProjectWatermarkCohortAssignment",kAnalyticsDataWatermarkShareToRemoveCohort:"editor:shareToRemoveWatermarkCohortAssignment",kAnalyticsDataWatermarkHiddenCohort:"editor:noWatermarkCohortAssignment",kAnalyticsDataWatermarkSelectedRemoveOnce:"editor:watermarkSelected_removeOnce",kAnalyticsDataWatermarkSelectedPayToRemove:"editor:watermarkSelected_payToRemove",kAnalyticsDataWatermarkRemovedRemoveOnce:"editor:watermarkRemoved_removeOnce",kAnalyticsDataWatermarkRemovedPayToRemove:"editor:watermarkRemoved_payToRemove",kAnalyticsDataWatermarkRemoveCancelledRemoveOnce:"editor:watermarkRemoveCancelled_removeOnce",kAnalyticsDataWatermarkRemoveCancelledPayToRemove:"editor:watermarkRemoveCancelled_payToRemove",kAnalyticsDataWatermarkShownRemoveOnce:"editor:watermarkShown_removeOnce",kAnalyticsDataWatermarkShownPayToRemove:"editor:watermarkShown_payToRemove",kAnalyticsDataWatermarkPayToRemove:"editor:payToRemoveWatermarkVariantAssignment",kAnalyticsDataWatermarkRemoveOnce:"editor:removeOnceVariantAssignment",kAnalyticsDataWatermarkPressed:"editor:watermarkPressed",kAnalyticsDataFollowUsInstagramPressed:"organizer:followUsInstagramPressed",kAnalyticsDataFollowUsInstagramCancelled:"organizer:followUsInstagramCancelled",kAnalyticsDataSharePosterStartEvent:"share:shareBegin",kAnalyticsDataSharePosterCancel:"share:shareCancelled",kAnalyticsDataSharePosterSuccess:"share:shareSuccess",kAnalyticsDataSharePosterMetadata:"share:documentMetadata",kAnalyticsDataSharePosterRemixTemplatePublished:"share:remixTemplatePublished",kAnalyticsDataSharePosterCreateRemixAllowPressed:"share:createRemixAllowPressed",kAnalyticsDataSharePosterCreateRemixDismissPressed:"share:createRemixDismissPressed",kAnalyticsDataSharePosterDiscoverabilityChanged:"share:communityPlatformDiscoverabilityChanged",kAnalyticsDataSharePosterInstagramStoryPressed:"share:instagramStoryPressed",kAnalyticsDataSharePosterSnapchatPressed:"share:snapchatPressed",kAnalyticsDataSharePosterCreateTemplateTapped:"share:createTemplateTapped",kAnalyticsDataSharePosterFacebookTapped:"share:facebookTapped",kAnalyticsDataSharePosterTwitterTapped:"share:twitterTapped",kAnalyticsDataSharePosterInstagramTapped:"share:instagramTapped",kAnalyticsDataSharePosterMessagesTapped:"share:messagesTapped",kAnalyticsDataSharePosterWhatsAppTapped:"share:whatsAppTapped",kAnalyticsDataSharePosterMailTapped:"share:mailTapped",kAnalyticsDataSharePosterCopyLinkTapped:"share:copyLinkTapped",kAnalyticsDataSharePosterCopySaveToCameraRollTapped:"share:saveToCameraRollTapped",kAnalyticsDataSharePosterMoreTapped:"share:moreTapped",kAnalyticsDataSharePosterDoneTapped:"share:doneTapped",kAnalyticsDataSharePosterCancelTapped:"share:cancelTapped",kAnalyticsDataSharePosterSuccessAction:"Content Publishes",kAnalyticsDataResharePosterSuccessAction:"Content Republishes",kAnalyticsDataSharePosterTransparentBackgroundTapped:"share:transparentBackgroundTapped",kAnalyticsDataSharePosterSolidBackgroundTapped:"share:solidBackgroundTapped",kAnalyticsDataFormaColorSelected:"editor:formaColorSelected",kAnalyticsDataFormaColorConfirm:"editor:formaColorConfirmed",kAnalyticsDataFormaColorCancel:"editor:formaColorCancelled",kAnalyticsDataFormaColorChanged:"editor:formaColorChanged",kAnalyticsDataOrganizerLoad:"app:launch",kAnalyticsDataTemplatesPressed:"home:templatesPressed",kAnalyticsDataMyPostsPressed:"home:myPostsPressed",kAnalyticsDataScrollFeaturedPosters:"lobby:scrollFeaturedPosters",kAnalyticsDataScrollMyDesigns:"lobby:scrollMyDesigns",kAnalyticsDataCreateNewTapped:"lobby:createNewTapped",kAnalyticsDataFollowOpenInstagram:"lobby:followInstagramOpened",kAnalyticsDataFollowOpenSafari:"lobby:followSafariOpened",kAnalyticsDataFollowInspirationInstagramDidDisplayButtonOnTop:"inspirationInstagramDidDisplayButtonOnTop",kAnalyticsDataFollowInspirationInstagramDidDisplayButtonOnBottom:"inspirationInstagramDidDisplayButtonOnBottom",kAnalyticsDataFollowInspirationInstagramDidPressHeader:"inspirationInstagramDidPressHeader",kAnalyticsDataFollowInspirationInstagramDidPressFooter:"inspirationInstagramDidPressFooter",kAnalyticsDataFollowSettingsInstagram:"settingsInstagramButtonPressed",kAnalyticsDataFollowSettingsTwitter:"settingsTwitterButtonPressed",kAnalyticsDataFollowSettingsFacebook:"settingsFacebookButtonPressed",kAnalyticsDataSettingsAccountViewed:"settingsAccountViewed",kAnalyticsDataViralShareWatermark:"viral:wm:sharedViaViral",kAnalyticsDataViralShareWithLinkWatermark:"wm:Viral Link",kAnalyticsDataViralShareWatermarkAttempt:"viral:wm:shareAttempt",kAnalyticsDataViralShareWatermarkCancel:"viral:wm:shareFail",kAnalyticsDataViralSharePremium:"viral:p:sharedViaViral",kAnalyticsDataViralShareWithLinkPremium:"p:Viral Link",kAnalyticsDataViralSharePremiumAttempt:"viral:p:shareAttempt",kAnalyticsDataViralSharePremiumCancel:"viral:p:shareFail",kAnalyticsDataViralSummitLogo:"viral:summitLogo:sharedViaViral",kAnalyticsDataViralSummitLogoRemove:"viral:summitLogo:remove",kAnalyticsDataApplicationDidBecomeActive:"applicationDidBecomeActive",kAnalyticsDataCancel:"rating:cancel",kAnalyticsDataLoveIt:"rating:loveIt:corrected",kAnalyticsDataFeedback:"rating:feedback:corrected",kAnalyticsOnboardingScreenViewed:"onboarding:screenViewed",kAnalyticsOnboardingScreenDismissed:"onboarding:screenDismissed",kAnalyticsOnboardingStartNowClicked:"onboarding:startNowClicked",kAnalyticsOnboardingSkipToSignInClicked:"onboarding:skipToSignInClicked",kAnalyticsOnboardingNextClicked:"onboarding:nextClicked",kAnalyticsOnboardingBackClicked:"onboarding:backClicked",kAnalyticsDataLoginFailed:"login:failed",kAnalyticsDataLoginBeganAccountCreation:"login:facebook:beganAccountCreation",kAnalyticsDataLoginTOSDisplayed:"login:facebook:tos:displayed",kAnalyticsDataLoginTOSAccepted:"login:facebook:tos:accepted",kAnalyticsDataLoginMarketingOptInDisplayed:"login:facebook:marketingOptIn:displayed",kAnalyticsDataLoginMarketingOptInOptionSelected:"login:facebook:marketingOptIn:optionSelected",kAnalyticsDataLoginMarketingOptInDoneClicked:"login:facebook:marketingOptIn:doneClicked",kAnalyticsDataLoginMarketingOptInLearnMoreClicked:"login:facebook:marketingOptIn:learnMoreClicked",kAnalyticsSummitDesignsUnlocked:"lobby:unlockSummitDesigns",kAnalyticsDataAnimationCancel:"editor:animation:animationCancel",kAnalyticsDataAnimationPressed:"editor:animationPressed",kAnalyticsDataAnimationViewed:"editor:animationViewed",kAnalyticsDataAnimationPreviewed:"animationPreviewed",kAnalyticsDataAnimationConfirmed:"animationConfirmed",kAnalyticsDataAnimationExportCancelled:"project:exportCancelled",kAnalyticsDataAnimationExportBegan:"project:exportBegan",kAnalyticsDataCategoryEntered:"organizer:category:entered",kAnalyticsDataCategoryExited:"organizer:category:exited",kAnalyticsDataPreviewEntered:"organizer:preview:entered",kAnalyticsDataPreviewExited:"organizer:preview:exited",kAnalyticsDataPreviewCancelled:"organizer:preview:cancelled",kAnalyticsDataPreviewDownloadSuccess:"organizer:preview:download:success",kAnalyticsDataPreviewDownloadFailed:"organizer:preview:download:failed",kAnalyticsDataPreviewDownloadRetry:"organizer:preview:download:retry",kAnalyticsDataPreviewTemplateName:"organizer:preview:templateName",kAnalyticsDataPreviewAuthorName:"organizer:preview:authorName",kAnalyticsDataPreviewRemixCountIcon:"organizer:preview:remix:countIconPressed",kAnalyticsDataPreviewRemixCountLabel:"organizer:preview:remix:countLabelPressed",kAnalyticsDataPreviewRemixMoreOptions:"organizer:preview:remix:moreOptionsPressed",kAnalyticsDataPreviewRemixMoreOptionsCopyLink:"organizer:preview:remix:moreOptions:copyLink",kAnalyticsDataPreviewRemixMoreOptionsShare:"organizer:preview:remix:moreOptions:share",kAnalyticsDataPreviewRemixMoreOptionsReport:"organizer:preview:remix:moreOptions:report",kAnalyticsDataPreviewRemixMoreOptionsCancel:"organizer:preview:remix:moreOptions:cancel",kAnalyticsDataTemplateSearchTapped:"templateSearchTapped",kAnalyticsDataTemplateSearchBegan:"templateSearchBegan",kAnalyticsDataTemplateSearchQuerySubmitted:"templateSearchSubmitted",kAnalyticsDataTemplateSearchCancelled:"templateSearchCancelled",kAnalyticsDataTemplateFeedViewed:"templateFeedViewed",kAnalyticsDataTemplatePressed:"templatePressed",kAnalyticsDataTemplateUpgradePressed:"template:upgradePressed",kAnalyticsDataPaidWelcomeViewed:"paidWelcomeViewed",kAnalyticsDataProjectExportCompleted:"project:exportCompleted",kAnalyticsDataProjectExportCompletedDNA:"project:exportCompletedDNA",kAnalyticsDataSparkFormat:"sparkFormat",kAnalyticsDataPreviewPosterMoreOptions:"organizer:preview:poster:moreOptionsPressed",kAnalyticsDataPreviewPosterMoreOptionsCopyLink:"organizer:preview:poster:moreOptions:copyLink",kAnalyticsDataPreviewPosterMoreOptionsUnpublish:"organizer:preview:poster:moreOptions:unpublish",kAnalyticsDataPreviewPosterMoreOptionsRename:"organizer:preview:poster:moreOptions:rename",kAnalyticsDataPreviewPosterMoreOptionsMoveProject:"organizer:preview:poster:moreOptions:moveProject",kAnalyticsDataPreviewPosterMoreOptionsCancel:"organizer:preview:poster:moreOptions:cancel",kAnalyticsDataPreviewPosterRenameConfirm:"organizer:preview:poster:moreOptions:rename:renameConfirm",kAnalyticsDataPreviewPosterRenameCancel:"organizer:preview:poster:moreOptions:rename:renameCancel",kAnalyticsDataTemplatePreviewed:"templatePreviewed",kAnalyticsDataPeekPost:"organizer:peek:post",kAnalyticsDataPopPost:"organizer:pop:post",kAnalyticsDataPeekTemplate:"organizer:peek:template",kAnalyticsDataPopTemplate:"organizer:pop:template",kAnalyticsDataPeekRemix:"organizer:peek:remix",kAnalyticsDataPopRemix:"organizer:pop:remix",kAnalyticsDataProjectEnterSelectionMode:"organizer:selectionMode:entered",kAnalyticsDataProjectCancelSelectionMode:"organizer:selectionMode:cancelled",kAnalyticsDataProjectSelected:"organizer:selectionMode:selectProject",kAnalyticsDataProjectDeselected:"organizer:selectionMode:deselectProject",kAnalyticsDataProjectsDeleted:"organizer:selectionMode:deleteProject",kAnalyticsDataProjectsMoved:"organizer:selectionMode:moveProjects",kAnalyticsDataProjectsWorkspaceSelection:"organizer:selectionMode:moveProjects:pickerSelected",kAnalyticsDataBrandkitPickerSelected:"organizer:brandkit:pickerSelected",kAnalyticsDataBrandkitPickerCancelled:"organizer:brandkit:pickerCancelled",kAnalyticsDataBrandkitSetActive:"organizer:brandkit:setActive",kAnalyticsDataBrandkitMoveProject:"organizer:brandkit:moveProject",kAnalyticsDataBrandkitElementUsed:"brandkit:elementUsed",kAnalyticsDataBrandkitCreatediOS:"brandkit:created:ios",kAnalyticsDataBrandkitCreatedAndroid:"brandkit:created:android",kAnalyticsDataDisplayMerchandising:"displayMerchandising",kAnalyticsDataDisplayPurchasePanel:"displayPurchasePanel",kAnalyticsDataDismissPurchasePanel:"dismissPurchasePanel",kAnalyticsDataDismissReasonSuccess:"success",kAnalyticsDataDismissReasonFailure:"failure",kAnalyticsDataDismissReasonCancel:"cancel",kAnalyticsDataMerchandisingSourceWatermark:"watermark",kAnalyticsDataMerchandisingSourceResize:"resize",kAnalyticsDataMerchandisingSourceLogo:"logo",kAnalyticsDataMerchandisingSourceAccount:"account",kAnalyticsDataMerchandisingSourceSettings:"settings",kAnalyticsDataMerchandisingSourceBrandify:"brandify",kAnalyticsDataMerchandisingSourceBrandedTemplate:"brandedTemplate",kAnalyticsDataMerchandisingSourceEditPost:"editPost",kAnalyticsDataMerchandisingSourceDesign:"enterDesign",kAnalyticsDataMerchandisingSourcePremiumTemplate:"premiumTemplate",kAnalyticsDataMerchandisingMessagingModalPremiumTemplate:"messagingModalPremiumTemplateUpgrade",kAnalyticsDataMerchandisingSourceFontPicker:"fontPicker",kAnalyticsDataMerchandisingSourceDeepLink:"deepLink",kAnalyticsDataMerchandisingSourceUseLibraryAssets:"messagingModalMerchLibraryUseAssets",kAnalyticsDataMerchandisingSourceAdobeStock:"adobeStock",kAnalyticsDataLivePhotoAdded:"editor:livePhotoAdded",kAnalyticsDataLivePhotoStillAdded:"editor:livePhotoStillAdded",kAnalyticsEventPushNotification:"pushNotifictionRegistrationStatus",kAnalyticsEventPushNotificationChanged:"pushNotifictionRegistrationStatusChanged",kAnalyticsDataImagePickerSelected:"imagePicker:pickerSelected",kAnalyticsDataImagePickerImageChanged:"imagePicker:imageChanged",kAnalyticsDataImagePickerCancelled:"imagePicker:pickerCancelled",kAnalyticsDataImagePickerSourceSelected:"imagePicker:sourceSelected",kAnalyticsDataImagePickerSourceCancelled:"imagePicker:sourceCancelled",kAnalyticsDataPeekImage:"imagePicker:peek:image",kAnalyticsDataPopImage:"imagePicker:pop:image",kAnalyticsDataDiagnosticsMessageEvent:"diagnostics:message",kAnalyticsDataExperimentAudienceDetermined:"experiments:audienceDetermined",kAnalyticsDataRemixInspirationUpdated:"organizer:remixInspirationUpdated",kAnalyticsSocialRemixTriggered:"socialRemix:triggered",kAnalyticsSocialRemixPresentedSignInToast:"socialRemix:presentedSignInToast",kAnalyticsSocialScreenUnwound:"socialRemix:screenUnwound",kAnalyticsTepidCreatorOpen:"pushNotification:tepidCreator:open",kAnalyticsTepidCreatorRegister:"pushNotification:tepidCreator:register",kAnalyticsTepidCreatorUnregister:"pushNotification:tepidCreator:unregister",kSettingsOptionSelectedPrefix:"settingOption:selected",kAnalyticsEventSearchAd:"searchAdAttribution",kAnalyticsEventUserNotFromSearchAd:"searchAdAttribution:userNotFromSearchAd",kAnalyticsEventDoclistStartup:"doclistStartup",kAnalyticsEventDocCompleteSync:"docSyncComplete",kAnalyticsEventDoclistPurge:"doclistPurge",kAnalyticsDataResizeStart:"resize:resizeBegin",kAnalyticsDataResizeCancel:"resize:resizeCancel",kAnalyticsDataResizeConfirm:"resize:resizeConfirmed",kAnalyticsDataResizeChange:"resize:changeSize",kAnalyticsEventUsedBrandkitPalette:"usedBrandKitPalette",kAnalyticsEventUsedBrandkitBGColor:"usedBrandKitBGColor",kAnalyticsEventUsedBrandkitFontColor:"usedBrandKitFontColor",kAnalyticsEventUsedBrandkitFont:"usedBrandKitFont",kAnalyticsEventUsedBrandkitLogo:"brandKitLogoApplied",kAnalyticsEventReplacedBrandkitLogo:"brand:logoReplaced",kAnalyticsLabelSource:"Source",kAnalyticsLabelReason:"reason",kAnalyticsAccessGranted:"accessGranted",kAnalyticsElementType:"elementType",kAnalyticsDataDocumentID:"document:id",kAnalyticsDataDocumentCommunityPlatformAssetID:"document:communityPlatformAssetID",kAnalyticsDataDeepLink:"deepLink",kAnalyticsDataDocumentCommunityPlatformDiscoverable:"document:communityPlatformDiscoverable",kAnalyticsDataAdobe360WorkflowInitiated:"adobe360Workflow:initiated",kAnalyticsDataAdobe360WorkflowCompleted:"adobe360Workflow:completed",kAnalyticsDataDocumentSourceID:"document:source:id",kAnalyticsDataDocumentSourceType:"document:source:type",kAnalyticsDataDocumentMetadata:"document:metadata",kAnalyticsDataDocumentMetadata2:"document:metadata2",kAnalyticsDataDocumentMetadata3:"document:metadata3",kAnalyticsDataDocumentMetadata4:"document:metadata4",kAnalyticsOnboardingScreenID:"onboarding:screenID",kAnalyticsOnboardingScreenViewDuration:"onboarding:screenViewDurationInSeconds",kAnalyticsDataSharesInCurrentVersion:"rate:sharesInCurrent",kAnalyticsDataSharesInAllVersions:"rate:sharesInAllVersions",kAnalyticsDataLoginFacebookIMSLoginMethod:"login:facebook:imsLoginMethod",kAnalyticsDataLoginFailedErrorCode:"login:failed:errorCode",kAnalyticsDataLoginFailedIMSErrorString:"login:failed:imsErrorString",kAnalyticsDataLoginFailedUnderlyingErrorDomain:"login:failed:underlyingErrorDomain",kAnalyticsDataLoginFailedUnderlyingErrorCode:"login:failed:underlyingErrorCode",kAnalyticsDataLoginFailedUnderlyingErrorUserInfo:"login:failed:underlyingErrorUserInfo",kAnalyticsDataLoginMarketingOptInValue:"login:facebook:marketingOptIn:optInValue",kAnalyticsDataAnimationExportType:"animation:animationExportType",kAnalyticsDataWheelDetent:"editor:wheelDetent",kAnalyticsDataNumLockups:"editor:numLockups",kAnalyticsDataSelectionCount:"editor:selection:count",kAnalyticsDataSelectionValue:"editor:selection:value",kAnalyticsDataCategory:"organizer:category:id",kAnalyticsDataPreviewIsForDirectRemix:"organizer:preview:isForDirectRemix",kAnalyticsDataDeviceToken:"devicetoken",kAnalyticsDataBundleIdentifier:"bundleIdentifier",kAnalyticsDataPushNotificationOpen:"pushNotification:open",kAnalyticsDataPushNotificationConfirm:"pushNotification:confirm",kAnalyticsDataPushNotificationCancel:"pushNotification:cancel",kAnalyticsDataPaletteID:"editor:palette:id",kAnalyticsDataFilterID:"editor:filter:id",kAnalyticsDataCutoutID:"editor:cutout:id",kAnalyticsDataThemeID:"editor:theme:id",kAnalyticsDataAnimationID:"editor:animation:id",kAnalyticsDataFontID:"editor:font:id",kAnalyticsDataBackingShapeID:"editor:backingShape:id",kAnalyticsDataTextLookID:"editor:textLook:id",kAnalyticsDataColorID:"editor:color:id",kAnalyticsDataLayoutID:"editor:layout:id",kAnalyticsDataLayoutSpacing:"editor:layout:spacing",kAnalyticsDataLayoutMargin:"editor:layout:margin",kAnalyticsDataTextLineHeight:"editor:text:lineHeight",kAnalyticsDataTextPadding:"editor:text:padding",kAnalyticsDataTextTracking:"editor:text:tracking",kAnalyticsDataTextShadowAngle:"editor:text:shadowAngle",kAnalyticsDataResizeSizeID:"resize:sizeID",kAnalyticsDataResizeInitialSize:"resize:initialSize",kAnalyticsDataDiagnosticsIssueId:"diagnostics:issueId",kAnalyticsDataDiagnosticsMessage:"diagnostics:message",kAnalyticsDataExperimentId:"experiments:audienceDetermined:experimentId",kAnalyticsDataExperimentAudienceId:"experiments:audienceDetermined:audienceId",kAnalyticsDataSocialRemixSource:"socialRemix:source",kAnalyticsDataSocialScreenID:"socialRemix:screenUnwound:screenId",kAnalyticsDataSearchAdIadAttribution:"searchAdAttribution:iadAttribution",kAnalyticsDataSearchAdClickDate:"searchAdAttribution:clickDate",kAnalyticsDataSearchAdKeyword:"searchAdAttribution:keyword",kAnalyticsDataSearchAdConversionDate:"searchAdAttribution:conversionDate",kAnalyticsDataSearchAdCampaignId:"searchAdAttribution:campaignId",kAnalyticsDataSearchAdCampaignName:"searchAdAttribution:campaignName",kAnalyticsDataSearchAdOrgName:"searchAdAttribution:orgName",kAnalyticsDataSearchAdCreativeId:"searchAdAttribution:creativeId",kAnalyticsDataSearchAdCreativeName:"searchAdAttribution:creativeName",kAnalyticsDataSearchAdLineItemId:"searchAdAttribution:lineItemId",kAnalyticsDataSearchAdLineItemName:"searchAdAttribution:lineItemName",kAnalyticsDataSearchAdGroupId:"searchAdAttribution:adGroupId",kAnalyticsDataSearchAdGroupName:"searchAdAttribution:adGroupName",kAnalyticsEventBranchIoReferredFromBranchLink:"branchIo:referredFromBranchLink",kAnalyticsDataBranchIoReferringLink:"branchIoReferringLink",kAnalyticsDataBranchIoMarketingTitle:"branchIoMarketingTitle",kAnalyticsDataBranchIoCampaign:"branchIoCampaign",kAnalyticsDataBranchIoChannel:"branchIoChannel",kAnalyticsDataBranchIoIsFirstSession:"branchIoIsFirstSession",kAnalyticsDataBranchIoRemixablePostCpid:"branchIoRemixablePostCpid",kAnalyticsDataBrandkitEnabled:"brandkit:enabled",kAnalyticsDataBrandkitId:"brandkit:id",kAnalyticsDataBrandkitCount:"brandkit:count",kAnalyticsDataBrandkitTemplateName:"brandkit:template:name",kAnalyticsDataBrandkitNewPost:"brandkit:newPost",kAnalyticsDataNewProject:"newProject",kAnalyticsDataRemixDesign:"Remix Design",kAnalyticsDataNotFound:"Not found",kAnalyticsDataTrue:"true",kAnalyticsDataFalse:"false",kAnalyticsEventAssertFailed:"assertFailed",kAnalyticsEventClickOccured:"multiselect:clickOccured",kAnalyticsEventCoeditingMobileBlockDialogViewed:"coediting:mobileBlockViewed",kAnalyticsEventCoeditingMobileBlockWebPageDialogViewed:"coediting:mobileDialogueViewed",kAnalyticsEventCoeditingProjectPreviewed:"coediting:projectPreviewed",kAnalyticsEventCollabLeavePressed:"collab:leavePressed",kAnalyticsEventCoeditingDeleteCollabErrorViewed:"coediting:deleteCollabErrorViewed",kAnalyticsEventCollabStockDuplicateBlocked:"collab:stockDuplicateBlocked",kDesignIngredientAdded:"designIngredient:added",kDesignIngredientBackingShapeChanged:"editor:textLockupShapeChanged",kDesignIngredientFontChanged:"editor:textLockupFontSelected",kDesignIngredientColorChanged:"editor:textLockupColorSelected",kAnalyticsLayoutCenterType:"center",kAnalyticsLayoutLeftType:"left",kAnalyticsLayoutRightType:"right",kAnalyticsLayoutMagicType:"magic",kAnalyticsLayoutCurvedType:"curvedText",kAnalyticsLayoutGridType:"gridText",kAnalyticsLayoutAutoType:"autoText",kAnalyticsLayoutCircleType:"circle",kAnalyticsLayoutSemiCircleType:"semiCircle",kAnalyticsLayoutInvertedSemiCircleType:"invertedSemiCircle",kAnalyticsLayoutLetterGridLeftType:"letterGridLeft",kAnalyticsLayoutLetterGridRightType:"letterGridRight",kAnalyticsLayoutLetterGridCenterType:"letterGridCenter",kAnalyticsLayoutAutoDropCapType:"autoDropCap",kAnalyticsLayoutAutoTripletType:"autoTriplet",kAnalyticsLayoutAutoRotateType:"autoRotate",kAnalyticsLayoutAutoRotateFitType:"autoRotateFit",kAnalyticsEventIconChosen:"iconChosen",kAnalyticsEventImageChosen:"imageChosen",kAnalyticsDataImageSourceType:"imageSource",kAnalyticsDataImageSourceTypeAdobeStock:"adobestock",kAnalyticsDataImageSourceTypeLightroom:"lightroom",kAnalyticsDataImageSourceTypeLibraries:"libraries",kAnalyticsDataImageSourceTypeCamera:"camera",kAnalyticsDataImageSourceTypeCameraRoll:"cameraRoll",kAnalyticsDataImageSourceTypeUpload:"upload",kAnalyticsDataImageSourceTypeDropbox:"dropbox",kAnalyticsDataImageSourceTypeGooglePhotos:"gphotos",kAnalyticsDataImageSourceTypeGoogleDrive:"gdrive",kAnalyticsDataImageSourceTypeAdobeStockFree:"stock:free",kAnalyticsDataImageSourceTypePixabay:"dooplo:pixabay",kAnalyticsDataImageSourceTypeNounProject:"dooplo:nounproject",kAnalyticsDataImageSourceTypeFiles:"fileBrowser",kAnalyticsDataImageSourceTypePatterns:"patterns",kAnalyticsDataImageSourceTypeSolidColor:"solidColor",kAnalyticsDataImageSourceTypePhotoLibrary:"photoLibrary",kAnalyticsDataImageSourceTypeVideos:"videos",kAnalyticsDataImageSourceTypeStockPhotos:"stockPhotos",kAnalyticsDataImageSourceTypeFiles2:"files",kAnalyticsEventCCLImageAssetsSourcePressed:"ccLibrarySourcePressed",kAnalyticsEventCCLImageAssetsPlaceImage:"imageChosen",kAnalyticsEventCCLImageAssetsPlaceImageSource:"imageSource",kAnalyticsEventBlendModePressed:"editor:blendModePressed",kAnalyticsEventBlendModeSelected:"editor:blendModeSelected",kAnalyticsEventPhotoAdded:"editor:photoAdded",kAnalyticsEventPhotoAddPressed:"editor:photoAddPressed",kAnalyticsEventDesignAssetsPressed:"editor:designAssetsPressed",kAnalyticsEventDesignAssetsAddPressed:"editor:designAssetAddPressed",kAnalyticsEventBackgroundsPressed:"editor:backgroundsPressed",kAnalyticsEventBackgroundsAddPressed:"editor:backgroundAddPressed",kAnalyticsEventAssetAdded:"editor:assetAdded",kAnalyticsEventBackgroundAdded:"editor:backgroundAdded",kAnalyticsEventMorePressed:"editor:morePressed",kAnalyticsEventKeywordEntered:"search:keywordEntered",kAnalyticsEventPhotosPressed:"editor:photosPressed",kAnalyticsDataAssetPath:"assetPath",kAnalyticsDataFilters:"filters",kAnalyticsDataIsPremium:"isPremium",kAnalyticsDataKeyword:"keyword",kAnalyticsDataAssetId:"assetID",kAnalyticsDataParentPath:"parentPath",kAnalyticsDataImageLayer:"imageLayer",kAnalyticsDataImageFloating:"floating",kAnalyticsDataImageBackground:"background",kAnalyticsDataIsReplacing:"isReplacing",kAnalyticsDataType:"type",kAnalyticsDataLocation:"location",kAnalyticsDataResultsCount:"resultsCount",kAnalyticsDataSourceDesignAssets:"designAssets",kAnalyticsDataSourceBackgrounds:"backgrounds",kAnalyticsDataSourcePhotos:"photos",kAnalyticsDataSourceTemplates:"templates",kAnalyticsDataSourceProjects:"projects",kAnalyticsDataSource:"source",kAnalyticsDataEditor:"editor",kAnalyticsDataHome:"home",kAnalyticsDataTemplateSearch:"templateSearch",kAnalyticsDataTemplateLocation:"templateLocation",kAnalyticsDataCreateLocation:"createLocation",kAnalyticsDataHomeSelectTemplate:"homeSelectTemplate",kAnalyticsDataHomeTemplateSearch:"homeTemplateSearch",kAnalyticsDataHomeCreateFromScratchTaskModule:"homeCreateFromScratchTaskModule",kAnalyticsDataCollection:"collection",kAnalyticsMobileRebrandOnboardingCompleted:"mobileRebrandOnboardingCompleted",kAnalyticsDataImagesNumber:"numOfImages",kAnalyticsEventDesignFilterSelected:"editor:designFilterSelected",kAnalyticsGenericNone:"none",kAnalyticsEventHomePageViewed:"homePageViewed",kAnalyticsEventTemplatesUseCaseClicked:"project:useCaseClicked",kAnalyticsEventTemplatesMorePressed:"morePressed",kAnalyticsEventMenuPlusPressed:"menuPlusPressed",kAnalyticsMenuPlusMorePressed:"menuPlusMorePressed",kAnalyticsMenuQuickActionClicked:"quickAction:ctaPressed",kAnalyticsMenuQuickAction:"menuQuickAction",kAnalyticsEventMenuQuickActionPressed:"menuQuickActionPressed",kAnalyticsMenuMore:"more",kAnalyticsMenuRemoveBackground:"removeBackground",kAnalyticsMenuImageResize:"imageResize",kAnalyticsMenuConvertToGIF:"convertToGIF",kAnalyticsMenuComingSoon:"comingSoon",kAnalyticsMenuMenuPlus:"menuPlus",kAnalyticsMenuQuickActionType:"quickActionType",kAnalyticsMenuActionLocation:"actionLocation",kAnalyticsMenuUseCaseTrigger:"useCaseTrigger",kAnalyticsMenuUseCaseLabel:"useCaseLabel"}}),r)},"13MC":function(e,t,n){var r,o,i,a,s,l,u,c,d=t,h=n("oAGj"),p=n("N5RB"),f=n("fVJ2"),m=n("dJuF"),g=n("SmK9"),y=n("fNpk");d.IDBObjectState=h.defineProtocol("IDBObjectState",{id:"String",className:"String",properties:"Dictionary<String>",allProperties:"Dictionary<String>",object:"IDBObject",checkpoint:"() -> IDBObjectState",getProperty:"(String) -> DBProperty",apply:"(Array<IDBObjectState>) -> Void",diff:"(IDBObjectState) -> Dictionary<String>",depth:"Integer",forEachProperty:"(Boolean, (String, DBProperty) -> Void) -> Void"}),d.IDBObjectAncestorState=h.defineProtocol("IDBObjectAncestorState",{isAncestorOf:"(IDBObjectDerivedState) -> Boolean"}),d.IDBObjectDerivedState=h.defineProtocol("IDBObjectDerivedState",{basedOn:"IDBObjectAncestorState"}),d.IDBObjectMutableState=h.defineProtocol("IDBObjectMutableState",{setProperty:"(String, DBProperty) -> Void",updateProperty:"(String, Any, DBPropertyCodec) -> Boolean",removeProperty:"(String) -> Void",clear:"() -> Void",assign:"(IDBObject) -> IDBObjectState",commit:"() -> IDBObjectState"}),d.IDBObjectMutableAncestorState=h.defineProtocol("IDBObjectMutableAncestorState",{flattenFrom:"(IDBObjectDerivedState) -> Void"}),d.IDBObjectMutableDerivedState=h.defineProtocol("IDBObjectMutableDerivedState",{}),d.IDBState=h.defineProtocol("IDBState",{guid:"String",branch:"String",basedOn:"IDBState",database:"IDatabase",objectStates:"Dictionary<String>",allObjectStates:"Dictionary<String>",transaction:"ITransaction",mutableState:"IDBMutableState",beginTransaction:"(String) -> ITransaction",getDerivedState:"(String) -> IDBState",apply:"() -> Void",getObjectStateByID:"(String) -> IDBObjectState",getObjectState:"(DBObject) -> IDBObjectState",forEachObjectState:"(Boolean, (String, IDBObjectState) -> Void) -> Void",validate:"() -> IDBValidationResult",encode:"(IExportDataObject, Integer) -> Void"}),d.IDBMutableState=h.defineProtocol("IDBMutableState",{parentTransaction:"ITransaction",makeObjectMutable:"(DBObject) -> Void",newObjectState:"(DBObject) -> IDBObjectMutableState",setObjectState:"(DBObject, IDBObjectState) -> Void",addNewObject:"(DBObject, IDBObjectState) -> Void",removeObject:"(String) -> Void",commit:"() -> IDBState",abandon:"() -> Void",flattenFrom:"(IDBState) -> Void"}),d.DBObjectBaseState=(r=function(){},h.defineClass({name:"DBObjectBaseState",ctor:r,props:{basedOn:{get:function(){return null}},isAncestorOf:function(e){for(var t=e.basedOn;null!=t;){if(t===this)return!0;t=h.opt(h.as(t,d.IDBObjectDerivedState),(function(e){return e.basedOn}))}return!1},properties:{get:function(){return{}}},id:{get:function(){return h.opt(this.properties.id,(function(e){return e.stringValue}))}},depth:{get:function(){return 0}},allProperties:{get:function(){var e=h.clone(this.properties);if(null!=this.basedOn)for(var t=h.iter(h.opt(this.basedOn,(function(e){return e.allProperties})));!t.done;t.next()){var n=t.key,r=t.value;null==e[n]&&(e[n]=r)}for(var o=h.keys(e).filter((function(t){return e[t]instanceof m.DBDeletedProperty}),this),i=h.iter(o);!i.done;i.next()){var a=i.value;h.removeKey(e,a)}return e}},getProperty:function(e){return this.properties[e]||h.opt(this.basedOn,(function(t){return t.getProperty(e)}))},diff:function(e){var t=this,n={};if(e!==this)if(null!=this.basedOn&&h.as(e,d.IDBObjectAncestorState)===this.basedOn)this.forEachProperty(!1,(function(t,r){var o;(o=e.getProperty(t))?o.isEqual(r)||(n[t]=[r,o]):n[t]=[r,null]}));else if(h.opt(h.as(e,d.IDBObjectDerivedState),(function(e){return e.basedOn===t})))e.forEachProperty(!1,(function(e,r){var o;(o=t.getProperty(e))?o.isEqual(r)||(n[e]=[o,r]):n[e]=[null,r]}));else{var r=h.clone(this.allProperties);e.forEachProperty(!0,(function(e,t){var o;(o=h.removeKey(r,e))?o.isEqual(t)||(n[e]=[o,t]):n[e]=[null,t]})),h.each(r,(function(e,t){n[e]=[t,null]}))}return n},forEachProperty:function(e,t){var n,r={};h.each(this.properties,(function(e,n){t(e,n),r[e]=!0})),e&&(n=this.basedOn)&&n.forEachProperty(!0,(function(e,n){null==r[e]&&(t(e,n),r[e]=!0)}))},notifyParentChange:function(e,t,n){if(null!=t&&0==!t.length)for(var r=h.iter(t);!r.done;r.next()){var o,i=r.value;if(o=h.as(i,d.DBChildObjectState)){for(var a=o.propertyPath,s=h.as(h.opt(o.parentObject,(function(e){return e.state})),d.DBChildObjectState);null!=s;)a=s.propertyPath.appendPath(a),s=h.as(h.opt(h.opt(s,(function(e){return e.parentObject})),(function(e){return e.state})),d.DBChildObjectState);n(o,o.deltaForPropertyPath(e,a))}}},notifyParentWillChange:function(e,t){this.notifyParentChange(e,t,(function(e,t){return e.parentWillChangeState(t)}))},notifyParentDidChange:function(e,t){this.notifyParentChange(e,t,(function(e,t){return e.parentDidChangeState(t)}))}}}),r),d.DBObjectDeletedState=(o=function(e){this.obj_=e},h.defineClass({name:"DBObjectDeletedState",ctor:o,statics:{_implements:function(e){return"IDBObjectState"==e}},props:{id:{get:function(){return null}},className:{get:function(){return""}},properties:{get:function(){return{}}},allProperties:{get:function(){return{}}},object:{get:function(){return this.obj_}},checkpoint:function(){return new o(this.object)},depth:{get:function(){return 0}},getProperty:function(e){return null},apply:function(e){},diff:function(e){var t={};if(e!==this)for(var n=h.clone(e.allProperties),r=h.iter(h.keys(n));!r.done;r.next()){var o=r.value;t[o]=[null,n[o]]}return t},forEachProperty:function(e,t){}}}),o),d.DBObjectState=(i=function(){},h.defineClass({name:"DBObjectState",ctor:i,superName:"DBObjectBaseState",statics:{_implements:function(e){return"IDBObjectDerivedState"==e||"IDBObjectState"==e||"IDBObjectAncestorState"==e}},props:{init_be8f:function(e){this.basedOn_=null,this.properties_={},this.obj_=e,this.className_=e.className,d.DBObjectBaseState.call(this)},init_2a9a:function(e,t){this.basedOn_=null,this.properties_=h.clone(t),this.obj_=e,this.className_=e.className,d.DBObjectBaseState.call(this)},init_9f95:function(e,t){this.basedOn_=e,this.properties_=h.clone(t),this.obj_=e.obj_,this.className_=e.className_,y.LegacyCoreAssert.isTrue(null!=this.obj_,"Created a new state on an object that has been destroyed.",void 0,"DBObjectState.init","DBState.swift",445),d.DBObjectBaseState.call(this)},basedOn:{get:function(){return this.basedOn_}},className:{get:function(){return this.className_}},properties:{get:function(){return this.properties_}},getProperty:function(e){return this.properties_[e]||h.opt(this.basedOn_,(function(t){return t.getProperty(e)}))},object:{get:function(){return this.obj_}},checkpoint:function(){return i.init_2a9a(this.object,this.allProperties)},apply:function(e){if(this.obj_.state!==this){var t=h.clone(this.diff(this.obj_.state));h.count(t)>0&&this.notifyParentWillChange(t,e),this.obj_.state=this,h.count(t)>0&&this.notifyParentDidChange(t,e)}}}}),i),d.DBObjectMutableState=(a=function(){this.mutableProperties_={}},h.defineClass({name:"DBObjectMutableState",ctor:a,superName:"DBObjectBaseState",statics:{_implements:function(e){return"IDBObjectDerivedState"==e||"IDBObjectState"==e||"IDBObjectMutableAncestorState"==e||"IDBObjectAncestorState"==e||"IDBObjectMutableState"==e||"IDBObjectMutableDerivedState"==e}},props:{init_6f66:function(e){this.className_=e,d.DBObjectBaseState.call(this)},init_226b:function(e){this.obj_=e.object,this.basedOn_=e,this.className_=e.className,d.DBObjectBaseState.call(this)},init_be8f:function(e){this.obj_=e,this.className_=e.className,d.DBObjectBaseState.call(this)},init_6271:function(e,t){this.mutableProperties_=h.clone(t),this.className_=e,d.DBObjectBaseState.call(this)},init_2a9a:function(e,t){this.obj_=e,this.mutableProperties_=h.clone(t),this.className_=e.className,d.DBObjectBaseState.call(this)},init_9f95:function(e,t){this.obj_=e.object,this.basedOn_=e,this.mutableProperties_=h.clone(t),this.className_=e.className,d.DBObjectBaseState.call(this)},basedOn:{get:function(){return this.basedOn_}},className:{get:function(){return this.className_}},properties:{get:function(){return this.mutableProperties_}},getProperty:function(e){return this.mutableProperties_[e]||h.opt(this.basedOn_,(function(t){return t.getProperty(e)}))},object:{get:function(){var e=null!=this.obj_?this.obj_:h.opt(this.basedOn,(function(e){return e.object}));return y.LegacyCoreAssert.isTrue(null!=e,"Mutable state not yet committed to an object",void 0,"DBObjectMutableState","DBState.swift",549),e}},checkpoint:function(){return a.init_2a9a(this.object,this.allProperties)},setProperty:function(e,t){y.LegacyCoreAssert.isTrue(e==t.name,"Setting property but value name does not match field name",{valueName:t.name,name:e},"DBObjectMutableState.setProperty","DBState.swift",558),this.mutableProperties_[e]=t},updateProperty:function(e,t,n){var r,o;if((r=this.mutableProperties_[e])&&null!=(o=n.update)&&!(r instanceof m.DBDeletedProperty)){var i=o(r,t);return i!==r&&this.setProperty(e,i),!0}return!1},removeProperty:function(e){this.mutableProperties_[e]=m.DBProperty.deleted(m.DBNamePath.init_b14a(e))},clear:function(){for(var e=h.iter(h.keys(this.allProperties));!e.done;e.next()){var t=e.value;this.removeProperty(t)}},apply:function(e){var t;if(t=null!=this.obj_?this.obj_:h.opt(this.basedOn,(function(e){return e.object}))){var n=h.clone(this.diff(t.state));this.notifyParentWillChange(n,e),t.state=this,this.notifyParentDidChange(n,e)}},assign:function(e){var t=null;this.basedOn_ instanceof d.DBObjectState?t=this.basedOn_:this.basedOn_ instanceof a&&(t=this.basedOn_.assign(e));var n=h.as(e,f.DBObject);h.opt(n,(function(e){return e.willCommitState()}));var r=null!=t?d.DBObjectState.init_9f95(t,this.mutableProperties_):d.DBObjectState.init_2a9a(e,this.mutableProperties_);return e.state=r,this.obj_=e,h.opt(n,(function(e){return e.didCommitState()})),r},commit:function(){return this.assign(this.object)},flattenFrom:function(e){for(var t=[],n=e;n!==this&&null!=n;)t.splice(0,0,n),n=h.as(n.basedOn,d.IDBObjectDerivedState);for(var r=h.iter(t);!r.done;r.next())for(var o=r.value,i=h.clone(this.diff(o)),a=h.iter(i);!a.done;a.next()){var s=a.key,l=a.value;null!=l[1]?this.mutableProperties_[s]=l[1]:h.removeKey(this.mutableProperties_,s)}}}}),a),d.DBChildObjectState=(s=function(){},h.defineClass({name:"DBChildObjectState",ctor:s,statics:{_implements:function(e){return"IDBObjectState"==e||"IDBObjectMutableState"==e}},props:{pendingProperties:{get:function(){return this.pendingProperties_}},init_7008:function(e,t,n){this.obj_=e,this.parentObject_=t,this.propertyPath_=n},init_94ed:function(e,t){this.obj_=null,this.parentObject_=e,this.propertyPath_=t},id:{get:function(){return h.opt(this.properties.id,(function(e){return e.stringValue}))}},className:{get:function(){return this.obj_.className}},parentObject:{get:function(){return this.parentObject_}},propertyPath:{get:function(){return this.propertyPath_}},parentProperty:{get:function(){var e,t=null;return(e=h.opt(this.parentObject_,(function(e){return e.state})))&&this.propertyPath_.forEach((function(n){var r,o;null==t?t=e.getProperty(n.name):null!=(r=h.toInt(n.name))&&(o=h.opt(t,(function(e){return e.arrayValue})))?r<o.length&&(t=o[r]):null!=t&&t.isDictionary&&(t=t.getDictionaryProperty(n.name))})),t}},properties:{get:function(){return null!=this.pendingProperties_?this.pendingProperties_:h.opt(this.parentProperty,(function(e){return e.dictionaryValue}))||{}}},depth:{get:function(){var e;return((e=h.opt(h.as(h.opt(this.parentObject_,(function(e){return e.state})),d.IDBObjectMutableState),(function(e){return e.depth})))||null!=e?e:0)+1}},allProperties:{get:function(){return this.properties}},object:{get:function(){return this.obj_},set:function(e){this.obj_!==e&&(y.LegacyCoreAssert.isTrue(null==this.obj_,"This state already has an object assigned",void 0,"DBChildObjectState","DBState.swift",718),this.obj_=e)}},checkpoint:function(){return this},getProperty:function(e){return null!=this.pendingProperties_?this.pendingProperties_[e]:h.opt(this.parentProperty,(function(t){return t.getDictionaryProperty(e)}))},deltaFromParentDelta:function(e){return this.deltaForPropertyPath(e,this.propertyPath)},parentWillChangeState:function(e){var t;(t=h.as(this.obj_,f.DBObject))&&h.count(e)>0&&t.willChangeState(e)},parentDidChangeState:function(e){var t;(t=h.as(this.obj_,f.DBObject))&&h.count(e)>0&&(t.clearCache(),t.didChangeState(e))},savePropertyDict:function(e){var t,n;if((t=h.as(this.parentObject_,f.DBObject))&&(n=h.as(this.object,f.DBObject))){if(null==t.childObjects.find((function(e){return e.id==n.id}),this))return;for(var r=h.clone(g.DBSchema.getCodecChain(this.propertyPath_.path,this.parentObject_)),o=this.propertyPath_,i=h.last(r)[0].encode(o,this.obj_,null);0==!r.length;){r.pop();var a=o.name;if(o=o.parent,0==r.length)t.setProperty(a,i);else{var s,l,u=null;if(null!=(s=h.last(r))&&(u=s[1]),u instanceof m.DBDeletedProperty)i=u;else if(null!=(l=h.toInt(a))){for(var c=h.clone(u.arrayValue);l>=c.length;)c.push(m.DBProperty.deleted(o.append(h.toString(c.length))));c[l]=i,i=m.DBProperty.arrayProperty(o,c)}else{var d=h.clone(u.dictionaryValue);d[a]=i,i=m.DBProperty.dictProperty(o,d)}}}}},savePendingProperties:function(){null!=this.pendingProperties_&&(this.savePropertyDict(this.pendingProperties_),this.pendingProperties_=null)},abandonPendingProperties:function(){this.pendingProperties_=null},setProperty:function(e,t){if(null==this.pendingProperties_){for(var n={},r=h.iter(this.properties);!r.done;r.next()){var o=r.key,i=r.value;o!=e&&(n[o]=i.copy())}this.pendingProperties_=h.clone(n)}t.reroot(m.DBNamePath.init_b14a(e)),this.pendingProperties_[e]=t,this.savePropertyDict(this.pendingProperties_)},canUpdate:{get:function(){var e;return(e=h.opt(h.as(h.opt(this.parentObject_,(function(e){return e.state})),s),(function(e){return e.canUpdate})))||null!=e?e:h.is(h.opt(this.parentObject_,(function(e){return e.state})),d.IDBObjectMutableState)}},updateProperty:function(e,t,n){var r,o;if(null!=this.pendingProperties_&&(r=this.properties[e])&&null!=(o=n.update)&&!(r instanceof m.DBDeletedProperty)&&this.canUpdate){var i=o(r,t);return i!==r&&this.setProperty(e,i),!0}return!1},removeProperty:function(e){this.setProperty(e,new m.DBDeletedProperty(m.DBNamePath.init_b14a(e)))},setProperties:function(e){if(null==this.pendingProperties_){for(var t={},n=h.iter(this.properties);!n.done;n.next()){var r=n.key,o=n.value;null==e[r]&&(t[r]=o.copy())}for(var i=h.iter(e);!i.done;i.next())r=i.key,(o=i.value).reroot(m.DBNamePath.init_b14a(r)),t[r]=o;this.pendingProperties_=h.clone(t),this.savePropertyDict(this.pendingProperties_)}},clear:function(){if(null==this.pendingProperties_){for(var e=h.clone(this.properties),t=h.iter(h.keys(this.properties));!t.done;t.next()){var n=t.value;e[n]=new m.DBDeletedProperty(m.DBNamePath.init_b14a(n))}this.pendingProperties_=h.clone(e),this.savePropertyDict(this.pendingProperties_)}},deltaForPropertyPath:function(e,t){var n,r,o,i={},a=h.clone(t.path);if(null!=(o=e[a.shift()])){for(var s=o[0],l=o[1];0==!a.length&&(null!=s||null!=l);){var u,c=a.shift();if(null!=(u=h.toInt(c))){var d=(n=h.opt(h.opt(s,(function(e){return e.arrayValue})),(function(e){return e.length})))||null!=n?n:0,p=(r=h.opt(h.opt(l,(function(e){return e.arrayValue})),(function(e){return e.length})))||null!=r?r:0;s=u<d?h.opt(h.opt(s,(function(e){return e.arrayValue})),(function(e){return e[u]})):null,l=u<p?h.opt(h.opt(l,(function(e){return e.arrayValue})),(function(e){return e[u]})):null}else s=h.opt(s,(function(e){return e.getDictionaryProperty(c)})),l=h.opt(l,(function(e){return e.getDictionaryProperty(c)}))}null!=s&&s.isDictionary?(s.forEachDictionaryProperty((function(e,t){i[e]=[t,h.opt(l,(function(t){return t.getDictionaryProperty(e)}))]})),null!=l&&l.isDictionary&&l.forEachDictionaryProperty((function(e,t){h.keys(i).includes(e)||(i[e]=[null,t])}))):null!=l&&l.isDictionary&&l.forEachDictionaryProperty((function(e,t){i[e]=[null,t]}))}return i},diff:function(e){var t={};if(e!==this){for(var n=h.clone(this.properties),r=h.clone(e.properties),o=h.iter(h.keys(n));!o.done;o.next()){var i,a=n[c=o.value];(i=e.getProperty(c))?a.isEqual(i)||(t[c]=[a,e.getProperty(c)]):t[c]=[a,null]}for(var s=h.keys(r),l=h.keys(n),u=h.iter(s);!u.done;u.next()){var c=u.value;l.includes(c)||(t[c]=[null,r[c]])}}return t},forEachProperty:function(e,t){h.each(this.properties,(function(e,n){return t(e,n)}))},apply:function(e){h.opt(this.parentObject_,(function(e){return e.state.apply(null)}))},assign:function(e){return s.init_7008(e,this.parentObject_,this.propertyPath_)},commit:function(){return this}}}),s),d.DBStateTransaction=(l=function e(t,n,r,o){var i;this.finished_=!1,void 0===o&&(o=null);var a,s=r.database.newState((i=o)||null!=i?i:p.PostDB.undoBranchID,r);this.basedOnState_=r,this.name=n,this.parent=t,this.state=s.state,(a=h.as(t,e))&&(y.LegacyCoreAssert.isTrue(null==a.child_,"DBStateTransaction already has a child",{parentStateTransactionName:a.name},"DBStateTransaction.init","DBState.swift",1008),a.child_=this),null!=r.transaction_&&y.LegacyCoreAssert.fail("State already has a transaction",{basedOnStateTransactionName:r.transaction_.name,creating:n},"DBStateTransaction.init","DBState.swift",1014)},h.defineClass({name:"DBStateTransaction",ctor:l,statics:{_implements:function(e){return"ITransaction"==e}},props:{child:{get:function(){return this.child_}},depth:{get:function(){return null==this.parent?1:this.parent.depth+1}},description:{get:function(){return null==this.parent?this.name:this.parent.description+", "+this.name}},finish:function(){var e;this.basedOnState_.database.endTransaction(this),this.basedOnState_.endTransaction(this),(e=h.as(this.parent,l))&&(y.LegacyCoreAssert.isTrue(e.child_===this,"Parent transaction mismatch",void 0,"DBStateTransaction.finish","DBState.swift",1032),e.child_=null),this.finished_=!0},end:function(){y.LegacyCoreAssert.isFalse(this.finished_,"Transaction already finished",{name:this.name},"DBStateTransaction.end","DBState.swift",1039),this.basedOnState_.database.commitState(this.state),this.finish()},mergeWithPrevious:function(){y.LegacyCoreAssert.isFalse(this.finished_,"Transaction already finished",{name:this.name},"DBStateTransaction.mergeWithPrevious","DBState.swift",1045),this.basedOnState_.database.commitAndMergeState(this.state),this.finish()},rollback:function(){y.LegacyCoreAssert.isFalse(this.finished_,"Transaction already finished",{name:this.name},"DBStateTransaction.rollback","DBState.swift",1051),this.basedOnState_.database.abandonState(this.state),this.finish()}}}),l),d.DBState=(u=function(){this.derivedStateIDs={}},h.defineClass({name:"DBState",ctor:u,statics:{_implements:function(e){return"IDBState"==e}},props:{database:{get:function(){return this.db_}},objectStates:{get:function(){return this.objectStates_}},allObjectStates:{get:function(){var e=h.dict([this.guid,this]),t=h.clone(this.objectStates),n=this.basedOn;for(y.LegacyCoreAssert.isTrue(this.generation_<200,"Depth of database states unusually high",void 0,"DBState","DBState.swift",1076);null!=n&&(y.LegacyCoreAssert.isTrue(null==e[n.guid],"Found a state cycle",void 0,"DBState","DBState.swift",1079),null==e[n.guid]);){e[n.guid]=n;for(var r=h.iter(n.objectStates);!r.done;r.next()){var o=r.key,i=r.value;null==t[o]&&(t[o]=i)}n=n.basedOn}return t}},transaction:{get:function(){return this.transaction_}},mutableState:{get:function(){var e;return(e=h.as(this.transaction_,d.DBStateTransaction))?e.state.mutableState||e.state:null}},init_40bf:function(e,t,n,r){this.db_=e,this.basedOn=null,this.generation_=0,this.objectStates_=h.clone(r),this.branch=t,this.guid=n},init_62ed:function(e,t,n,r){this.db_=e.database,this.basedOn=e,this.generation_=e.generation_+1,this.objectStates_=h.clone(r),this.branch=t,this.guid=n,e.derivedStateIDs[t]=n},checkpoint:function(){var e={};return this.forEachObjectState(!0,(function(t,n){e[t]=n.checkpoint()})),u.init_40bf(this.db_,this.branch,this.guid,e)},descendsFrom:function(e){return this===e||this.basedOn instanceof u&&this.basedOn.descendsFrom(e)},getDerivedState:function(e){return null!=this.derivedStateIDs[e]?this.db_.getState(this.derivedStateIDs[e]):null},apply:function(){this.applyInternal(!0)},applyInternal:function(e){var t=[];this.forEachObjectState(!0,(function(e,n){return t.push([e,n])}));for(var n=h.iter(t);!n.done;n.next()){var r,o=n.value,i=o[0],a=o[1],s=this.db_.getObject(i);if(r=h.opt(s,(function(e){return e.descendantObjects}))){var l=r.map((function(e){return e.state}),this);a.apply(l)}else a.apply(null)}e&&this.db_.stateChanged(this)},getObjectStateByID:function(e){return null!=e?this.objectStates_[e]||h.opt(this.basedOn,(function(t){return t.getObjectStateByID(e)})):null},getObjectState:function(e){return this.getObjectStateByID(e.id)},forEachObjectState:function(e,t){var n,r={};h.each(this.objectStates_,(function(e,n){t(e,n),r[e]=!0})),e&&(n=this.basedOn)&&n.forEachObjectState(!0,(function(e,n){null==r[e]&&(t(e,n),r[e]=!0)}))},validate:function(){var e,t,n=h.clone(this.allObjectStates);return(e=h.as(this.database.host,f.DBObject))&&(t=n[e.id])?g.DBSchema.getValidator(e.className)(t):new g.DBValidationErrorNoHost},encode:function(e,t){var n;if(g.DBSchema.currentSchema=g.DBSchema.init_2af7(t),n=h.as(this.database.host,f.DBObject)){var r=g.DBSchema.getDataObjectWriter(e,n.id,this,this.database);g.DBSchema.getSerializer(n.className)(this.getObjectState(n),r)}},beginTransaction:function(e){return y.LegacyCoreAssert.isTrue(null==this.transaction_,"beginTransaction: State already has an open transaction",void 0,"DBState.beginTransaction","DBState.swift",1255),this.transaction_=new d.DBStateTransaction(h.opt(this.basedOn,(function(e){return e.transaction})),e,this,this.branch),this.transaction_},endTransaction:function(e){y.LegacyCoreAssert.isTrue(e===this.transaction_,"endTransaction transaction mismatch",void 0,"DBState.endTransaction","DBState.swift",1261),this.transaction_=null}}}),u),d.DBMutableState=(c=function(){this.objectMutableStates_={},this.newObjectIDs_=[]},h.defineClass({name:"DBMutableState",ctor:c,superName:"DBState",statics:{_implements:function(e){return"IDBMutableState"==e||"IDBState"==e}},props:{parentTransaction:{get:function(){return this.basedOn.transaction}},objectStates:{get:function(){return this.objectMutableStates_}},mutableState:{get:function(){var e;return(e=d.DBState._getters.mutableState.call(this))||null!=e?e:this}},init_4be2:function(e,t,n){h.super_init(this,d.DBState,d.DBState.prototype.init_40bf,e,t,n,{})},init_1198:function(e,t,n){var r;if(h.super_init(this,d.DBState,d.DBState.prototype.init_62ed,e,t,n,{}),r=h.as(e,c))for(var o=h.iter(r.objectMutableStates_);!o.done;o.next()){var i,a=o.key,s=o.value;(i=h.as(s,d.IDBObjectAncestorState))&&(this.objectMutableStates_[a]=d.DBObjectMutableState.init_226b(i))}},init_40bf:function(e,t,n,r){h.super_init(this,d.DBState,d.DBState.prototype.init_40bf,e,t,n,r);for(var o=h.iter(this.objectStates_);!o.done;o.next()){var i,a=o.key,s=o.value;(i=h.as(s,d.IDBObjectAncestorState))&&(this.objectMutableStates_[a]=d.DBObjectMutableState.init_226b(i))}},init_62ed:function(e,t,n,r){h.super_init(this,d.DBState,d.DBState.prototype.init_62ed,e,t,n,r);for(var o=h.iter(this.objectStates_);!o.done;o.next()){var i,a=o.key,s=o.value;(i=h.as(s,d.IDBObjectAncestorState))&&(this.objectMutableStates_[a]=d.DBObjectMutableState.init_226b(i))}},getObjectStateByID:function(e){return null!=e?this.objectMutableStates_[e]||d.DBState.prototype.getObjectStateByID.call(this,e):null},forEachObjectState:function(e,t){var n,r={};h.each(this.objectMutableStates_,(function(e,n){t(e,n),r[e]=!0})),e&&(n=this.basedOn)&&n.forEachObjectState(!0,(function(e,n){null==r[e]&&(t(e,n),r[e]=!0)}))},stateToMutableState:function(e){var t,n,r;return(t=h.as(e,d.IDBObjectMutableState))?t:(n=h.as(e,d.IDBObjectDerivedState))&&(r=n.basedOn)?d.DBObjectMutableState.init_9f95(r,e.properties):d.DBObjectMutableState.init_2a9a(e.object,e.properties)},makeObjectMutable:function(e){null==this.objectMutableStates_[e.id]&&this.newObjectState(e)},newObjectState:function(e){if(e.isChildObject)return this.objectMutableStates_[e.id]=e.state,e.state;var t=this.basedOn,n=h.as(h.opt(t,(function(t){return t.getObjectState(e)})),d.DBObjectState);y.LegacyCoreAssert.isTrue(null!=n||!(e.initialized&&e.persisted),"Object is initialized, but could not find an existing state",{objID:e.id},"DBMutableState.newObjectState","DBState.swift",1369);var r=null!=n?d.DBObjectMutableState.init_226b(n):d.DBObjectMutableState.init_be8f(e),o=e.id;return y.LegacyCoreAssert.isTrue(null==this.objectMutableStates_[o],"Object already has a state",{objID:o},"DBMutableState.newObjectState","DBState.swift",1376),this.objectMutableStates_[e.id]=r,e.state=r,r},setObjectState:function(e,t){var n=this.stateToMutableState(t),r=e.id;y.LegacyCoreAssert.isTrue(t instanceof d.DBChildObjectState||null==this.objectMutableStates_[r],"Object already has a state",{objID:r},"DBMutableState.setObjectState","DBState.swift",1387),this.objectMutableStates_[e.id]=n,e.state=n},addNewObject:function(e,t){this.newObjectIDs_.push(e.id),this.setObjectState(e,t)},removeObject:function(e){this.newObjectIDs_.includes(e)?(h.remove(this.newObjectIDs_,e),h.removeKey(this.objectMutableStates_,e),this.db_.removeObject(e)):null!=this.objectMutableStates_[e]&&(this.objectMutableStates_[e]=this.db_.deletedObject.state)},forEachInCommitList:function(e){for(var t=[],n={},r=0;r<h.count(this.objectMutableStates_);)for(var o=h.keys(this.objectMutableStates_),i=h.iter(o);!i.done;i.next()){var a;if(null==n[u=i.value])(a=this.database.getObject(u))&&(a.willCommitState(),(l=h.as(a.state,d.DBChildObjectState))&&l.savePendingProperties()),n[u]=!0,r+=1}for(var s=h.iter(this.objectMutableStates_);!s.done;s.next()){var l,u=s.key;(p=s.value)instanceof d.DBObjectDeletedState||(y.LegacyCoreAssert.isTrue(h.is(p,d.IDBObjectMutableState),"Immutable state in mutable states dictionary",void 0,"DBMutableState.forEachInCommitList","DBState.swift",1431),(l=h.as(h.opt(this.database.getObject(u),(function(e){return e.state})),d.DBChildObjectState))?t.push([u,l]):t.push([u,p]))}h.sortInPlace(t,(function(e,t){return t[1].depth<e[1].depth}));for(var c=h.iter(t);!c.done;c.next()){var p,f=c.value;e(u=f[0],p=f[1]),h.opt(this.database.getObject(u),(function(e){return e.didCommitState()}))}},commit:function(){var e,t=this,n={};if(this.forEachInCommitList((function(e,r){var o,i,a;(o=h.as(r,d.DBObjectMutableState))?null==o.basedOn?(a=t.database.getObject(e))&&(n[e]=o.assign(a)):n[e]=o.commit():(i=h.as(r,d.DBChildObjectState))?n[e]=i:(y.LegacyCoreAssert.isTrue(r instanceof d.DBObjectDeletedState,"The only immutable object state in a mutable DB state should be the deleted object state",void 0,"DBMutableState.commit","DBState.swift",1467),n[e]=t.db_.deletedObject.state)})),e=h.as(this.basedOn,d.DBState)){var r=d.DBState.init_62ed(e,this.branch,this.guid,n);return e.generation_>25?r.checkpoint():r}return d.DBState.init_40bf(this.db_,this.branch,this.guid,n)},abandon:function(){var e=h.clone(this.newObjectIDs_);this.newObjectIDs_.splice(0);for(var t=h.clone(this.objectMutableStates_),n=h.iter(t);!n.done;n.next()){var r,o,i=n.key,a=n.value;(r=h.as(a,d.DBChildObjectState))&&r.abandonPendingProperties(),(o=this.database.getObject(i))&&o.abandonChanges()}for(var s=h.iter(e);!s.done;s.next())i=s.value,h.removeKey(this.objectMutableStates_,i),this.db_.removeObject(i)},flattenFrom:function(e){for(var t=this,n=[],r=e;r!==this&&null!=r;)n.splice(0,0,r),r=r.basedOn;for(var o=h.iter(n);!o.done;o.next()){var i,a=o.value;if(i=h.as(a,c))i.forEachInCommitList((function(e,n){var r;if(n instanceof d.DBObjectDeletedState)t.objectMutableStates_[e]=t.db_.deletedObject.state;else if(null==t.objectMutableStates_[e])t.objectMutableStates_[e]=t.stateToMutableState(n);else if(r=h.as(t.objectMutableStates_[e],d.DBObjectMutableState))for(var o=h.iter(n.properties);!o.done;o.next()){var i=o.key,a=o.value;r.setProperty(i,a)}}));else for(var s=h.iter(a.objectStates);!s.done;s.next()){var l,u=s.key;if((r=s.value)instanceof d.DBObjectDeletedState)this.objectMutableStates_[u]=this.db_.deletedObject.state;else if(null==this.objectMutableStates_[u])this.objectMutableStates_[u]=this.stateToMutableState(r);else if(l=h.as(this.objectMutableStates_[u],d.DBObjectMutableState))for(var p=h.iter(r.properties);!p.done;p.next()){var f=p.key,m=p.value;l.setProperty(f,m)}}}}}}),c)},"2ALn":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("QbzR"),l=n("Zifs");o.RootStyle=(r=function(){this.deprecatedPrimaryColor=null},i.defineClass({name:"RootStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"RootStyle"}},KIND:{get:function(){return"RootStyle"}},PROPERTY_COLOR_DEPRECATED:"color",factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_70dd(l.SolidColor.WHITE)},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){var n;i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_866e,e,t),(n=i.as(this.get(r.PROPERTY_COLOR_DEPRECATED),["Array",l.SolidColor]))&&n.length>=1&&(this.deprecatedPrimaryColor=n[0])},init_70dd:function(e){i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,r.KIND,s.FormaStyle.OPACITY_DEFAULT,a.ColorTable.createDefault())},className:{get:function(){return r.SCHEMA_CLASS_NAME}},colorTableSupportsRole:function(e){return e==a.ColorRole.FieldPrimary},willCommitState:function(){null!=this.deprecatedPrimaryColor&&(this.colors.fieldPrimary=this.deprecatedPrimaryColor,this.deprecatedPrimaryColor=null,this.removeProperty(r.PROPERTY_COLOR_DEPRECATED)),s.FormaStyle.prototype.willCommitState.call(this)}}}),r)},"2bF5":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.MoaConstants=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"MoaConstants",ctor:r,superName:"CoreObject",statics:{kMoaColorMapSizeRGB:256,kSatVibranceSumMax:150}}),r)},"3/rh":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("4/a+");o.MotionEntryFadeIn=(r=function(){this.srcId="MotionSrcFadeIn",this.logic=new a.MotionLogicDur,this.args={st:.1,dur:.9}},i.defineClass({name:"MotionEntryFadeIn",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},"37nf":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("FNB+"),s=n("6ZWm"),l=n("lmwz"),u=n("fNpk"),c=n("tGKA"),d=n("djAF"),h=n("oKlP"),p=n("sIWg"),f=n("LGJg"),m=n("mxdD");o.ImageUtils=(r=function(){},i.defineClass({name:"ImageUtils",ctor:r,statics:{suggestCrop:function(e,t,n,o,i){var a,l=n.size,d=Math.max(l.width/e.width,l.height/e.height);if((d>1||i==s.CropType.FitBorder)&&(l=l.multiply(1/d)),i==s.CropType.FillFocus){var f=new p.TheoRect(0,0,e.width,e.height),m=t.insetRel(-.25,-.25,-.25,-.25),g=t.insetXY(f.width/10,f.height/10),y=(m.area>g.area?m:g).insetRel(-.25,-.25,-.25,-.25).intersectionWith(f);a=r.getCropOfFocusRegion(y,n.size)}else if(i==s.CropType.ExtremeCloseup)a=r.getCropOfFocusRegion(t.insetRel(.25,.25,.25,.25),n.size);else if(i==s.CropType.AbstractCloseup)a=p.TheoRect.fromXYWH(t.center.x,t.center.y,5,5);else if(i==s.CropType.PreserveFocus&&null!=o){var _=o.center,T=t.center,v=new h.TheoPoint((T.x-_.x)/o.width,(T.y-_.y)/o.height);a=p.TheoRect.fromSize(l);var C=new h.TheoPoint(_.x-a.center.x,_.y-a.center.y);a=a.transform(c.Matrix2D.translation(C));var P=new h.TheoPoint((T.x-a.center.x)/a.width,(T.y-a.center.y)/a.height),S=new h.TheoPoint((P.x-v.x)*a.width,(P.y-v.y)*a.height);(a=a.transform(c.Matrix2D.translation(S))).minX<0&&(a=a.transform(c.Matrix2D.translation(new h.TheoPoint(-a.minX,0)))),a.maxX>=e.width&&(a=a.transform(c.Matrix2D.translation(new h.TheoPoint(e.width-a.maxX,0)))),a.minY<0&&(a=a.transform(c.Matrix2D.translation(new h.TheoPoint(0,-a.minY)))),a.maxY>=e.height&&(a=a.transform(c.Matrix2D.translation(new h.TheoPoint(0,e.height-a.maxY))))}else if(i==s.CropType.FitBorder){var D=e.width-l.width,A=e.height-l.height,E=D<1?0:Math.min(Math.max(0,t.center.x-l.width/2),D),R=A<1?0:Math.min(Math.max(0,t.center.y-l.height/2),A);a=p.TheoRect.fromXYWH(E,R,l.width,l.height)}else u.LegacyCoreAssert.fail("no valid crop type",void 0,"ImageUtils.suggestCrop","ImageUtils.swift",85);return null!=a&&a.area>0?a:null},getCropOfFocusRegion:function(e,t){var n=t.aspectRatio;if(n>e.aspectRatio){var r=e.width/n;return p.TheoRect.fromXYWH(e.minX,e.minY+(e.height-r)/2,e.width,r)}var o=e.height*n;return p.TheoRect.fromXYWH(e.minX+(e.width-o)/2,e.minY,o,e.height)},getMediaMetadataForForma:function(e){var t,n,r=null;if(t=m.VideoFacade.getVideoFormaForForma(e))r=i.opt(t.videoContentNode,(function(e){return e.mediaMetadata}));else if(n=l.ImageFacade.getImageFormaForForma(e))r=i.opt(n.contentNode,(function(e){return e.mediaMetadata}));else if(e.hasIntent(a.Forma.INTENT_ICON)){var o,s;(o=i.as(e,d.ShapeForma))&&(s=i.as(o.contentNode,f.VectorContentNode))&&(r=s.mediaMetadata)}return r}}}),r)},"3DEm":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("fNpk"),l=n("tGKA"),u=n("oKlP");i.CircleCircleData=(r=function(e,t,n,r){this.leftCenter=e,this.rightCenter=t,this.sine=n,this.cosine=r},a.defineClass({name:"CircleCircleData",ctor:r}),r),i.MathUtils=(o=function(){},a.defineClass({name:"MathUtils",ctor:o,statics:{nearestMultiple:function(e,t){return s.LegacyCoreAssert.isTrue(!isNaN(e),"Can't find nearest multiple for NaN",void 0,"MathUtils.nearestMultiple","MathUtils.swift",40),s.LegacyCoreAssert.isTrue(!isNaN(t),"Can't find nearest multiple when factor is NaN",void 0,"MathUtils.nearestMultiple","MathUtils.swift",41),Math.round(e/t)*t},absDouble:function(e){return e>=0?e:-e},absInt:function(e){return e>=0?e:-e},minInt:function(e,t){return t<e?t:e},maxInt:function(e,t){return t>e?t:e},minDouble:function(e,t){var n,r,o,i;return(r=null!=(i=t)?i:0)<(n=null!=(o=e)?o:0)?r:n},maxDouble:function(e,t){var n,r,o,i;return(r=null!=(i=t)?i:0)>(n=null!=(o=e)?o:0)?r:n},VectorDot:function(e,t){return e.x*t.x+e.y*t.y},VectorCross:function(e,t){return e.x==t.x?e.x*(t.y-e.y):e.y==t.y?e.y*(e.x-t.x):e.x*t.y-t.x*e.y},VectorNorm:function(e){return 0==e.x?o.absDouble(e.y):0==e.y?o.absDouble(e.x):Math.sqrt(o.VectorDot(e,e))},UnitTriangleToTriangleMatrix:function(e,t,n){return new l.Matrix2D(u._minus_TheoPoint_TheoPoint(t,e).x,u._minus_TheoPoint_TheoPoint(t,e).y,u._minus_TheoPoint_TheoPoint(n,e).x,u._minus_TheoPoint_TheoPoint(n,e).y,e.x,e.y)},TriangleToUnitTriangleMatrix:function(e,t,n,r){return new l.Matrix2D(u._minus_TheoPoint_TheoPoint(r,t).y/e,u._minus_TheoPoint_TheoPoint(t,n).y/e,u._minus_TheoPoint_TheoPoint(t,r).x/e,u._minus_TheoPoint_TheoPoint(n,t).x/e,o.VectorCross(r,t)/e,o.VectorCross(t,n)/e)},MoveRectangleMatrix:function(e,t){var n=new u.TheoPoint(0,0),r=new u.TheoPoint(1,0),i=new u.TheoPoint(0,1);return o.MoveTriangleMatrix(e.eval(n),e.eval(r),e.eval(i),t.eval(n),t.eval(r),t.eval(i))},TriangleDiscriminant:function(e,t,n){return o.VectorCross(u._minus_TheoPoint_TheoPoint(t,e),u._minus_TheoPoint_TheoPoint(n,e))},MoveTriangleMatrix:function(e,t,n,r,i,a){var s=o.TriangleDiscriminant(e,t,n),l=o.TriangleToUnitTriangleMatrix(s,e,t,n);return l=l.concat(o.UnitTriangleToTriangleMatrix(r,i,a))},CircleCircleIntersection:function(e,t,n,r){var a=u._minus_TheoPoint_TheoPoint(n,e),s=o.VectorNorm(a),l=o.VectorDot(a,a),c=u.TheoPoint.ZERO,d=u.TheoPoint.ZERO,h=(l+t*t-r*r)/2/s/t;if(h>1||h<-1)return c=u.TheoPoint.INVALID,d=u.TheoPoint.INVALID,new i.CircleCircleData(c,d,NaN,NaN);var p=Math.sqrt(1-h*h),f=s*t*h,m=s*t*p,g=new u.TheoPoint(m,f),y=new u.TheoPoint(o.VectorCross(a,g),o.VectorDot(a,g)).divide(l);c=u._plus_TheoPoint_TheoPoint(e,y);var _=new u.TheoPoint(f,m),T=new u.TheoPoint(o.VectorDot(_,a),o.VectorCross(_,a)).divide(l);return d=u._plus_TheoPoint_TheoPoint(e,T),new i.CircleCircleData(c,d,p,h)},ArcToBezier3:function(e,t,n){if(isNaN(e)||!isFinite(e))return s.LegacyCoreAssert.fail("bad start value",void 0,"MathUtils.ArcToBezier3","MathUtils.swift",267),[];if(isNaN(t)||!isFinite(t))return s.LegacyCoreAssert.fail("bad end value",void 0,"MathUtils.ArcToBezier3","MathUtils.swift",273),[];if(n<1)return s.LegacyCoreAssert.fail("bad patch count",void 0,"MathUtils.ArcToBezier3","MathUtils.swift",279),[];for(var r=[],i=(t-e)/a.toDouble(n),l=e,u=a.iter(a.range(0,n-1,!0));!u.done;u.next()){var c=u.value+1<n?l+i:t,d=a.clone(o.arc2bezier2_(l,c));r.length>0&&r.splice(r.length-1,1),r=r.concat(d),l=c}return r},arc2bezier2_:function(e,t){var n=t-e,r=a.clone(o.arc2bezier_(n)),i=e+n/2,s=Math.cos(i),u=Math.sin(i);1==s||-1==s?u=0:1==u||-1==u?s=0:0==s?u=u>0?1:-1:0==u&&(s=s>0?1:-1);var c=l.Matrix2D.rotation(s,u);return r[0]=c.transformPoint(r[0]),r[1]=c.transformPoint(r[1]),r[2]=c.transformPoint(r[2]),r[3]=c.transformPoint(r[3]),r},arc2bezier_:function(e){var t=new u.TheoPoint(Math.cos(e/2),-Math.sin(e/2)),n=new u.TheoPoint(t.x,-t.y),r=new u.TheoPoint((4-t.x)/3,(1-t.x)*(3-t.x)/(3*t.y));return[t,r,new u.TheoPoint(r.x,-r.y),n]},saturate_range:function(e,t,n){var r=e,o=t;if(s.LegacyCoreAssert.isTrue(r<o||o<r||r==o,"range high or low is not a number",void 0,"MathUtils.saturate_range","MathUtils.swift",357),o<r){var i=r;r=o,o=i}return n<r?r:n>o?o:(s.LegacyCoreAssert.isTrue(n==n,"value to clip is not a number",void 0,"MathUtils.saturate_range","MathUtils.swift",372),n)},Reflect:function(e,t){return new u.TheoPoint(-e.x+2*t.x,-e.y+2*t.y)},sign:function(e){return 0==e?0:e<0?-1:1},getMean:function(e){var t=null,n=a.toDouble(e.length);if(n>0){for(var r=0,o=a.iter(e);!o.done;o.next())r+=o.value;t=r/n}return t},getGeometricMean:function(e){var t=null,n=a.toDouble(e.length);if(n>0){for(var r=1,o=a.iter(e);!o.done;o.next())r*=o.value;t=Math.pow(r,1/n)}return t},roundDoubleToString:function(e,t){var n=t;return e%1==0&&(n=0),a.toString("%."+a.toString(n)+"f",e)}}}),o)},"3HaQ":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("6ZWm"),l=n("7Pku"),u=n("w/+j"),c=n("9Lk3"),d=n("iCxV"),h=n("fNpk"),p=n("tGKA"),f=n("Ird5"),m=n("jLWG"),g=n("jfma"),y=n("yjxF"),_=n("euLT"),T=n("Aj79"),v=n("Ucb9"),C=n("g6aL"),P=n("Zifs"),S=n("djAF"),D=n("byfQ"),A=n("hgLm"),E=n("oKlP");i.ShapeFormaToPGMMapper=(r=function e(){l.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},a.defineClass({name:"ShapeFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=S.ShapeForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance},applyAnimations:function(e,t,n,r,o){var i,s=n;if(e.asDynamic&&(i=t.animation)){var l=a.clone(u.FormaToPGMUtils.convertAnimation(n,i,r,o));if(l.length>0){var c=f.PGMAnimationList.fromArray(l);s=n.withAnimations(n.animations.merge(c))}}return s},DUMMY_REF:{get:function(){return void 0===o.DUMMY_REF&&(o.DUMMY_REF=new T.PGMReference(new _.PGMNullNode("dummy"))),o.DUMMY_REF}},makePGMRefForArtwork:function(e,t,n,o,i,s){var l,u,c,d,p=f.PGMAnimationList.EMPTY;if(u=o.bounds)if(c=a.as(o,D.TheoArtworkShape))l=new T.PGMReference(new v.PGMShape(n,new y.PGMNodeMetadata(n,"shape"),p,u,c.paths,s),i);else if(d=a.as(o,D.TheoArtworkGroup)){var _,P=[],S=1;d.forEachChild((function(o){var i;if(i=r.makePGMRefForArtwork(e,t,n+"-"+S,o,g.PGMCompositingParams.DEFAULT,s)){var a=r.applyAnimations(e,t,i,!1,!0);P.push(a)}S+=1})),l=(_=a.as(d,D.TheoArtworkClipGroup))?new T.PGMReference(new m.PGMClip(n,new y.PGMNodeMetadata(n,"clip"),f.PGMAnimationList.EMPTY,P,[_.path]),i):1==P.length?P[0].withCompositing(i):new T.PGMReference(new C.PGMSimpleGroup(n,new y.PGMNodeMetadata(n,"group"),f.PGMAnimationList.EMPTY,P),i)}else h.LegacyCoreAssert.fail("unable to create PGM for artwork: not a shape or a group",void 0,"ShapeFormaToPGMMapper.makePGMRefForArtwork","ShapeFormaToPGMMapper.swift",156),l=null;else h.LegacyCoreAssert.fail("unable to create PGM for artwork: no bounds",void 0,"ShapeFormaToPGMMapper.makePGMRefForArtwork","ShapeFormaToPGMMapper.swift",160),l=null;return l},makePGMRefForShape:function(e,t,n){var o=r.DUMMY_REF,i=t.style.colors.fieldPrimary;null==i&&a.opt(d.Host.logging,(function(e){return e.warning("shape forma has no primary color; will not render")}));var u,m,v=i||P.SolidColor.ZERO,S=c.GridController.isBackgroundColoredCell(t)?e.backgroundOpacityOverride:1,D=v.withAlphaOf(v.alpha*S),A=l.FormaToPGMMapper.mapBlendMode(t);if(null==t.sliceBox)if((u=t.canonicalArtwork.bounds)&&(m=t.bounds)){var R,F=p.Matrix2D.calculateResizeTransform(u,m,E.TheoPoint.ZERO,s.FitType.Stretch);if(R=r.makePGMRefForArtwork(e,t,n,t.canonicalArtwork,new g.PGMCompositingParams(F,t.style.opacity,A),D)){var b=r.applyAnimations(e,t,R,!1,!0);o=new T.PGMReference(new C.PGMSimpleGroup(n+"-shape-container",new y.PGMNodeMetadata(n,"shape-container"),f.PGMAnimationList.EMPTY,[b]),new g.PGMCompositingParams(t.placement))}else h.LegacyCoreAssert.fail("unexpected artwork configuration",void 0,"ShapeFormaToPGMMapper.makePGMRefForShape","ShapeFormaToPGMMapper.swift",226),o=new T.PGMReference(new _.PGMNullNode(n+"-shape-error-1"))}else h.LegacyCoreAssert.fail("couldn't get artwork or forma bounds for shape",void 0,"ShapeFormaToPGMMapper.makePGMRefForShape","ShapeFormaToPGMMapper.swift",230),o=new T.PGMReference(new _.PGMNullNode(n+"-shape-error-2"));else(R=r.makePGMRefForArtwork(e,t,n,t.sizedArtwork,new g.PGMCompositingParams(t.placement,t.style.opacity,A),D))?o=R:(h.LegacyCoreAssert.fail("unexpected artwork configuration",void 0,"ShapeFormaToPGMMapper.makePGMRefForShape","ShapeFormaToPGMMapper.swift",245),o=new T.PGMReference(new _.PGMNullNode(n+"-shape-error-3")));return o},applyPathAsClip:function(e,t,n,o,i){var l,u,c,d,v=r.DUMMY_REF,P=f.PGMAnimationList.EMPTY,S=a.clone(o);if(null==t.sliceBox)(l=t.canonicalArtwork.bounds)&&(d=n.bounds)?((N=(k=p.Matrix2D.calculateResizeTransform(l,d,E.TheoPoint.ZERO,s.FitType.Stretch).concat(t.placement)).inverse)&&(S=[new T.PGMReference(new C.PGMSimpleGroup(i,new y.PGMNodeMetadata(i,"clipped-node-wrapper"),P,S),new g.PGMCompositingParams(N))]),(c=a.as(t.canonicalArtwork,D.TheoArtworkShape))?v=new T.PGMReference(new m.PGMClip(i+"-clip",new y.PGMNodeMetadata(i,"shape-clip"),P,S,c.paths),new g.PGMCompositingParams(k)):(u=a.as(t.canonicalArtwork,D.TheoArtworkClipGroup))&&(c=a.as(u.childAt(0),D.TheoArtworkShape))?v=new T.PGMReference(new m.PGMClip(i+"-clip",new y.PGMNodeMetadata(i,"outer-shape-clip"),f.PGMAnimationList.EMPTY,[new T.PGMReference(new m.PGMClip(i+"-inner-clip",new y.PGMNodeMetadata(i,"inner-shape-clip"),P,S,c.paths))],[u.path]),new g.PGMCompositingParams(k)):(h.LegacyCoreAssert.fail("unexpected artwork configuration",void 0,"ShapeFormaToPGMMapper.applyPathAsClip","ShapeFormaToPGMMapper.swift",325),v=new T.PGMReference(new _.PGMNullNode(i)))):(h.LegacyCoreAssert.fail("no shape and/or primary color?",void 0,"ShapeFormaToPGMMapper.applyPathAsClip","ShapeFormaToPGMMapper.swift",329),v=new T.PGMReference(new _.PGMNullNode(i)));else if((c=a.as(t.sizedArtwork,D.TheoArtworkShape))&&(d=n.bounds)){for(var R=(I=a.clone(c.paths))[0].bounds,F=a.iter(a.range(1,I.length,!1));!F.done;F.next()){var b=F.value;R=R.unionWith(I[b].bounds)}(N=(k=p.Matrix2D.calculateResizeTransform(R,d,E.TheoPoint.ZERO,s.FitType.Stretch).concat(t.placement)).inverse)&&(v=new T.PGMReference(new m.PGMClip(i,new y.PGMNodeMetadata(i,"shape"),P,[new T.PGMReference(new C.PGMSimpleGroup(i+"-clip-wrapper",new y.PGMNodeMetadata(i,"clipped-node-wrapper"),P,S),new g.PGMCompositingParams(N))],I),new g.PGMCompositingParams(k)))}else if((u=a.as(t.sizedArtwork,D.TheoArtworkClipGroup))&&(c=a.as(u.childAt(0),D.TheoArtworkShape))&&(d=n.bounds)){R=(I=a.clone(c.paths))[0].bounds;for(var I,O=a.iter(a.range(1,I.length,!1));!O.done;O.next())b=O.value,R=R.unionWith(I[b].bounds);var k,N;if(N=(k=p.Matrix2D.calculateResizeTransform(R,d,E.TheoPoint.ZERO,s.FitType.Stretch).concat(t.placement)).inverse){var M,L=!0;u.path instanceof A.TheoEmptyPath?L=!1:(M=a.as(u.path,A.TheoRectanglePath))&&(L=M.rect.contains(R));var x=new T.PGMReference(new m.PGMClip(i,new y.PGMNodeMetadata(i,"shape"),P,[new T.PGMReference(new C.PGMSimpleGroup(i+"-clip-wrapper",new y.PGMNodeMetadata(i,"clipped-node-wrapper"),P,S),new g.PGMCompositingParams(N))],I),new g.PGMCompositingParams(L?p.Matrix2D.Identity:k));v=L?new T.PGMReference(new m.PGMClip(i+"-clip",new y.PGMNodeMetadata(i,"clip"),f.PGMAnimationList.EMPTY,[x],[u.path]),new g.PGMCompositingParams(k)):x}}else h.LegacyCoreAssert.fail("unexpected artwork configuration",void 0,"ShapeFormaToPGMMapper.applyPathAsClip","ShapeFormaToPGMMapper.swift",439),v=new T.PGMReference(new _.PGMNullNode(i));return v}},props:{makePGMRef:function(e,t,n,o){var i;return(i=a.as(e,S.ShapeForma))?0==t.backgroundOpacityOverride&&c.GridController.isBackgroundColoredCell(e)?new T.PGMReference(new _.PGMNullNode(i.formaID)):u.FormaToPGMUtils.applyAnimations(t,e,r.makePGMRefForShape(t,i,i.formaID)):(h.LegacyCoreAssert.fail("ShapeFormaToPGMMapper: not a shape forma",void 0,"ShapeFormaToPGMMapper.makePGMRef","ShapeFormaToPGMMapper.swift",50),null)}}}),r)},"3OP7":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("aS4X"),l=n("uMFj"),u=n("iCxV"),c=n("8vXU"),d=n("muPB"),h=n("C4JV"),p=n("rxGp");o.DocumentPersistenceFactory=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"DocumentPersistenceFactory",ctor:r,superName:"CoreObject",statics:{THEO_PROPERTY_NAMESPACE:"theo#",namespacedPropertyName:function(e){return e.includes("#")?e:r.THEO_PROPERTY_NAMESPACE+e},usesJsonDocumentEncoding:function(e){return!!e.getComponentWithAbsolutePath(h.JSON_CONTENT_PATH_DCX2D)},encoderFor:function(e){return u.Host.persistUtils.useJsonDocumentEncoding()?(u.Host.logging.logForCategory(p.LogCategories.kDocPersistenceFactory,"Using JSONDocumentEncoder",c.LogLevelEnum.INFO_LEVEL),new h.JSONDocumentEncoder(e)):(u.Host.logging.logForCategory(p.LogCategories.kDocPersistenceFactory,"Using DCXDocumentEncoder",c.LogLevelEnum.INFO_LEVEL),new l.DCXDocumentEncoder(e))},decoderFor:function(e){return r.usesJsonDocumentEncoding(e)?(u.Host.logging.logForCategory(p.LogCategories.kDocPersistenceFactory,"Using JSONDocumentDecoder",c.LogLevelEnum.INFO_LEVEL),new d.JSONDocumentDecoder(e)):(u.Host.logging.logForCategory(p.LogCategories.kDocPersistenceFactory,"Using DCXDocumentDecoder",c.LogLevelEnum.INFO_LEVEL),new s.DCXDocumentDecoder(e))}}}),r)},"3hwA":function(e,t,n){var r=t,o=n("oAGj");r.IImportDataObject=o.defineProtocol("IImportDataObject",{id:"String",type:"String",name:"String",path:"String",optionalStringProperty:"(String) -> String",stringProperty:"(String, String) -> String",numberProperty:"(String, Double) -> Double",intProperty:"(String, Integer) -> Integer",booleanProperty:"(String, Boolean) -> Boolean",optionalBooleanProperty:"(String) -> Boolean",property:"(String) -> AnyObject",forEachChild:"((IImportDataObject, Integer) -> Void) -> Void",forEachComponent:"((IImportDataComponent, Integer) -> Void) -> Void"}),r.IMissingFontHelper=o.defineProtocol("IMissingFontHelper",{recordMissingFont:"(String) -> Void"}),r.IImportDataComponent=o.defineProtocol("IImportDataComponent",{id:"String",name:"String",path:"String",mimeType:"String",etag:"String",url:"String"})},"4/a+":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("URxh"),s=n("iCxV"),l=n("RkYL");o.MotionLogicDur=(r=function(){},i.defineClass({name:"MotionLogicDur",ctor:r,statics:{_implements:function(e){return"MotionLogic"==e}},props:{apply:function(e,t,n){var r,o,u,c,d=(r=i.as(n.st,"Double"))||null!=r?r:0,h=d+((o=i.as(n.dur,"Double"))||null!=o?o:1),p=[];if(h>0&&t.length>0){p=[];var f=t[0],m=t[t.length-1];d!=f.time.seconds&&p.push(f),p.push(new a.KeyFrame(l.TheoTime.fromSeconds(d),f.timingFunction,f.placement,f.bounds,f.style)),p.push(new a.KeyFrame(l.TheoTime.fromSeconds(h),m.timingFunction,m.placement,m.bounds,m.style))}(u=e.animation)?u.keyFrames=p.concat():i.opt(s.Host.logging,(function(e){return e.warning("Missing animation key-frame array")})),(c=i.opt(e.animation,(function(e){return e.endTime})))&&c.seconds<h&&(e.animation.endTime=l.TheoTime.fromSeconds(h))}}}),r)},"44Iz":function(e,t,n){var r,o,i,a=t,s=n("oAGj");a.PGMExportSettings=(r=function(e,t){void 0===t&&(t=1),this.asDynamic=e,this.backgroundOpacityOverride=t},o={},s.defineClass({name:"PGMExportSettings",ctor:r,superName:"CoreObject",statics:{STATIC:{get:function(){return void 0===o.STATIC&&(o.STATIC=new r(!1)),o.STATIC}},DYNAMIC:{get:function(){return void 0===o.DYNAMIC&&(o.DYNAMIC=new r(!0)),o.DYNAMIC}}},props:{asString:{get:function(){return(this.asDynamic?"dynamic":"static")+(1==this.backgroundOpacityOverride?"":"bgop="+this.backgroundOpacityOverride)}}}}),r),a.PGMSource=(i=function(){},s.defineClass({name:"PGMSource",ctor:i,props:{getGraph:function(e){return null},getGraphForForma:function(e,t){return null}}}),i)},"4mVB":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("FNB+"),l=n("6ZWm"),u=n("cmoc"),c=n("QbzR"),d=n("9Lk3"),h=n("tQF8"),p=n("iCxV"),f=n("fNpk"),m=n("oKlP"),g=n("sIWg");o.GridStyle=(r=function(){this.gridCells_=null,this.formaMapping_=null,this.forma_=null},i.defineClass({name:"GridStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"GridStyle"}},KIND:{get:function(){return"GridStyle"}},DEFAULT_NAME:"None",DEFAULT_CATEGORY:"Grid",CUSTOM_LAYOUT_NAME:"Custom",SINGLE_LAYOUT_NAME:"Single",BALANCED_LAYOUT_NAME:"Balanced-Layout",PROPERTY_NAME:"name",PROPERTY_CATEGORY:"category",PROPERTY_GRID_CELLS:"grid-cells",PROPERTY_FORMA_MAPPING:"forma-mapping",PROPERTY_SPACING:"spacing",PROPERTY_CROP_TYPE:"crop-type",factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_bf40(r.DEFAULT_NAME,r.DEFAULT_CATEGORY,[new h.GridCell(g.TheoRect.ONE_BY_ONE)],null,0,!1,l.CropType.PreserveFocus)},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){this.moveableShift_=!1,i.super_init(this,c.FormaStyle,c.FormaStyle.prototype.init_866e,e,t)},init_bf40:function(e,t,n,o,s,u,d){void 0===e&&(e="None"),void 0===t&&(t="Grid"),void 0===o&&(o=null),void 0===s&&(s=0),void 0===u&&(u=!0),void 0===d&&(d=l.CropType.PreserveFocus);var h={name:e,category:t,"grid-cells":n,spacing:s,"crop-type":d};if(null!=o){for(var p=[],f=i.iter(o);!f.done;f.next()){var m=f.key,g=f.value;p.push([m,g])}h[r.PROPERTY_FORMA_MAPPING]=i.clone(p)}this.moveableShift_=u,i.super_init(this,c.FormaStyle,c.FormaStyle.prototype.init_5afe,r.KIND,c.FormaStyle.OPACITY_DEFAULT,a.ColorTable.createDefault(),null,null,h)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},didChangeState:function(e){null!=e[r.PROPERTY_FORMA_MAPPING]&&(this.formaMapping_=null),null!=e[r.PROPERTY_GRID_CELLS]&&(this.gridCells_=null),c.FormaStyle.prototype.didChangeState.call(this,e)},name:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_NAME),"String"))||null!=e?e:r.DEFAULT_NAME},set:function(e){this.set(r.PROPERTY_NAME,e)}},category:{get:function(){return i.as(this.get(r.PROPERTY_CATEGORY),"String")},set:function(e){this.set(r.PROPERTY_CATEGORY,e)}},ensureGridCells:function(){var e;if(null==this.gridCells_&&(this.gridCells_=[],(e=i.as(this.get(r.PROPERTY_GRID_CELLS),["Array","Any"]))&&e.length>0&&e[0]instanceof h.GridCell))for(var t=i.clone(e),n=i.iter(t);!n.done;n.next()){var o=n.value;i.opt(this.gridCells_,(function(e){return e.push(o)}))}},commitGridCells:function(){this.set(r.PROPERTY_GRID_CELLS,this.gridCells_)},gridCells:{get:function(){return this.ensureGridCells(),this.gridCells_}},setGridCells:function(e){this.gridCells_=i.clone(e),this.commitGridCells()},cellIndex:function(e){return i.opt(this.indexedCell(e,this.gridCells),(function(e){return e[0]}))},ensureFormaMapping:function(){var e;if(null==this.formaMapping_&&(this.formaMapping_={},(e=i.as(this.get(r.PROPERTY_FORMA_MAPPING),["Array","Any"]))&&e.length>0&&i.is(e[0],["Array","Any"])))for(var t=i.clone(e),n=i.iter(t);!n.done;n.next()){var o=n.value,a=i.as(o[0],"String"),s=i.as(o[1],h.GridCell);null!=a&&null!=s&&(this.formaMapping_[a]=s)}},commitFormaMapping:function(){for(var e=[],t=i.iter(this.formaMapping_);!t.done;t.next()){var n=t.key,o=t.value;e.push([n,o])}this.set(r.PROPERTY_FORMA_MAPPING,e)},formaMapping:{get:function(){return this.ensureFormaMapping(),this.formaMapping_}},setFormaMapping:function(e){this.formaMapping_=i.clone(e),this.commitFormaMapping()},indexedCell:function(e,t){for(var n=i.iter(i.toSequence(t));!n.done;n.next()){var r=n.value,o=r.offset,a=r.element;if(i.eq(h._equality_GridCell_GridCell,a,e))return[o,e]}return null},updateCell:function(e,t,n,r){var o;return void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),null!=(o=this.indexedCell(e,this.gridCells))?this.updateCellByIndex(o[0],t,n,r):null},updateCellByIndex:function(e,t,n,r){void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null);var o=this.gridCells[e],a=this.gridCells[e].copyTo(t,n,r);if(!i.eq(h._equality_GridCell_GridCell,o,a)){for(var s=[],l=i.iter(this.formaMapping);!l.done;l.next()){var u=l.key,c=l.value;i.eq(h._equality_GridCell_GridCell,c,o)&&s.push(u)}this.ensureGridCells(),this.gridCells_[e]=a,this.commitGridCells(),this.ensureFormaMapping();for(var d=i.iter(s);!d.done;d.next())u=d.value,this.formaMapping_[u]=a;return this.commitFormaMapping(),a}return o},insertCell:function(e,t){this.ensureGridCells(),this.gridCells_.splice(t,0,e),this.commitGridCells()},removeCell:function(e){this.ensureGridCells();for(var t,n=[],r=i.iter(this.formaMapping);!r.done;r.next()){var o=r.key,a=r.value;i.eq(h._equality_GridCell_GridCell,e,a)&&n.push(o)}null!=(t=this.indexedCell(e,this.gridCells_))&&i.opt(this.gridCells_,(function(e){return e.splice(t[0],1)}));for(var s=i.iter(n);!s.done;s.next())o=s.value,i.removeKey(this.formaMapping_,o);this.commitFormaMapping(),this.commitGridCells()},mergeCell:function(e,t){var n;if(null!=(n=this.indexedCell(e,this.gridCells))){for(var r=[],o=i.iter(this.formaMapping);!o.done;o.next()){var a=o.key,s=o.value;i.eq(h._equality_GridCell_GridCell,e,s)&&r.push(a)}this.ensureGridCells(),this.gridCells_[n[0]]=n[1].mergeWith(t),this.commitGridCells(),this.ensureFormaMapping();for(var l=i.iter(r);!l.done;l.next())a=l.value,this.formaMapping_[a]=this.gridCells_[n[0]];return this.commitFormaMapping(),this.gridCells[n[0]]}return null},mapCellToForma:function(e,t){this.mapCellToFormaID(e.formaID,t)},mapCellToFormaID:function(e,t){this.ensureFormaMapping(),this.formaMapping_[e]=t,this.commitFormaMapping()},removeMappingToForma:function(e){this.removeMappingToFormaID(e.formaID)},removeMappingToFormaID:function(e){this.ensureFormaMapping(),i.removeKey(this.formaMapping_,e),this.commitFormaMapping()},replaceMappedForma:function(e,t){this.ensureFormaMapping();var n=i.removeKey(this.formaMapping_,e.formaID);this.formaMapping_[t.formaID]=n,this.commitFormaMapping()},cellForForma:function(e){var t;if(t=this.formaMapping[e.formaID])for(var n=i.iter(i.toSequence(this.gridCells));!n.done;n.next()){var r=n.value,o=r.offset,a=r.element;if(i.eq(h._equality_GridCell_GridCell,t,a))return[o,t]}return null},forma:{get:function(){return this.forma_},set:function(e){this.forma_=e}},colorTableSupportsRole:function(e){return e==a.ColorRole.FieldPrimary},cropType:{get:function(){var e;return l.CropType.toCaseValue((e=i.as(this.get(r.PROPERTY_CROP_TYPE),"Int"))||null!=e?e:l.CropType.PreserveFocus)},set:function(e){this.set(r.PROPERTY_CROP_TYPE,e)}},gridCellArray:{get:function(){return this.gridCells}},drawnGridCell:function(e,t){return t.evalRect(e.bounds).insetXY(this.spacing/2,this.spacing/2).rounded()},spacing:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_SPACING),"Double"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_SPACING,e)}},moveableShift:{get:function(){return this.moveableShift_},set:function(e){this.moveableShift_=e}},numCells:{get:function(){return this.gridCells.length}},numBackgroundCells:{get:function(){return this.nonOverlappingCells().length}},flipRegion:function(){for(var e=[],t=i.iter(this.gridCells);!t.done;t.next()){var n=t.value;e.push(n.flip())}var o=this.name.includes("-flip")?i.replaceAll(this.name,"-flip",""):this.name+"-flip",a=null!=this.category?this.category:r.DEFAULT_CATEGORY;return r.init_bf40(o,a,e)},removeFormaMapping:function(){this.formaMapping_={},this.commitFormaMapping()},anyOverlap:{get:function(){return this.overlappingCells().length>0}},overlappingIndices:function(){if(0==this.gridCells.length)return[];for(var e=[],t=i.iter(i.range(0,this.gridCells.length-1,!0));!t.done;t.next())for(var n=t.value,r=i.iter(i.range(n,this.gridCells.length-1,!0));!r.done;r.next()){var o=r.value;if(o>n){var a,s=this.gridCells[o];(a=this.gridCells[n].bounds.intersectionWith(s.bounds))&&a.area>.01&&!e.includes(o)&&e.push(o)}}return e},overlappingCells:function(){var e=this;return this.overlappingIndices().map((function(t){return e.gridCells[t]}),this)},nonOverlappingCells:function(){return this.enumeratedNonOverlappingCells().map((function(e){return e[1]}),this)},enumeratedNonOverlappingCells:function(){for(var e=i.clone(this.overlappingIndices()),t=[],n=i.iter(i.toSequence(this.gridCells));!n.done;n.next()){var r=n.value,o=r.offset,a=r.element;e.includes(o)||t.push([o,a])}return t},fork:function(e){return c.FormaStyle.prototype.fork.call(this,e)},match:function(e){var t;if(t=i.as(e,r)){if(null==this.forma||null==t.forma||null==this.forma.root)return void f.LegacyCoreAssert.fail("Serious error in grid style. Not pointing to correct forma",void 0,"GridStyle.match","GridStyle.swift",419);if(this.forma.controller.kind!=d.GridController.KIND||t.forma.controller.kind!=d.GridController.KIND)return void f.LegacyCoreAssert.fail("Error: Not matching grids.",void 0,"GridStyle.match","GridStyle.swift",424);i.keys(this.formaMapping).length>0&&f.LegacyCoreAssert.isTrue(null!=this.forma,"missing forma",void 0,"GridStyle.match","GridStyle.swift",429),i.keys(t.formaMapping).length>0&&f.LegacyCoreAssert.isTrue(null!=t.forma,"missing forma",void 0,"GridStyle.match","GridStyle.swift",432),this.name=t.name,this.spacing=t.spacing,this.moveableShift=t.moveableShift,this.cropType=t.cropType,this.category=t.category;for(var n=[],o={},a=i.iter(t.gridCells);!a.done;a.next()){var l=a.value;n.push(l)}if(null!=this.forma){for(var c,m=[],y=[],_=i.iter(i.keys(this.formaMapping));!_.done;_.next()){var T=_.value;l=this.formaMapping[T],null!=(C=i.opt(this.forma,(function(e){return e.page.formaByID(T)})))&&C.isBackgroundImage()&&m.push(l)}for(var v=i.iter(i.keys(t.formaMapping));!v.done;v.next()){var C;T=v.value,l=t.formaMapping[T],null!=(C=i.opt(t.forma,(function(e){return e.page.formaByID(T)})))&&C.isBackgroundImage()&&y.push(l)}if(null!=this.forma&&(c=i.as(t.forma.controller,d.GridController))){var P=i.clone(c.gridStyle.gridCells),S=i.clone(t.forma.filterByKind(u.FrameForma.KIND));if(m.length>1&&1==P.length&&S.length<=1&&P[0].bounds.equalWithAccuracy(g.TheoRect.ONE_BY_ONE,h.GridCell.BOUNDS_ACCURACY))return}for(var D=function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX},A=i.sort(m,D),E=i.sort(y,D),R=i.clone(t.overlappingCells()),F=i.clone(t.nonOverlappingCells()),b=i.iter(this.forma.visitAsArray(s.FormaTraversal.JustChildren));!b.done;b.next()){var I=b.value;if(T=I.formaID,I.isBackgroundImage()){if(A.length>0)for(var O=i.iter(i.range(0,A.length-1,!0));!O.done;O.next()){var k=O.value,N=A[k];i.eq(h._equality_GridCell_GridCell,this.formaMapping[T],N)&&E.length>0&&(o[T]=E[Math.min(k,E.length-1)])}if(null==o[T]&&(N=this.formaMapping[T]))for(var M=0,L=i.iter(F);!L.done;L.next()){var x;(x=(l=L.value).bounds.intersectionWith(N.bounds))&&x.area>M&&(M=x.area,o[I.formaID]=l)}}else if(I.isTypeLockup()&&R.length>0)o[T]=R[0];else{var B,w,G;null!=(B=I.contentID)&&(w=i.opt(i.opt(t.forma,(function(e){return e.root})),(function(e){return e.formaByContentID(B)})))&&(G=t.formaMapping[w.formaID])&&(o[I.formaID]=G)}}}for(var Y=[],U=i.iter(i.keys(t.formaMapping));!U.done;U.next()){var j;if(T=U.value,l=t.formaMapping[T],null!=this.forma&&i.opt(this.forma,(function(e){return null!=e.root}))){if(j=i.opt(this.forma,(function(e){return e.page.formaByID(T)}))){var V,H=!0;(V=i.as(i.opt(this.forma,(function(e){return e.controller})),d.GridController))&&(H=!V.isGridCell(j)||!j.isShape()),H&&(o[T]=l)}}else o[T]=l;null==this.indexedCell(l,Y)&&Y.push(l)}this.setGridCells(n.concat()),this.removeFormaMapping();var K={};i.each(o,(function(e,t){K[e]=t})),this.gridCells.length<Y.length&&p.Host.logging.info("cells "+this.gridCells.length+" mapped "+Y);for(var W=i.iter(i.keys(K));!W.done;W.next())T=W.value,l=K[T],null==this.forma.page.formaByID(T)?(f.LegacyCoreAssert.fail("shouldn't point to a forma which isn't a child",void 0,"GridStyle.match","GridStyle.swift",595),i.opt(this.forma,(function(e){return null==e.page.formaByID(T)}))&&f.LegacyCoreAssert.fail("we're really borked. pointing a forma which isn't in the forma tree",void 0,"GridStyle.match","GridStyle.swift",598),i.removeKey(K,T)):null==this.indexedCell(l,this.gridCells)&&(f.LegacyCoreAssert.fail("shouldn't point to a cell which isn't part of the grid.",void 0,"GridStyle.match","GridStyle.swift",605),i.removeKey(K,T));this.formaMapping_=i.clone(K),this.commitFormaMapping()}},postCloneMatch:function(e){if(null!=this.forma&&null!=e.forma&&null!=this.forma.root)for(var t=i.clone(e.forma.visitAsArray(s.FormaTraversal.JustChildren)),n=i.keys(e.formaMapping),r=i.iter(n);!r.done;r.next()){var o,a=r.value,l=e.formaMapping[a];if(o=i.opt(this.forma,(function(e){return e.page.formaByID(a)}))){e.ensureFormaMapping();for(var u=i.iter(t);!u.done;u.next()){var c=u.value;o.frame.equalWithAccuracy(c.frame,.01)&&(e.formaMapping_[c.formaID]=l,i.removeKey(e.formaMapping_,a))}e.commitFormaMapping()}}else f.LegacyCoreAssert.fail("Serious error in grid style. Not pointing to correct forma",void 0,"GridStyle.postCloneMatch","GridStyle.swift",620)},equals:function(e){return this.name==e.name&&this.geometricEquals(e)},geometricEquals:function(e){if(this.gridCells.length!=e.gridCells.length)return!1;for(var t=i.sort(this.gridCells,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)})),n=i.sort(e.gridCells,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)})),r=i.iter(i.range(0,t.length-1,!0));!r.done;r.next()){var o,a=r.value;if(!(o=t[a].bounds.intersectionWith(n[a].bounds)))return!1;if(Math.abs((o.area-t[a].bounds.area)/o.area)>.02)return!1}return!0},similarity:function(e){if(this.numCells!=e.numCells)return 1;for(var t=i.sort(this.gridCells,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)})),n=i.sort(e.gridCells,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)})),r=[],o=i.iter(i.range(0,t.length-1,!0));!o.done;o.next()){var a=o.value;r.push(t[a].bounds.similarity(n[a].bounds))}return r.reduce((function(e,t){return e+t}),0)/i.toDouble(r.length)},insetBackgroundCells:function(e){for(var t=i.iter(this.enumeratedNonOverlappingCells());!t.done;t.next()){var n,r=t.value;(n=r[1].bounds.intersectionWith(e))&&this.updateCellByIndex(r[0],n)}},setCellBounds:function(e,t){null!=this.gridCells_&&i.containsEq(this.gridCells_,e,h._equality_GridCell_GridCell)&&(e.bounds=t,this.commitGridCells())},asString:{get:function(){return this.name}}}}),r)},"5XIA":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("9oQN"),l=n("T6jX"),u=n("9BFu");i.PageResizeScore=(r=function e(t){this.rejectThreshold=-1,this.overlapInitial_={},this.outOfBoundsInitial_={},this.alignmentInitial_={},this.root_=t,this.floating_=a.clone(this.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),this.floating_.length>2*l.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD&&(this.floating_=this.floating_.slice(0,2*l.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD)),u.WeightedScore.call(this,e.Features.NUM_FEAT),this.initFeatures()},o={},a.defineClass({name:"PageResizeScore",ctor:r,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===o.Features&&(o.Features=a.defineEnum("Features",{TEXT_OVERLAP:1,FLOATING_ELEMENT_OVERLAP:2,TEXT_FLOATING_OVERLAP:3,OUT_OF_BOUNDS:4,INCORRECT_TEXT_ALIGNMENT:5,NUM_FEAT:6})),o.Features}},_implements:function(e){return"DocumentEvaluationScore"==e}},props:{initFeatures:function(){this.setFeatureName(r.Features.TEXT_OVERLAP,"Text Overlap"),this.setFeatureName(r.Features.FLOATING_ELEMENT_OVERLAP,"Floating Elements Overlap"),this.setFeatureName(r.Features.TEXT_FLOATING_OVERLAP,"Text Forma Overlapping floating"),this.setFeatureName(r.Features.OUT_OF_BOUNDS,"Out of bounds"),this.setFeatureName(r.Features.INCORRECT_TEXT_ALIGNMENT,"Broken Text Alignments"),this.setWeight(r.Features.TEXT_OVERLAP,-20),this.setWeight(r.Features.FLOATING_ELEMENT_OVERLAP,-10),this.setWeight(r.Features.TEXT_FLOATING_OVERLAP,-10),this.setWeight(r.Features.OUT_OF_BOUNDS,-10),this.setWeight(r.Features.INCORRECT_TEXT_ALIGNMENT,-1),this.setFeature(r.Features.TEXT_OVERLAP,0),this.setFeature(r.Features.FLOATING_ELEMENT_OVERLAP,0),this.setFeature(r.Features.TEXT_FLOATING_OVERLAP,0),this.setFeature(r.Features.OUT_OF_BOUNDS,0),this.setFeature(r.Features.INCORRECT_TEXT_ALIGNMENT,0),this.overlapInitial_=a.clone(s.EvaluationUtils.getFormaOverlap(this.floating_)),this.outOfBoundsInitial_=a.clone(s.EvaluationUtils.getFormaOutOfBounds(this.floating_)),this.alignmentInitial_=a.clone(s.EvaluationUtils.getFormaAlignment(this.floating_))},evaluateDocument:function(){var e=s.EvaluationUtils.evaluateOutOfBounds(this.floating_,this.outOfBoundsInitial_,s.EvaluationUtils.getFormaOutOfBounds(this.floating_)),t=s.EvaluationUtils.evaluateAlignment(this.floating_,this.alignmentInitial_,s.EvaluationUtils.getFormaAlignment(this.floating_)),n=s.EvaluationUtils.evaluateOverlap(this.floating_,this.overlapInitial_,s.EvaluationUtils.getFormaOverlap(this.floating_)),o=n.textOverlap,i=n.graphicOverlap,a=n.graphicTextOverlap;this.setFeature(r.Features.OUT_OF_BOUNDS,e),this.setFeature(r.Features.INCORRECT_TEXT_ALIGNMENT,t),this.setFeature(r.Features.TEXT_OVERLAP,o),this.setFeature(r.Features.FLOATING_ELEMENT_OVERLAP,i),this.setFeature(r.Features.TEXT_FLOATING_OVERLAP,a)},print:function(){return this.asString},reject:function(){return this.score<this.rejectThreshold},evalScore:function(){return this.score}}}),r)},"5ex8":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("6ZWm"),l=n("cmoc"),u=n("7Pku"),c=n("w/+j"),d=n("fdtz"),h=n("lmwz"),p=n("fNpk"),f=n("tGKA"),m=n("Ird5"),g=n("jLWG"),y=n("jfma"),_=n("dmHI"),T=n("vTQu"),v=n("yjxF"),C=n("Aj79"),P=n("Ucb9"),S=n("g6aL"),D=n("Zifs"),A=n("djAF"),E=n("3HaQ"),R=n("hgLm"),F=n("oKlP");i.FrameFormaToPGMMapper=(r=function e(){u.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},a.defineClass({name:"FrameFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=l.FrameForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{frameHasFillColor:function(e){var t,n;return!(!(t=a.as(e,l.FrameForma))||!(n=a.as(t.controller,s.FrameController)))&&n.hasCutout},makePGMRef:function(e,t,n,r){var o,i,b;if((o=a.as(e,l.FrameForma))&&(i=n.childReferences(o))&&(b=o.bounds)){var I,O,k=null,N=o.formaID,M=new v.PGMNodeMetadata(o.formaID,"frame"),L=m.PGMAnimationList.EMPTY,x=this.frameHasFillColor(e),B=o.style.opacity,w=y.PGMBlendModeEnum.Normal;if(x){var G,Y=o.style.colors.fieldPrimary||D.SolidColor.ZERO,U=new R.TheoRectanglePath(b);(G=h.ImageFacade.getImageFormaForForma(o))&&(B=G.style.opacity),k=new C.PGMReference(new P.PGMShape(o.formaID+"-background",new v.PGMNodeMetadata(o.formaID,"background"),m.PGMAnimationList.EMPTY,b,[U],Y)),i.splice(0,0,k)}if(w=u.FormaToPGMMapper.mapBlendMode(o),O=h.ImageFacade.getMaskFormaForForma(o)){var j,V;if(j=a.as(O,A.ShapeForma))I=new S.PGMSimpleGroup(N,M,L,[E.ShapeFormaToPGMMapper.applyPathAsClip(t,j,e,i,j.formaID)]);else{if(!(V=a.as(O,d.ImageForma)))return p.LegacyCoreAssert.fail("child reference generation failed for frame: unknown mask type",void 0,"FrameFormaToPGMMapper.makePGMRef","FrameFormaToPGMMapper.swift",150),null;var H,K;if(!(H=n.referenceForForma(V)))return p.LegacyCoreAssert.fail("child reference generation failed for frame: no image?",void 0,"FrameFormaToPGMMapper.makePGMRef","FrameFormaToPGMMapper.swift",145),null;K=1==i.length?i[0]:new C.PGMReference(new S.PGMSimpleGroup(N+"-children-group",M,L,i));var W,X=f.Matrix2D.calculateResizeTransform(V.bounds,o.bounds,F.TheoPoint.ZERO,s.FitType.Stretch),z=H.withPlacement(X);I=new _.PGMFilter(N,M,L,[K,z],new T.PGMMaskFilterSpec),(W=k)&&(I=new S.PGMSimpleGroup(N,M,L,[W,new C.PGMReference(I)]))}}else{var q,Z=!1,J=new R.TheoRectanglePath(o.bounds);(q=a.as(o.controller,s.FrameController))&&(Z=q.clip),I=Z?new g.PGMClip(N,M,L,i,[J]):new S.PGMSimpleGroup(N,M,L,i)}return c.FormaToPGMUtils.applyAnimations(t,e,new C.PGMReference(I,new y.PGMCompositingParams(o.placement,B,w)))}return p.LegacyCoreAssert.fail("frame forma child reference generation failed",void 0,"FrameFormaToPGMMapper.makePGMRef","FrameFormaToPGMMapper.swift",185),null}}}),r)},"6Rk9":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("tGKA"),s=n("MnRR"),l=n("8t9B"),u=n("oKlP"),c=n("sIWg");o.GeometryFacade=(r=function(){},i.defineClass({name:"GeometryFacade",ctor:r,statics:{getFormaeBounds:function(e,t){void 0===t&&(t=!1);var n=c.TheoRect.Zero;if(e.length>0)if(t){var r=e.map((function(e){return e.controller.getUserPerceivedFrame()}),this);n=r.reduce((function(e,t){return e.unionWith(t)}),r[0])}else{var o=e[0];n=e.reduce((function(e,t){return e.unionWith(t.finalFrame)}),o.finalFrame)}return n},unionFrame:function(e,t){if(void 0===t&&(t=null),0==e.length)return null;for(var n=t||e[0].parent,r=null,o=i.iter(e);!o.done;o.next()){for(var a=o.value,s=a.placement,l=a.parent;null!=l&&l!=n;)s=s.concat(l.placement),l=i.opt(l,(function(e){return e.parent}));var u=a.boundsInCoordSpace(s);r=null==r?u:r.unionWith(u)}return r},polyFromFormaBounds:function(e){var t=e.bounds||c.TheoRect.Zero,n=[t.evalXY(0,0),t.evalXY(1,0),t.evalXY(1,1),t.evalXY(0,1)];return e.totalPlacement.transformPoints(n)},formaBoundsIntersect:function(e,t){var n=i.clone(r.polyFromFormaBounds(e)),o=i.clone(r.polyFromFormaBounds(t)),a=[];a.push(n),a.push(o);for(var s=i.iter(a);!s.done;s.next())for(var l=s.value,c=i.iter(i.toSequence(l));!c.done;c.next()){for(var d=c.value,h=d.offset,p=d.element,f=l[(h+1)%l.length],m=new u.TheoPoint(f.y-p.y,p.x-f.x),g=null,y=null,_=i.iter(n);!_.done;_.next()){var T=_.value,v=m.x*T.x+m.y*T.y;(null==g||v<g)&&(g=v),(null==y||v>y)&&(y=v)}for(var C=null,P=null,S=i.iter(o);!S.done;S.next()){var D=S.value,A=m.x*D.x+m.y*D.y;(null==C||A<C)&&(C=A),(null==P||A>P)&&(P=A)}if(null!=y&&null!=C&&y<C)return!1;if(null!=P&&null!=g&&P<g)return!1}return!0},getIntersectionPolygon:function(e,t,n,o){var i=[];return r.getEdgeIntersections(e,t,n,o,i),r.getCornersInsideOtherRect(e,t,n,o,i),r.getCornersInsideOtherRect(t,e,o,n,i),i},getEdgeIntersections:function(e,t,n,o,a){for(var s=[e.horizontalLine(0).transform(n),e.horizontalLine(1).transform(n),e.verticalLine(0).transform(n),e.verticalLine(1).transform(n)],l=[t.horizontalLine(0).transform(o),t.horizontalLine(1).transform(o),t.verticalLine(0).transform(o),t.verticalLine(1).transform(o)],u=i.iter(s);!u.done;u.next())for(var c=u.value,d=i.iter(l);!d.done;d.next()){var h,p=d.value;if(h=c.intersection(p)){var f=c.locate(h),m=p.locate(h);f>=-.001&&f<=1.001&&m>=-.001&&m<=1.001&&r.appendPoint(h,a)}}},getCornersInsideOtherRect:function(e,t,n,o,s){for(var l=a._asterisk_Matrix2D_Matrix2D(o,n.inverse),u=i.clone(t.points),c=i.iter(u);!c.done;c.next()){var d=c.value;e.containsPoint(l.transformPoint(d))&&r.appendPoint(o.transformPoint(d),s)}},appendPoint:function(e,t){for(var n=i.iter(t);!n.done;n.next())if(n.value.distanceTo(e)<.01)return;t.push(e)},areaOfConvexPolygon:function(e){if(e.length<3)return 0;for(var t=i.clone(r.sortConvexPolygonVertices(e)),n=0,o=0,a=i.iter(i.toSequence(t));!a.done;a.next()){var s=a.value,l=s.offset,u=s.element,c=t[(l+1)%t.length].y;n+=u.x*c;var d=t[(l+1)%t.length].x;o+=u.y*d}return(n-o)/2},centerOfPolygon:function(e){return 0==e.length?u.TheoPoint.ZERO:e.reduce((function(e,t){return u._plus_TheoPoint_TheoPoint(e,t)}),u.TheoPoint.ZERO).divide(i.toDouble(e.length))},sortConvexPolygonVertices:function(e){if(0==e.length)return e;var t=r.centerOfPolygon(e),n=new s.TheoLine(t,u._plus_TheoPoint_TheoPoint(t,new u.TheoPoint(100,0)));return i.sort(e,(function(e,r){return new s.TheoLine(t,e).angleWith(n)>new s.TheoLine(t,r).angleWith(n)}))},getClosestPin:function(e,t){for(var n,r=[[.5,.5],[.5,0],[.5,1],[0,.5],[1,.5],[0,0],[0,1],[1,0],[1,1]],o=null,a=1/0,s=i.iter(r);!s.done;s.next()){var l=s.value,c=e.evalXY(l[0],l[1]),d=t.evalXY(l[0],l[1]),h=c.distanceTo(d);h<a&&(a=h,o=l)}var p=(n=o)||null!=n?n:r[0];return new u.TheoPoint(p[0],p[1])},getScaleToFit:function(e,t,n){if(e.outsetXY(1,1).containsPoint(n)&&t.outsetXY(1,1).containsPoint(n)){var o,i,a,s,l=1/0;return null!=(o=r.getScaleToFitOneDim(e.minX,t.minX,n.x))&&(l=Math.min(l,o)),null!=(i=r.getScaleToFitOneDim(e.maxX,t.maxX,n.x))&&(l=Math.min(l,i)),null!=(a=r.getScaleToFitOneDim(e.minY,t.minY,n.y))&&(l=Math.min(l,a)),null!=(s=r.getScaleToFitOneDim(e.maxY,t.maxY,n.y))&&(l=Math.min(l,s)),l}return null},getScaleToFitOneDim:function(e,t,n){var r=Math.abs(e-n);return r<.1?null:Math.abs(t-n)/r},NEEDS_FITTING_MAX_INITIAL_RATIO:1.1,NEEDS_FITTING_MIN_NEW_RATIO:1.5,FIT_IN_PAGE_MARGIN:10,fitInPage:function(e,t,n,o,a,s){var d,h,p,f,m;if(void 0===t&&(t=null),void 0===n&&(n=u.TheoPoint.ZERO),void 0===o&&(o=r.FIT_IN_PAGE_MARGIN),void 0===a&&(a=r.NEEDS_FITTING_MAX_INITIAL_RATIO),void 0===s&&(s=r.NEEDS_FITTING_MIN_NEW_RATIO),(p=e.root)&&(f=e.controller)&&(m=e.finalFrame)){var g=c.TheoRect.fromSize(e.page.pageSize).insetXY(o,o),y=g.width,_=g.height,T=((d=i.opt(t,(function(e){return e.width})))||null!=d?d:0)<y*a,v=((h=i.opt(t,(function(e){return e.height})))||null!=h?h:0)<_*a;if(T&&m.width>y*s||v&&m.height>_*s){var C=Math.min(y/m.width,1),P=Math.min(_/m.height,1);f.maintainAspectRatio&&(C=Math.min(C,P),P=C),e.bounds=i.opt(e.bounds,(function(e){return e.scaleXY(C,P,n)})),i.opt(i.as(f,l.TypeLockupController),(function(e){return e.snapSizeToBounds()}))}f.preventOutofBounds(p,g)}}}}),r)},"6Tzw":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("0wFF"),s=n("gXiO"),l=n("FNB+"),u=n("9Lk3"),c=n("iCxV"),d=n("sIWg");o.MultiSelectUIMode=i.defineEnum("MultiSelectUIMode",{ModeWithAutoDismissAfterOneTap:0,ModeRequiresExplicitDismiss:1}),o.SelectionFacade=(r=function(){s.CoreObject.call(this)},i.defineClass({name:"SelectionFacade",ctor:r,superName:"CoreObject",statics:{isMultiSelect:function(e){var t;return!(!((t=e)&&t.selectedCount>1)||t.inCharStyleMode)},isGroupSelect:function(e){var t,n;return!(!(n=e)||1!=n.selectedCount||!(t=i.opt(i.opt(n.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroupMember})))&&null==t||!t)},isCharStyleSelection:function(e){var t,n,r;return!!((t=e)&&t.selectedCount>1&&(n=t.formaAt(0))&&(r=t.formaAt(1)))&&(n.isTypeLockup()&&r.isText())},getMultiSelectUIMode:function(){return o.MultiSelectUIMode.ModeRequiresExplicitDismiss},enableAdditionalMultiSelectGestures:function(){return!1},selectFormae:function(e){var t;if(e.length>0&&(t=i.opt(i.opt(i.opt(i.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){var n=t.selectedCount;t.selectFormae(e);for(var r=i.iter(t.asFormaArray());!r.done;r.next()){var o,s=r.value;(o=i.opt(s.controller,(function(e){return e.userGroupRoot})))&&(t.deselectForma(s),t.selectForma(o))}var l=t.selectedCount;if(l>1){for(var u=i.iter(t.asFormaArray());!u.done;u.next())s=u.value,i.opt(s.controller,(function(e){return 0==e.canMultiSelect}))&&t.deselectForma(s);i.opt(c.Host.logging,(function(e){return e.logToAnalytics(a.AnalyticsConstants.kAnalyticsDataSelectionMultiple,{contextualData1:"oldSelectedCount:"+n,contextualData2:"newSelectedCount:"+l})}))}}},replaceSelectionWithFormae:function(e){var t;if(e.length>0&&(t=i.opt(i.opt(i.opt(i.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){var n=e.filter((function(e){return i.opt(e.controller,(function(e){return 1==e.canMultiSelect}))}),this);t.replaceSelectionWithFormae(n)}},deselectFormae:function(e){var t;if(e.length>0&&(t=i.opt(i.opt(i.opt(i.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){t.deselectFormae(e);for(var n=i.iter(e);!n.done;n.next()){var r,o=n.value;(r=i.opt(o.controller,(function(e){return e.userGroupRoot})))&&t.deselectForma(r)}}},canSelectParent:function(e){var t;return!!((t=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&t.selectedCount>=1&&t.formaAt(0))},selectParent:function(e){var t;if(t=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection}))){var n,o,a;if(1==t.selectedCount&&(n=t.formaAt(0))&&(o=n.parent)&&(a=o.controller)&&a.kind!=u.GridController.KIND&&a.selectable)return void t.replaceSelection(a.forma);r.deselectAllOnPage(e)}},canSelectChild:function(e){var t,n,r;if((n=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==n.selectedCount&&(r=n.formaAt(0))&&r.controller)for(var o=i.iter(r.visitAsArray(l.FormaTraversal.JustChildren));!o.done;o.next()){var a=o.value;if(((t=i.opt(a.controller,(function(e){return e.selectable})))||null!=t)&&t&&i.opt(a.controller,(function(e){return e.kind!=u.GridController.KIND})))return!0}return!1},selectChild:function(e){var t,n,r;if((n=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==n.selectedCount&&(r=n.formaAt(0))&&r.controller)for(var o=i.iter(r.visitAsArray(l.FormaTraversal.JustChildren));!o.done;o.next()){var a=o.value;((t=i.opt(a.controller,(function(e){return e.selectable})))||null!=t)&&t&&n.replaceSelection(a)}},canSelectSibling:function(e){var t,n,r,o,a=this;return!!((t=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==t.selectedCount&&(n=t.formaAt(0))&&(r=n.controller)&&(o=i.opt(r.getSiblingFormae(),(function(e){return e.filter((function(e){return i.opt(e.controller,(function(e){return 1==e.selectable}))}),a)}))))&&o.length>1},selectSibling:function(e,t){void 0===t&&(t=!0);var n,r,o,a,s,u=this;if((n=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&1==n.selectedCount&&(r=n.formaAt(0))&&(o=r.controller)&&(a=i.opt(o.getSiblingFormae(),(function(e){return e.filter((function(e){return i.opt(e.controller,(function(e){return 1==e.selectable}))}),u)})))&&null!=(s=i.indexOfEq(a,r,l._equality_Forma_Forma))){var c=(s+(t?1:-1))%a.length;c<0&&(c=a.length-1);var d=a[c];n.replaceSelection(d)}},marqueeSelectFormae:function(e,t){var n;if(e.length>0&&(n=i.opt(i.opt(i.opt(i.first(e),(function(e){return e.page.document})),(function(e){return e.controller})),(function(e){return e.selection})))){for(var o=!0,a=i.iter(e);!a.done;a.next()){var s=a.value;if(!n.isSelected(s)&&!n.isGroupSelected(s)){o=!1;break}}o&&(t||c.Host.platform.isMobile)?r.deselectFormae(e):t||c.Host.platform.isMobile?r.selectFormae(e):r.replaceSelectionWithFormae(e)}},deselectAllOnPage:function(e){var t;(t=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&t.clearSelection(!0)},selectAllOnPage:function(e){var t;if(t=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection}))){var n=t.selectedCount;t.clearSelectionNoUpdate();var o=i.clone(e.selectableFormaeIntersectingRect(d.TheoRect.Huge));r.selectFormae(o);var s=t.selectedCount;i.opt(c.Host.logging,(function(e){return e.logToAnalytics(a.AnalyticsConstants.kAnalyticsDataSelectionSelectAll,{contextualData1:"oldSelectedCount:"+n,contextualData2:"newSelectedCount:"+s})}))}},getSelectionBounds:function(e){var t,n=d.TheoRect.Zero;return(t=i.opt(i.opt(e.document,(function(e){return e.controller})),(function(e){return e.selection})))&&(n=t.getSelectionBounds()),n}}}),r)},"6azk":function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("gXiO"),u=n("WF+G"),c=n("ZhwN"),d=n("fNpk");a.MiniDocumentBranch=(r=function(e){this.root_=new a.MiniDocumentNode(e,null)},s.defineClass({name:"MiniDocumentBranch",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"HostDocumentBranch"==e}},props:{root:{get:function(){return this.root_}},id:{get:function(){return this.root.nodeId}},allComponents:{get:function(){var e=[];return this.root_.findComponent((function(t){return e.push(t),!1})),e}},getValue:function(e){return this.root_.getValue(e)},setValue:function(e,t){this.root.setValue(e,t)},appendNode:function(e,t,n){return(n||this.root_).appendNode(e,t)},removeNode:function(e){this.root_.removeNode(e)},getNodeWithAbsolutePath:function(e){return this.root_.find((function(t){return t.getAbsolutePath().asString==e}))},getChildrenOfNode:function(e){return e.children},getComponentsOfNode:function(e){return e.components},getComponentWithId:function(e){return this.root_.findComponent((function(t){return t.componentId==e}))},getPathForComponent:function(e){return e.sourceFile},getComponentWithAbsolutePath:function(e){return this.root_.findComponent((function(t){return t.absolutePath.asString==e}))},addComponent:function(e,t,n,r,o,i,a,s,l){return i.addComponent(e,t,n,r,o,a)},moveComponent:function(e,t){return t.moveComponent(e)},updateComponent:function(e,t,n){var r;return(r=s.as(e,a.MiniDocumentComponent))?(null!=t&&(r.sourceFile=t),r):(d.LegacyCoreAssert.fail("Not a Core component",void 0,"MiniDocumentBranch.updateComponent","MiniDocumentBranch.swift",97),null)},transferEncodingTo:function(e){this.root_.transferEncodingTo(e);for(var t=s.iter(this.root_.components);!t.done;t.next()){var n=t.value;e.appendComponent(n.componentId,n.sourceFile,n.type)}}}}),r),a.MiniDocumentNode=(o=function(e,t){var n;this.parent_=null,this.props_={},this.children_=[],this.components_=[],l.CoreObject.call(this),this.setValue("id",s.as((n=e)||null!=n?n:c.GUIDUtils.makeGUID(),"AnyObject")),this.path=t},s.defineClass({name:"MiniDocumentNode",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"HostDocumentNode"==e}},props:{path:{get:function(){return s.as(this.props_.path,"String")},set:function(e){null==e?s.removeKey(this.props_,"path"):this.props_.path=s.as(e,"AnyObject")}},nodeId:{get:function(){var e;return(e=s.as(this.props_.id,"String"))||null!=e?e:""}},getValue:function(e){return this.props_[e]},setValue:function(e,t){null==t?s.removeKey(this.props_,e):this.props_[e]=t},removeValue:function(e){s.removeKey(this.props_,e)},appendNode:function(e,t){var n=new o(e,t);return this.children_.push(n),n.parent_=this,n},removeNode:function(e){var t;(t=s.as(e,o))?t.parent_!==this?d.LegacyCoreAssert.fail("Can't remove a non-child node",void 0,"MiniDocumentNode.removeNode","MiniDocumentBranch.swift",167):(s.remove(this.children_,t),t.parent_=null):d.LegacyCoreAssert.fail("Not a Core node",void 0,"MiniDocumentNode.removeNode","MiniDocumentBranch.swift",173)},children:{get:function(){return this.children_}},components:{get:function(){return this.components_}},addComponent:function(e,t,n,r,o,i){var s=new a.MiniDocumentComponent(e,t,n,r,o,i);return s.node=this,this.components_.push(s),s},moveComponent:function(e){var t,n;return(t=s.as(e,a.MiniDocumentComponent))?((n=t.node)&&s.remove(n.components_,t),this.components_.push(t),t.node=this,t):(d.LegacyCoreAssert.fail("Not a Core component",void 0,"MiniDocumentNode.moveComponent","MiniDocumentBranch.swift",206),null)},getAbsolutePath:function(){var e=s.opt(this.parent_,(function(e){return e.getAbsolutePath()}))||u.CorePath.ROOT;return null==this.path?e:e.appendPart(this.path)},find:function(e){if(e(this))return this;for(var t=s.iter(this.children);!t.done;t.next()){var n;if(n=t.value.find(e))return n}return null},findComponent:function(e){for(var t=s.iter(this.components);!t.done;t.next()){var n=t.value;if(e(n))return n}for(var r=s.iter(this.children);!r.done;r.next()){var o;if(o=r.value.findComponent(e))return o}return null},transferEncodingTo:function(e){for(var t=s.iter(this.props_);!t.done;t.next()){var n=t.key,r=t.value;e.setManifestProperty(n,r,!1)}for(var o=s.iter(this.children);!o.done;o.next()){var i=o.value,a=e.findChild(i.path)||e.appendChild(i.nodeId);i.transferEncodingTo(a)}}}}),o),a.MiniDocumentComponent=(i=function(e,t,n,r,o,i){var a;this.node=null,this.componentId="",this.name=null,this.etag=null,this.relationship=null,this.name=e,this.componentId=(a=t)||null!=a?a:c.GUIDUtils.makeGUID(),this.type=n,this.relationship=r,this.path=o,this.sourceFile=i,l.CoreObject.call(this)},s.defineClass({name:"MiniDocumentComponent",ctor:i,superName:"CoreObject",statics:{_implements:function(e){return"HostDocumentComponent"==e}},props:{absolutePath:{get:function(){var e=s.opt(this.node,(function(e){return e.getAbsolutePath()}))||u.CorePath.ROOT;return null!=this.path&&(e=e.appendPart(this.path)),e}},mutableCopy:{get:function(){return this}},setValue:function(e,t){}}}),i)},"6h7+":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("Tq01"),s=n("0wFF"),l=n("dHJt"),u=n("CWW7"),c=n("yGNn"),d=n("FNB+"),h=n("6ZWm"),p=n("G1DZ"),f=n("P83h"),m=n("pnSN"),g=n("X0GW"),y=n("iCxV"),_=n("c+uM"),T=n("tGKA"),v=n("jcfx"),C=n("djAF"),P=n("8t9B"),S=n("sIWg");o.BadgeType=i.defineEnum("BadgeType",{Lockup:"lockup"}),o.BadgeFacade=(r=function(){},i.defineClass({name:"BadgeFacade",ctor:r,statics:{addBadge:function(e,t,n,o,s){void 0===o&&(o=null),void 0===s&&(s=null);var d=[];if(r.getFormaeToCopy(e.firstPage.root,d),0==d.length)return c.CorePromise.reject("Badge is empty");var h=r.areFormaeGrayscale(d),p=new f.FormaStyleChangedEvent(n.root);return n.beginUpdate(p),u.CreationFacade.copyItems(d,n,h,!1,s).then((function(e){var u=i.clone(e);return r.recordSources(t,d,u),new l.BadgeLayoutController(u).update(s),r.handleReplace(o,u),r.stopColorChangeLoggingForID[t]=!0,r.onBadgeFormaePlaced(u,n,h),i.removeKey(r.stopColorChangeLoggingForID,t),n.endUpdate(p),new a.FormaActionResult(u)})).fail((function(e){return n.endUpdate(p),c.CorePromise.reject("Forma copy failed")}))},getDesignIngredientIDAndType:function(e){return{id:p.FormaSourceUtils.stripNamespace(e),type:o.BadgeType.Lockup}},stopColorChangeLoggingForID:{},logColorChange:function(e){var t;if(null!=(t=e)&&p.FormaSourceUtils.isDesignIngredient(t)){var n=r.getDesignIngredientIDAndType(t),o=n.id,a=n.type;null==r.stopColorChangeLoggingForID[o]&&(i.opt(y.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kDesignIngredientColorChanged,{contextualData1:"designIngredientId:"+o,contextualData2:"designIngredientType:"+a})})),r.stopColorChangeLoggingForID[o]=!0)}},logFontChange:function(e,t){var n;if(null!=(n=e)&&p.FormaSourceUtils.isDesignIngredient(n)){var o=r.getDesignIngredientIDAndType(n),a=o.id,l=o.type;i.opt(y.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kDesignIngredientFontChanged,{contextualData1:"designIngredientId:"+a,contextualData2:"designIngredientType:"+l,contextualData10:"fontName:"+t})}))}},logBackingShapeChange:function(e,t){var n;if(null!=(n=e)&&p.FormaSourceUtils.isDesignIngredient(n)){var o=r.getDesignIngredientIDAndType(n),a=o.id,l=o.type;i.opt(y.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kDesignIngredientBackingShapeChanged,{contextualData1:"designIngredientId:"+a,contextualData2:"designIngredientType:"+l,contextualData12:"shapeName:"+t})}))}},getFormaeToCopy:function(e,t){var n;if(r.checkEligibility(e,r.isBadgeAtom))t.push(e);else if((n=i.as(e,m.GroupForma))&&i.opt(n.controller,(function(e){return 0==e.userGroup})))for(var o=i.iter(i.range(0,n.childCount,!1));!o.done;o.next()){var a=o.value;r.getFormaeToCopy(n.childAt(a),t)}},isBadgeAtom:function(e,t){return!(e.kind!=C.ShapeForma.KIND||!e.hasIntent(d.Forma.INTENT_ICON))||t.kind==P.TypeLockupController.KIND||t.kind==h.FrameController.KIND&&t.duplicatable},handleReplace:function(e,t){var n,r,o,a,s,l,u,c,d=!1;if(i.opt(e,(function(e){return 1==e.isBackgroundImage()}))){if(t.length>1||i.opt(i.opt(i.first(t),(function(e){return e.controller})),(function(e){return 1==e.userGroup})))return;d=!0}if((r=e)&&(o=r.parent)&&null!=(a=o.indexOfChild(r))&&(s=r.controller)&&(l=r.frame)&&(u=1==t.length?i.first(t):g.GroupFacade.createGroupFromFormae(t))&&(c=u.controller)){if(o.insertChildAt(u,a),d)u.allowUserMove=!1,c.fit(l);else{var h=r.rotationInRadians();s.rotate(-h),u.placement=T.Matrix2D.Identity,u.bounds=S.TheoRect.fromSize(l.fitAspectRatioWithin((n=i.opt(u.bounds,(function(e){return e.aspectRatio})))||null!=n?n:1)),u.moveCenterToPoint(l.center),c.rotate(h)}r.removeFromParent(),t.length>1&&g.GroupFacade.ungroupItems(t)}},onBadgeFormaePlaced:function(e,t,n){for(var o=!!n&&null,a=i.iter(e);!a.done;a.next()){var s=a.value;r.forEachBadgeAtom(s,(function(e,t){var n;(n=i.as(t,P.TypeLockupController))&&n.updateScoring()})),null!=o||r.checkContrast(s)||(o=!0)}if(1==o){(new v.ProfilingColorMap).updateCurrentColorIndices();for(var l=i.iter(e);!l.done;l.next())s=l.value,r.forEachBadgeAtom(s,(function(e,t){return t.shuffleColorAssignment()}))}},areFormaeGrayscale:function(e){for(var t=i.iter(e);!t.done;t.next()){var n=t.value;if(!r.checkEligibility(n,r.isFormaGrayscale))return!1}return!0},isFormaGrayscale:function(e,t){if(t.kind==h.FrameController.KIND)return!1;var n,o,a,s=e.style;return!(!r.isStyleGrayscale(s)||(n=i.as(s,_.LockupStyle))&&(o=n.characterStyles[P.TypeLockupController.HIGHLIGHT_STYLE])&&(a=i.opt(i.as(t,P.TypeLockupController),(function(e){return e.charStyleRanges})))&&0==!a.length&&!r.isStyleGrayscale(o))},isStyleGrayscale:function(e){var t,n,r,o;return(o=e.colorLibrary)&&e.colors.forEachColor((function(e,n,a){if(null==r){var s=null==a?i.opt(o.color((t=n)||null!=t?t:""),(function(e){return e.rgbColor})):a;i.opt(s,(function(e){return 0==e.isGrayscale()}))&&(r=!1)}})),!(n=r)&&null==n||n},checkContrast:function(e){return r.checkEligibility(e,(function(e,t){return t.doesContrast()}))},recordSources:function(e,t,n){for(var o=n.length>1,a=i.iter(i.toSequence(n));!a.done;a.next()){var s=a.value,l=s.offset;s.element.source=r.makeSourceDescriptor(e,o?t[l].formaID:null)}},makeSourceDescriptor:function(e,t){var n;return null!=(n=t)?p.FormaSourceNamespace.DesignIngredient+e+":"+n:p.FormaSourceNamespace.DesignIngredient+e},checkEligibility:function(e,t){var n;if(n=e.controller){if(!n.userGroup)return t(e,n);var o;if(o=i.as(e,m.GroupForma)){for(var a=i.iter(i.range(0,o.childCount,!1));!a.done;a.next()){var s=a.value;if(!r.checkEligibility(o.childAt(s),t))return!1}return!0}}return!1},forEachBadgeAtom:function(e,t){var n,o;if(n=e.controller)if(n.userGroup){if(o=i.as(e,m.GroupForma))for(var a=i.iter(i.range(0,o.childCount,!1));!a.done;a.next()){var s=a.value;r.forEachBadgeAtom(o.childAt(s),t)}}else t(e,n)}}}),r)},"7EVG":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.WatermarkFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"WatermarkFacade",ctor:r,superName:"CoreObject",statics:{setWatermark:function(e,t){t.watermarkEnabled=e},getWatermark:function(e){return e.watermarkEnabled}}}),r)},"7Pku":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("SpAV"),s=n("QbzR"),l=n("fNpk"),u=n("T8w7"),c=n("jfma");o.FormaToPGMFactory=i.defineProtocol("FormaToPGMFactory",{childReferences:"(GroupForma) -> Array<PGMReference>",referenceForForma:"(Forma) -> PGMReference"}),o.FormaToPGMMapper=(r=function(e){this.formaKind=e},i.defineClass({name:"FormaToPGMMapper",ctor:r,statics:{mapBlendMode:function(e){var t=u.OpacityFacade.formaCanHaveBlendMode(e)?e.style.blendMode:s.FormaBlendMode.Normal;return t==s.FormaBlendMode.Multiply?c.PGMBlendModeEnum.Multiply:t==s.FormaBlendMode.Screen?c.PGMBlendModeEnum.Screen:(a.CoreAssertDebugOnly.isTrue(t==s.FormaBlendMode.Normal,"Only normal, multiply, and screen blend modes are supported in PGM",void 0,"FormaToPGMMapper.mapBlendMode","FormaToPGMMapper.swift",79),c.PGMBlendModeEnum.Normal)}},props:{makePGMRef:function(e,t,n,r){return l.LegacyCoreAssert.fail("PGMMapperForForma isn't overriding makePGMRef",{kind:this.formaKind},"FormaToPGMMapper.makePGMRef","FormaToPGMMapper.swift",52),null},canDoSimpleTransformUpdate:function(e){return!u.OpacityFacade.formaHasNonNormalBlendMode(e.forma)}}}),r)},"8Quq":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("fNpk"),c=n("c+uM"),d=n("Ird5"),h=n("jfma"),p=n("djwB"),f=n("yjxF"),m=n("Aj79"),g=n("W6ub"),y=n("bAjp"),_=n("bJhu"),T=n("enh0"),v=n("sIWg");i.TextFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},a.defineClass({name:"TextFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=T.TextForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance},getPGMNodeForTextForma:function(e,t,n,r){var o;void 0===r&&(r=null);var i=d.PGMAnimationList.EMPTY,s=t.fontColor,l=t.fontDescriptor,h=t.textLook,m=t.fontStrokeColor,T=t.fontStrokeWidth;h==c.LockupTextLook.KnockoutAndOutline&&n.includes("-txt-ko#")&&(T=0);var C=t.tracking,P=t.fontSize,S=r||s;null==r&&T>0&&(h==c.LockupTextLook.KnockoutAndOutline||h==c.LockupTextLook.OutlineOnly||h==c.LockupTextLook.KnockoutAndShadow)&&(S=null),u.LegacyCoreAssert.isFalse(null==t.bounds,"nil text forma bounds encountered when getting PGM node",void 0,"TextFormaToPGMMapper.getPGMNodeForTextForma","TextFormaToPGMMapper.swift",95);var D=((o=a.opt(t.bounds,(function(e){return e.width})))||null!=o?o:a.toDouble(t.text.length)*P)-T,A=v.TheoRect.fromXYWH(0,P*(l.capRatio-l.ascentRatio),D,P*(l.ascentRatio+l.descentRatio));return new y.PGMText(n,new f.PGMNodeMetadata(t.formaID,"text"),i,A,t.text,_.PGMTextStyle.createCacheable(p.PGMFont.fromDescriptor(l),S,m,T,C),g.PGMRenderRuns.init_378c(t.renderRuns))}},props:{makePGMRef:function(e,t,n,o){var i;return(i=a.as(e,T.TextForma))?l.FormaToPGMUtils.applyAnimations(t,i,new m.PGMReference(r.getPGMNodeForTextForma(t,i,i.formaID,null),new h.PGMCompositingParams(i.placement,i.style.opacity))):(u.LegacyCoreAssert.fail("TextFormaToPGMMapper: not a text forma",void 0,"TextFormaToPGMMapper.makePGMRef","TextFormaToPGMMapper.swift",52),null)}}}),r)},"95jH":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("URxh"),l=n("iCxV"),u=n("K17h"),c=n("RkYL");o.MotionLogicStacked=(r=function(){},i.defineClass({name:"MotionLogicStacked",ctor:r,statics:{_implements:function(e){return"MotionLogic"==e}},props:{updateColorTable:function(e,t){var n=t.style.colors.clone();i.opt(e.style,(function(e){return e.colors.setColor(a.ColorRole.FieldPrimary,n.fieldPrimary)})),i.opt(e.style,(function(e){return e.colors.setColor(a.ColorRole.FieldSecondary,n.fieldSecondary)}))},updateFormaAnim:function(e,t,n,r,o){var a,l=[],u=c.TheoTime.fromSeconds(t),d=c.TheoTime.fromSeconds(n);if(o.length>0){var h=o[0];this.updateColorTable(h,e),u.value>0&&l.push(new s.KeyFrame(c.TheoTime.Zero,h.timingFunction,h.placement,h.bounds,i.opt(h.style,(function(e){return e.clone()})))),l.push(new s.KeyFrame(u,h.timingFunction,h.placement,h.bounds,i.opt(h.style,(function(e){return e.clone()}))))}o.length>1&&(h=o[1],this.updateColorTable(h,e),l.push(new s.KeyFrame(d,h.timingFunction,h.placement,h.bounds,i.opt(h.style,(function(e){return e.clone()}))))),(a=e.animation)&&(a.startTime=c.TheoTime.Zero,a.endTime=d,a.keyFrames=l.concat())},apply:function(e,t,n){var r,o,a=(r=i.as(n.lineDur,"Double"))||null!=r?r:1,s=(o=i.as(n.endPadDur,"Double"))||null!=o?o:0,d=i.clone(u.MotionUtils.findTextLines(e)),h=d.length,p=i.toDouble(h)*a+s;if(t.length<8)i.opt(l.Host.logging,(function(e){return e.warning("Less than required key-frames for Motion-Logic-Stacked")}));else{var f=t;if(h>0){var m=0,g=i.clone(d.shift()),y=null;d.length>0&&(y=i.clone(d.pop()));for(var _=f.slice(0,2),T=i.iter(g);!T.done;T.next()){var v=T.value;this.updateFormaAnim(v,m,m+a,p,_)}m+=a;for(var C=i.iter(i.toSequence(d));!C.done;C.next()){var P=C.value,S=P.offset,D=P.element;if(0==S%2)for(var A=f.slice(2,4),E=i.iter(D);!E.done;E.next())v=E.value,this.updateFormaAnim(v,m,m+a,p,A);else for(var R=f.slice(4,6),F=i.iter(D);!F.done;F.next())v=F.value,this.updateFormaAnim(v,m,m+a,p,R);m+=a}if(null!=y)for(var b=f.slice(6,8),I=i.iter(y);!I.done;I.next())v=I.value,this.updateFormaAnim(v,m,m+a,p,b);m+=a}}i.opt(e.animation,(function(e){return e.endTime=c.TheoTime.fromSeconds(p)}))}}}),r)},"9WSY":function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("dJuF"),u=n("fNpk"),c=n("Quhx"),d=n("umUn"),h=n("90dd");a.ColorLibrary=(r=function(){this.changedIDs_=null},o={},s.defineClass({name:"ColorLibrary",ctor:r,superName:"PostPublishingObject",statics:{SCHEMA_CLASS_NAME:"ColorLibrary",codec:{get:function(){return void 0===o.codec&&(o.codec=l.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,l.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){return r.init_866e(n,e)}),o.factory},set:function(e){o.factory=e}},PROPERTY_ENTRIES:"entries",PROPERTY_ENTRY_COLORID:"id",PROPERTY_ENTRY_COLOR:"color",PROPERTY_PALETTE_ID:"palette:id",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_fcb1:function(e){s.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_dd5d,s.opt(e,(function(e){return e.state.allProperties}))||{},{})},init_d41d:function(){s.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_dd5d,{},{})},init_866e:function(e,t){s.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_866e,e,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},paletteID_:{get:function(){return s.as(this.get(r.PROPERTY_PALETTE_ID),"String")},set:function(e){this.set(r.PROPERTY_PALETTE_ID,e)}},entries:{get:function(){return s.as(this.get(r.PROPERTY_ENTRIES),["Array",["Dictionary","String","Any"]])}},lookupFromEntries:function(e){var t={};if(null!=e)for(var n=s.iter(e);!n.done;n.next()){var o,i,a=n.value;null!=(o=s.as(a[r.PROPERTY_ENTRY_COLORID],"String"))&&(i=s.as(a[r.PROPERTY_ENTRY_COLOR],d.TheoColor))&&(t[o]=i)}return t},lookup_:{get:function(){return this.lookupFromEntries(this.entries)}},flushColors:function(e){for(var t=[],n=s.iter(e);!n.done;n.next()){var o={id:n.key,color:n.value};t.push(o)}this.set(r.PROPERTY_ENTRIES,t)},hasEntries:function(e){for(var t=!0,n=s.keys(this.lookup_),r=s.iter(e);!r.done;r.next()){var o=r.value;if(!n.includes(o)){t=!1;break}}return t},getIdForEntry:function(e){for(var t,n=s.iter(this.lookup_);!n.done;n.next()){var r=n.key,o=n.value;if(s.eq(d._equality_TheoColor_TheoColor,e,o)){t=r;break}}return t},color:function(e){return this.lookup_[e]},paletteID:{get:function(){return this.paletteID_},set:function(e){this.paletteID_=e}},setColor:function(e,t){this.setColors(s.dict([e,t]))},setColors:function(e){for(var t=!1,n=s.keys(e),r=s.clone(this.lookup_),o=s.iter(e);!o.done;o.next()){var i=o.key,l=o.value,u=this.lookup_[i];null==l&&null!=u?(t||(this.makeMutable(),this.publish(new a.ColorLibraryChangedMessage(this,!0,n)),t=!0),s.removeKey(r,i)):null==l||null!=u&&s.eq(d._equality_TheoColor_TheoColor,l,u)||(t||(this.makeMutable(),this.publish(new a.ColorLibraryChangedMessage(this,!0,n)),t=!0),r[i]=l)}if(t){var c=this.database.beginTransaction("flushColors",null);this.flushColors(r),c.mergeWithPrevious(),this.publish(new a.ColorLibraryChangedMessage(this,!1,n))}},colorCount:{get:function(){return s.count(this.lookup_)}},forEachColor:function(e){for(var t=s.iter(this.lookup_);!t.done;t.next())e(t.key,t.value)},recordUndoState:function(){return s.as(this.state.allProperties,["Dictionary","String","Any"])},restoreUndoState:function(e){null!=e&&this.matchProperties(e)},matchProperties:function(e){var t=s.keys(this.lookup_).map((function(e){return e}),this);this.publish(new a.ColorLibraryChangedMessage(this,!0,t)),this.makeMutable(),c.PostPublishingObject.prototype.matchProperties.call(this,e),this.publish(new a.ColorLibraryChangedMessage(this,!1,t))},asString:{get:function(){var e;return"ID:"+this.id.substr(0,8)+" paletteID:"+((e=this.paletteID)||null!=e?e:"<none>")+" themeColors:"+this.themeColorsAsString}},themeColorsAsString:{get:function(){for(var e,t=this,n=["themeColor0","themeColor1","themeColor2","themeColor3","themeColor4","themeColor5"],r=n.map((function(n){return(e=s.opt(t.color(n),(function(e){return e.rgbColor.asString})))||null!=e?e:"<none>"}),this),o="themeColors: ",i=s.iter(s.range(0,n.length,!1));!i.done;i.next()){var a=i.value;o+=n[a]+":("+r[a]+") "}return o}},willChangeState:function(e){var t;if(null!=(t=e[r.PROPERTY_ENTRIES])){u.LegacyCoreAssert.isTrue(null==this.changedIDs_,"Got a second will-change without an intervening did-change",void 0,"ColorLibrary.willChangeState","ColorLibrary.swift",276),this.changedIDs_=[];var n=this.getCodec(r.PROPERTY_ENTRIES);u.LegacyCoreAssert.isTrue(null!=n,"Got a state change before the entries codec got registered. How?",void 0,"ColorLibrary.willChangeState","ColorLibrary.swift",280);for(var o=s.clone(s.as(n.decode(t[0],this),["Array",["Dictionary","String","Any"]])),i=s.clone(s.as(n.decode(t[1],this),["Array",["Dictionary","String","Any"]])),l=s.clone(this.lookupFromEntries(o)),d=s.clone(this.lookupFromEntries(i)),h=s.keys(l),p=s.iter(s.keys(d));!p.done;p.next()){var f=p.value;h.includes(f)||h.push(f)}for(var m=s.iter(h);!m.done;m.next()){var g=l[f=m.value],y=d[f];null==g||null==y?this.changedIDs_.push(f):g.isEqual(y)||this.changedIDs_.push(f)}this.changedIDs_.length>0&&this.publish(new a.ColorLibraryChangedMessage(this,!0,this.changedIDs_))}c.PostPublishingObject.prototype.willChangeState.call(this,e)},didChangeState:function(e){c.PostPublishingObject.prototype.didChangeState.call(this,e),null!=e[r.PROPERTY_ENTRIES]&&(u.LegacyCoreAssert.isTrue(null!=this.changedIDs_,"Got a did-change without a matching will-change",void 0,"ColorLibrary.didChangeState","ColorLibrary.swift",320),this.publish(new a.ColorLibraryChangedMessage(this,!1,this.changedIDs_)),this.changedIDs_=null)}}}),r),a.ColorLibraryChangedMessage=(i=function e(t,n,r){this.isBefore=n,this.isAfter=!n,this.affectedColorIDs=s.clone(r),h.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"ColorLibraryChangedMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:"ColorLibraryChangedMessage"}}),i)},"9YN4":function(e,t,n){var r,o,i,a,s,l,u,c,d=t,h=n("oAGj"),p=n("VQVe"),f=n("ytEx"),m=n("qsM9"),g=n("9a+Y"),y=n("9WSY"),_=n("yGNn"),T=n("ascj"),v=n("Vvcj"),C=n("fVJ2"),P=n("13MC"),S=n("quOg"),D=n("LcYy"),A=n("3OP7"),E=n("BbDD"),R=n("FNB+"),F=n("URxh"),b=n("H9Ol"),I=n("cmoc"),O=n("fWxZ"),k=n("QbzR"),N=n("JEzR"),M=n("P83h"),L=n("A6KL"),x=n("pnSN"),B=n("h67N"),w=n("4mVB"),G=n("iCxV"),Y=n("8vXU"),U=n("q5zr"),j=n("9eTw"),V=n("fdtz"),H=n("SDdr"),K=n("uWOl"),W=n("C4JV"),X=n("Puiz"),z=n("rxGp"),q=n("fNpk"),Z=n("c+uM"),J=n("DP9v"),Q=n("0PPJ"),$=n("AxS/"),ee=n("K0Rh"),te=n("2ALn"),ne=n("djAF"),re=n("kSRw"),oe=n("aN2p"),ie=n("u2iI"),ae=n("QBb7"),se=n("a9ow"),le=n("MO6F"),ue=n("lJxM"),ce=n("Qb69"),de=n("T6jX"),he=n("enh0"),pe=n("voyk"),fe=n("90dd"),me=n("x4Gy"),ge=n("LCGV"),ye=n("Kkml"),_e=n("LGJg"),Te=n("sW6f"),ve=n("WWR6"),Ce=n("zjod"),Pe=n("QTen");d.TheoDocumentVersion=h.defineEnum("TheoDocumentVersion",{Invalid:0,BeginningOfStoringVersion:1,BackingShapePaddingEnabled:2,FormaController:1e3,ColorBackgroundAndPreviewEncoding:2e3,Knockouts:3e3,GridLayouts:4e3,CharacterStyles:5e3,GridsWithAlphaImages:6e3,OmitShapeLibraryPathData:7e3,Icons:8e3,TextEffects:9e3,LetterSpacing:1e4,AdobeFonts:11e3,ImageAdjustments:12e3,PremiumTemplates:13e3,Giphys:14e3,NewTextAnimations:15e3,FontSourcesMetadata:15100,NewTextLayouts:16e3,JSONDocumentEncoding:17e3,VideoSupport:18e3,FloatingImages:19e3,Grouping:2e4,Deepcut:21e3,FourColorsAndOpacities:22e3,BlendModes:23e3,LimitedUseStockLicenses:24e3}),d.TheoDocumentUserAction=(r=function(e,t){this.doc=e,this.action=t,h.opt(e.controller,(function(e){return e.undoRedoMgr.beginUserAction(t,(function(){}))}))},h.defineClass({name:"TheoDocumentUserAction",ctor:r,superName:"CoreObject",props:{end:function(){var e=this;null!=this.action&&h.opt(this.doc.controller,(function(t){return t.undoRedoMgr.endUserAction((function(){e.action=null}))}))},rollback:function(){var e=this;null!=this.action&&h.opt(this.doc.controller,(function(t){return t.undoRedoMgr.cancelUserAction((function(){e.action=null}))}))}}}),r),d.TheoDocument=(o=function(){this.modifiedSinceShare_=!1,this.missingFontsDuringOpen_=[],this.allowPrune_=!0,this.docInited_=!0,this.maskSubstitutionController_=new Q.MaskSubstitutionController,this.initNewDocumentTransaction=null,this.pendingAuthoringContextID_=null,this.forkID_=null,this.atomicChangeEvent_=null,this.blockedControllers_=[]},i={},h.defineClass({name:"TheoDocument",ctor:o,superName:"DBHostObject",statics:{SCHEMA_CLASS_NAME:"TheoDocument",CURRENT_VERSION:{get:function(){return void 0===i.CURRENT_VERSION&&(i.CURRENT_VERSION=d.TheoDocumentVersion.LimitedUseStockLicenses),i.CURRENT_VERSION},set:function(e){i.CURRENT_VERSION=e}},MIME_TYPE:"application/vnd.adobe.theo.document+dcx",PROPERTY_VERSION:"format-version",PROPERTY_WATERMARK_ENABLED:"watermark-enabled",PROPERTY_SHARED:"shared",PROPERTY_MODIFIED_SINCE_SHARE:"modified-since-share",PROPERTY_FONT_SOURCES:"font-sources",PROPERTY_FONT_USAGE:"font-usage",PROPERTY_CP_CONTENT_MODIFIED:"cp#contentModified",PROPERTY_CP_PROJECT_ID:"cp#projectId",PROPERTY_CP_ALIAS:"cp#shortId",PROPERTY_CP_ASSET_ID:"cp#assetId",PROPERTY_CP_PUBLISHED_ETAG:"cp#publishedEtag",PROPERTY_CP_IS_EXPORTED:"cp#isExported",PROPERTY_REMIX_ANCESTORS_CP_ASSET_IDS:"remix-ancestors",PROPERTY_STOCK_IMAGES:"stockImages",PROPERTY_UNLICENSED:"unlicensed",PROPERTY_STANDARD:"standard",PROPERTY_EXTENDED:"extended",PROPERTY_LIMITED:"limited",PROPERTY_NAME:"name",PROPERTY_TYPE:"type",PROPERTY_CHILDREN:"children",ALL_CP_PROPERTIES:{get:function(){return void 0===i.ALL_CP_PROPERTIES&&(i.ALL_CP_PROPERTIES=[o.PROPERTY_CP_PROJECT_ID,o.PROPERTY_CP_ALIAS,o.PROPERTY_CP_ASSET_ID,o.PROPERTY_CP_PUBLISHED_ETAG,o.PROPERTY_CP_IS_EXPORTED]),i.ALL_CP_PROPERTIES}},PROPERTY_DOCUMENT_DATA:"doc#data",PROPERTY_AUTHORING_CONTEXT_ID:"authctx#ctxid",PROPERTY_AUTHORING_CONTEXT_NAME:"authctx#ctxname",PROPERTY_AUTHORING_CONTEXT_URN:"authctx#ctxurn",PROPERTY_AUTHORING_CONTEXT_THEME_ID:"authctx#themeid",PROPERTY_USES_BRANDED_ELEMENTS:"authctx#uses-branded-elements",DEFAULT_NAME:"My project",PROPERTY_CONSTRAINED_IMAGES:"constrainedImages",ERR_NEWER_FORMAT_VERSION:"newer-format-version",ERR_COULD_NOT_READ_JSON:"json-read-failed",COMPONENT_PATH_CONTENT:"content.json",COMPONENT_NAME_DOM:"dom",COMPONENT_RELATIONSHIP_DOM:"dom",COMPONENT_MIME_TYPE_DOCUMENT_JSON:"application/json",COMPONENT_RELATIONSHIP_METADATA:"metadata",COMPONENT_RELATIONSHIP_RENDITION:"rendition",classCodecs_:[],classFactories_:[],registerCodecs:function(){0==o.classCodecs_.length&&(o.classCodecs_.push(ce.TheoDocumentData.codec),o.classCodecs_.push(b.ControllerMetadata.codec),o.classCodecs_.push(k.FormaStyle.codec),o.classCodecs_.push(me.TextModel.codec),o.classCodecs_.push(me.ContentTextModel.codec),o.classCodecs_.push(se.UTF16Attribute.codec),o.classCodecs_.push(se.FontDescriptorAttribute.codec),o.classCodecs_.push(se.FontSizeAttribute.codec),o.classCodecs_.push(se.FontColorAttribute.codec),o.classCodecs_.push(se.FontStrokeColorAttribute.codec),o.classCodecs_.push(se.FontStrokeWidthAttribute.codec),o.classCodecs_.push(se.TextLookAttribute.codec),o.classCodecs_.push(se.TrackingAttribute.codec),o.classCodecs_.push(y.ColorLibrary.codec),o.classCodecs_.push(T.ColorTable.codec),o.classCodecs_.push(F.FormaAnimation.codec),o.classCodecs_.push(p.AnimationStyle.codec),o.classCodecs_.push(H.ImageFilter.codec),o.classCodecs_.push(m.Codecs.theoTimeCodec),o.classCodecs_.push(m.Codecs.theoSizeCodec),o.classCodecs_.push(m.Codecs.solidColorCodec),o.classCodecs_.push(m.Codecs.theoColorCodec),o.classCodecs_.push(m.Codecs.paletteIDCodec),o.classCodecs_.push(m.Codecs.theoPointCodec),o.classCodecs_.push(m.Codecs.theoRectCodec),o.classCodecs_.push(m.Codecs.matrix2DCodec),o.classCodecs_.push(m.Codecs.colorRoleCodec),o.classCodecs_.push(m.Codecs.textRangeCodec),o.classCodecs_.push(m.Codecs.gridCellCodec),o.classCodecs_.push(m.Codecs.fontDescriptorCodec),o.classCodecs_.push(m.Codecs.fontCodec),o.classCodecs_.push(m.Codecs.mediaMetadataCodec),o.classCodecs_.push(m.Codecs.imageColorDataCodec),o.classCodecs_.push(m.Codecs.emptyPathCodec),o.classCodecs_.push(m.Codecs.rectanglePathCodec),o.classCodecs_.push(m.Codecs.ellipsePathCodec),o.classCodecs_.push(m.Codecs.arbitraryPathCodec),o.classCodecs_.push(m.Codecs.pathCodec),o.classCodecs_.push(m.Codecs.artworkShapeCodec),o.classCodecs_.push(m.Codecs.artworkGroupCodec),o.classCodecs_.push(m.Codecs.artworkClipGroupCodec),o.classCodecs_.push(m.Codecs.artworkNodeCodec),o.classCodecs_.push(m.Codecs.pageExportDataCodec),o.classCodecs_.push(m.Codecs.keyFrameCodec),o.classCodecs_.push(m.Codecs.imageAdjustmentsCodec),o.classCodecs_.push(m.Codecs.textPathCodec),o.classCodecs_.push(m.Codecs.textPathSegmentCodec))},registerFactories:function(){0==o.classFactories_.length&&(o.classFactories_.push(C.DBHostObject.registerFactory(ce.TheoDocumentData.SCHEMA_CLASS_NAME,ce.TheoDocumentData.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(me.TextModel.SCHEMA_CLASS_NAME,me.TextModel.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(me.ContentTextModel.SCHEMA_CLASS_NAME,me.ContentTextModel.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(O.FormaPage.SCHEMA_CLASS_NAME,O.FormaPage.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(g.ContentDocument.SCHEMA_CLASS_NAME,g.ContentDocument.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(v.ColorThemeDocument.SCHEMA_CLASS_NAME,v.ColorThemeDocument.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(D.DocumentHistory.SCHEMA_CLASS_NAME,D.DocumentHistory.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(y.ColorLibrary.SCHEMA_CLASS_NAME,y.ColorLibrary.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(oe.SimpleSwatch.SCHEMA_CLASS_NAME,oe.SimpleSwatch.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(T.ColorTable.SCHEMA_CLASS_NAME,T.ColorTable.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(L.GroupContentNode.SCHEMA_CLASS_NAME,L.GroupContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ee.RootForma.SCHEMA_CLASS_NAME,ee.RootForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(x.GroupForma.SCHEMA_CLASS_NAME,x.GroupForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(re.SmartGroupForma.SCHEMA_CLASS_NAME,re.SmartGroupForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(I.FrameForma.SCHEMA_CLASS_NAME,I.FrameForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(V.ImageForma.SCHEMA_CLASS_NAME,V.ImageForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ne.ShapeForma.SCHEMA_CLASS_NAME,ne.ShapeForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(he.TextForma.SCHEMA_CLASS_NAME,he.TextForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ve.VectorForma.SCHEMA_CLASS_NAME,ve.VectorForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Ce.VideoForma.SCHEMA_CLASS_NAME,Ce.VideoForma.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(b.ControllerMetadata.SCHEMA_CLASS_NAME,b.ControllerMetadata.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(F.FormaAnimation.SCHEMA_CLASS_NAME,F.FormaAnimation.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(k.FormaStyle.SCHEMA_CLASS_NAME,k.FormaStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(te.RootStyle.SCHEMA_CLASS_NAME,te.RootStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(p.AnimationStyle.SCHEMA_CLASS_NAME,p.AnimationStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(K.ImageStyle.SCHEMA_CLASS_NAME,K.ImageStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ge.TextStyle.SCHEMA_CLASS_NAME,ge.TextStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ie.ShapeStyle.SCHEMA_CLASS_NAME,ie.ShapeStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Pe.VideoStyle.SCHEMA_CLASS_NAME,Pe.VideoStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(w.GridStyle.SCHEMA_CLASS_NAME,w.GridStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(N.FrameStyle.SCHEMA_CLASS_NAME,N.FrameStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Z.LockupStyle.SCHEMA_CLASS_NAME,Z.LockupStyle.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(H.AlphaBlendFilter.SCHEMA_CLASS_NAME,H.AlphaBlendFilter.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(H.CompositeFilter.SCHEMA_CLASS_NAME,H.CompositeFilter.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(L.GroupContentNode.SCHEMA_CLASS_NAME,L.GroupContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory($.RootContentNode.SCHEMA_CLASS_NAME,$.RootContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(U.ImageContentNode.SCHEMA_CLASS_NAME,U.ImageContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(ue.TextContentNode.SCHEMA_CLASS_NAME,ue.TextContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(Te.VideoContentNode.SCHEMA_CLASS_NAME,Te.VideoContentNode.factory)),o.classFactories_.push(C.DBHostObject.registerFactory(_e.VectorContentNode.SCHEMA_CLASS_NAME,_e.VectorContentNode.factory)))},decodeDocument:function(e,t){var n=[],r=A.DocumentPersistenceFactory.decoderFor(e.current),i=A.DocumentPersistenceFactory.namespacedPropertyName(o.PROPERTY_VERSION),a=d.VersionInfo.fromProperty(h.as(e.current.getValue(i),"AnyObject")),s=new d.VersionInfo(o.CURRENT_VERSION);a.major>s.major&&n.push(o.ERR_NEWER_FORMAT_VERSION);var l=o.init_209f(r,(function(e){return n.push(e)}));0==!n.length&&(n.splice(0,0,"Error opening document version "+a.rawValue),t(n));var u=l.beginTransaction("post_history_entry");return l.history.postEntry("open,was-vers="+h.toString(a.rawValue)),u.mergeWithPrevious(),l},decodeTemplate:function(e,t,n){var r,i=[];if(r=h.as(h.opt(G.Host.persistUtils,(function(e){return e.readJsonContentFromFile(t)})),["Dictionary","String","Any"])){var a=e.current,s=new X.JSONNodeDecoder(a,r),l=o.init_209f(s,(function(e){return i.push(e)}));0==!i.length&&n(i);var u=l.beginTransaction("set_authoring_context_ID");return l.authoringContextID=a.getValue(f.PROPERTY_KEY_ID),u.mergeWithPrevious(),l}return i.push(o.ERR_COULD_NOT_READ_JSON),0==!i.length&&n(i),null},newDocumentFromDataObject:function(e,t){return o.init_209f(e,t)},createDefault:function(e){return void 0===e&&(e=null),o.init_b80b(e)},INIT_DOC_TRANSACTION_NAME:"init_new_document",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"IDatabaseListener"==e}},props:{init_209f:function(e,t){o.registerCodecs(),o.registerFactories(),this.publishing_=new le.TheoBasePublishing,this.controller_=new S.DocumentController;var n=null,r=d.TheoDocumentVersion.Invalid,i=e.intProperty(o.PROPERTY_VERSION,r);i==r&&(i=h.toInt(e.numberProperty(o.PROPERTY_VERSION,h.toDouble(r)))),h.super_init(this,C.DBHostObject,C.DBHostObject.prototype.init_1be9,i,e,(function(e){n=e,null!=t&&t(e)}));var a=this.database.beginTransaction("init",null);if(this.gridLibrary_=new B.GridLibrary,this.hostDB_.addListener(this),this.publishing_.owner=this,E.DocumentSingletonTracker.creatingDocumentSingleton(this),null==n?(this.publishing_.publish(new d.TheoDocumentDidDecodeMessage(this)),this.controller_.attach(this),this.firstPage.postDecode(),this.content.postDecode(),this.modifiedSinceShare_=this.get(o.PROPERTY_MODIFIED_SINCE_SHARE),null==e.property(o.PROPERTY_DOCUMENT_DATA)&&this.set(o.PROPERTY_DOCUMENT_DATA,ce.TheoDocumentData.init_d41d())):(this.firstPage_=O.FormaPage.init_d0e4(this),this.content_=g.ContentDocument.init_26a9(this,null),this.colorTheme_=v.ColorThemeDocument.init_d0e4(this),this.history_=D.DocumentHistory.init_d0e4(this),this.saveChildren(),this.set(o.PROPERTY_DOCUMENT_DATA,ce.TheoDocumentData.init_d41d()),this.set(o.PROPERTY_VERSION,o.CURRENT_VERSION),this.set(o.PROPERTY_MODIFIED_SINCE_SHARE,this.modifiedSinceShare_),this.set(o.PROPERTY_SHARED,!1),this.documentName=o.DEFAULT_NAME,this.controller_.attach(this)),this.instantiateDescendants(),i!=o.CURRENT_VERSION&&this.set(o.PROPERTY_VERSION,o.CURRENT_VERSION),!h.isEmpty(this.authoringContextID)&&(h.isEmpty(this.authoringContextName)||h.isEmpty(this.authoringContextURN))){var s=J.MultiBrandFacade.authoringContext(this.authoringContextID);null!=s&&(this.authoringContextName=s.name,this.authoringContextURN=s.urn)}de.TheoDocumentUtils.pruneOrphanedContent(this),this.allowPrune_=!1,this.finishInitDocument(a)},init_b80b:function(e){void 0===e&&(e=null),this.allowPrune_=!1,o.registerCodecs(),o.registerFactories(),this.publishing_=new le.TheoBasePublishing,this.controller_=new S.DocumentController,h.super_init(this,C.DBHostObject,C.DBHostObject.prototype.init_7341,o.CURRENT_VERSION,e);var t=this.database.beginTransaction("init",null);this.gridLibrary_=new B.GridLibrary,this.hostDB_.addListener(this),this.publishing_.owner=this,E.DocumentSingletonTracker.creatingDocumentSingleton(this),this.firstPage_=O.FormaPage.init_d0e4(this),this.content_=g.ContentDocument.init_26a9(this,null),this.colorTheme_=v.ColorThemeDocument.init_d0e4(this),this.history_=D.DocumentHistory.init_d0e4(this),this.saveChildren(),this.set(o.PROPERTY_DOCUMENT_DATA,ce.TheoDocumentData.init_d41d()),this.set(o.PROPERTY_VERSION,o.CURRENT_VERSION),this.set(o.PROPERTY_MODIFIED_SINCE_SHARE,this.modifiedSinceShare_),this.set(o.PROPERTY_SHARED,!1),this.documentName=o.DEFAULT_NAME,this.controller_.attach(this),this.rawVersion!=o.CURRENT_VERSION&&this.set(o.PROPERTY_VERSION,o.CURRENT_VERSION),this.finishInitDocument(t)},finishInitDocument:function(e){var t=this;e.mergeWithPrevious(),this.controller_.undoRedoMgr.reset(),q.LegacyCoreAssert.isTrue(null==this.database.mutableState,"Database already has an outstanding transaction",void 0,"TheoDocument.finishInitDocument","TheoDocument.swift",542),q.LegacyCoreAssert.isTrue(null!=this.database.immutableState,"Database missing immutable state",void 0,"TheoDocument.finishInitDocument","TheoDocument.swift",543),q.LegacyCoreAssert.isTrue(h.opt(this.database.appliedState,(function(e){return e.guid==h.opt(t.database.immutableState,(function(e){return e.guid}))})),"Database applied state is not latest immutable state",void 0,"TheoDocument.finishInitDocument","TheoDocument.swift",544),this.lastFullSaveStateID_=h.opt(this.database.immutableState,(function(e){return e.guid})),this.lastMiniSaveStateID_=h.opt(this.database.immutableState,(function(e){return e.guid})),this.controller_.saveMgr.enable(this.lastFullSaveStateID_),this.maskSubstitutionController_.attach(this),this.docInited_=!0},initNewDocument:function(){this.docInited_=!1,q.LegacyCoreAssert.isTrue(null==this.initNewDocumentTransaction,"Already have an init transaction",void 0,"TheoDocument.initNewDocument","TheoDocument.swift",559),q.LegacyCoreAssert.isTrue(null==this.database.mutableState,"Database already has an outstanding transaction",void 0,"TheoDocument.initNewDocument","TheoDocument.swift",560),this.initNewDocumentTransaction=this.beginTransaction(o.INIT_DOC_TRANSACTION_NAME)},finishInitNewDocument:function(){q.LegacyCoreAssert.isTrue(null!=this.initNewDocumentTransaction,"New document init transaction not open",void 0,"TheoDocument.finishInitNewDocument","TheoDocument.swift",565),this.finishInitDocument(this.initNewDocumentTransaction)},documentInited:{get:function(){return this.docInited_}},disableAutosave:function(){this.controller_.saveMgr.disable()},description:{get:function(){return"Doc Name: "+this.documentName+", uuid: "+this.uuid+", versionDecoded: "+this.versionDecoded.description}},documentName:{get:function(){return this.get(o.PROPERTY_NAME)},set:function(e){this.set(o.PROPERTY_NAME,e)}},pendingAuthoringContextID:{get:function(){return this.pendingAuthoringContextID_},set:function(e){var t=this.pendingAuthoringContextID_;this.pendingAuthoringContextID_=e,null!=t&&null==e?(G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"Finishing the pending brand change for a document to:"+t,Y.LogLevelEnum.INFO_LEVEL),q.LegacyCoreAssert.isTrue(this.authoringContextID==t,"pendingAuthoringContextID cleared before change was committed",void 0,"TheoDocument","TheoDocument.swift",619)):null==t&&null!=e?G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"Applying a pending brand change for a document from:"+this.authoringContextID+" to:"+e,Y.LogLevelEnum.INFO_LEVEL):null!=t&&null!=e&&q.LegacyCoreAssert.fail("overlapping calls to set the pendingAuthoringContextID",{was:t,new:e},"TheoDocument","TheoDocument.swift",623),null==this.pendingAuthoringContextID_||h.isEmpty(this.pendingAuthoringContextID_)||G.Host.brandkitManager.activateBrand(this.pendingAuthoringContextID_)}},setAuthoringContext:function(e){var t,n,r;this.authoringContextID=(t=h.opt(e,(function(e){return e.id})))||null!=t?t:"",this.authoringContextName=(n=h.opt(e,(function(e){return e.name})))||null!=n?n:"",this.authoringContextURN=(r=h.opt(e,(function(e){return e.urn})))||null!=r?r:""},authoringContextID:{get:function(){var e,t,n;return null!=(n=this.pendingAuthoringContextID)?(G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"authoringContextID returning pendingAuthoringContextID: "+((e=this.pendingAuthoringContextID)||null!=e?e:"none"),Y.LogLevelEnum.INFO_LEVEL),n):(t=h.as(this.get(o.PROPERTY_AUTHORING_CONTEXT_ID),"String"))||null!=t?t:""},set:function(e){q.LegacyCoreAssert.isTrue(null==this.pendingAuthoringContextID_,"Found unexpected pending value",{newValue:e},"TheoDocument","TheoDocument.swift",653),this.set(o.PROPERTY_AUTHORING_CONTEXT_ID,e),this.set(o.PROPERTY_USES_BRANDED_ELEMENTS,e.length>0)}},authoringContextName:{get:function(){var e;return(e=h.as(this.get(o.PROPERTY_AUTHORING_CONTEXT_NAME),"String"))||null!=e?e:""},set:function(e){this.set(o.PROPERTY_AUTHORING_CONTEXT_NAME,e)}},authoringContextURN:{get:function(){var e;return(e=h.as(this.get(o.PROPERTY_AUTHORING_CONTEXT_URN),"String"))||null!=e?e:""},set:function(e){this.set(o.PROPERTY_AUTHORING_CONTEXT_URN,e)}},authoringContextThemeID:{get:function(){var e;return(e=h.as(this.get(o.PROPERTY_AUTHORING_CONTEXT_THEME_ID),"String"))||null!=e?e:""},set:function(e){this.set(o.PROPERTY_AUTHORING_CONTEXT_THEME_ID,e)}},uuid:{get:function(){var e;return(e=this.forkID_)||null!=e?e:this.id}},forkDocument:function(e){this.forkID_=e},rawVersion:{get:function(){var e;return(e=h.as(this.get(o.PROPERTY_VERSION),"Int"))||null!=e?e:0}},versionDecoded:{get:function(){return new d.VersionInfo(this.rawVersion)}},communityPlatformAssetID:{get:function(){return h.as(this.get(o.PROPERTY_CP_ASSET_ID),"String")},set:function(e){this.set(o.PROPERTY_CP_ASSET_ID,e)}},communityPlatformAlias:{get:function(){return h.as(this.get(o.PROPERTY_CP_ALIAS),"String")},set:function(e){this.set(o.PROPERTY_CP_ALIAS,e)}},publishedEtag:{get:function(){return h.as(this.get(o.PROPERTY_CP_PUBLISHED_ETAG),"String")},set:function(e){this.set(o.PROPERTY_CP_PUBLISHED_ETAG,e)}},publishedResourcePath:{get:function(){return h.as(this.get(o.PROPERTY_CP_PROJECT_ID),"String")},set:function(e){this.set(o.PROPERTY_CP_PROJECT_ID,e)}},documentData:{get:function(){return h.as(this.get(o.PROPERTY_DOCUMENT_DATA),ce.TheoDocumentData)}},shared:{get:function(){return this.get(o.PROPERTY_SHARED)},set:function(e){var t=this.persisted?this.database.beginTransaction("share",null):null;this.set(o.PROPERTY_SHARED,e),this.set(o.PROPERTY_MODIFIED_SINCE_SHARE,!1),h.opt(t,(function(e){return e.end()}))}},isExported:{get:function(){var e;return!(!(e=h.as(this.get(o.PROPERTY_CP_IS_EXPORTED),"Bool"))&&null==e)&&e},set:function(e){var t=this.persisted?this.database.beginTransaction("export",null):null;this.set(o.PROPERTY_CP_IS_EXPORTED,e),h.opt(t,(function(e){return e.end()}))}},recordModification:function(){this.modifiedSinceShare_=!0},modifiedSinceShare:{get:function(){return this.modifiedSinceShare_}},modifiedSinceSave:{get:function(){return this.documentInited&&(this.lastFullSaveStateID_!=h.opt(this.appliedState,(function(e){return e.guid}))||this.lastMiniSaveStateID_!=h.opt(this.appliedState,(function(e){return e.guid})))}},allowPrune:{get:function(){return this.allowPrune_},set:function(e){this.allowPrune_=e}},willCloseDocument:function(){this.disableAutosave()},firstPage:{get:function(){return null==this.firstPage_&&this.cacheChildren(),this.firstPage_}},content:{get:function(){return null==this.content_&&this.cacheChildren(),this.content_}},colorTheme:{get:function(){return null==this.colorTheme_&&this.cacheChildren(),this.colorTheme_}},history:{get:function(){return null==this.history_&&this.cacheChildren(),this.history_}},watermarkEnabled:{get:function(){return!1},set:function(e){this.set(o.PROPERTY_WATERMARK_ENABLED,e)}},constrainedImages:{get:function(){var e;return(e=h.as(this.get(o.PROPERTY_CONSTRAINED_IMAGES),["Dictionary","String",["Dictionary","String",["Array","String"]]]))?e:{stockImages:{unlicensed:[],standard:[],extended:[],limited:[]}}}},setConstrainedImages:function(e){this.set(o.PROPERTY_CONSTRAINED_IMAGES,e)},controller:{get:function(){return this.controller_}},gridLibrary:{get:function(){return this.gridLibrary_}},maskSubstitutionController:{get:function(){return this.maskSubstitutionController_}},recordMissingFont:function(e){this.missingFontsDuringOpen_.includes(e)||this.missingFontsDuringOpen_.push(e)},hadMissingFontsWhenOpened:{get:function(){return this.missingFontsDuringOpen_.length>0}},missingFontList:{get:function(){return this.missingFontsDuringOpen_}},getSynthesizedTitle:function(){return de.TheoDocumentUtils.synthesizeTitle(this)},getSynthesizedDescription:function(){return de.TheoDocumentUtils.synthesizeDescription(this)},setRemixParentCpId:function(e){var t=h.clone(h.as(this.get(o.PROPERTY_REMIX_ANCESTORS_CP_ASSET_IDS),["Array","String"]));null==t&&(t=[]),t.push(e),this.set(o.PROPERTY_REMIX_ANCESTORS_CP_ASSET_IDS,t)},getRemixAncestorsCpMachineTags:function(){var e=[],t=h.clone(h.as(this.get(o.PROPERTY_REMIX_ANCESTORS_CP_ASSET_IDS),["Array","String"]));if(null!=t&&t.length>0){e.push("_REMIX_"),e.push("_REMIX_PROGENITOR_"+t[0]);for(var n=t.length-1,r=h.iter(t);!r.done;r.next()){var i=r.value;e.push("_REMIX_FROM_"+i),e.push("_REMIX_FROM_"+i+"_"+n),n-=1}}return e},className:{get:function(){return o.SCHEMA_CLASS_NAME}},beginTransaction:function(e){return this.hostDB_.beginTransaction(e,this.hostDB_.mutableState)},beginUserAction:function(e){return new d.TheoDocumentUserAction(this,new ye.UserAction(e,ye.CollapseBehavior.NEVER,!0,null))},subscribeWithCallback:function(e,t){return this.publishing_.subscribeWithCallback(e,t)},subscribe:function(e,t){return this.publishing_.subscribe(e,t)},unsubscribe:function(e){return this.publishing_.unsubscribe(e)},onBeginTransaction:function(e,t){this.publishing_.publish(new ae.TransactionBegunMessage(t,this))},onEndTransaction:function(e,t){this.publishing_.publish(new ae.TransactionEndedMessage(t,this))},onStateChanged:function(e,t){},onObjectStateChanged:function(e,t){},didChangeState:function(e){C.DBHostObject.prototype.didChangeState.call(this,e),null!=e[o.PROPERTY_AUTHORING_CONTEXT_ID]&&(G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"DocumentDidChangeState: brandID to "+this.authoringContextID,Y.LogLevelEnum.INFO_LEVEL),this.pendingAuthoringContextID=null)},willCommitState:function(){var e;if(this.initialized&&(!(!(e=h.as(this.get(o.PROPERTY_MODIFIED_SINCE_SHARE),"Bool"))&&null==e)&&e)!=this.modifiedSinceShare_){var t=this.database.beginTransaction("recordModification",null);this.set(o.PROPERTY_MODIFIED_SINCE_SHARE,this.modifiedSinceShare_),t.end()}C.DBHostObject.prototype.willCommitState.call(this)},willApplyDatabaseState:function(e){var t,n,r,i=this;if(q.LegacyCoreAssert.isTrue(null==this.atomicChangeEvent_,"found atomic change event in willApplyDatabaseState",void 0,"TheoDocument.willApplyDatabaseState","TheoDocument.swift",958),q.LegacyCoreAssert.isTrue(null==this.pendingAuthoringContextID_,"found pending auth context in willApplyDatabaseState",void 0,"TheoDocument.willApplyDatabaseState","TheoDocument.swift",959),this.atomicChangeEvent_=new M.FormaNullChangedEvent(this.firstPage.root),this.firstPage.beginUpdate(this.atomicChangeEvent_),this.firstPage.root.visitAll(R.FormaTraversal.PreOrder,(function(e){var t;(t=e.controller)&&(t.beginBlockedUpdate(),i.blockedControllers_.push(t))})),(n=e.getObjectStateByID(this.id))&&(G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"willApplyDatabaseState: document brand is:"+this.authoringContextID,Y.LogLevelEnum.INFO_LEVEL),null!=(r=h.opt(n.getProperty(o.PROPERTY_AUTHORING_CONTEXT_ID),(function(e){return e.stringValue}))))){var a=(t=h.opt(this.state.getProperty(o.PROPERTY_AUTHORING_CONTEXT_ID),(function(e){return e.stringValue})))||null!=t?t:"";r!=a&&(G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"willApplyDatabaseState: detected pending brand change for a document from:"+a+" to:"+r,Y.LogLevelEnum.INFO_LEVEL),this.pendingAuthoringContextID=r)}},didApplyDatabaseState:function(e){this.firstPage.root.setParent(null,!0),q.LegacyCoreAssert.isTrue(null==this.pendingAuthoringContextID_,"found pending auth context in didApplyDatabaseState",void 0,"TheoDocument.didApplyDatabaseState","TheoDocument.swift",984),this.blockedControllers_.forEach((function(e){return e.endBlockedUpdate()})),this.blockedControllers_.splice(0),this.recordModification(),q.LegacyCoreAssert.isTrue(null!=this.atomicChangeEvent_,"missing atomic change event in didApplyDatabaseState",void 0,"TheoDocument.didApplyDatabaseState","TheoDocument.swift",988),null!=this.atomicChangeEvent_&&(this.firstPage.endUpdate(this.atomicChangeEvent_),this.atomicChangeEvent_=null)},inUndoRedo:{get:function(){return null!=this.atomicChangeEvent_}},appliedState:{get:function(){return this.database.appliedState||this.database.immutableState}},isFullSave:function(e){return!0},encodeDocument:function(e,t){if(void 0===t&&(t=null),this.isFullSave(t)){var n=this.beginTransaction("post_history_entry");this.history.postEntry("save"),n.mergeWithPrevious()}var r=A.DocumentPersistenceFactory.encoderFor(e.current);this.retrieveEncodedDocument(t,r)||this.encodeStateByID(t,r),r.finish()},retrieveEncodedDocument:function(e,t){var n,r,o=this;if(h.opt(G.Host.logging,(function(t){return t.info("retrieveEncodedDocument for "+o.uuid+" at "+h.toString(e))})),n=this.controller_.saveMgr.branchForState(e))if(r=n.getComponentWithAbsolutePath(W.JSON_CONTENT_PATH_DCX2D)){var i;if(i=h.as(t,W.JSONDocumentEncoder))return n.transferEncodingTo(t),i.jsonFile=n.getPathForComponent(r),G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"retrieveEncodedDocument: success",Y.LogLevelEnum.INFO_LEVEL),this.lastMiniSaveStateID_=e,this.lastMiniSaveStateID_!=this.lastFullSaveStateID_&&(i.isMiniSave=!0),!0;G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"retrieveEncodedDocument: encoder is not a JSONDocumentEncoder",Y.LogLevelEnum.WARN_LEVEL)}else G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"retrieveEncodedDocument could not find json dom component in cached branch",Y.LogLevelEnum.WARN_LEVEL);else null!=e&&G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"retrieveEncodedDocument could not find branch for stateID",Y.LogLevelEnum.WARN_LEVEL);return!1},encode:function(e){null!=this.hostDB_.mutableState&&q.LegacyCoreAssert.fail("Saving a document with mutable state",{transactions:this.hostDB_.transactionStackDescription},"TheoDocument.encode","TheoDocument.swift",1054),this.encodeStateToDataObject(this.database.immutableState,e)},encodeStateByID:function(e,t){var n=null!=e?this.database.getState(e):this.database.immutableState;q.LegacyCoreAssert.isTrue(null!=n,"State not found",{stateID:h.toString(e)},"TheoDocument.encodeStateByID","TheoDocument.swift",1062),q.LegacyCoreAssert.isFalse(n instanceof P.DBMutableState,"Encoding a mutable state",{stateID:h.toString(e)},"TheoDocument.encodeStateByID","TheoDocument.swift",1063),G.Host.logging.logForCategory(z.LogCategories.kTheoDocument,"TheoDocument.encodeStateByID: save "+this.uuid+" at "+n.guid,Y.LogLevelEnum.INFO_LEVEL),this.isFullSave(e)&&(this.lastFullSaveStateID_=h.opt(n,(function(e){return e.guid})),this.lastMiniSaveStateID_=h.opt(n,(function(e){return e.guid}))),null!=n&&this.encodeStateToDataObject(n,t)},encodeToJSON:function(){var e=new pe.TheoJSONEncoder;return this.encodeStateToDataObject(this.appliedState,e),e.json()},encodeStateToDataObject:function(e,t){var n=h.clone(de.TheoDocumentUtils.getFontSourceUsage(this));t.setCompositeID(this.uuid),t.setType(o.MIME_TYPE),t.setDocumentSize(this.firstPage.pageSize,j.DocumentUnitsEnum.PIXEL),t.setProperty(o.PROPERTY_FONT_SOURCES,h.as(n,"AnyObject")),e.encode(t,o.CURRENT_VERSION)},saveChildren:function(){if(null!=this.firstPage_&&null!=this.content_&&null!=this.colorTheme_&&null!=this.history_){var e=[this.firstPage_,this.content_,this.colorTheme_,this.history_];this.set(o.PROPERTY_CHILDREN,e)}},cacheChildren:function(){var e,t,n,r,i;if(i=h.as(this.get(o.PROPERTY_CHILDREN),["Array",C.DBObject]))for(var a=h.iter(i);!a.done;a.next()){var s=a.value;this.firstPage_=(e=h.as(s,O.FormaPage))||null!=e?e:this.firstPage_,this.content_=(t=h.as(s,g.ContentDocument))||null!=t?t:this.content_,this.colorTheme_=(n=h.as(s,v.ColorThemeDocument))||null!=n?n:this.colorTheme_,this.history_=(r=h.as(s,D.DocumentHistory))||null!=r?r:this.history_}var l=null==this.firstPage_||null==this.content_||null==this.colorTheme_||null==this.history_;null==this.firstPage_&&(this.firstPage_=O.FormaPage.init_d0e4(this)),null==this.content_&&(this.content_=g.ContentDocument.init_26a9(this,null)),null==this.colorTheme_&&(this.colorTheme_=v.ColorThemeDocument.init_d0e4(this)),null==this.history_&&(this.history_=D.DocumentHistory.init_d0e4(this)),l&&this.saveChildren()},requestSaveDocumentAt:function(e){var t,n;return(t=G.Host.asyncPersist)&&null!=(n=e)?t.saveStateAsync(n):(this.publishing_.publish(new d.TheoDocumentRequestsSaveMessage(this,e)),_.CorePromise.resolve(null))}}}),o),d.DummyExport=(a=function(e){var t;void 0===e&&(e=null),this.prefix=(t=e)||null!=t?t:""},h.defineClass({name:"DummyExport",ctor:a,statics:{_implements:function(e){return"IExportDataObject"==e}},props:{setPath:function(e){h.info(this.prefix+"setPath path: "+e)},setName:function(e){h.info(this.prefix+"setName name: "+e)},setType:function(e){h.info(this.prefix+"setType type: "+e)},setProperty:function(e,t){h.info(this.prefix+"setProperty","name:",e,"value:",t||"nil")},setOptionalStringProperty:function(e,t){var n;h.info(this.prefix+"setOptionalStringProperty","name:",e,"value:",(n=t)||null!=n?n:"nil")},setStringProperty:function(e,t){h.info(this.prefix+"setStringProperty","name:",e,"value:",t)},setNumberProperty:function(e,t){h.info(this.prefix+"setNumberProperty","name:",e,"value:",t)},setIntProperty:function(e,t){h.info(this.prefix+"setIntProperty","name:",e,"value:",t)},setBooleanProperty:function(e,t){h.info(this.prefix+"setBooleanProperty","name:",e,"value:",t)},setOptionalBooleanProperty:function(e,t){var n;h.info(this.prefix+"setOptionalBooleanProperty","name:",e,"value:",(n=t)||null!=n?n:"nil")},findChild:function(e){return null},appendChild:function(e){return h.info(this.prefix+"appendChild id: "+e),new a("child "+e+" ")},appendComponent:function(e,t,n){h.info(this.prefix+"appendComponent","id:",e,"url:",t,"mimeType:",n)},setCompositeID:function(e){h.info(this.prefix+"setCompositeID","uuid:",e)},setManifestProperty:function(e,t,n){h.info(this.prefix+"setManifestProperty","name:",e,"value:",t||"nil","prependNamespace:",n)},setDocumentSize:function(e,t){h.info(this.prefix+"setDocumentSize","size:",e,"units:",t)}}}),a),d.VersionInfo=function(){var e=function(e){var t;this.vers=(t=d.TheoDocumentVersion.toCaseValue(e))||null!=t?t:d.TheoDocumentVersion.Invalid,this.minor=e%1e3,this.major=e-this.minor},t={};return h.defineClass({name:"VersionInfo",ctor:e,superName:"CoreObject",statics:{UNKNOWN:{get:function(){return void 0===t.UNKNOWN&&(t.UNKNOWN=new e(0)),t.UNKNOWN}},fromProperty:function(t){var n;return null!=(n=h.as(t,"Int"))?new e(n):e.UNKNOWN}},props:{description:{get:function(){return"Version Major: "+h.toString(this.major)+", minor: "+h.toString(this.minor)}},rawValue:{get:function(){return this.major+this.minor}}}}),e}(),d.TheoDocumentMessage=(s=function(e,t){fe.TheoMessage.call(this,e,t)},h.defineClass({name:"TheoDocumentMessage",ctor:s,superName:"TheoMessage",props:{document:{get:function(){return h.as(this.publisher,d.TheoDocument)}}}}),s),d.TheoDocumentWillDecodeMessage=(l=function e(t){d.TheoDocumentMessage.call(this,e.TYPE,t)},h.defineClass({name:"TheoDocumentWillDecodeMessage",ctor:l,superName:"TheoDocumentMessage",statics:{TYPE:"TheoDocumentWillDecodeMessage"}}),l),d.TheoDocumentDidDecodeMessage=(u=function e(t){d.TheoDocumentMessage.call(this,e.TYPE,t)},h.defineClass({name:"TheoDocumentDidDecodeMessage",ctor:u,superName:"TheoDocumentMessage",statics:{TYPE:"TheoDocumentDidDecodeMessage"}}),u),d.TheoDocumentRequestsSaveMessage=(c=function e(t,n){this.stateID=n,d.TheoDocumentMessage.call(this,e.TYPE,t)},h.defineClass({name:"TheoDocumentRequestsSaveMessage",ctor:c,superName:"TheoDocumentMessage",statics:{TYPE:"TheoDocumentRequestsSaveMessage"}}),c)},"9a+Y":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("HRWw"),l=n("A6KL"),u=n("iCxV"),c=n("q5zr"),d=n("fNpk"),h=n("Quhx"),p=n("AxS/"),f=n("lJxM"),m=n("9YN4"),g=n("LGJg"),y=n("sW6f");i.ContentDocument=(r=function(){this.factory_={}},o={},a.defineClass({name:"ContentDocument",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ContentDocument",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),m.TheoDocument);return d.LegacyCoreAssert.isTrue(null!=i,"ContentDocument needs a parent document",void 0,"ContentDocument","ContentDocument.swift",15),r.init_3144(e,t,n,i)}),o.factory},set:function(e){o.factory=e}},PROPERTY_CHILDREN:"children",DCXTYPE:{get:function(){return"application/vnd.adobe.theo.content+dcx"}},PATH:{get:function(){return"content"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{initFactories:function(){this.factory_[p.RootContentNode.KIND]=function(e,t,n){return p.RootContentNode.init_5972(e,n)},this.factory_[l.GroupContentNode.KIND]=function(e,t,n){return l.GroupContentNode.init_5972(e,n)},this.factory_[c.ImageContentNode.KIND]=function(e,t,n){return c.ImageContentNode.init_5972(e,n)},this.factory_[g.VectorContentNode.KIND]=function(e,t,n){return g.VectorContentNode.init_5972(e,n)},this.factory_[f.TextContentNode.KIND]=function(e,t,n){return f.TextContentNode.init_5972(e,n)},this.factory_[y.VideoContentNode.KIND]=function(e,t,n){return y.VideoContentNode.init_5972(e,n)}},init_3144:function(e,t,n,r){this.parent_=r,a.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_3181,t,n,e),this.initFactories()},init_26a9:function(e,t){this.parent_=e,a.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_11e0,e.database),this.set(h.PostDCXObject.PROPERTY_PATH,r.PATH),this.set(h.PostDCXObject.PROPERTY_TYPE,r.DCXTYPE),this.initFactories(),this.root_=p.RootContentNode.init_5972(this,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},root_:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_CHILDREN),["Array",s.ContentNode]))?a.as(a.first(e),p.RootContentNode):null},set:function(e){if(null!=e){var t=a.clone(a.as(this.get(r.PROPERTY_CHILDREN),["Array",s.ContentNode]));null!=t&&t.length>0?t[0]=e:t=[a.as(e,s.ContentNode)],this.set(r.PROPERTY_CHILDREN,t)}}},root:{get:function(){return this.root_}},nodeByID:function(e){return this.root.nodeByID(e)},nodeWithTag:function(e,t){return this.root.nodeWithTag(e,t)},createNode:function(e,t){var n=this.factory_[e];return null==n?(a.opt(u.Host.logging,(function(t){return t.warning("Could not instantiate a contentnode of kind "+e+": no factory")})),null):n(this,e,t)},publishForChild:function(e){this.publish(e)},postDecode:function(){this.root.postDecode()}}}),r)},"9eTw":function(e,t,n){var r=t,o=n("oAGj");r.DocumentUnitsEnum=o.defineEnum("DocumentUnitsEnum",{PIXEL:"pixel",POINT:"point",INCH:"inch",MM:"mm",CM:"cm"}),r.IExportDataObject=o.defineProtocol("IExportDataObject",{setPath:"(String) -> Void",setName:"(String) -> Void",setType:"(String) -> Void",setProperty:"(String, AnyObject) -> Void",setOptionalStringProperty:"(String, String) -> Void",setStringProperty:"(String, String) -> Void",setNumberProperty:"(String, Double) -> Void",setIntProperty:"(String, Integer) -> Void",setBooleanProperty:"(String, Boolean) -> Void",setOptionalBooleanProperty:"(String, Boolean) -> Void",findChild:"(String) -> IExportDataObject",appendChild:"(String) -> IExportDataObject",appendComponent:"(String, String, String) -> Void",setCompositeID:"(String) -> Void",setManifestProperty:"(String, AnyObject, Boolean) -> Void",setDocumentSize:"(TheoSize, String) -> Void"})},"9oQN":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("cZuM"),s=n("Z25M"),l=n("FNB+"),u=n("6ZWm"),c=n("JO5d"),d=n("8t9B");o.EvaluationUtils=(r=function(){},i.defineClass({name:"EvaluationUtils",ctor:r,statics:{getFormaOutOfBounds:function(e){for(var t,n={},r=i.iter(e);!r.done;r.next()){var o,a,s=r.value;if((o=s.finalFrame)&&(a=i.opt(s.root,(function(e){return e.finalFrame})))){var l=(t=i.opt(o.intersectionWith(a),(function(e){return e.area})))||null!=t?t:0;n[s.formaID]=1-l/o.area}}return n},evaluateOutOfBounds:function(e,t,n){for(var r,o,a=[],s=i.iter(i.keys(n));!s.done;s.next()){var l=s.value,u=(r=t[l])||null!=r?r:0,c=(o=n[l])||null!=o?o:0;if(u<.01||c>.99){var d=Math.abs(u-c);d>.001&&a.push(d)}}return a.reduce((function(e,t){return e+t}),0)},getFormaOverlap:function(e){var t,n={};if(e.length>1)for(var r=i.iter(i.range(0,e.length-1,!1));!r.done;r.next())for(var o=r.value,a=i.iter(i.range(o+1,e.length,!1));!a.done;a.next()){var s,l,u=a.value,c=e[o],d=e[u];if((s=c.finalFrame)&&(l=d.finalFrame)){var h=(t=i.opt(s.intersectionWith(l),(function(e){return e.area})))||null!=t?t:0;h>0&&(n[c.formaID+d.formaID]=h/s.area,n[d.formaID+c.formaID]=h/l.area)}}return n},evaluateOverlap:function(e,t,n){for(var r,o,a=[],s=[],u=[],c=i.iter(e);!c.done;c.next())for(var d=c.value,h=i.iter(e);!h.done;h.next()){var p=h.value;if(!i.eq(l._equality_Forma_Forma,d,p)){var f=(r=t[d.formaID+p.formaID])||null!=r?r:0,m=(o=n[d.formaID+p.formaID])||null!=o?o:0;if(f<=.01){var g=Math.abs(m-f);g>.01&&(d.isText()&&p.isText()?a.push(g):d.isGraphic()&&p.isGraphic()?s.push(g):u.push(g))}}}return{textOverlap:a.reduce((function(e,t){return e+t}),0),graphicOverlap:s.reduce((function(e,t){return e+t}),0),graphicTextOverlap:u.reduce((function(e,t){return e+t}),0)}},getFormaAlignment:function(e){for(var t=e.filter((function(e){return e.isTypeLockup()}),this),n=t.filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<.01}),this),r={},o=i.iter(n);!o.done;o.next())for(var l=o.value,u=i.clone(l.controller.alignmentDetector.detectFormaAlignments(a.AlignmentDetector.DISTANCE_THRESHOLD)),c=i.iter(s.DesignFeatureUtils.getSetDiff(t,u));!c.done;c.next()){var d=c.value;r[l.formaID+d.formaID]=1,r[d.formaID+l.formaID]=1}return r},evaluateAlignment:function(e,t,n){for(var r,o,a=0,s=0,u=i.iter(e);!u.done;u.next())for(var c=u.value,d=i.iter(e);!d.done;d.next()){var h=d.value;if(!i.eq(l._equality_Forma_Forma,c,h)){var p=(r=t[c.formaID+h.formaID])||null!=r?r:0,f=(o=n[c.formaID+h.formaID])||null!=o?o:0;1==p&&(s+=1,a+=Math.abs(p-f))}}return a/(s+.001)},getFormaSizes:function(e){for(var t={},n=i.iter(e);!n.done;n.next()){var r,o=n.value;(r=i.as(o.controller,d.TypeLockupController))?t[o.formaID]=r.getCurrentFontSize():t[o.formaID]=o.finalFrame.area}return t},evaluateSizeDifferences:function(e,t,n){for(var r=[],o=[],a=i.iter(e);!a.done;a.next()){var s,l,u=a.value;if(null!=(s=t[u.formaID])&&null!=(l=n[u.formaID]))if(u.isTypeLockup())s>d.TypeLockupController.MIN_LINE_HEIGHT&&l<.5*d.TypeLockupController.MIN_LINE_HEIGHT?r.push(s-l):r.push(0);else{var c=u.root.finalFrame.area/50;s>c&&l<.25*c?o.push(Math.abs(s-l)/Math.max(s,l)):o.push(0)}}return{textDiff:r.reduce((function(e,t){return e+t}),0),graphicDiff:o.reduce((function(e,t){return e+t}),0)}},getEmptySpace:function(e){for(var t,n=i.opt(e.finalFrame,(function(e){return e.insetRel(.15,.15,.15,.15)})),r=null,o=i.iter(e.visitAsArray(l.FormaTraversal.PreOrder));!o.done;o.next()){var a,s=o.value;if((a=s.controller)&&(a.kind==u.FrameController.KIND||a.kind==d.TypeLockupController.KIND||a.kind==c.ShapeController.KIND)){if(s.isShape()&&!s.hasIntent(l.Forma.INTENT_ICON))continue;var h,p;(h=n)&&(p=i.opt(s.finalFrame,(function(e){return e.intersectionWith(h)})))&&(r=null==r?p:i.opt(r,(function(e){return e.unionWith(p)})))}}return(t=r)&&(h=n)?1-Math.min(t.area/h.area,1):0}}}),r)},A6KL:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("dNOY"),s=n("HRWw"),l=n("fNpk");o.GroupContentNode=(r=function(){},i.defineClass({name:"GroupContentNode",ctor:r,superName:"ContentNode",statics:{KIND:{get:function(){return"group"}},SCHEMA_CLASS_NAME:{get:function(){return"GroupContentNode"}},factory:{get:function(){return function(e,t,n,o){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),r);return l.LegacyCoreAssert.isTrue(null!=a,"Non-root group content nodes need a parent",void 0,"GroupContentNode","GroupContentNode.swift",16),r.init_3144(e,t,n,a)}}},PROPERTY_CHILDREN:"children",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_3144,e,t,n,r)},init_5e75:function(e,t,n,r){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_5e75,e,t,n,r)},init_8b5c:function(e,t,n){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_8b5c,e,t,n)},init_5972:function(e,t){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_8b5c,e,"group",t)},init_26a9:function(e,t){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_c3fa,e,"group",t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},children_:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_CHILDREN),["Array",s.ContentNode]))||null!=e?e:[]}},nodeByID:function(e){if(e==this.id)return this;for(var t=i.iter(this.children_);!t.done;t.next()){var n=t.value;if(null!=n.nodeByID(e))return n}return null},nodeWithTag:function(e,t){if(this.getTag(e)==t)return this;for(var n=i.iter(this.children_);!n.done;n.next()){var r=n.value;if(null!=r.nodeWithTag(e,t))return r}return null},insertChildrenAt:function(e,t){for(var n=e,o=i.iter(t);!o.done;o.next())null!=(c=o.value).parent&&(l.LegacyCoreAssert.isTrue(c.parent!=this,"attempting to insert a child that is already a child",void 0,"GroupContentNode.insertChildrenAt","GroupContentNode.swift",81),c.parent.removeChild(c));for(var s=i.clone(this.children_),u=i.iter(t);!u.done;u.next()){var c;(c=u.value).parent=this,s.splice(n,0,c)}this.set(r.PROPERTY_CHILDREN,s),this.publish(new a.InsertedContentChildrenMessage(this,e,t))},removeChildrenAt:function(e,t){if(e<0||t<0||e+t>this.children_.length)l.LegacyCoreAssert.fail("removeChildrenAt: invalid index and/or count",void 0,"GroupContentNode.removeChildrenAt","GroupContentNode.swift",98);else{var n=i.clone(this.children_),o=n.splice(e,t);this.set(r.PROPERTY_CHILDREN,n);for(var s=i.iter(o);!s.done;s.next())s.value.parent=null;this.publish(new a.RemovedContentChildrenMessage(this,e,o))}},appendChild:function(e){this.insertChildrenAt(this.children_.length,[e])},insertChild:function(e,t){this.insertChildrenAt(e,[t])},removeChild:function(e){var t;l.LegacyCoreAssert.isTrue(e.parent==this,"can't remove child that doesn't belong to me",void 0,"GroupContentNode.removeChild","GroupContentNode.swift",121),e.parent==this&&null!=(t=i.indexOf(this.children_,e))&&this.removeChildrenAt(t,1)},removeChildAt:function(e){l.LegacyCoreAssert.isTrue(e>=0&&e<this.children_.length,"index out of range",void 0,"GroupContentNode.removeChildAt","GroupContentNode.swift",130),this.removeChildrenAt(e,1)},removeAllChildren:function(){this.removeChildrenAt(0,this.children_.length)},childAt:function(e){return l.LegacyCoreAssert.isTrue(e>=0&&e<this.children_.length,"index out of range",void 0,"GroupContentNode.childAt","GroupContentNode.swift",139),this.children_[e]},childCount:{get:function(){return this.children_.length}},forEachChild:function(e){for(var t=i.iter(this.children_);!t.done;t.next())e(t.value)},visit:function(e){if(e(this))return this;for(var t=i.iter(this.children_);!t.done;t.next()){var n=t.value;if(e(n))return n}return null},didChangeState:function(e){var t;if(null!=(t=e[r.PROPERTY_CHILDREN])){var n=this.getCodec(r.PROPERTY_CHILDREN);l.LegacyCoreAssert.isTrue(null!=n,"State changed before codecs registered.",void 0,"GroupContentNode.didChangeState","GroupContentNode.swift",170);var o,u,c=i.clone(i.as(n.decode(t[0],this),["Array",s.ContentNode])),d=i.clone(i.as(n.decode(t[1],this),["Array",s.ContentNode]));if((o=c)&&this.publish(new a.RemovedContentChildrenMessage(this,0,o)),u=d){for(var h=i.iter(u);!h.done;h.next()){var p=h.value;l.LegacyCoreAssert.isTrue(null==p.parent||p.parent===this,"Changing this group's state shouldn't rip a child from its old parent",void 0,"GroupContentNode.didChangeState","GroupContentNode.swift",182),null==p.parent&&(p.parent=this)}this.publish(new a.InsertedContentChildrenMessage(this,0,u))}}s.ContentNode.prototype.didChangeState.call(this,e)}}}),r)},"AxS/":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("9a+Y"),s=n("A6KL"),l=n("fNpk");o.RootContentNode=(r=function(){},i.defineClass({name:"RootContentNode",ctor:r,superName:"GroupContentNode",statics:{KIND:{get:function(){return"root"}},SCHEMA_CLASS_NAME:{get:function(){return"RootContentNode"}},factory:{get:function(){return function(e,t,n,o){var s=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),a.ContentDocument);return l.LegacyCoreAssert.isTrue(null!=s,"Root content node needs a content document parent",void 0,"RootContentNode","RootContentNode.swift",18),r.init_5e75(e,t,n,s)}}},DOCUMENT_SOURCE_ID_TAG:"document:source:id",DOCUMENT_SOURCE_TYPE_TAG:"document:source:type",THEME_ID_TAG:"theme:id",PALETTE_ID_TAG:"palette:id",SUMMIT_LOGO_TAG:"SummitLogo",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_5e75:function(e,t,n,r){i.super_init(this,s.GroupContentNode,s.GroupContentNode.prototype.init_5e75,e,t,n,r)},init_5972:function(e,t){i.super_init(this,s.GroupContentNode,s.GroupContentNode.prototype.init_8b5c,e,"root",t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r)},B8ge:function(e,t,n){var r,o,i,a,s,l,u=t,c=n("oAGj"),d=n("gXiO"),h=n("iCxV"),p=n("fNpk"),f=n("tGKA"),m=n("3DEm"),g=n("oTAR"),y=n("hgLm"),_=n("oKlP"),T=n("sIWg");u.svg_item=(r=function(){},c.defineClass({name:"svg_item",ctor:r,props:{visit:function(e,t){return p.LegacyCoreAssert.fail("subclass must implement",void 0,"svg_item.visit","SVGParser.swift",15),[]}}}),r),u.svg_path=(o=function(){this.path_transform=f.Matrix2D.Identity,this.path_outline=null,u.svg_item.call(this)},c.defineClass({name:"svg_path",ctor:o,superName:"svg_item",props:{visit:function(e,t){if(!this.path_outline.isOnlyMoves()){var n=this.path_transform.concat(t),r=y.TheoArbitraryPath.ArbitraryPathFromPath(this.path_outline,n);if(null==e)return[r];var o=r.bounds;if(0==o.area&&(o=T.TheoRect.fromXYWH(o.minX,o.minY,o.width+.1,o.height+.1)),e.intersects(o))return[r]}return[]}}}),o),u.svg_group=(i=function(){this.items=[],this.group_attributes={},u.svg_item.call(this)},c.defineClass({name:"svg_group",ctor:i,superName:"svg_item",props:{addItem:function(e){this.items.push(e)},addAttribute:function(e,t){this.group_attributes[e]=t},visit:function(e,t){var n=[];if("none"!=this.group_attributes.display)for(var r=this.group_attributes.transform,o=g.SVGParserUtils.parseSVGTransform(r).concat(t),i=c.iter(this.items);!i.done;i.next()){var a=i.value;n=n.concat(a.visit(e,o))}return n}}}),i),u.svg_dom=(a=function(){this.root_item=null,this.view_box=T.TheoRect.Zero,this.slice_box=T.TheoRect.Zero,this.content_region=T.TheoRect.Zero,d.CoreObject.call(this)},c.defineClass({name:"svg_dom",ctor:a,superName:"CoreObject"}),a),u.SVGPathData=(s=function(e,t,n,r,o,i){this.paths=c.clone(e),this.viewBox=t,this.sliceBox=n,this.contentBox=r,this.hasNoPaths=o,this.usedTags=c.clone(i)},c.defineClass({name:"SVGPathData",ctor:s,superName:"CoreObject"}),s),u.k_radians_per_degree=.017453292519943295,u.SVGParser=(l=function(){this._currentElementValue=null,this._dom=new u.svg_dom,this._stack=[],this._ignoringUnknownTag=null,this._usedTags=[],this._styleClasses={},this._elementAttrDict={},this._currentGroupAttrDict={},d.CoreObject.call(this)},c.defineClass({name:"SVGParser",ctor:l,superName:"CoreObject",statics:{collectTagDataForTest:!1},props:{createTheoPathFromParsedDom:function(){var e=null;this._dom.view_box.width>0&&this._dom.view_box.height>0&&(e=this._dom.view_box);var t=!1,n=c.clone(c.opt(this._dom.root_item,(function(t){return t.visit(e,f.Matrix2D.Identity)}))||[]);if(0==n.length&&null!=e){t=!0,c.info("SVGParser:failed to get any paths for parsed SVG. drawing an X so there's something to see");var r=(e.width+e.height)/15,o=Math.round(r/2),i=y.TheoPathBuilder.init_31cf(y.TheoPath.PATHFILL_NONE,y.TheoPath.PATHEND_ROUND,y.TheoPath.PATHJOIN_BEVEL,o,o),a=e.insetXY(r,r);i.rectangle(e.minX,e.minY,e.maxX,e.maxY),i.moveTo(a.minX,a.minY),i.lineTo(a.maxX,a.maxY),i.moveTo(a.maxX,a.minY),i.lineTo(a.minX,a.maxY),n.push(i.path)}return new u.SVGPathData(n,this._dom.view_box,this._dom.slice_box,this._dom.content_region,t,this._usedTags)},handleStringValue:function(e){null==this._currentElementValue?this._currentElementValue=e.trim():this._currentElementValue=this._currentElementValue+e},parseStyleClassDefinitions:function(e){for(var t=c.clone(h.Host.pathUtils.matchesForRegexInString("\\.[\\w-]+\\s*\\{[^\\}]*\\}",e)),n=c.iter(t);!n.done;n.next()){var r=n.value,o=c.clone(h.Host.pathUtils.matchesForRegexInString("[\\w-]+\\s*",r));if(o.length>0){var i=o[0],a=r.substr(i.length+2,r.length-i.length-3),s=c.clone(g.SVGParserUtils.parseStyleStringToAttrDict(a));this._styleClasses[i.trim()]=c.clone(s)}}},mergeIntoAttrDict:function(e,t){for(var n=c.iter(e);!n.done;n.next()){var r=n.key,o=n.value;t&&"transform"==r||null==this._elementAttrDict[r]&&(this._elementAttrDict[r]=o)}},mergeStyleClassAttributes:function(e){for(var t=e.split(" "),n=c.iter(this._styleClasses);!n.done;n.next())for(var r=n.key,o=n.value,i=c.iter(t);!i.done;i.next())r==i.value&&this.mergeIntoAttrDict(o,!1)},getSVGFillType:function(e){var t=y.TheoPath.PATHFILL_NONZERO;return"none"==e.fill?t=y.TheoPath.PATHFILL_NONE:"evenodd"==e["fill-rule"]&&(t=y.TheoPath.PATHFILL_EVENODD),t},beginElement:function(e,t){if(l.collectTagDataForTest&&!this._usedTags.includes(e)&&(null!=this._ignoringUnknownTag?this._usedTags.push(this._ignoringUnknownTag+"/"+e):this._usedTags.push(e)),null==this._ignoringUnknownTag){this._elementAttrDict=c.clone(t);var n=this._elementAttrDict.style;if(null!=n){var r=c.clone(g.SVGParserUtils.parseStyleStringToAttrDict(n));this.mergeIntoAttrDict(r,!1)}null!=(n=this._elementAttrDict.class)&&this.mergeStyleClassAttributes(this._elementAttrDict.class);for(var o=c.iter(c.reverse(this._stack));!o.done;o.next()){var i=o.value;this.mergeIntoAttrDict(i.group_attributes,!0)}n=this._elementAttrDict.transform;var a=f.Matrix2D.Identity;null!=n&&(a=g.SVGParserUtils.parseSVGTransform(n));var s=this.getSVGFillType(this._elementAttrDict),d=g.SVGParserUtils.getSVGEndcapType(this._elementAttrDict),v=g.SVGParserUtils.getSVGPathJoin(this._elementAttrDict),C=g.SVGParserUtils.getSVGSMiterLimit(this._elementAttrDict),P=g.SVGParserUtils.getSVGStrokeWt(this._elementAttrDict),S=this._elementAttrDict.display;if("svg:svg"==e||"svg"==e){p.LegacyCoreAssert.isTrue(null==this._dom.root_item,"nil root item",void 0,"SVGParser.beginElement","SVGParser.swift",361);var D=new u.svg_group;this._dom.root_item=D,this._stack.push(D),this._dom.view_box=g.SVGParserUtils.parseSVGBox(this._elementAttrDict.viewBox),this._dom.slice_box=g.SVGParserUtils.parseSVGBox(this._elementAttrDict.sliceBox),this._dom.content_region=g.SVGParserUtils.parseSVGBox(this._elementAttrDict.contentRegion);for(var A=c.iter(this._elementAttrDict);!A.done;A.next()){var E=A.key,R=A.value;D.addAttribute(E,R)}if(l.collectTagDataForTest){var F="Creating App: ";null!=this._elementAttrDict["xmlns:inkscape"]?F+=this._elementAttrDict["xmlns:inkscape"]:null!=this._elementAttrDict["xmlns:sketch"]?F+=this._elementAttrDict["xmlns:sketch"]:null!=this._elementAttrDict["xmlns:serif"]?F+=this._elementAttrDict["xmlns:serif"]:null!=this._elementAttrDict["xmlns:i"]?F+=this._elementAttrDict["xmlns:i"]:F+="unknown",this._usedTags.push(F)}}else if("svg:g"==e||"g"==e){D=new u.svg_group,c.last(this._stack).addItem(D),this._stack.push(D);for(var b=c.iter(this._elementAttrDict);!b.done;b.next())E=b.key,R=b.value,D.addAttribute(E,R)}else if("svg:circle"==e||"circle"==e||"svg:ellipse"==e||"ellipse"==e){if("none"==S)return;var I=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"r",0),O=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"rx",I),k=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"ry",I);if(0==O||0==k)return;p.LegacyCoreAssert.isTrue(O>=0&&k>=0,"circle with negative radius?",void 0,"SVGParser.beginElement","SVGParser.swift",427);var N=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"cx",0),M=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"cy",0),L=new u.svg_path;c.last(this._stack).addItem(L),L.path_transform=a;var x=T.TheoRect.fromXYWH(N-O,M-k,2*O,2*k);(X=y.TheoPathBuilder.init_31cf(s,d,v,P,C)).ellipse(x.minX,x.minY,x.maxX,x.maxY),L.path_outline=X.path}else if("svg:line"==e||"line"==e){if("none"==S)return;var B=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"x1",0),w=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"y1",0),G=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"x2",0),Y=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"y2",0);L=new u.svg_path,c.last(this._stack).addItem(L),L.path_transform=a,(X=y.TheoPathBuilder.init_31cf(y.TheoPath.PATHFILL_NONE,d,v,P,C)).moveTo(B,w),X.lineTo(G,Y),L.path_outline=X.path}else if("svg:polyline"==e||"polyline"==e||"svg:polygon"==e||"polygon"==e){if("none"==S)return;if(n=this._elementAttrDict.points,0==(ne=(q=c.clone(g.SVGParserUtils.scanCoordinateData(n))).length)||ne%2!=0)return;for(var U=[],j=0;j<ne;){var V=h.Host.pathUtils.parseStringToDouble(q[j]),H=h.Host.pathUtils.parseStringToDouble(q[j+1]);j+=2,U.push(new _.TheoPoint(V,H))}L=new u.svg_path,c.last(this._stack).addItem(L),L.path_transform=a,(X=y.TheoPathBuilder.init_31cf(s,d,v,P,C)).addLines(U),"svg:polygon"!=e&&"polygon"!=e||X.closePath(),L.path_outline=X.path}else if("svg:rect"==e||"rect"==e){if("none"==S)return;var K=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"width",0),W=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"height",0);if(0==W||0==K)return;V=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"x",0),H=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"y",0),O=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"rx",0),k=g.SVGParserUtils.getAttrDoubleForKey(this._elementAttrDict,"ry",0),O=m.MathUtils.saturate_range(0,K/2,O),k=m.MathUtils.saturate_range(0,W/2,k),L=new u.svg_path,c.last(this._stack).addItem(L),L.path_transform=a;var X=y.TheoPathBuilder.init_31cf(s,d,v,P,C);if(0==O||0==k){var z=T.TheoRect.fromXYWH(V,H,K,W);X.rectangle(z.minX,z.minY,z.maxX,z.maxY)}else z=T.TheoRect.fromXYWH(V,H,K,W),X.roundedRectangle(z.minX,z.minY,z.maxX,z.maxY,O,k);L.path_outline=X.path}else if("svg:path"==e||"path"==e){if("none"==S)return;if(null==(n=this._elementAttrDict.d))return;L=new u.svg_path,c.last(this._stack).addItem(L),L.path_transform=a;var q,Z,J,Q,$,ee,te,ne=(q=c.clone(g.SVGParserUtils.scanPathData(n))).length;if(X=y.TheoPathBuilder.init_31cf(s,d,v,P,C),V=0,H=0,ee=0,te=0,Z=0,J=0,Q=0,$=0,j=0,0==ne)X.moveTo(0,0),X.closePath();else{function re(){V=h.Host.pathUtils.parseStringToDouble(q[j]),H=h.Host.pathUtils.parseStringToDouble(q[j+1]),j+=2,X.lineTo(V,H),Z=V,Q=V,J=H,$=H}function oe(){V+=h.Host.pathUtils.parseStringToDouble(q[j]),H+=h.Host.pathUtils.parseStringToDouble(q[j+1]),j+=2,X.lineTo(V,H),Z=V,Q=V,J=H,$=H}for(;j<ne;){var ie=q[j];if(j+=1,"M"==ie)V=h.Host.pathUtils.parseStringToDouble(q[j]),H=h.Host.pathUtils.parseStringToDouble(q[j+1]),j+=2,X.moveTo(V,H),ee=V,te=H,Z=V,Q=V,J=H,$=H;else if("m"==ie)V+=h.Host.pathUtils.parseStringToDouble(q[j]),H+=h.Host.pathUtils.parseStringToDouble(q[j+1]),j+=2,X.moveTo(V,H),Z=V,Q=V,J=H,$=H,ee=V,te=H;else if("L"==ie)re();else if("l"==ie)oe();else if("H"==ie)V=h.Host.pathUtils.parseStringToDouble(q[j]),j+=1,X.lineTo(V,H),Z=V,Q=V,J=H,$=H;else if("h"==ie)V+=h.Host.pathUtils.parseStringToDouble(q[j]),j+=1,X.lineTo(V,H),Z=V,Q=V,J=H,$=H;else if("V"==ie)H=h.Host.pathUtils.parseStringToDouble(q[j]),j+=1,X.lineTo(V,H),Z=V,Q=V,J=H,$=H;else if("v"==ie)H+=h.Host.pathUtils.parseStringToDouble(q[j]),j+=1,X.lineTo(V,H),Z=V,Q=V,J=H,$=H;else if("C"==ie)Z=h.Host.pathUtils.parseStringToDouble(q[j]),J=h.Host.pathUtils.parseStringToDouble(q[j+1]),Q=h.Host.pathUtils.parseStringToDouble(q[j+2]),$=h.Host.pathUtils.parseStringToDouble(q[j+3]),V=h.Host.pathUtils.parseStringToDouble(q[j+4]),H=h.Host.pathUtils.parseStringToDouble(q[j+5]),j+=6,X.cubicBezier(Z,J,Q,$,V,H),Z=V,J=H;else if("c"==ie)Z=V+h.Host.pathUtils.parseStringToDouble(q[j]),J=H+h.Host.pathUtils.parseStringToDouble(q[j+1]),Q=V+h.Host.pathUtils.parseStringToDouble(q[j+2]),$=H+h.Host.pathUtils.parseStringToDouble(q[j+3]),V+=h.Host.pathUtils.parseStringToDouble(q[j+4]),H+=h.Host.pathUtils.parseStringToDouble(q[j+5]),j+=6,X.cubicBezier(Z,J,Q,$,V,H),Z=V,J=H;else if("S"==ie){var ae=m.MathUtils.Reflect(new _.TheoPoint(Q,$),new _.TheoPoint(V,H));Z=ae.x,J=ae.y,Q=h.Host.pathUtils.parseStringToDouble(q[j]),$=h.Host.pathUtils.parseStringToDouble(q[j+1]),V=h.Host.pathUtils.parseStringToDouble(q[j+2]),H=h.Host.pathUtils.parseStringToDouble(q[j+3]),j+=4,X.cubicBezier(Z,J,Q,$,V,H),Z=V,J=H}else if("s"==ie)ae=m.MathUtils.Reflect(new _.TheoPoint(Q,$),new _.TheoPoint(V,H)),Z=ae.x,J=ae.y,Q=V+h.Host.pathUtils.parseStringToDouble(q[j]),$=H+h.Host.pathUtils.parseStringToDouble(q[j+1]),V+=h.Host.pathUtils.parseStringToDouble(q[j+2]),H+=h.Host.pathUtils.parseStringToDouble(q[j+3]),j+=4,X.cubicBezier(Z,J,Q,$,V,H),Z=V,J=H;else if("Q"==ie)Z=h.Host.pathUtils.parseStringToDouble(q[j]),J=h.Host.pathUtils.parseStringToDouble(q[j+1]),V=h.Host.pathUtils.parseStringToDouble(q[j+2]),H=h.Host.pathUtils.parseStringToDouble(q[j+3]),j+=4,X.quadraticBezier(Z,J,V,H),Q=V,$=H;else if("q"==ie)Z=V+h.Host.pathUtils.parseStringToDouble(q[j]),J=H+h.Host.pathUtils.parseStringToDouble(q[j+1]),V+=h.Host.pathUtils.parseStringToDouble(q[j+2]),H+=h.Host.pathUtils.parseStringToDouble(q[j+3]),j+=4,X.quadraticBezier(Z,J,V,H),Q=V,$=H;else if("T"==ie)ae=m.MathUtils.Reflect(new _.TheoPoint(Z,J),new _.TheoPoint(V,H)),Z=ae.x,J=ae.y,V=h.Host.pathUtils.parseStringToDouble(q[j]),H=h.Host.pathUtils.parseStringToDouble(q[j+1]),j+=2,X.quadraticBezier(Z,J,V,H),Q=V,$=H;else if("t"==ie)ae=m.MathUtils.Reflect(new _.TheoPoint(Z,J),new _.TheoPoint(V,H)),Z=ae.x,J=ae.y,V+=h.Host.pathUtils.parseStringToDouble(q[j]),H+=h.Host.pathUtils.parseStringToDouble(q[j+1]),j+=2,X.quadraticBezier(Z,J,V,H),Q=V,$=H;else if("A"==ie||"a"==ie){O=m.MathUtils.absDouble(h.Host.pathUtils.parseStringToDouble(q[j])),k=m.MathUtils.absDouble(h.Host.pathUtils.parseStringToDouble(q[j+1]));var se=h.Host.pathUtils.parseStringToDouble(q[j+2])*u.k_radians_per_degree,le=0!=h.Host.pathUtils.parseStringToDouble(q[j+3]),ue=0!=h.Host.pathUtils.parseStringToDouble(q[j+4]);j+=5;var ce=new _.TheoPoint(V,H);if("A"==ie){if(0==O||0==k){re();continue}V=h.Host.pathUtils.parseStringToDouble(q[j]),H=h.Host.pathUtils.parseStringToDouble(q[j+1]),j+=2}else{if(0==O||0==k){oe();continue}V+=h.Host.pathUtils.parseStringToDouble(q[j]),H+=h.Host.pathUtils.parseStringToDouble(q[j+1]),j+=2}var de=new _.TheoPoint(V,H);if(ce.equal(de))continue;g.SVGParserUtils.svgArcToPath(ce,O,k,se,le,ue,de,X),Z=V,Q=V,J=H,$=H}else"Z"==ie||"z"==ie?(X.closePath(),V=ee,Z=ee,Q=ee,H=te,J=te,$=te):p.LegacyCoreAssert.fail("unimplemented svg path opcode",{opcode:ie},"SVGParser.beginElement","SVGParser.swift",822)}}p.LegacyCoreAssert.isTrue(j==ne,"i should equal count",void 0,"SVGParser.beginElement","SVGParser.swift",826),L.path_outline=X.path}else"svg:switch"==e||"switch"==e||(this._ignoringUnknownTag=e)}},endElement:function(e){null!=this._ignoringUnknownTag?this._ignoringUnknownTag==e&&(this._ignoringUnknownTag=null):"svg:svg"==e||"svg"==e?this._stack.pop():"svg:desc"==e||"desc"==e||"svg:g"!=e&&"g"!=e||this._stack.pop(),null!=this._ignoringUnknownTag&&"defs"!=this._ignoringUnknownTag||"svg:style"!=e&&"style"!=e||null!=this._currentElementValue&&this.parseStyleClassDefinitions(this._currentElementValue),this._currentElementValue=null,this._elementAttrDict={}}}}),l)},BAdM:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ytEx"),s=n("gXiO"),l=n("iCxV");o.JSONComponentDecoder=(r=function(){},i.defineClass({name:"JSONComponentDecoder",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IImportDataComponent"==e}},props:{init_466d:function(e){this.json_=i.clone(e),s.CoreObject.call(this)},init_f390:function(e,t,n,r,o,s){var u={};null!=e&&(u[a.PROPERTY_KEY_ID]=e),null!=t&&(u[a.PROPERTY_KEY_NAME]=t),null!=n&&(u[a.PROPERTY_KEY_PATH]=n),null!=r&&(u[a.PROPERTY_KEY_MIMETYPE]=r),null!=o&&(u[a.PROPERTY_KEY_ETAG]=o),null!=s&&(u[a.PROPERTY_KEY_URL]=s),this.init_466d(u),i.opt(l.Host.logging,(function(o){return o.info("init "+i.toString(e)+" "+i.toString(t)+" "+i.toString(r)+" "+i.toString(n)+" "+i.toString(s))}))},id:{get:function(){return i.as(this.json_[a.PROPERTY_KEY_ID],"String")}},name:{get:function(){return i.as(this.json_[a.PROPERTY_KEY_NAME],"String")}},path:{get:function(){return i.as(this.json_[a.PROPERTY_KEY_PATH],"String")}},mimeType:{get:function(){return i.as(this.json_[a.PROPERTY_KEY_MIMETYPE],"String")}},etag:{get:function(){return i.as(this.json_[a.PROPERTY_KEY_ETAG],"String")}},url:{get:function(){return i.as(this.json_[a.PROPERTY_KEY_URL],"String")}}}}),r)},BQMb:function(e,t,n){var r=t,o=n("oAGj");r.MotionEntry=o.defineProtocol("MotionEntry",{srcId:"String",logic:"MotionLogic",args:"Dictionary<String>"})},BbDD:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.DocumentSingletonTracker=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"DocumentSingletonTracker",ctor:r,superName:"CoreObject",statics:{creatingDocumentSingleton:function(e,t){void 0===t&&(t=!1)},destroyingDocumentSingleton:function(e){},noDocumentSingletonsShouldExist:function(){}}}),r)},Bcdx:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("5ex8"),l=n("Bqrn"),u=n("dX/e"),c=n("pR+7"),d=n("3HaQ"),h=n("8Quq"),p=n("zW/s"),f=n("s3ad");i.FormaToPGMMapperFactory=(r=function(){},o={},a.defineClass({name:"FormaToPGMMapperFactory",ctor:r,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},FORMA_KIND_TO_FN:{get:function(){return void 0===o.FORMA_KIND_TO_FN&&(o.FORMA_KIND_TO_FN={Root:function(e){return c.RootFormaToPGMMapper.createMapper(e)},Frame:function(e){return s.FrameFormaToPGMMapper.createMapper(e)},Text:function(e){return h.TextFormaToPGMMapper.createMapper(e)},Shape:function(e){return d.ShapeFormaToPGMMapper.createMapper(e)},Image:function(e){return u.ImageFormaToPGMMapper.createMapper(e)},Video:function(e){return f.VideoFormaToPGMMapper.createMapper(e)},Vector:function(e){return p.VectorFormaToPGMMapper.createMapper(e)},group:function(e){return l.GroupFormaToPGMMapper.createMapper(e)},"smart-group":function(e){return l.GroupFormaToPGMMapper.createMapper(e)}}),o.FORMA_KIND_TO_FN}}},props:{getMapper:function(e){return a.opt(r.FORMA_KIND_TO_FN[e.kind],(function(t){return t(e)}))}}}),r)},BgH2:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("iCxV"),l=n("fNpk"),u=n("oKlP"),c=n("sIWg");i.TextPathSegment=(r=function(e,t,n,r){this._cachedTolerance=0,this._p0=e,this._p1=t,this._p2=n,this._p3=r},a.defineClass({name:"TextPathSegment",ctor:r,superName:"CoreObject",statics:{decodeFromJson:function(e){var t;if(t=e){var n=r.decodePoint(t[r.PROPERTY_P0]),o=r.decodePoint(t[r.PROPERTY_P1]),i=r.decodePoint(t[r.PROPERTY_P2]),a=r.decodePoint(t[r.PROPERTY_P3]);if(null!=n&&null!=o&&null!=i&&null!=a)return new r(n,o,i,a)}return null},encodePoint:function(e){return[e.x,e.y]},decodePoint:function(e){return u.TheoPoint.decodeJson(a.as(e,"AnyObject"))},PROPERTY_P0:"p0",PROPERTY_P1:"p1",PROPERTY_P2:"p2",PROPERTY_P3:"p3"},props:{p0:{get:function(){return this._p0}},p1:{get:function(){return this._p1}},p2:{get:function(){return this._p2}},p3:{get:function(){return this._p3}},clone:function(){return new r(this.p0,this.p1,this.p2,this.p3)},pointAt:function(e){if(!this.checkT(e))return u.TheoPoint.INVALID;var t=1-e,n=t*t*t*this.p0.x+3*e*t*t*this.p1.x+3*e*e*t*this.p2.x+e*e*e*this.p3.x,r=t*t*t*this.p0.y+3*e*t*t*this.p1.y+3*e*e*t*this.p2.y+e*e*e*this.p3.y;return new u.TheoPoint(n,r)},tangentUnitVectorAt:function(e){if(!this.checkT(e))return u.TheoPoint.INVALID;var t=e;t<.01?t=.01:t>.99&&(t=.99);var n=a.clone(this.calculateMidpoints(t)),r=u._minus_TheoPoint_TheoPoint(n[4],n[3]);return r.divide(r.length())},getBounds:function(){var e=this.getBoundsOneDim(this.p0.x,this.p1.x,this.p2.x,this.p3.x,(function(e){return e.x})),t=e.min,n=e.max,r=this.getBoundsOneDim(this.p0.y,this.p1.y,this.p2.y,this.p3.y,(function(e){return e.y})),o=r.min,i=r.max,a=new c.TheoRect(t,o,n,i),s=c.TheoRect.boundsOfPoints([this.p0,this.p1,this.p2,this.p3]);return s.equal(a)||s.contains(a)||l.LegacyCoreAssert.fail("Text path segment bounds incorrect",void 0,"TextPathSegment.getBounds","TextPath.swift",99),a},getBoundsOneDim:function(e,t,n,r,o){var i,a,s=3*r-9*n+9*t-3*e,l=6*e-12*t+6*n,u=3*(-e+t);if(Math.abs(s)<1e-6)a=i=-u/l;else{var c=Math.sqrt(l*l-4*s*u);i=(-l+c)/(2*s),a=(-l-c)/(2*s)}var d=this.checkT(i)?o(this.pointAt(i)):e,h=this.checkT(a)?o(this.pointAt(a)):r;return{min:Math.min(d,h,e,r),max:Math.max(d,h,e,r)}},multiply:function(e){return new r(this._p0.multiplyPoint(e),this._p1.multiplyPoint(e),this._p2.multiplyPoint(e),this._p3.multiplyPoint(e))},offset:function(e){return new r(u._plus_TheoPoint_TheoPoint(this._p0,e),u._plus_TheoPoint_TheoPoint(this._p1,e),u._plus_TheoPoint_TheoPoint(this._p2,e),u._plus_TheoPoint_TheoPoint(this._p3,e))},truncate:function(e){var t=a.clone(this.calculateMidpoints(e)),n=t[3].interpolate(t[4],e);return{prefix:new r(this.p0,t[0],t[3],n),suffix:new r(n,t[4],t[2],this._p3)}},getLength:function(e){if(null!=this._cachedLen&&this._cachedTolerance<=e)return this._cachedLen;for(var t=0,n=0,r=e,o=this.clone();!(o.getPolylineLength()-(t=o.getChordLength())<=e);){r/=2;var i=o.truncate(.5),a=i.prefix,s=i.suffix;n+=a.getLength(r),o=s}return this._cachedLen=n+t,this._cachedTolerance=r,this._cachedLen},getCorrectedLength:function(e,t,n){var r=this.getLength(n),o=u._minus_TheoPoint_TheoPoint(this.p3,this.p2),i=Math.atan2(o.y,o.x);return o=u._minus_TheoPoint_TheoPoint(this.p1,this.p0),(i-=Math.atan2(o.y,o.x))<-Math.PI&&(i+=2*Math.PI),i>Math.PI&&(i-=2*Math.PI),r+(i*=i>0?e:t)},findTValueByCorrectedPrefixLength:function(e,t,n,r){for(var o=r/2,i=0,l=1,u=0,c=0;c<1e3;){u=(i+l)/2;var d=this.truncate(u).prefix.getCorrectedLength(e,t,o);if(Math.abs(n-d)<=o)return u;n<d?l=u:i=u,c+=1}return a.opt(s.Host.logging,(function(e){return e.warning("findTValueByCorrectedPrefixLength did not converge")})),u},encodeJson:function(){var e={};return e[r.PROPERTY_P0]=r.encodePoint(this.p0),e[r.PROPERTY_P1]=r.encodePoint(this.p1),e[r.PROPERTY_P2]=r.encodePoint(this.p2),e[r.PROPERTY_P3]=r.encodePoint(this.p3),e},isEqual:function(e){return this.isEqualWithAccuracy(e,1e-6)},isEqualWithAccuracy:function(e,t){var n;return!!(n=a.as(e,r))&&this.p0.equalWithAccuracy(n.p0,t)&&this.p1.equalWithAccuracy(n.p1,t)&&this.p2.equalWithAccuracy(n.p2,t)&&this.p3.equalWithAccuracy(n.p3,t)},getPolylineLength:function(){return this.p0.distanceTo(this.p1)+this.p1.distanceTo(this.p2)+this.p2.distanceTo(this.p3)},getChordLength:function(){return this.p0.distanceTo(this.p3)},calculateMidpoints:function(e){var t=this.p0.interpolate(this.p1,e),n=this.p1.interpolate(this.p2,e),r=this.p2.interpolate(this.p3,e),o=t.interpolate(n,e),i=n.interpolate(r,e);return[t,n,r,o,i]},checkT:function(e){return e>=0&&e<=1}}}),r),i.TextPath=(o=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=1),this._segments=a.clone(e),this._flex=t},a.defineClass({name:"TextPath",ctor:o,superName:"CoreObject",statics:{decodeFromJson:function(e){var t,n;if(n=e){var r,s=(t=a.as(n[o.PROPERTY_FLEX],"Double"))||null!=t?t:1,l=[];if(r=a.as(n[o.PROPERTY_SEGMENTS],["Array","Any"]))for(var u=a.iter(r);!u.done;u.next()){var c=u.value,d=i.TextPathSegment.decodeFromJson(a.as(c,["Dictionary","String","Any"]));if(null==d)return null;l.push(d)}return new o(l,s)}return null},areSegmentsContiguous:function(e){for(var t=a.iter(a.toSequence(e));!t.done;t.next()){var n=t.value,r=n.offset,o=n.element;if(r<e.length-1){var i=e[r+1];if(!o.p3.equal(i.p0))return!1}}return!0},PROPERTY_FLEX:"flex",PROPERTY_SEGMENTS:"segment"},props:{segments:{get:function(){return this._segments}},numSegments:{get:function(){return this._segments.length}},flex:{get:function(){return this._flex}},isClosed:function(){return!(this.numSegments<2)&&o.areSegmentsContiguous(this._segments)&&a.first(this._segments).p0.equal(a.last(this._segments).p3)},clone:function(){var e=this._segments.map((function(e){return e.clone()}),this);return new o(e,this._flex)},pointAt:function(e){var t;return null!=(t=this.getSegementIndex(e))?this._segments[t].pointAt(e-a.toDouble(t)):u.TheoPoint.INVALID},tangentUnitVectorAt:function(e){var t;return null!=(t=this.getSegementIndex(e))?this._segments[t].tangentUnitVectorAt(e-a.toDouble(t)):u.TheoPoint.INVALID},getBounds:function(){for(var e,t=a.iter(this._segments);!t.done;t.next()){var n=t.value.getBounds();e=null==e?n:e.unionWith(n)}return e||c.TheoRect.Zero},multiply:function(e){var t=this._segments.map((function(t){return t.multiply(new u.TheoPoint(e.width,e.height))}),this);return new o(t,this._flex)},offset:function(e){var t=this._segments.map((function(t){return t.offset(e)}),this);return new o(t,this._flex)},truncate:function(e){if(e>=0&&e<a.toDouble(this.numSegments)){var t=a.toInt(Math.floor(e)),n=a.clone(this._segments),r=n.splice(0,t),i=e-a.toDouble(t);if(i>0){var s=n[0].truncate(i),l=s.prefix,u=s.suffix,c=l;n[0]=u,r.push(c)}return{prefix:new o(r),suffix:new o(n,this._flex)}}return{prefix:new o,suffix:this.clone()}},getLength:function(e){if(0==this.numSegments)return 0;for(var t=e/a.toDouble(this.numSegments),n=0,r=a.iter(this._segments);!r.done;r.next())n+=r.value.getLength(t);return n},getCorrectedLength:function(e,t,n){for(var r=n/a.toDouble(this.numSegments),o=0,i=a.iter(this._segments);!i.done;i.next())o+=i.value.getCorrectedLength(e,t,r);return o},findTValueByCorrectedPrefixLength:function(e,t,n,r){for(var o=r/a.toDouble(this.numSegments),i=n,s=0;s<this.numSegments&&i>0;){var l=this._segments[s].getCorrectedLength(e,t,o);if(i<=l-o){var u=this._segments[s].findTValueByCorrectedPrefixLength(e,t,i,o);return a.toDouble(s)+u}i-=l,s+=1}return a.toDouble(s)},encodeJson:function(){var e={};e[o.PROPERTY_FLEX]=this.flex;for(var t=[],n=a.iter(this.segments);!n.done;n.next()){var r=n.value;t.push(r.encodeJson())}return e[o.PROPERTY_SEGMENTS]=t,e},isEqual:function(e){return this.isEqualWithAccuracy(e,1e-6)},isEqualWithAccuracy:function(e,t){var n;if(n=a.as(e,o)){if(this.numSegments!=n.numSegments||Math.abs(this.flex-n.flex)>t)return!1;for(var r=a.iter(a.toSequence(this.segments));!r.done;r.next()){var i=r.value,s=i.offset;if(!i.element.isEqualWithAccuracy(n.segments[s],t))return!1}return!0}return!1},getSegementIndex:function(e){return e<0||e>a.toDouble(this.numSegments)?null:Math.min(a.toInt(Math.floor(e)),this.numSegments-1)}}}),o)},Bqrm:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("cZuM"),s=n("Z25M"),l=n("FNB+"),u=n("wc1n"),c=n("pnSN"),d=n("fdtz"),h=n("c+uM"),p=n("JO5d"),f=n("8t9B"),m=n("oKlP");o.DesignConstraintFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=i.clone(t),this.featureEvals_=[],u.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"DesignConstraintFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Maxzoomlevel",[this.evaluateMaxZoomLevel,u.FeatureType.Numerical]],["textareanotcontrasting",[this.evaluateForUnreadableText,u.FeatureType.Numerical]],["shapesareanotcontrasting",[this.evaluateForUnreadableShapes,u.FeatureType.Numerical]],["lockupareaoutofbounds",[this.evaluateForOutOfBoundsElements,u.FeatureType.Numerical]],["minfontsize",[this.evaluateMinimumFont,u.FeatureType.Numerical]],["maxfontsize",[this.evaluateMaximumFont,u.FeatureType.Numerical]],["mintextarea",[this.evaluateMinimumText,u.FeatureType.Numerical]],["maxtextarea",[this.evaluateMaximumText,u.FeatureType.Numerical]],["minshapesize",[this.evaluateMinimumShape,u.FeatureType.Numerical]],["maxshapesize",[this.evaluateMaximumShape,u.FeatureType.Numerical]],["lockupareaoverlapping",[this.evaluatePercentageOverlapping,u.FeatureType.Numerical]],["Maxemptyspace",[this.evaluateEmptySpace,u.FeatureType.Numerical]],["textincorrectalign",[this.evaluateIncorrectlyAligned,u.FeatureType.Numerical]],["emptygridsquares",[this.evaluateEmptyGridPercent,u.FeatureType.Numerical]],["overlappingmultiplegridcells",[this.evaluateOverlappingMultipleGridCells,u.FeatureType.Numerical]],["maxaspectratio",[this.evaluateMaxAspectRatio,u.FeatureType.Numerical]],["breakingflowX",[this.evaluateBreakFlowX,u.FeatureType.Numerical]],["breakingflowY",[this.evaluateBreakFlowY,u.FeatureType.Numerical]],["BreakingHorisontalSymmetryinsidevisualparent",[this.evaluateHorisontalSymmetry,u.FeatureType.Numerical]],["marginsaretoosmall",[this.evaluateMargins,u.FeatureType.Numerical]],["balanceofvisualparentX",[this.evaluateBalanceX,u.FeatureType.Numerical]],["balanceofvisualparentY",[this.evaluateBalanceY,u.FeatureType.Numerical]],["totalalignmentlines",[this.evaluateTotalAlignmentLines,u.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateMaxZoomLevel:function(e){for(var t=i.clone(e.root_.filterByKind(d.ImageForma.KIND)),n=m.TheoPoint.ZERO,r=i.iter(t);!r.done;r.next()){var o=r.value.placement.extractedScale.scale;o.length()>n.length()&&(n=o)}return n.length()},evaluateForUnreadableText:function(e){return e.TestUnreadableController(f.TypeLockupController.KIND)},evaluateForUnreadableShapes:function(e){return e.TestUnreadableController(p.ShapeController.KIND)},evaluateForOutOfBoundsElements:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n=e.root_.finalFrame,r=0,o=0,a=i.iter(t);!a.done;a.next()){var s,l;(s=a.value.finalFrame)&&(o+=s.area,(l=n.intersectionWith(s))&&(r+=l.area))}return(o-r)/Math.max(1e-5,o)},evaluateMinimumFont:function(e){for(var t,n=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.controller.kind==f.TypeLockupController.KIND}))),r=null,o=i.iter(n);!o.done;o.next()){var a=o.value.controller.averageLineHeight;0!=a&&(null==r||a<r)&&(r=a)}return(t=r)||null!=t?t:0},evaluateMaximumFont:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.controller.kind==f.TypeLockupController.KIND}))),n=0,r=i.iter(t);!r.done;r.next()){var o=r.value.controller.averageLineHeight;o>n&&(n=o)}return n},evaluateMinimumText:function(e){return e.getMinControllerArea(f.TypeLockupController.KIND)},evaluateMaximumText:function(e){return e.getMaxControllerArea(f.TypeLockupController.KIND)},evaluateMinimumShape:function(e){return e.getMinControllerArea(p.ShapeController.KIND)},evaluateMaximumShape:function(e){return e.getMaxControllerArea(p.ShapeController.KIND)},evaluatePercentageOverlapping:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))),n=[],r=i.iter(t);!r.done;r.next()){var o=r.value;n.push(o.finalFrame)}for(var a=0,s=0,l=0,u=i.iter(n);!u.done;u.next()){var c=u.value;s+=c.area;for(var d=i.iter(i.range(0,l,!1));!d.done;d.next()){var h=d.value,p=c.intersectionWith(n[h]);null!=p&&(a+=p.area)}l+=1}return 2*a/s},evaluateEmptySpace:function(e){return s.DesignFeatureUtils.evaluateRootEmptySpace(e.root_)},evaluateIncorrectlyAligned:function(e){var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))),n=t.filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(n.length<=1)return 0;for(var r=0,o=i.iter(n);!o.done;o.next()){var l=o.value,u=i.clone(l.controller.alignmentDetector.detectFormaAlignments(a.AlignmentDetector.DISTANCE_THRESHOLD)),c=i.clone(s.DesignFeatureUtils.getLockupsWithin(l,n,300));i.clone(s.DesignFeatureUtils.getSetDiff(c,u)).length>0&&(r+=1)}return r/i.toDouble(t.length)},evaluateEmptyGridPercent:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return e.isGridCell()}))),n=0,r=i.iter(t);!r.done;r.next()){var o=r.value,a=i.clone(e.root_.filterWithCallback((function(e){return null!=e.finalFrame&&null!=e.controller&&(e.finalFrame.intersects(o.finalFrame)||e.finalFrame.contains(o.finalFrame))&&e.controller.floating})));o.isShape()&&0==a.length&&(n+=1)}return n/i.toDouble(t.length)},evaluateOverlappingMultipleGridCells:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&(e.isGridCell()||e.isShape())}))),r=0,o=i.iter(t);!o.done;o.next()){var a=o.value;a.kind==c.GroupForma.KIND?r+=e.groupOverlapHelper(a,n):r+=e.overlapHelper(a,n)}return r},evaluateMaxAspectRatio:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return e.isGridCell()}))),n=0,r=i.iter(t);!r.done;r.next()){var o=r.value.finalFrame;if(o.area>0){var a=(o.width>o.height?o.width:o.height)/(o.width>o.height?o.height:o.width);a>n&&(n=a)}}return n},evaluateBreakFlowX:function(e){return e.breakFlowHelper(!0)},evaluateBreakFlowY:function(e){return e.breakFlowHelper(!1)},evaluateHorisontalSymmetry:function(e){var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));if(0==t.length)return 0;for(var n=0,r=i.iter(t);!r.done;r.next()){var o=r.value,s=o.finalFrame.center.x,l=o.controller.visualParent.finalFrame.center.x,u=a.AlignmentDetector.DISTANCE_THRESHOLD;Math.abs(s-l)>u&&(n+=Math.exp(2*u-Math.abs(s-l)))}return n},evaluateMargins:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n=0,r=i.iter(t);!r.done;r.next()){var o=r.value,a=e.getMinMarginHelper(o);n+=Math.exp(9-a)}return n>9999999?9999999:n},evaluateBalanceX:function(e){return e.balanceHelper(!0)},evaluateBalanceY:function(e){return e.balanceHelper(!1)},evaluateTotalAlignmentLines:function(e){var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))).filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(t.length<=1)return 0;for(var n=0,r=[],o=i.iter(t);!o.done;o.next()){var s=o.value,u=i.clone(s.controller.alignmentDetector.detectFormaAlignments(a.AlignmentDetector.DISTANCE_THRESHOLD));if(u.length>0){for(var c=[],d=i.iter(u);!d.done;d.next()){var h=d.value;if(null!=h.forma){var p=h.forma;null!=p.controller&&p.controller.floating&&(p.isTypeLockup()||p.isShape())&&c.push(h.forma)}}for(var f=i.iter(c);!f.done;f.next()){var m=f.value;if(!i.containsEq(r,m,l._equality_Forma_Forma)){for(var g=i.iter(c);!g.done;g.next()){var y=g.value;i.containsEq(r,y,l._equality_Forma_Forma)||r.push(y)}i.containsEq(r,s,l._equality_Forma_Forma)||r.push(s),n+=1;break}}}}return n},TestUnreadableController:function(e,t,n){void 0===t&&(t=5),void 0===n&&(n=.05);var r=i.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e})));if(0==r.length)return 0;for(var o=0,a=0,s=i.iter(r);!s.done;s.next()){for(var l=s.value,u=[],c=l.finalFrame,d=!!l.isTypeLockup()&&l.style.textLook==h.LockupTextLook.Shadow,p=i.clone(c.split(t,!0)),f=i.iter(p);!f.done;f.next()){var m=f.value,g=i.clone(m.split(t,!1));i.append(u,g)}for(var y=0,_=i.iter(u);!_.done;_.next()){var T=_.value,v=l.controller.getBackgroundColor(T),C=l.style.colors.fieldPrimary,P=l.style.colors.fieldSecondary;null!=C&&null!=v&&(v.contrasts(C,!1)||null!=P&&!d&&v.contrasts(P,!1)||(y+=1))}y/i.toDouble(t*t)>n&&(o+=c.area),a+=c.area}return o/a},getMaxControllerArea:function(e){for(var t=i.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e}))),n=0,r=i.iter(t);!r.done;r.next()){var o=r.value.finalFrame.area;o>n&&(n=o)}return n},getMinControllerArea:function(e){for(var t=i.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e}))),n=null,r=i.iter(t);!r.done;r.next()){var o=r.value.finalFrame.area;0!=o&&(null==n||o<n)&&(n=o)}return null==n?0:n},overlapHelper:function(e,t){for(var n=0,r=e.finalFrame,o=i.iter(t);!o.done;o.next()){var a=o.value,s=a.finalFrame;if(!s.contains(r)&&e.controller.visualParent.formaID==a.controller.visualParent.formaID||e.controller.visualParent.formaID==this.root_.formaID){var l=s.intersectionWith(r);null!=l&&l.area/r.area<.5&&(n+=.5-l.area/r.area)}}return n},groupOverlapHelper:function(e,t){for(var n=0,r=e.childrenFinalFrame,o=i.iter(t);!o.done;o.next()){var a=o.value,s=a.finalFrame;if(!s.contains(r)&&e.controller.groupVisualParent.formaID==a.controller.visualParent.formaID||e.controller.groupVisualParent.formaID==this.root_.formaID){var l=s.intersectionWith(r);null!=l&&l.area/r.area<.5&&(n+=.5-l.area/r.area)}}return n},balanceHelper:function(e){for(var t=i.clone(this.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n={},r={},o=i.iter(t);!o.done;o.next()){var a=o.value;null==n[(c=a.controller.visualParent).formaID]?(n[c.formaID]=[a],r[c.formaID]=c.finalFrame):n[c.formaID].push(a)}for(var s=0,l=0,u=i.iter(n);!u.done;u.next()){for(var c=u.key,d=u.value,h=e?r[c].center.x:r[c].center.y,p=0,f=0,m=i.iter(d);!m.done;m.next()){var g=m.value.finalFrame,y=e?g.center.x:g.center.y,_=e?g.width:g.height,T=y-_/2;if(h>y+_/2)p+=g.area;else if(h<T)f+=g.area;else{var v=(h-T)/_;p+=g.area*v,f+=g.area*(1-v)}}s+=Math.abs(p-f),l+=p+f}return s/l},breakFlowHelper:function(e){var t=i.clone(this.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()})));if(0==t.length)return 0;for(var n=0,r=i.iter(t);!r.done;r.next())for(var o=r.value,a=o.controller.averageLineHeight,s=e?o.finalFrame.center.x:o.finalFrame.center.y,u=e?o.finalFrame.minX:o.finalFrame.minY,c=i.iter(t);!c.done;c.next()){var d=c.value;if(i.eq(l._equality_Forma_Forma,o,d))break;var h=d.controller.averageLineHeight,p=e?d.finalFrame.center.x:d.finalFrame.center.y,f=e?d.finalFrame.minX:d.finalFrame.minY;if(h>a){var m=p-s,g=f-u;if((g<m?g:m)>0){n+=1;break}}}return 2*n/i.toDouble(t.length)},getMinMarginHelper:function(e){var t,n;e.kind==c.GroupForma.KIND?(t=e.childrenFinalFrame,n=e.controller.groupVisualParent.finalFrame):(t=e.finalFrame,n=e.controller.visualParent.finalFrame);var r=n.maxY-t.maxY;return t.minX-n.minX<r&&(r=t.minX-n.minX),t.minY-n.minY<r&&(r=t.minY-n.minY),n.maxX-t.maxX<r&&(r=n.maxX-t.maxX),r}}}),r)},Bqrn:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("9Lk3"),c=n("pnSN"),d=n("RBTN"),h=n("fNpk"),p=n("Ird5"),f=n("jfma"),m=n("yjxF"),g=n("Aj79"),y=n("g6aL"),_=n("8t9B"),T=n("QgdZ");a.gvar(i,"_groupSingleton",(function(){return new i.GroupFormaToPGMMapper})),a.gvar(i,"_typeLockupSingleton",(function(){return new T.TypeLockupToPGMMapper})),a.gvar(i,"_gridSingleton",(function(){return new d.GridToPGMMapper})),i.GroupFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},a.defineClass({name:"GroupFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=c.GroupForma.KIND),o.FORMA_KIND}},createMapper:function(e){var t;if(t=e.controller){if(t instanceof _.TypeLockupController)return i._typeLockupSingleton;if(t instanceof u.GridController)return i._gridSingleton}return i._groupSingleton}},props:{makePGMRef:function(e,t,n,r){var o,i;if((o=a.as(e,c.GroupForma))&&(i=n.childReferences(o))){var u=s.FormaToPGMMapper.mapBlendMode(e);return l.FormaToPGMUtils.applyAnimations(t,e,new g.PGMReference(new y.PGMSimpleGroup(o.formaID,new m.PGMNodeMetadata(o.formaID,"group"),p.PGMAnimationList.EMPTY,i),new f.PGMCompositingParams(o.placement,o.style.opacity,u)))}return h.LegacyCoreAssert.fail("group forma child reference generation failed",void 0,"GroupFormaToPGMMapper.makePGMRef","GroupFormaToPGMMapper.swift",66),null}}}),r)},C42b:function(e,t){var n,r=(n={rng:void 0,getRng:function(){return void 0===this.rng&&(this.rng={w:32,n:624,m:397,r:31,f:1812433253,a:-1727483681,stdCDefaultSeed:5489,u:11,d:-1,s:7,b:-1658038656,t:15,c:-272236544,l:18,state:[],index:625,lowerMask:2147483647,upperMask:-2147483648,randMax:2147483647,twist:function(){for(var e=0;e<this.n;e++){var t=(this.state[e]&this.upperMask)+(this.state[(e+1)%this.n]&this.lowerMask),n=t>>1;t%2!=0&&(n^=this.a),this.state[e]=this.state[(e+this.m)%this.n]^n}this.index=0},mulDiscardOverflow:function(e,t){var n=65535&e,r=65535&t;return(((-65536&e)>>16&65535)*r+n*((-65536&t)>>16&65535)<<16&this.randMax)+n*r&this.randMax},seed:function(e){this.state=new Array(this.n).fill(0),this.index=this.n,this.state[0]=e;for(var t=1;t<this.n;t++){var n=this.state[t-1];this.state[t]=this.mulDiscardOverflow(this.f,n^n>>this.w-2)+t}},nextInt:function(){this.index>=this.n&&(this.index>this.n&&this.seed(this.stdCDefaultSeed),this.twist());var e=this.state[this.index];return e^=e>>this.u&this.d,e^=e<<this.s&this.b,e^=e<<this.t&this.c,e^=e>>this.l,this.index+=1,e&this.randMax},nextIntUniform:function(e){var t=this.nextInt(),n=this.randMax%e+1;if(n!=e)for(var r=this.randMax-n;t>r;)t=this.nextInt();return t%e}}),this.rng},seedRandom:function(e){this.getRng().seed(e)},nextIntUniform:function(e){return this.getRng().nextIntUniform(e)}},Object.defineProperty(n,"nextInt",{get:function(){return n.getRng().nextInt()}}),Object.defineProperty(n,"randMax",{get:function(){return n.getRng().randMax}}),n.seedRandom((new Date).getTime()),n);e.exports={CoreRandom:r}},C4JV:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ytEx"),s=n("3OP7"),l=n("iCxV"),u=n("CqFS"),c=n("fNpk"),d=n("9YN4");o.PROPERTY_VALUE_CANVASES="canvases",o.PROPERTY_VALUE_CANVAS="canvas",o.PROPERTY_VALUE_CANVAS1_NAME="page-1",o.PROPERTY_VALUE_ARTBOARD="artboard",o.PROPERTY_VALUE_ARTBOARD1_NAME="artboard-1",i.gvar(o,"CANVASES_PATH",(function(){return"/"+o.PROPERTY_VALUE_CANVASES})),i.gvar(o,"CANVAS1_PATH",(function(){return o.CANVASES_PATH+"/"+o.PROPERTY_VALUE_CANVAS1_NAME})),i.gvar(o,"ARTBOARD1_PATH",(function(){return o.CANVAS1_PATH+"/"+o.PROPERTY_VALUE_ARTBOARD1_NAME})),i.gvar(o,"JSON_CONTENT_PATH_DCX2D",(function(){return o.ARTBOARD1_PATH+"/"+d.TheoDocument.COMPONENT_PATH_CONTENT})),o.PROPERTY_KEY_UNITS="units",o.PROPERTY_KEY_WIDTH="width",o.PROPERTY_KEY_HEIGHT="height",o.PROPERTY_KEY_X="x",o.PROPERTY_KEY_Y="y",i.gvar(o,"PROPERTY_KEY_MINISAVE",(function(){return s.DocumentPersistenceFactory.namespacedPropertyName("minisave")})),o.JSONDocumentEncoder=(r=function(e){this.isMiniSave=!1,this.previouslyUsedJSONDocumentEncoding=s.DocumentPersistenceFactory.usesJsonDocumentEncoding(e),u.JSONNodeEncoder.call(this,e,{},null);var t=[d.TheoDocument.COMPONENT_RELATIONSHIP_DOM,d.TheoDocument.COMPONENT_RELATIONSHIP_METADATA,d.TheoDocument.COMPONENT_RELATIONSHIP_RENDITION,o.PROPERTY_VALUE_CANVASES];this.prepareCompositeForSave(t)},i.defineClass({name:"JSONDocumentEncoder",ctor:r,superName:"JSONNodeEncoder",statics:{_implements:function(e){return"IExportDataObject"==e}},props:{getOrCreateArtboardNode:function(){var e=this.branch_.getNodeWithAbsolutePath(o.ARTBOARD1_PATH);if(null==e){var t=this.branch_.appendNode(null,o.PROPERTY_VALUE_CANVASES,null);i.opt(t,(function(e){return e.setValue(a.PROPERTY_KEY_RELATIONSHIP,i.as(o.PROPERTY_VALUE_CANVASES,"AnyObject"))}));var n=this.branch_.appendNode(null,o.PROPERTY_VALUE_CANVAS1_NAME,t);i.opt(n,(function(e){return e.setValue(a.PROPERTY_KEY_RELATIONSHIP,i.as(o.PROPERTY_VALUE_CANVAS,"AnyObject"))})),e=this.branch_.appendNode(null,o.PROPERTY_VALUE_ARTBOARD1_NAME,n),i.opt(e,(function(e){return e.setValue(a.PROPERTY_KEY_RELATIONSHIP,i.as(o.PROPERTY_VALUE_ARTBOARD,"AnyObject"))})),i.opt(e,(function(e){return e.setValue(a.PROPERTY_KEY_NAME,i.as(o.PROPERTY_VALUE_ARTBOARD1_NAME,"AnyObject"))}))}return e},getPropertyOnNode:function(e){return e==a.PROPERTY_KEY_ID||e==a.PROPERTY_KEY_NAME?i.as(this.branch_.getValue(e),"AnyObject"):u.JSONNodeEncoder.prototype.getPropertyOnNode.call(this,e)},setPropertyOnNode:function(e,t){if(e==a.PROPERTY_KEY_NAME)return this.branch_.setValue(e,t);if(u.JSONNodeEncoder.prototype.setPropertyOnNode.call(this,e,t),!this.previouslyUsedJSONDocumentEncoding)switch(e){case"name":case"type":case"children":break;default:this.branch_.root.removeValue(e)}},setDocumentSize:function(e,t){var n,r=this.getOrCreateArtboardNode();r.setValue(o.PROPERTY_KEY_X,i.as(0,"AnyObject")),r.setValue(o.PROPERTY_KEY_Y,i.as(0,"AnyObject")),r.setValue(o.PROPERTY_KEY_WIDTH,i.as(e.width,"AnyObject")),r.setValue(o.PROPERTY_KEY_HEIGHT,i.as(e.height,"AnyObject")),(n=this.branch_.getNodeWithAbsolutePath(o.CANVAS1_PATH))?n.setValue(o.PROPERTY_KEY_UNITS,i.as(t,"AnyObject")):c.LegacyCoreAssert.fail("expected to find a canvas node",void 0,"JSONDocumentEncoder.setDocumentSize","JSONDocumentEncoder.swift",120)},finish:function(){var e,t=this;u.JSONNodeEncoder.prototype.finish.call(this),this.discardStashedComponents(),this.jsonFile=(e=this.jsonFile)||null!=e?e:i.opt(l.Host.persistUtils,(function(e){return e.writeJsonContentToTempFile(i.as(t.jsonNode_,"AnyObject"))}));var n=this.branch_.getComponentWithAbsolutePath(o.JSON_CONTENT_PATH_DCX2D);if(null!=n)n=this.branch_.updateComponent(n,this.jsonFile,!1);else{var r=this.getOrCreateArtboardNode();n=this.branch_.addComponent(d.TheoDocument.COMPONENT_NAME_DOM,null,d.TheoDocument.COMPONENT_MIME_TYPE_DOCUMENT_JSON,d.TheoDocument.COMPONENT_RELATIONSHIP_DOM,d.TheoDocument.COMPONENT_PATH_CONTENT,r,this.jsonFile,!1,null)}if(null!=n){var a=n.mutableCopy;a.setValue(o.PROPERTY_KEY_MINISAVE,i.as(this.isMiniSave,"AnyObject")),this.branch_.updateComponent(a,null,!1)}}}}),r)},C654:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("FNB+"),s=n("3/rh"),l=n("Pn67"),u=n("nQ+V"),c=n("pmb0"),d=n("nUE5"),h=n("K17h"),p=n("RkYL"),f=n("zjod"),m=n("mxdD");o.ANIMATE_ICON=!1,o.MotionLogicStackedRoot=(r=function(){},i.defineClass({name:"MotionLogicStackedRoot",ctor:r,statics:{_implements:function(e){return"MotionLogic"==e}},props:{apply:function(e,t,n){var r,g,y,_,T=(r=i.as(n.lineDur,"Double"))||null!=r?r:1,v=(g=i.as(n.delay,"Double"))||null!=g?g:0,C=(y=i.as(n.fadeInDur,"Double"))||null!=y?y:1,P=(_=i.as(n.endPadDur,"Double"))||null!=_?_:0,S=0,D=[],A=[],E=[],R=new l.MotionEntryNone,F=new s.MotionEntryFadeIn,b=new u.MotionEntryStacked;e.visitAll(a.FormaTraversal.PreOrder,(function(e){var t;if(c.MotionFacade.applyEntryToForma(e,R),e.isTypeLockup())D.push(e);else if(t=i.as(e,f.VideoForma)){var n;t.isSticker()?(A.push(t),(n=h.MotionUtils.getGifDur(t)-C)>P&&(P=n)):(n=m.VideoFacade.getDurationInSecondsForVideo(t))>S&&(S=n)}else o.ANIMATE_ICON&&e.hasIntent(a.Forma.INTENT_ICON)&&E.push(e)}));var I=0,O=D.length>1||E.length>0;if(0==A.length&&(P=2),D.length>0){for(var k=i.clone(h.MotionUtils.getTitleLockups(D)),N=i.clone(k.shift()),M=i.clone(k.shift()),L=I,x=i.iter(N);!x.done;x.next()){var B,w=x.value,G=d.MotionSource.getSourceAnimation(b.srcId,w);b.logic.apply(w,G,{lineDur:T,endPadDur:O?v:0}),null!=(B=i.opt(w.animation,(function(e){return e.endTime.seconds})))&&B>L&&(L=B)}I=L;for(var Y=i.iter(M);!Y.done;Y.next()){var U=Y.value;G=d.MotionSource.getSourceAnimation(F.srcId,U),F.logic.apply(U,G,{st:I,dur:C})}}if(o.ANIMATE_ICON)for(var j=i.iter(E);!j.done;j.next()){var V=j.value;G=d.MotionSource.getSourceAnimation(F.srcId,e),F.logic.apply(V,G,{st:I,dur:C})}O&&(I+=C);var H=I+P;if(S>0&&(H=Math.ceil(H/S)*S,0==!A.length&&(H-=C)),A.length>0){H+=C;for(var K=i.iter(A);!K.done;K.next()){var W=K.value;G=d.MotionSource.getSourceAnimation(F.srcId,W),F.logic.apply(W,G,{st:I,dur:C}),i.opt(W.animation,(function(e){return e.endTime=p.TheoTime.fromSeconds(H)}))}}i.opt(e.animation,(function(e){return e.animationStyle.endTime=p.TheoTime.fromSeconds(H)}))}}}),r)},CWW7:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("Tq01"),u=n("KSe6"),c=n("kYI4"),d=n("SpAV"),h=n("yvDn"),p=n("vYM0"),f=n("gXiO"),m=n("yGNn"),g=n("T9pj"),y=n("FNB+"),_=n("QgZx"),T=n("cmoc"),v=n("V3yt"),C=n("ZK0l"),P=n("pnSN"),S=n("X0GW"),D=n("iCxV"),A=n("2rlr"),E=n("8vXU"),R=n("U010"),F=n("q5zr"),b=n("fdtz"),I=n("lmwz"),O=n("fNpk"),k=n("MYNe"),N=n("c+uM"),M=n("tGKA"),L=n("VkKB"),x=n("K17h"),B=n("uxH+"),w=n("K0Rh"),G=n("JO5d"),Y=n("djAF"),U=n("35Q0"),j=n("lJxM"),V=n("T6jX"),H=n("8t9B"),K=n("1NAc"),W=n("LGJg"),X=n("sW6f"),z=n("WWR6"),q=n("zjod"),Z=n("QTen");a.FloatingImageStrategy=s.defineEnum("FloatingImageStrategy",{IfHasAlphaOrIsLogo:0,Always:1,Never:2}),a.AddFormaParentingHint=s.defineEnum("AddFormaParentingHint",{defaultHandling:0,addToRoot:1,doNotAddFormaForContentToTree:2}),a.AddFormaParams=(r=function(e,t,n,r,o,i){void 0===e&&(e=l.ControllerSettingsBehaviorEnum.IgnoreControllerSettings),void 0===t&&(t=!0),void 0===n&&(n=null),void 0===r&&(r=a.FloatingImageStrategy.IfHasAlphaOrIsLogo),void 0===o&&(o=a.AddFormaParentingHint.defaultHandling),void 0===i&&(i=null),this.behavior=e,this.suggestPlacement=t,this.formaToReplace=n,this.floatingImageStrategy=r,this.parentingHint=o,this.atPagePoint=i},o={},s.defineClass({name:"AddFormaParams",ctor:r,superName:"CoreObject",statics:{DEFAULTS:{get:function(){return void 0===o.DEFAULTS&&(o.DEFAULTS=new r),o.DEFAULTS}},makeWithFormaToReplace:function(e){return new r(void 0,void 0,e)},makeWithFormaToReplace:function(e,t){return new r(void 0,void 0,e,void 0,t)}}}),r),a.CreationFacade=function(){var e=function(){f.CoreObject.call(this)},t={};return s.defineClass({name:"CreationFacade",ctor:e,superName:"CoreObject",statics:{addImage:function(t,n,r,o,i,l,u,c,d,h){var p,f,g,y,_,T;if(void 0===o&&(o=null),void 0===i&&(i=null),void 0===l&&(l=null),void 0===u&&(u=!1),void 0===c&&(c=a.AddFormaParams.DEFAULTS),void 0===d&&(d=null),void 0===h&&(h=null),(y=t.document)&&(_=y.controller)&&(T=s.as(y.content.createNode(F.ImageContentNode.KIND,null),F.ImageContentNode))){var v;if(null==T.componentID&&null!=h&&(T.componentID=h),T.url=n,T.mimeType=r,v=d)for(var C=s.iter(v);!C.done;C.next()){var P=C.key,S=C.value;T.setTag(P,S)}return T.whenLoaded().then((function(t){var n;return(n=s.as(t,A.HostImage))&&(u&&T.createImageFeatures(),T.hasAlpha=(p=l)||null!=p?p:n.hasAlpha(),T.pixelWidth=(f=o)||null!=f?f:n.getWidth(),T.pixelHeight=(g=i)||null!=g?g:n.getHeight()),e.addImageForContentNode(_.document.firstPage,T,c)}))}return m.CorePromise.reject("document has no controller or imageCN was nil")},addImageForContentNode:function(t,n,r){return e.addContent(t,n,null,!1,r).then((function(e){var n;return(n=s.as(e,y.Forma))?(n.isImage()&&V.TheoDocumentUtils.updateConstrainedImageInfo(t.document),n):(O.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"CreationFacade.addImageForContentNode","CreationFacade.swift",167),null)}))},addLibraryShape:function(e,t,n,r){var o;return(o=s.as(e.createFormaWithController(Y.ShapeForma.KIND,G.ShapeController.KIND),Y.ShapeForma))?(e.root.appendChild(o),o.intent=y.Forma.INTENT_ICON,U.ShapeLibrary.applyToShapeForma(o,t),o.style.colors.fieldPrimary=r,o.controller.fit(n),m.CorePromise.resolve(o)):m.CorePromise.reject("could not create shape forma")},addText:function(t,n,r,o){return void 0===o&&(o=a.AddFormaParams.DEFAULTS),D.Host.textModelUtils.defaultFont().availability!=_.FontAvailability.LOADED?(s.opt(D.Host.logging,(function(e){return e.logToNewRelic(E.RemoteLoggingEvent.ADD_TEXT_FONT_UNAVAILABLE_ERROR,{})})),m.CorePromise.reject(new h.CoreStringError(g.ErrorMessageConstants.kAddTextMissingFontError,!0))):(i=t.document)?m.CorePromise.resolve(null).then((function(t){var a;return(a=s.as(i.content.createNode(j.TextContentNode.KIND,null),j.TextContentNode))?(a.text=n,e.addContent(i.firstPage,a,void 0,void 0,o).then((function(e){var t;return(t=s.as(e,y.Forma))?t:(O.LegacyCoreAssert.fail("Unexpected result from AddContentAction, expected a Forma",void 0,"CreationFacade.addText","CreationFacade.swift",228),null)})).then((function(e){return r?(t=s.as(e,y.Forma))&&(n=s.as(t.controller,H.TypeLockupController))&&(o=s.as(t.style,N.LockupStyle))&&(i=o.font)?v.FontFacade.ensureFontLoaded(i.fontData).then((function(e){return n.updateGroup(),t})):m.CorePromise.reject("unable to inspect created lockup for style and font"):e;var t,n,o,i}))):m.CorePromise.reject("textCN is nil")})):m.CorePromise.reject("document has no controller");var i},duplicateItems:function(t,n,r,o){var i,a;void 0===o&&(o=!1);var l=s.clone(k.LayerFacade.sortInZOrder(t));return e.copyItems(l,null).then((function(e){var t=s.clone(e);if(0==!t.length){if(n&&t.forEach((function(e){return e.move(M.Matrix2D.translationXY(25,25))})),r)t[0].page.document.controller.selection.replaceSelectionWithFormae(t);if(t.length==l.length)for(var u=s.iter(s.toSequence(l));!u.done;u.next()){var c=u.value,d=c.offset,h=c.element,p=t[d],f=k.LayerFacade.getZOrder(h),m=k.LayerFacade.getReorderableLayerCount(p)+k.LayerFacade.getMinLayerIndex(p)-1,g=Math.min(f+1,m);1==o?(k.LayerFacade.setZOrder(f,p),k.LayerFacade.setZOrder(g,h)):k.LayerFacade.setZOrder(g,p)}else s.opt(D.Host.logging,(function(e){return e.info("copyItems failed to copy all items")}));if(((i=s.opt(s.opt(t[0].page.document,(function(e){return e.controller})),(function(e){return e.enableMoveableChildren})))||null!=i)&&i&&l.length==t.length)for(var y=s.iter(s.range(0,l.length,!1));!y.done;y.next()){var _=y.value;((a=s.opt(l[_].controller,(function(e){return e.userGroupChild})))||null!=a)&&a&&s.opt(l[_].parent,(function(e){return e.appendChild(t[_])}))}}return t}))},fixUpColorReferences:function(e,t,n,r,o,i){t?p.ColorLibraryMap.remapColors(e,n,r,i):p.ColorLibraryMap.detachFromLibrary(e,n,o)},remapReferences:function(t,n,r,o){if(!s.opt(t.controller,(function(e){return 1==e.userGroup}))){if(t.page!=n.page){var i,a,l,u,c=t.style,d=n.style;if((i=c.colorLibrary)&&(a=d.colorLibrary))e.fixUpColorReferences(d.colors,o,i,a,n.page.colorLibraryController,r),(l=s.as(d,N.LockupStyle))&&(u=l.characterStyles[H.TypeLockupController.HIGHLIGHT_STYLE])&&e.fixUpColorReferences(u.colors,o,i,a,n.page.colorLibraryController,r)}var h,p,f,m;(h=s.as(t,T.FrameForma))&&(p=s.as(n,T.FrameForma))&&(f=h.image)&&(m=p.image)&&e.remapReferences(f,m,r,o)}},copyItemsState:{get:function(){return void 0===t.copyItemsState&&(t.copyItemsState=new a.CopyItemsState),t.copyItemsState},set:function(e){t.copyItemsState=e}},copyItems:function(t,n,r,o,i){if(void 0===n&&(n=null),void 0===r&&(r=!0),void 0===o&&(o=null),void 0===i&&(i=null),0==t.length)return m.CorePromise.resolve([]);var a;if(a=t[0].page.document){var l=t.filter((function(e){return s.opt(e.controller,(function(e){return 1==e.duplicatable}))}),this);if(0==l.length)return m.CorePromise.resolve([]);e.copyItemsState.onStart(r);var u=[],c=!1,d=m.CorePromise.resolve(null);return l.forEach((function(t){d=d.then((function(r){return t.controller.copyTo(n,o,i).then((function(n){var r;return(r=s.as(n,y.Forma))?(r.isImage()&&(c=!0),e.remapReferences(t,r,e.copyItemsState.mappingCache,e.copyItemsState.mapColorsToTheme),u.push(r),r):null}))}))})),d.then((function(t){return c&&V.TheoDocumentUtils.updateConstrainedImageInfo(s.opt(n,(function(e){return e.document}))||a),e.copyItemsState.onEnd(),u}))}return m.CorePromise.reject("copyItems: no document?")},deleteFormae:function(e,t){var n,r;if(e.length>0&&(r=e[0].page.document)){for(var o,i,a=!1,l=!1,d=!1,h=s.iter(e);!h.done;h.next()){var p=h.value;if(!(p instanceof w.RootForma)){var f;if(p.isImage()&&(l=!0),p.isLogo()?c.BrandingFacade.isImageBrandedLogo(p)&&(a=!0):p.isTypeLockup()&&c.BrandingFacade.doesLockupUseBrandedFonts(p)&&(a=!0),p.isVideo()&&(d=!0),r.controller.selection.isSelected(p)&&r.controller.selection.deselectForma(p),f=p.parent){var m=p.parent;for(s.opt(s.as(f.controller,C.GroupController),(function(e){return e.removeFormaFromGroup(p)}));((n=s.opt(s.opt(m,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=n)&&n;){var g=m.parent;m.childCount<=1?S.GroupFacade.ungroupItems([m]):S.GroupFacade.updateUserGroupBounds(m),m=g}}var y=p.controller.settings;null!=y&&y==p.page.document.controller.controllerSettingsState.settings&&(p.page.document.controller.controllerSettingsState.settings=null)}}if(o=s.as(r.firstPage.root.controller,B.RootController))(i=o.getGridController())&&i.onFormaeDeleted(e);u.AnimationLibrary.updateCurrentStyle(r,d),a&&c.BrandingFacade.unBrandDocumentIfNoBrandedElements(r),l&&V.TheoDocumentUtils.updateConstrainedImageInfo(r)}s.opt(t,(function(e){return e()}))},addContentNodeToDocument:function(e,t){var n;(n=e)&&null==n.parent&&t.content.root.appendChild(n)},removeContentNodeFromDocument:function(e,t){var n;(n=e)&&t.content.root.removeChild(n)},addContent:function(t,n,r,o,i){var l,c;if(void 0===r&&(r=null),void 0===o&&(o=!1),void 0===i&&(i=a.AddFormaParams.DEFAULTS),(l=t.document)&&(c=l.controller)){var d;if(e.addContentNodeToDocument(n,l),e.addContentNodeToDocument(r,l),x.MotionUtils.invalidateAnimation(l),d=e.createFormaFromContent(t,n,r)){var h,p;if((h=i.formaToReplace)&&(p=s.as(s.opt(h.parent,(function(e){return e.controller})),C.GroupController))){var f=I.ImageFacade.getCutoutModeForForma(h);return(f==R.CutoutMode.Off?m.CorePromise.resolve(null):I.ImageFacade.createAndLoadCutoutMaskForReplacementImage(d,f)).then((function(e){var t,n,r,i=h.finalFrame;return p.replaceChildWithForma(h,d,o),u.AnimationLibrary.updateCurrentStyle(l,d.isVideo()),(t=s.as(e,b.ImageForma))&&(n=s.as(d,T.FrameForma))&&(r=s.as(h,T.FrameForma))&&I.ImageFacade.finalizeCutoutAfterMaskLoad(n,t,f,r,i),d}))}return i.parentingHint==a.AddFormaParentingHint.doNotAddFormaForContentToTree?m.CorePromise.resolve(d):e.addForma(c.document.firstPage,d,i).thenReturn(d)}return m.CorePromise.reject("Could not create forma from content")}return m.CorePromise.reject("No related document, or controller")},addForma:function(e,t,n){var r;return void 0===n&&(n=a.AddFormaParams.DEFAULTS),(r=t.controller)?r.addForma(e,t,n).then((function(r){var o;return t.isImage()&&V.TheoDocumentUtils.updateConstrainedImageInfo(e.document),(o=e.document)&&u.AnimationLibrary.updateCurrentStyle(o,t.isVideo()),n.behavior==l.ControllerSettingsBehaviorEnum.SetControllerSettings&&s.opt(s.opt(e.document,(function(e){return e.controller})),(function(e){return e.controllerSettingsState.settings=s.opt(t.controller,(function(e){return e.settings}))})),null})):m.CorePromise.resolve(null)},createFormaFromContent:function(e,t,n){var r,o,i,a,l,u,d;if((o=e.document)&&(i=o.controller))if(a=s.as(t,F.ImageContentNode)){var h=e.createForma(b.ImageForma.KIND);if(h.contentID=t.id,t.getTag(F.ImageContentNode.IMAGE_MASK_ROLE_TAG)==F.ImageContentNode.ROLE_MASK)r=h;else{switch(s.opt(a.mediaMetadata,(function(e){return e.designIntent}))){case"logo":null!=a.sparkElementID&&""!=a.sparkElementID&&c.BrandingFacade.brandDocumentForElement(o,a.sparkElementID,c.AUTHORING_CONTEXT_TYPE_LOGO),h.intent=y.Forma.INTENT_LOGO;break;case"pattern":h.intent=y.Forma.INTENT_PATTERN;break;case"icon":h.intent=y.Forma.INTENT_ICON;break;case"floating-image":h.intent=y.Forma.INTENT_FLOATING_IMAGE}(f=e.createForma(T.FrameForma.KIND)).appendChild(h),r=f}}else if(l=s.as(t,X.VideoContentNode)){var p,f,m=e.createForma(q.VideoForma.KIND);m.videoContentNode=l,(p=s.as(m.style,Z.VideoStyle))&&(p.duration=l.duration),null!=n&&(m.contentID=n.id),(f=e.createForma(T.FrameForma.KIND)).appendChild(m),r=f,s.opt(s.opt(m.contentNode,(function(e){return e.mediaMetadata})),(function(e){return e.designIntent==L.MediaMetadata.DESIGNINTENT_STICKER}))&&(m.intent=y.Forma.INTENT_STICKER)}else if(u=s.as(t,W.VectorContentNode)){O.LegacyCoreAssert.isFalse(s.opt(u.mediaMetadata,(function(e){return e.designIntent==L.MediaMetadata.DESIGNINTENT_ICON})),"can't create icon from VectorContentNode",void 0,"CreationFacade.createFormaFromContent","CreationFacade.swift",762);var g=e.createForma(z.VectorForma.KIND);g.contentID=u.id,r=g}else if(d=s.as(t,j.TextContentNode)){var _=e.createForma(P.GroupForma.KIND),v=i.controllerFactory.createController(H.TypeLockupController.KIND,_);_.controller=v,v.contentNode=d,v.size=new K.TheoSize(400,300),r=_}return r}}}),e}(),a.CopyItemsState=(i=function(){this.mappingCache=null,this.mapColorsToTheme=!1,this.depth=0},s.defineClass({name:"CopyItemsState",ctor:i,props:{onStart:function(e){0==this.depth&&(this.mappingCache={},this.mapColorsToTheme=e),this.depth+=1},onEnd:function(){0!=this.depth?(this.depth-=1,0==this.depth&&(this.mappingCache=null,this.mapColorsToTheme=!1)):d.CoreAssertDebugOnly.fail("CopyItemsState mismatched onStart/onEnd",void 0,"CopyItemsState.onEnd","CreationFacade.swift",809)}}}),i)},CqFS:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("ytEx"),l=n("x0BK"),u=n("3OP7"),c=n("FNB+"),d=n("fNpk");i.PREFIX_COMPONENT="component:",i.PROPERTY_KEY_CHILDREN="children",i.PROPERTY_KEY_EXTERNAL_URL="external-url",i.JSONNodeEncoder=(r=function(e,t,n){this.manifestEncoder_=null,this.jsonNode_=t,this.parentEncoder_=n,s.BaseNodeEncoder.call(this,e,e.root)},o={},a.defineClass({name:"JSONNodeEncoder",ctor:r,superName:"BaseNodeEncoder",statics:{PROPERTY_KIND_NAMESPACED:{get:function(){return void 0===o.PROPERTY_KIND_NAMESPACED&&(o.PROPERTY_KIND_NAMESPACED=u.DocumentPersistenceFactory.namespacedPropertyName(c.Forma.PROPERTY_KIND)),o.PROPERTY_KIND_NAMESPACED}},_implements:function(e){return"IExportDataObject"==e}},props:{getPropertyOnNode:function(e){return this.jsonNode_[e]},setPropertyOnNode:function(e,t){var n,o;null!=t?(this.jsonNode_[e]=t,(n=this.manifestEncoder_)&&null!=(o=a.as(t,"String"))&&(e==s.PROPERTY_KEY_PATH?n.setPath(o):e==s.PROPERTY_KEY_TYPE?n.setType(o):e==r.PROPERTY_KIND_NAMESPACED&&n.setStringProperty(c.Forma.PROPERTY_KIND,o))):a.removeKey(this.jsonNode_,e)},createChildEncoder:function(e){var t={};t[s.PROPERTY_KEY_ID]=a.as(e,"AnyObject");var n=a.as(this.getPropertyOnNode(i.PROPERTY_KEY_CHILDREN),["Array","AnyObject"]);null==n&&(n=[]),n.push(t),this.setPropertyOnNode(i.PROPERTY_KEY_CHILDREN,n),d.LegacyCoreAssert.isTrue(this.getPropertyOnNode(i.PROPERTY_KEY_CHILDREN)===n,"children getter should return same object reference as just set",void 0,"JSONNodeEncoder.createChildEncoder","JSONNodeEncoder.swift",64);var o=new r(this.branch_,t,this);return d.LegacyCoreAssert.isTrue(a.as(o.jsonNode_,"AnyObject")===a.as(t,"AnyObject"),"JSON encoder should same json node reference as it was just constructed with",void 0,"JSONNodeEncoder.createChildEncoder","JSONNodeEncoder.swift",67),o},findChild:function(e){return null==e?null:(t=this.getManifestEncoder().findChild(e))?t:s.BaseNodeEncoder.prototype.findChild.call(this,e);var t},appendComponent:function(e,t,n){s.BaseNodeEncoder.prototype.appendComponent.call(this,e,t,n);var r=this.branch_.getValue(s.PROPERTY_KEY_ID),o=i.PREFIX_COMPONENT+r+"/"+e+"/"+a.replaceAll(n,"/","+");this.setProperty(i.PROPERTY_KEY_EXTERNAL_URL,a.as(o,"AnyObject"))},getManifestEncoder:function(){var e,t,n;return null==this.manifestEncoder_&&(null==this.parentEncoder_?this.manifestEncoder_=new l.DCXNodeEncoder(this.branch_,this.branch_.root):this.manifestEncoder_=this.parentEncoder_.getManifestEncoder().createChildEncoder(this.id),null!=(e=a.as(this.getPropertyOnNode(s.PROPERTY_KEY_PATH),"String"))&&a.opt(this.manifestEncoder_,(function(t){return t.setPath(e)})),null!=(t=a.as(this.getPropertyOnNode(s.PROPERTY_KEY_TYPE),"String"))&&a.opt(this.manifestEncoder_,(function(e){return e.setType(t)})),null!=(n=this.getPropertyOnNode(r.PROPERTY_KIND_NAMESPACED))&&a.opt(this.manifestEncoder_,(function(e){return e.setProperty(c.Forma.PROPERTY_KIND,n)}))),this.manifestEncoder_},finish:function(){s.BaseNodeEncoder.prototype.finish.call(this),this.parentEncoder_=null,this.manifestEncoder_=null}}}),r)},DP9v:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("0wFF"),l=n("gXiO"),u=n("iCxV"),c=n("8vXU"),d=n("rxGp"),h=n("fNpk"),p=n("Kkml"),f=n("rrhp");i.MultiBrandFeatureSet=a.defineEnum("MultiBrandFeatureSet",{MULTIBRAND_OWNED_ONLY:0,MULTIBRAND_COMPATIBILITY_MODE_OWNED_ONLY:1,SHARED_BRANDS:2}),i.MultiBrandFacade=(r=function(){l.CoreObject.call(this)},o={},a.defineClass({name:"MultiBrandFacade",ctor:r,superName:"CoreObject",statics:{_sparkACManager:{get:function(){return void 0===o._sparkACManager&&(o._sparkACManager=u.Host.brandkitManager.authoringContextManager),o._sparkACManager},set:function(e){o._sparkACManager=e}},acManager:{get:function(){var e;return(e=r._acManager)?e:r._sparkACManager}},_usingMockedACManager:!1,usingMockedACManager:{get:function(){return r._usingMockedACManager}},useMockACManager:function(e){r._acManager=e,r._usingMockedACManager=!0,r._defaultBrandkitID=null,r._activeBrandkitID=null},useDefaultACHelper:function(){r._acManager=r._sparkACManager,r._usingMockedACManager=!1,r._defaultBrandkitID=null,r._activeBrandkitID=null,r.determineDefaultBrand()},_defaultBrandkitID:null,defaultBrandkitID:{get:function(){return h.LegacyCoreAssert.isTrue(null==r._defaultBrandkitID||!a.isEmpty(r._defaultBrandkitID),"default brand kit id should be nil or non-empty",void 0,"MultiBrandFacade","MultiBrandFacade.swift",74),r._defaultBrandkitID}},defaultBrand:{get:function(){var e;return(e=r.authoringContext(r.defaultBrandkitID))?e.isMinimal?null:e:null}},_activeBrandkitID:null,activeBrandkitID:{get:function(){return h.LegacyCoreAssert.isTrue(null==r._activeBrandkitID||!a.isEmpty(r._activeBrandkitID),"active brand kit id should be nil or non-empty",void 0,"MultiBrandFacade","MultiBrandFacade.swift",103),r._activeBrandkitID}},setActiveBrandkitID:function(e){var t=r.activeBrandkitID;r._activeBrandkitID=null!=e&&a.isEmpty(e)?null:e,t!=r.activeBrandkitID&&(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.setActiveBrand: changing from "+r.brandInfo(t)+" to "+r.brandInfo(r.activeBrandkitID),c.LogLevelEnum.INFO_LEVEL),a.opt(u.Host.brandkitManager,(function(e){return e.sendActiveBrandChangedNotification(r.activeBrandkitID)})))},activeBrand:{get:function(){var e,t;return null==r.activeBrandkitID&&null!=r.defaultBrandkitID&&(r.usingMockedACManager||u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.activeBrand: activeBrandkitID is nil, falling back to defaultBrandkit: "+((e=r.defaultBrandkitID)||null!=e?e:"none"),c.LogLevelEnum.INFO_LEVEL)),r.authoringContext((t=r.activeBrandkitID)||null!=t?t:r.defaultBrandkitID)}},getBrand:function(e){return a.isEmpty(e.authoringContextID)?null:r.authoringContext(e.authoringContextID)},setActiveBrand:function(e){null==e?r.setActiveBrandkitID(null):a.isEmpty(e.authoringContextID)?r.setActiveBrandkitID(r.defaultBrandkitID):r.setActiveBrandkitID(e.authoringContextID)},isBrandOwnedByCurrentUser:function(e){return a.clone(r.acManager.getOwnedAuthoringContextIDs()).filter((function(t){return t==e.id}),this).length>0},authoringContext:function(e){return null==e||a.isEmpty(e)?null:r.acManager.authoringContext(e)},authoringContexts:{get:function(){return r.acManager.authoringContexts}},ownedAuthoringContexts:{get:function(){var e=[],t=a.clone(r.acManager.getOwnedAuthoringContextIDs());if(t.length>0)for(var n=a.iter(t);!n.done;n.next()){var o,i=n.value;(o=r.acManager.authoringContext(i))&&e.push(o)}return e}},ownedBrandCount:{get:function(){return r.ownedAuthoringContexts.length}},sharedWithMeAuthoringContexts:{get:function(){var e=a.clone(r.acManager.getOwnedAuthoringContextIDs());return r.authoringContexts.filter((function(t){return!e.includes(t.id)}),this)}},sharedWithMeBrandCount:{get:function(){return r.sharedWithMeAuthoringContexts.length}},partialAuthoringContexts:{get:function(){return r.authoringContexts.filter((function(e){return!e.activated}),this)}},partialBrandCount:{get:function(){return r.partialAuthoringContexts.length}},usableAuthoringContexts:{get:function(){var e,t,n,o=[];if(e=r.featureSet==i.MultiBrandFeatureSet.SHARED_BRANDS?r.authoringContexts.filter((function(e){return e.activated}),this).map((function(e){return e.id}),this):r.ownedAuthoringContexts.filter((function(e){return e.activated}),this).map((function(e){return e.id}),this),null!=(t=r.defaultBrandkitID)&&(n=r.acManager.authoringContext(t))&&(o.push(n),e=e.filter((function(e){return e!=t}),this)),e.length>0)for(var s=a.iter(e);!s.done;s.next()){var l,u=s.value;(l=r.acManager.authoringContext(u))&&o.push(l)}return o}},usableBrandCount:{get:function(){return r.usableAuthoringContexts.length}},handleUndoRedoMessage:function(e){var t,n,r,o,i;if((o=a.as(e.changeAction,p.ChangeBrandingUserAction))&&null!=(i=e.changeDirection)){var s=(t=o.fromDocBrandID)||null!=t?t:"",l=(n=o.toBrandID)||null!=n?n:"";a.isEmpty(s)&&(i==f.UndoRedoChangeDirection.Undo?(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandManager.handleUndoRedoMessage: for Undo from "+l+" to none, resetting active brand to previous value "+((r=o.fromActiveBrandID)||null!=r?r:"none"),c.LogLevelEnum.INFO_LEVEL),a.opt(u.Host.brandkitManager,(function(e){return e.activateBrand(o.fromActiveBrandID)}))):(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandManager.handleUndoRedoMessage: for Redo from none to "+l+", resetting active brand to new brand",c.LogLevelEnum.INFO_LEVEL),a.opt(u.Host.brandkitManager,(function(e){return e.activateBrand(l)}))))}},featureSet:{get:function(){return void 0===o.featureSet&&(o.featureSet=i.MultiBrandFeatureSet.MULTIBRAND_OWNED_ONLY),o.featureSet},set:function(e){o.featureSet=e}},determineDefaultBrand:function(){var e=r.acManager.getDefaultBrandIdFromServer();switch(r.featureSet){case i.MultiBrandFeatureSet.MULTIBRAND_OWNED_ONLY:r.determineDefaultBrand_forMultiBrand();break;case i.MultiBrandFeatureSet.MULTIBRAND_COMPATIBILITY_MODE_OWNED_ONLY:r.determineDefaultBrand_CompatibilityMode(e);break;case i.MultiBrandFeatureSet.SHARED_BRANDS:r.determineDefaultBrand(e)}},determineDefaultBrand_forMultiBrand:function(){var e,t,n=null,o=null,i=(e=a.opt(u.Host.brandkitManager,(function(e){return e.adobeID})))||null!=e?e:"";if(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: "+r.authoringContexts.length+" authoringContexts",c.LogLevelEnum.INFO_LEVEL),(!a.isEmpty(i)&&u.Host.brandkitManager.isBrandkitEnabled||r.usingMockedACManager)&&r.authoringContexts.length>0){var s=a.clone(r.ownedAuthoringContexts);switch(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: "+s.length+" ownedBrands",c.LogLevelEnum.INFO_LEVEL),s.length){case 0:n=null;break;case 1:s[0].isDefault&&(n=(o=s[0]).id,o.activated||u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand "+r.brandInfo(o.id)+" is a partial brand",c.LogLevelEnum.INFO_LEVEL));break;default:for(var l=a.iter(s);!l.done;l.next()){var h=l.value;if(h.isDefault){n=(o=h).id,h.activated||u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand "+r.brandInfo(h.id)+" is a partial brand",c.LogLevelEnum.INFO_LEVEL);break}}}}null!=o&&o.isMinimal&&u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),r.defaultBrandkitID!=n?(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+r.brandInfo(r.defaultBrandkitID)+" to "+r.brandInfo(n),c.LogLevelEnum.INFO_LEVEL),r._defaultBrandkitID=n,r.usingMockedACManager||u.Host.brandkitManager.sendDefaultBrandChangedNotification(r.defaultBrandkitID)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=r.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},determineDefaultBrand_CompatibilityMode:function(e){var t,n=null;if(u.Host.brandkitManager.isBrandkitEnabled||r.usingMockedACManager){var o,i=!1;if((o=r.authoringContext(e))&&o.ownedByCurrentUser&&o.activated&&(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: using valueFromSpark "+o.name,c.LogLevelEnum.INFO_LEVEL),i=!0),i)n=e;else{var s,l,h,p=a.clone(r.ownedAuthoringContexts);(s=a.first(p.filter((function(e){return e.isDefault}),this).filter((function(e){return e.activated}),this)))?(n=s.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using preSharingLogic_DefaultBrand "+s.name,c.LogLevelEnum.INFO_LEVEL)):(l=a.first(a.sort(p.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=l.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedActivatedAlphabeticBrand "+l.name,c.LogLevelEnum.INFO_LEVEL)):(h=a.first(a.sort(p.filter((function(e){return!e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=h.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedUnActivatedAlphabeticBrand: "+h.name,c.LogLevelEnum.INFO_LEVEL)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: no fallback default brand",c.LogLevelEnum.INFO_LEVEL)}}var f=r.authoringContext(n);null!=f&&f.isMinimal&&u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),r.defaultBrandkitID!=n?(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+r.brandInfo(r.defaultBrandkitID)+" to "+r.brandInfo(n),c.LogLevelEnum.INFO_LEVEL),r._defaultBrandkitID=n,r.usingMockedACManager||u.Host.brandkitManager.sendDefaultBrandChangedNotification(r.defaultBrandkitID)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=r.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},determineDefaultBrand:function(e){var t,n=null;if(u.Host.brandkitManager.isBrandkitEnabled||r.usingMockedACManager){var o,i=!1;if((o=r.authoringContext(e))&&o.activated&&(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: using valueFromSpark "+o.name,c.LogLevelEnum.INFO_LEVEL),i=!0),i)n=e;else{var s,l,h,p,f=a.clone(r.ownedAuthoringContexts);(s=a.first(f.filter((function(e){return e.isDefault}),this).filter((function(e){return e.activated}),this)))?(n=s.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using preSharingLogic_DefaultBrand "+s.name,c.LogLevelEnum.INFO_LEVEL)):(l=a.first(a.sort(f.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=l.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedActivatedAlphabeticBrand "+l.name,c.LogLevelEnum.INFO_LEVEL)):(h=a.first(a.sort(r.sharedWithMeAuthoringContexts.filter((function(e){return e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=h.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstSharedActivatedAlphabeticBrand: "+h.name,c.LogLevelEnum.INFO_LEVEL)):(p=a.first(a.sort(f.filter((function(e){return!e.activated}),this),(function(e,t){return e.name<t.name}))))?(n=p.id,u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: fallback using firstOwnedUnActivatedAlphabeticBrand: "+p.name,c.LogLevelEnum.INFO_LEVEL)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"determineDefaultBrand: no fallback default brand",c.LogLevelEnum.INFO_LEVEL)}}var m=r.authoringContext(n);null!=m&&m.isMinimal&&u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: default brand is in minimal sync state!",c.LogLevelEnum.INFO_LEVEL),r.defaultBrandkitID!=n?(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: changing from "+r.brandInfo(r.defaultBrandkitID)+" to "+r.brandInfo(n),c.LogLevelEnum.INFO_LEVEL),r._defaultBrandkitID=n,r.usingMockedACManager||u.Host.brandkitManager.sendDefaultBrandChangedNotification(r.defaultBrandkitID)):u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.determineDefaultBrand: no change, still using "+((t=r.defaultBrandkitID)||null!=t?t:"none"),c.LogLevelEnum.INFO_LEVEL)},brandWasDeleted:function(e){r.determineDefaultBrand(),r.activeBrandkitID==e&&(u.Host.logging.logForCategory(d.LogCategories.kMultibrand,"MultiBrandFacade.onAuthoringContextDeleted:  Active Brand was deleted!",c.LogLevelEnum.INFO_LEVEL),r.setActiveBrandkitID(r.defaultBrandkitID))},brandInfo:function(e){var t,n="none";return(t=r.authoringContext(e))&&(n=t.name+":"+t.id),n},addBrandkit:function(e){var t;return 0!=r.ownedBrandCount&&h.LegacyCoreAssert.fail("addBrandkit called when user already owns at least one Brandkit",{},"MultiBrandFacade.addBrandkit","MultiBrandFacade.swift",535),(t=r.acManager.createAuthoringContext(e,!0))?(u.Host.platform.isIOS?a.opt(u.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataBrandkitCreatediOS,{})})):u.Host.platform.isAndroid&&a.opt(u.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataBrandkitCreatedAndroid,{})})),t):null}}}),r)},DaVl:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("BAdM");o.TheoJSONDecoder=(r=function(e,t){this.namespace_="",void 0===t&&(t=""),this.json=i.clone(e),this.namespace_=t},i.defineClass({name:"TheoJSONDecoder",ctor:r,statics:{_implements:function(e){return"IImportDataObject"==e}},props:{id:{get:function(){return i.as(this.json.id,"String")}},type:{get:function(){return i.as(this.json.type,"String")}},name:{get:function(){return i.as(this.json.name,"String")}},path:{get:function(){return i.as(this.json.path,"String")}},optionalStringProperty:function(e){return i.as(this.json[this.namespace_+e],"String")},stringProperty:function(e,t){var n;return(n=i.as(this.json[this.namespace_+e],"String"))||null!=n?n:t},numberProperty:function(e,t){var n;return(n=i.as(this.json[this.namespace_+e],"Double"))||null!=n?n:t},intProperty:function(e,t){var n;return(n=i.as(this.json[this.namespace_+e],"Int"))||null!=n?n:t},booleanProperty:function(e,t){var n;return(n=i.as(this.json[this.namespace_+e],"Bool"))||null!=n?n:t},optionalBooleanProperty:function(e){return i.as(this.json[this.namespace_+e],"Bool")},property:function(e){return i.as(this.json[this.namespace_+e],"AnyObject")},forEachChild:function(e){var t;if(t=i.as(this.json.children,["Array",["Dictionary","String","Any"]]))for(var n=0,o=i.iter(t);!o.done;o.next()){var a=o.value;e(new r(a,this.namespace_),n),n+=1}},forEachComponent:function(e){var t;if(t=i.as(this.json.components,["Array",["Dictionary","String","Any"]]))for(var n=0,r=i.iter(t);!r.done;r.next()){var o=r.value;e(a.JSONComponentDecoder.init_466d(o),n),n+=1}}}}),r)},"FNB+":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("HRWw"),s=n("ascj"),l=n("dJuF"),u=n("SmK9"),c=n("URxh"),d=n("H9Ol"),h=n("6ZWm"),p=n("G1DZ"),f=n("QbzR"),m=n("P83h"),g=n("9Lk3"),y=n("pnSN"),_=n("4mVB"),T=n("ZhwN"),v=n("iCxV"),C=n("fNpk"),P=n("tGKA"),S=n("Quhx"),D=n("K0Rh"),A=n("8t9B"),E=n("zjod");o.FormaPlatformView=i.defineProtocol("FormaPlatformView",{beginUpdate:"(FormaUpdateEvent) -> Void",endUpdate:"(FormaUpdateEvent) -> Void",formaDeleted:"() -> Void"}),o.FormaTraversal=i.defineEnum("FormaTraversal",{PreOrder:1,PostOrder:2,NearestAncestor:4,FurthestAncestor:5,JustChildren:6,PreOrderWithAuxiliaries:7,PostOrderWithAuxiliaries:8,JustAuxiliaries:9,JustChildrenAndAuxiliaries:10}),o.Forma=(r=function(){this.isFullCanvas=!1,this.stateChangeEvents=null,this.isModel_=!1},i.defineClass({name:"Forma",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:{get:function(){return"Forma"}},KIND:{get:function(){return""}},PROPERTY_KIND:"kind",PROPERTY_PLACEMENT:"placement",PROPERTY_STYLE:"style",PROPERTY_ANIMATION:"animation",PROPERTY_MOVEABLE:"moveable",PROPERTY_INTENT:"intent",PROPERTY_ORIGINAL_ID:"original-id",PROPERTY_SOURCE:"source",PROPERTY_TAGS:"tags",PROPERTY_CONTROLLER_KIND:"controller-kind",PROPERTY_CONTROLLER_METADATA:"controller-metadata",INTENT_LOGO:"logo",INTENT_PATTERN:"pattern",INTENT_ICON:"icon",INTENT_FLOATING_SHAPE:"floating-shape",INTENT_GRID_CELL:"grid-cell",INTENT_INFERRED_TEMP_GROUP:"inferred-temp-group",INTENT_STICKER:"sticker",INTENT_FLOATING_IMAGE:"floating-image",INTENT_TEMP_IMAGE_CROP:"temp-image-crop",INTENT_TEMP_IMAGE_REFINE_CUTOUT:"temp-image-refine-cutout",INTENT_IMAGE_MASK:"image-mask",INTENT_CUTOUT_MASK:"cutout-mask",INTENT_USER_GROUP:"user-group",TAG_IS_AUXILIARY:"is-auxiliary",TAG_CREATED_FROM_REMIX:"created-from-remix",ancestorsNearest:function(e,t,n){return null==e?null:n(e,t,0)?e:r.ancestorsNearest(e.parent,t-1,n)},ancestorsFurthest:function(e,t,n){if(null==e)return null;var o=r.ancestorsFurthest(e.parent,t-1,n);return null!=o?o:n(e,t,0)?e:null},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,o){var a,s,l=this;if(this.parent_=o,this.page_=o.page,i.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_3181,t,n,e),null==i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle)&&this.set(r.PROPERTY_STYLE,f.FormaStyle.createDefault()),(a=i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(a.owner=this,a.colorLibrary=i.opt(this.page_,(function(e){return e.colorLibrary}))),s=this.animation)for(var u=i.iter(s.keyFrames);!u.done;u.next()){var c=u.value;i.opt(c.style,(function(e){return e.colorLibrary=i.opt(l.page_,(function(e){return e.colorLibrary}))}))}this.decodeController()},init_7dbd:function(e,t,n,o){var a,s,l=this;if(this.page_=o,i.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_3181,t,n,e),null==i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle)&&this.set(r.PROPERTY_STYLE,f.FormaStyle.createDefault()),(a=i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(a.owner=this,a.colorLibrary=this.page_.colorLibrary),s=this.animation)for(var u=i.iter(s.keyFrames);!u.done;u.next()){var c=u.value;i.opt(c.style,(function(e){return e.colorLibrary=l.page_.colorLibrary}))}this.decodeController()},init_812f:function(e,t){for(var n,o=e.database,a={path:function(){return T.GUIDUtils.makeGUID()},kind:function(){return r.KIND},"controller-kind":function(){return""},placement:function(){return P.Matrix2D.Identity},"controller-metadata":function(){return d.ControllerMetadata.init_d41d()},style:function(){return f.FormaStyle.createDefault()}},s=i.clone(t),l=i.iter(a);!l.done;l.next()){var u=l.key,c=l.value;null==t[u]&&(s[u]=c())}this.page_=e,i.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_5079,o,{},s,""),(n=i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(n.owner=this,n.colorLibrary=this.page_.colorLibrary),this.initializeDefaultState(),this.decodeController()},init_d1c9:function(e,t){var n;this.parent_=null,this.page_=null,i.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_866e,t,e),null==i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle)&&this.set(r.PROPERTY_STYLE,f.FormaStyle.createDefault()),(n=i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(n.owner=this)},initializeDefaultState:function(){var e;(e=i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle))&&(this.cachedStyle_=e,this.cachedStyle_.colorLibrary=this.page.colorLibrary,this.subscribeToStyle(this.cachedStyle_))},willChangeState:function(e){var t=this;S.PostDCXObject.prototype.willChangeState.call(this,e),C.LegacyCoreAssert.isTrue(null==this.stateChangeEvents,"About to change states when a pending state change still has queued events",void 0,"Forma.willChangeState","Forma.swift",178),this.stateChangeEvents={},i.keys(e).forEach((function(e){var n;(n=t.updateEventForProperty(e))&&(t.stateChangeEvents[e]=n)}));for(var n=i.iter(this.stateChangeEvents);!n.done;n.next()){var r=n.value;this.beginUpdate(r)}i.opt(this.controller,(function(n){return n.formaWillChangeState(t,e)}))},didChangeState:function(e){var t=this;S.PostDCXObject.prototype.didChangeState.call(this,e),C.LegacyCoreAssert.isTrue(null!=this.stateChangeEvents,"Changed states without prior will-change notification",void 0,"Forma.didChangeState","Forma.swift",197);for(var n=i.iter(this.stateChangeEvents);!n.done;n.next()){var r=n.value;this.endUpdate(r)}this.stateChangeEvents=null,i.opt(this.controller,(function(n){return n.formaDidChangeState(t,e)}))},willCommitState:function(){var e=this;S.PostDCXObject.prototype.willCommitState.call(this),i.opt(this.controller,(function(t){return t.formaWillCommitState(e)}))},didCommitState:function(){var e=this;S.PostDCXObject.prototype.didCommitState.call(this),i.opt(this.controller,(function(t){return t.formaDidCommitState(e)}))},updateEventForProperty:function(e){var t=null;return e==r.PROPERTY_PLACEMENT?t=new m.FormaTransformChangedEvent(this):e==r.PROPERTY_STYLE&&(t=new m.FormaStyleChangedEvent(this)),t},initializeToDefaults:function(){},decodeController:function(){var e=this;if(0!=this.controllerKind.length){var t=i.opt(i.opt(this.page.document,(function(e){return e.controller})),(function(e){return e.controllerFactory}));null!=t?(this.controller=t.createController(this.controllerKind,this),null!=this.controller?null==this.controllerMetadata&&(i.opt(v.Host.logging,(function(e){return e.warning("Forma: No controller metadata found?")})),this.set(r.PROPERTY_CONTROLLER_METADATA,d.ControllerMetadata.init_d41d()),i.opt(this.controller,(function(t){return t.controllerMetadata=e.controllerMetadata}))):i.opt(v.Host.logging,(function(t){return t.warning("Forma: Factory did not create a controller for "+e.controllerKind+"!")}))):i.opt(v.Host.logging,(function(t){return t.warning("Forma: No constructor for controller kind "+e.controllerKind+"!")}))}},postDecode:function(){this.style.colorLibrary=i.opt(this.page_,(function(e){return e.colorLibrary})),i.opt(this.styleSubscription_,(function(e){return e.unsubscribe()})),this.subscribeToStyle(this.style),i.opt(this.controller,(function(e){return e.postDecode()}))},destroy:function(){this.style.dispose(),i.opt(this.styleSubscription_,(function(e){return e.unsubscribe()})),this.styleSubscription_=null},controllerKind:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_CONTROLLER_KIND),"String"))||null!=e?e:""}},controllerMetadata:{get:function(){return i.as(this.get(r.PROPERTY_CONTROLLER_METADATA),d.ControllerMetadata)}},className:{get:function(){return r.SCHEMA_CLASS_NAME}},controller:{get:function(){return this.controller_},set:function(e){var t;null==e&&i.opt(v.Host.logging,(function(e){return e.warning("setting a nil controller")})),this.controller_=e,null!=this.controller_&&(this.set(r.PROPERTY_CONTROLLER_KIND,i.opt(this.controller_,(function(e){return e.kind}))),(t=this.controllerMetadata)&&(this.controller_.controllerMetadata=t))}},animation:{get:function(){return i.as(this.get(r.PROPERTY_ANIMATION),c.FormaAnimation)},set:function(e){var t,n,o=this,a=new m.FormaAnimationChangedEvent(this);if(this.beginUpdate(a),t=i.as(this.get(r.PROPERTY_ANIMATION),c.FormaAnimation))for(var s=i.iter(t.keyFrames);!s.done;s.next()){var l=s.value;i.opt(l.style,(function(e){return e.clearColorLibrarySub()}))}if(this.set(r.PROPERTY_ANIMATION,e),n=e)for(var u=i.iter(n.keyFrames);!u.done;u.next())l=u.value,i.opt(l.style,(function(e){return e.colorLibrary=i.opt(o.page_,(function(e){return e.colorLibrary}))}));this.endUpdate(a)}},formaID:{get:function(){return this.path}},contentID:{get:function(){return null!=this.controller?this.controller.contentID:null}},originalID_:{get:function(){return i.as(this.get(r.PROPERTY_ORIGINAL_ID),"String")},set:function(e){this.set(r.PROPERTY_ORIGINAL_ID,e)}},originalID:{get:function(){var e;return(e=this.originalID_)||null!=e?e:this.formaID}},source:{get:function(){var e;return(e=i.opt(i.opt(this.controller,(function(e){return e.userGroupRoot})),(function(e){return e.source})))||null!=e?e:i.as(this.get(r.PROPERTY_SOURCE),"String")},set:function(e){C.LegacyCoreAssert.isTrue(p.FormaSourceUtils.isValid(e),"invalid forma source",void 0,"Forma","Forma.swift",342),this.set(r.PROPERTY_SOURCE,e)}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},isEqual:function(e){var t;return!!(t=i.as(e,r))&&this.formaID==t.formaID},parent:{get:function(){return this.parent_}},removeFromParent:function(){null!=this.parent_&&this.parent_.removeChild(this)},setParent:function(e,t){void 0===t&&(t=!1);var n=this,r=this.parent_;null!=this.parent_&&null==e&&i.opt(this.styleSubscription_,(function(e){return e.unsubscribe()})),this.parent_=e,null==r&&null!=e&&(this.styleSubscription_=i.opt(this.style_,(function(e){return e.subscribe(n,f.FormaStyleChangedMessage.TYPE)})))},subscribeToStyle:function(e){var t=this;null!=this.parent_?this.styleSubscription_=i.opt(e,(function(e){return e.subscribe(t,f.FormaStyleChangedMessage.TYPE)})):this.styleSubscription_=null},root:{get:function(){return null==this.parent_?i.as(this,y.GroupForma):this.parent_.root}},isDescendent:function(e){for(var t=this.parent;null!=t;){if(t==e)return!0;t=i.opt(t,(function(e){return e.parent}))}return!1},visit:function(e,t){switch(e){case 4:return r.ancestorsNearest(this,0,t);case 5:return r.ancestorsFurthest(this,0,t);case 6:return null;default:if(t(this,0,0))return this}return null},visitPlaced:function(e,t){var n=[];return this.visit(o.FormaTraversal.PreOrder,(function(r,o,a){return 0==o?n=[e]:(n=n.slice(0,o)).push(r.placement.concat(i.last(n))),t(r,i.last(n),o,a)}))},visitAll:function(e,t){this.visit(e,(function(e,n,r){return t(e),!1}))},visitAsArray:function(e){var t=[];return this.visitAll(e,(function(e){t.push(e)})),t},visitChildren:function(e){return this.visit(o.FormaTraversal.JustChildren,(function(t,n,r){return e(t,r)}))},filterByKind:function(e,t){void 0===t&&(t=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(t,(function(t){t.kind==e&&n.push(t)})),n},filterByControllerKind:function(e,t){void 0===t&&(t=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(t,(function(t){i.opt(t.controller,(function(t){return t.kind==e}))&&n.push(t)})),n},filterWithCallback:function(e,t){void 0===t&&(t=o.FormaTraversal.PreOrder);var n=[];return this.visitAll(t,(function(t){e(t)&&n.push(t)})),n},successor:function(){return null==this.parent_?null:null!=(e=this.parent_.indexOfChild(this))?this.parent_.childAt(e+1):null;var e},predecessor:function(){return null==this.parent_?null:null!=(e=this.parent_.indexOfChild(this))?this.parent_.childAt(e-1):null;var e},formaByID:function(e){return this.visit(o.FormaTraversal.PreOrder,(function(t,n,r){return t.formaID==e}))},formaByContentID:function(e){return this.visit(o.FormaTraversal.PreOrder,(function(t,n,r){var o;return!(!(o=i.as(t,E.VideoForma))||o.videoContentID!=e)||t.contentID==e}))},allowUserMove:{get:function(){return i.as(this.get(r.PROPERTY_MOVEABLE),"Bool")},set:function(e){this.set(r.PROPERTY_MOVEABLE,e)}},page:{get:function(){return this.page_},set:function(e){this.page_=e}},bounds:{get:function(){return this.boundsInCoordSpace(P.Matrix2D.Identity)},set:function(e){C.LegacyCoreAssert.fail("Forma does not support setting it's bounds",void 0,"Forma","Forma.swift",574)}},boundsInCoordSpace:function(e){return null},frame:{get:function(){return this.boundsInCoordSpace(this.placement)}},finalFrame:{get:function(){return this.boundsInCoordSpace(this.totalPlacement)}},placement:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_PLACEMENT),P.Matrix2D))||null!=e?e:P.Matrix2D.Identity},set:function(e){if(!this.placement.equal(e)){C.LegacyCoreAssert.isTrue(e.finite&&0!=e.determinant,"Placement is not finite",void 0,"Forma","Forma.swift",596);var t=new m.FormaTransformChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_PLACEMENT,e),this.endUpdate(t)}}},totalPlacement:{get:function(){var e=P.Matrix2D.Identity;return this.visitAll(o.FormaTraversal.FurthestAncestor,(function(t){e=t.placement.concat(e)})),e}},placementFromAncestor:function(e){for(var t=P.Matrix2D.Identity,n=i.iter(this.visitAsArray(o.FormaTraversal.NearestAncestor));!n.done;n.next()){var r=n.value;if(i.eq(o._equality_Forma_Forma,r,e))break;t=t.precat(r.placement)}return t},move:function(e){this.placement=this.placement.concat(e)},moveOriginToPoint:function(e){var t;(t=this.frame)?this.move(P.Matrix2D.translation(t.evalXY(0,0).multiply(-1)).translate(e)):i.opt(v.Host.logging,(function(e){return e.warning("moveOriginToPoint not possible because could not obtain frame")}))},moveCenterToPoint:function(e){var t;(t=this.frame)?this.move(P.Matrix2D.translation(t.evalXY(.5,.5).multiply(-1)).translate(e)):i.opt(v.Host.logging,(function(e){return e.warning("moveCenterToPoint not possible because could not obtain frame")}))},movePinToPoint:function(e,t){var n;(n=this.frame)?this.move(P.Matrix2D.translation(n.eval(e).multiply(-1)).translate(t)):i.opt(v.Host.logging,(function(e){return e.warning("moveCenterToPoint not possible because could not obtain frame")}))},rotation:function(){return 180*this.rotationInRadians()/Math.PI},rotationInRadians:function(){var e=this.placement.transformValues;return Math.atan2(e.rotSine,e.rotCosine)},containsPoint:function(e,t){if(void 0===t&&(t=0),null!=this.controller_)return this.controller.containsPoint(e,t);var n=this.bounds;return null!=n&&(0!=t&&(n=n.outsetXY(t,t)),n.containsPoint(e))},style_:{get:function(){return null==this.cachedStyle_&&(this.cachedStyle_=i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle)),this.cachedStyle_},set:function(e){null!=e&&this.internalSetStyle(e,!0,!0)}},style:{get:function(){return this.style_}},canApplyStyle:function(e){return null!=e},internalSetStyle:function(e,t,n){var o;if(void 0===t&&(t=!1),void 0===n&&(n=!0),o=e){var a=new m.FormaStyleChangedEvent(this);this.beginUpdate(a),i.opt(i.as(this.get(r.PROPERTY_STYLE),f.FormaStyle),(function(e){return e.dispose()})),this.cachedStyle_=null,i.opt(this.styleSubscription_,(function(e){return e.unsubscribe()})),this.set(r.PROPERTY_STYLE,o),this.cachedStyle_=o,this.cachedStyle_.colorLibrary=this.page_.colorLibrary,t&&(C.LegacyCoreAssert.isTrue(null==this.cachedStyle_.owner,"Setting a forma style that is already owned.",void 0,"Forma.internalSetStyle","Forma.swift",740),this.cachedStyle_.owner=this),this.subscribeToStyle(this.cachedStyle_),n&&i.opt(this.controller,(function(e){return e.styleChanged()})),this.endUpdate(a)}},applyStyle:function(e){null!=e&&e!==this.style_&&(this.style_=e.clone()),i.opt(this.controller,(function(e){return e.styleChanged()}))},protectedSetStyle:function(e){this.style_=e},onMessage:function(e){var t;(t=i.as(e,f.FormaStyleChangedMessage))&&(t.isBefore?(C.LegacyCoreAssert.isTrue(null==this.styleUpdateEvent_,"nested FormaStyleChangedMessage not allowed right now",void 0,"Forma.onMessage","Forma.swift",791),this.styleUpdateEvent_=new m.FormaStyleChangedEvent(this),this.beginUpdate(this.styleUpdateEvent_)):(i.opt(this.controller,(function(e){return e.styleChanged()})),this.endUpdate(this.styleUpdateEvent_),this.styleUpdateEvent_=null),t.isAfter&&i.opt(this.controller,(function(e){return e.styleChanged()})))},matchColors:function(e){var t,n;null!=(t=e.style.colors.colorID(s.ColorRole.FieldPrimary))&&this.style.colors.setColorId(s.ColorRole.FieldPrimary,t),null!=(n=e.style.colors.colorID(s.ColorRole.FieldSecondary))&&this.style.colors.setColorId(s.ColorRole.FieldSecondary,n)},match:function(e){var t;this.placement=e.placement,this.style.kind==e.style.kind?this.style.kind==_.GridStyle.KIND?this.style.match(e.style):(t=e.style.cloneToDatabase(this.database))?this.protectedSetStyle(t):C.LegacyCoreAssert.fail("Forma.match: could not clone style",void 0,"Forma.match","Forma.swift",835):this.matchColors(e),this.allowUserMove=e.allowUserMove,null!=this.controller&&null!=e.controller&&this.controller.match(e.controller)},siblingForma:function(){var e,t=[];if(e=this.parent)for(var n=i.clone(e.visitAsArray(o.FormaTraversal.JustChildren)),r=i.iter(n);!r.done;r.next()){var a=r.value;i.eq(o._equality_Forma_Forma,a,this)||t.push(a)}return t},postMatch:function(e){null!=this.controller&&null!=e.controller&&this.controller.postMatch(e.controller)},getGraph:function(e){var t;return(t=this.page_)?t.pgm.getGraphForForma(this,e):(C.LegacyCoreAssert.fail("Forma.getGraph: unexpectedly couldn't get a graph representation",void 0,"Forma.getGraph","Forma.swift",876),null)},isText:function(){return!1},isImage:function(){return!1},isShape:function(){return!1},isVideo:function(){return!1},isSticker:function(){return!1},isGraphic:function(){return this.isImage()||this.isShape()},isTypeLockup:function(){return null!=this.controller&&i.opt(this.controller,(function(e){return e.kind==A.TypeLockupController.KIND}))},isLogo:function(){return this.hasIntent(r.INTENT_LOGO)},isGridCell:function(){var e;return!!(e=i.as(i.opt(this.parent,(function(e){return e.controller})),g.GridController))&&e.isGridCell(this)},isBackgroundImage:function(){var e;return!!(e=i.as(this.controller,h.FrameController))&&!e.floating&&!e.userGroupMember},hasIntent:function(e){var t;return null!=(t=this.intent)&&t==e},intent:{get:function(){return i.as(this.get(r.PROPERTY_INTENT),"String")},set:function(e){this.set(r.PROPERTY_INTENT,e)}},isModel:{get:function(){return this.isModel_},set:function(e){this.isModel_=e}},tags_:{get:function(){var e,t={};if(e=i.opt(this.getProperty(r.PROPERTY_TAGS),(function(e){return e.dictionaryValue})))for(var n=i.iter(e);!n.done;n.next()){var o,a=n.key;null!=(o=n.value.stringValue)&&(t[a]=o)}return t},set:function(e){for(var t={},n=i.iter(e);!n.done;n.next()){var r=n.key,o=n.value;t[r]=l.DBProperty.stringProperty(l.DBNamePath.init_b14a(a.ContentNode.PROPERTY_TAGS).append(r),o)}this.setProperty(a.ContentNode.PROPERTY_TAGS,l.DBProperty.dictProperty(l.DBNamePath.init_b14a(a.ContentNode.PROPERTY_TAGS),t))}},tags:{get:function(){for(var e=[],t=i.iter(this.tags_);!t.done;t.next()){var n=t.key;e.push(n)}return e}},hasTag:function(e){return null!=this.tags_[e]},clearTags:function(){this.tags_={}},getTag:function(e){return this.tags_[e]},setTag:function(e,t){void 0===t&&(t="");var n=i.clone(this.tags_);n[e]=t,this.tags_=i.clone(n)},removeTag:function(e){i.removeKey(this.tags_,e)},asString:{get:function(){var e,t,n,r,o=(e=i.opt(this.contentID,(function(e){return e.substr(0,8)})))||null!=e?e:"nil",a=this.formaID.substr(0,8),s=(t=i.opt(this.controller,(function(e){return e.kind})))||null!=t?t:"";s==A.TypeLockupController.KIND&&"nil"==o&&this.contentID;var l=(n=i.opt(this.style.colors.library,(function(e){return e.asString})))||null!=n?n:"<none>",u=(r=i.opt(this.finalFrame,(function(e){return e.asString})))||null!=r?r:"(nil finalFrame)";return this.kind==D.RootForma.KIND?this.kind+": "+s+" "+a+" colorLibrary:("+l+") "+o+" "+this.style.opacity+" "+(null!=this.animation?"A":"NA")+" "+u:this.kind+": "+s+" "+a+" "+o+" "+this.style.opacity+" "+(null!=this.animation?"A":"NA")+" "+u}},print:function(){var e="";return this.visit(o.FormaTraversal.PreOrder,(function(t,n,r){for(var o="",a=i.iter(i.range(0,n,!0));!a.done;a.next())o+="    ";return null!=t.controller&&(e+=o+t.asString+"\n"),!1})),e},beginUpdate:function(e){this.isModel||i.opt(this.page_,(function(t){return t.beginUpdate(e)}))},endUpdate:function(e){this.isModel||i.opt(this.page_,(function(t){return t.endUpdate(e)}))},forkToDatabase:function(e,t,n,r){var o,i=S.PostDCXObject.prototype.forkToDatabase.call(this,e,t,n,r);return(o=i)&&(o.setProperty(S.PostDCXObject.PROPERTY_PATH,l.DBProperty.stringProperty(l.DBNamePath.init_b14a(S.PostDCXObject.PROPERTY_PATH),T.GUIDUtils.makeGUID())),null!=o.getProperty(u.DBSchema.PROPERTY_ID)&&o.setProperty(u.DBSchema.PROPERTY_ID,l.DBProperty.stringProperty(l.DBNamePath.init_b14a(u.DBSchema.PROPERTY_ID),e))),i}}}),r),o._equality_Forma_Forma=function(e,t){return e.isEqual(t)}},G1DZ:function(e,t,n){var r,o,i=t,a=n("oAGj");i.FormaSourceNamespace=a.defineEnum("FormaSourceNamespace",{DesignIngredient:"di:",DesignVariation:"dv:"}),i.FormaSourceUtils=(r=function(){},o={},a.defineClass({name:"FormaSourceUtils",ctor:r,statics:{allNamespaces:{get:function(){return void 0===o.allNamespaces&&(o.allNamespaces=[i.FormaSourceNamespace.DesignIngredient,i.FormaSourceNamespace.DesignVariation]),o.allNamespaces}},isValid:function(e){if(null==e)return!0;for(var t=a.iter(r.allNamespaces);!t.done;t.next()){var n=t.value;if(r.checkMatch(e,n))return!0}return!1},isDesignIngredient:function(e){return r.checkMatch(e,i.FormaSourceNamespace.DesignIngredient)},isDesignVariation:function(e){return r.checkMatch(e,i.FormaSourceNamespace.DesignVariation)},stripNamespace:function(e){for(var t=a.iter(r.allNamespaces);!t.done;t.next()){var n=t.value;if(e.startsWith(n))return e.substr(a.toString(n).length)}return e},checkMatch:function(e,t){var n;return!(!(n=a.opt(e,(function(e){return e.startsWith(t)})))&&null==n)&&n}}}),r)},HRWw:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("dJuF"),s=n("ZhwN"),l=n("Quhx");o.ContentNode=(r=function(){},i.defineClass({name:"ContentNode",ctor:r,superName:"PostDCXObject",statics:{KIND:{get:function(){return""}},SCHEMA_CLASS_NAME:{get:function(){return"GroupContentNode"}},CONTENT_NODE_CHILD_TYPES_NAME:"NonRootContentNodeTypes",PROPERTY_KIND:"kind",PROPERTY_TAGS:"tags",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){var o=n.getProperty(l.PostDCXObject.PROPERTY_PATH).stringValue;this.parent_=r,this.doc_=r.document,i.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_3181,t,n,o)},init_5e75:function(e,t,n,r){var o=n.getProperty(l.PostDCXObject.PROPERTY_PATH).stringValue;this.doc_=r,i.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_3181,t,n,o)},init_8b5c:function(e,t,n){var o;void 0===n&&(n=null);var u=(o=n)||null!=o?o:s.GUIDUtils.makeGUID();this.doc_=e,i.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_5079,e.database,{path:a.DBProperty.stringProperty(a.DBNamePath.init_b14a(l.PostDCXObject.PROPERTY_PATH),u),kind:a.DBProperty.stringProperty(a.DBNamePath.init_b14a(r.PROPERTY_KIND),t)},{},u)},init_c3fa:function(e,t,n){var o;void 0===n&&(n=null);var u=(o=n)||null!=o?o:s.GUIDUtils.makeGUID();this.parent_=e,this.doc_=e.document,i.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_5079,e.database,{path:a.DBProperty.stringProperty(a.DBNamePath.init_b14a(l.PostDCXObject.PROPERTY_PATH),u),kind:a.DBProperty.stringProperty(a.DBNamePath.init_b14a(r.PROPERTY_KIND),t)},{},u)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},document:{get:function(){return this.doc_}},parent:{get:function(){return this.parent_},set:function(e){this.parent_=e}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},contentID:{get:function(){return this.path}},tags_:{get:function(){var e,t={};if(e=i.opt(this.getProperty(r.PROPERTY_TAGS),(function(e){return e.dictionaryValue})))for(var n=i.iter(e);!n.done;n.next()){var o,a=n.key;null!=(o=n.value.stringValue)&&(t[a]=o)}return t},set:function(e){for(var t={},n=i.iter(e);!n.done;n.next()){var o=n.key,s=n.value;t[o]=a.DBProperty.stringProperty(a.DBNamePath.init_b14a(r.PROPERTY_TAGS).append(o),s)}this.setProperty(r.PROPERTY_TAGS,a.DBProperty.dictProperty(a.DBNamePath.init_b14a(r.PROPERTY_TAGS),t))}},tags:{get:function(){for(var e=[],t=i.iter(this.tags_);!t.done;t.next()){var n=t.key;e.push(n)}return e}},nodeByID:function(e){return e==this.contentID?this:null},nodeWithTag:function(e,t){return this.tags_[e]==t?this:null},clearTags:function(){this.tags_={}},getTag:function(e){return this.tags_[e]},setTag:function(e,t){var n=i.clone(this.tags_);n[e]=t,this.tags_=i.clone(n)},removeTag:function(e){var t=i.clone(this.tags_);i.removeKey(t,e),this.tags_=i.clone(t)},removeFromParent:function(){null!=this.parent_&&this.parent.removeChild(this)},match:function(e,t){void 0===t&&(t=null);var n,r=i.clone(e.state.allProperties);if(r[l.PostDCXObject.PROPERTY_PATH]=this.getProperty(l.PostDCXObject.PROPERTY_PATH),n=t)for(var o=i.iter(n);!o.done;o.next()){var a=o.value;i.removeKey(r,a)}this.matchProperties(r)},visit:function(e){return e(this)?this:null},visitAll:function(e){this.visit((function(t){return e(t),!1}))},releaseResources:function(){},publish:function(e){l.PostDCXObject.prototype.publish.call(this,e),i.opt(this.doc_,(function(t){return t.publishForChild(e)}))},postDecode:function(){}}}),r)},JEzR:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("ascj"),l=n("QbzR"),u=n("U010");i.FrameStyle=(r=function(){},o={},a.defineClass({name:"FrameStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"FrameStyle"}},KIND:{get:function(){return"FrameStyle"}},PROPERTY_CUTOUT_MODE:"cutout-mode",initialProps:{get:function(){return void 0===o.initialProps&&(o.initialProps={"cutout-mode":u.CutoutMode.Off}),o.initialProps}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_d41d()},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){a.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_866e,e,t)},init_dd5d:function(e,t){for(var n=a.clone(t),o=a.iter(r.initialProps);!o.done;o.next()){var i=o.key,s=o.value;null==e[i]&&null==t[i]&&(n[i]=s)}a.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_dd5d,e,n)},init_d41d:function(){var e=s.ColorTable.init_25f6([{key:s.ColorRole.FieldPrimary,value:null}]);a.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_5afe,r.KIND,1,e,void 0,void 0,r.initialProps)},init_6c45:function(e,t){a.super_init(this,l.FormaStyle,l.FormaStyle.prototype.init_5afe,r.KIND,e,t,void 0,void 0,r.initialProps)},cutoutMode:{get:function(){var e,t;return null!=(e=a.as(this.get(r.PROPERTY_CUTOUT_MODE),"Int"))&&null!=(t=u.CutoutMode.toCaseValue(e))?t:u.CutoutMode.Off},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_CUTOUT_MODE,e),this.notifyAfter()}},willCommitState:function(){l.FormaStyle.prototype.willCommitState.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r)},K0Rh:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("FNB+"),s=n("fWxZ"),l=n("QbzR"),u=n("P83h"),c=n("pnSN"),d=n("lmwz"),h=n("fNpk"),p=n("uxH+"),f=n("2ALn"),m=n("Zifs"),g=n("sIWg");o.RootForma=(r=function(){},i.defineClass({name:"RootForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"Root"}},PROPERTY_FILLCOLOR_DEPRECATED:"fill-color",PROPERTY_ROOT_STYLE_DEPRECATED:"root-style",SCHEMA_CLASS_NAME:{get:function(){return"RootForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.FormaPage);return h.LegacyCoreAssert.isTrue(null!=a,"RootForma needs a parent page",void 0,"RootForma","RootForma.swift",25),r.init_7dbd(e,t,n,a)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_7dbd:function(e,t,n,r){i.super_init(this,c.GroupForma,c.GroupForma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return f.RootStyle.createDefault()}},o=i.clone(t),a=i.iter(n);!a.done;a.next()){var s=a.key,l=a.value;null==t[s]&&(o[s]=l())}i.super_init(this,c.GroupForma,c.GroupForma.prototype.init_812f,e,o)},init_7186:function(e){var t={kind:r.KIND,style:f.RootStyle.createDefault()};this.init_812f(e,t)},init_d1c9:function(e,t){i.super_init(this,c.GroupForma,c.GroupForma.prototype.init_d1c9,e,t)},initializeDefaultState:function(){null!=this.rootStyleDeprecated_&&this.protectedSetStyle(this.rootStyleDeprecated_),null!=this.fillColorDeprecated_&&(this.style.colors.fieldPrimary=this.fillColorDeprecated_),c.GroupForma.prototype.initializeDefaultState.call(this)},initializeToDefaults:function(){var e;(e=i.opt(this.page.document,(function(e){return e.controller})))&&(this.controller=e.controllerFactory.createController(p.RootController.KIND,this)),this.bounds=g.TheoRect.fromSize(this.page.pageSize),c.GroupForma.prototype.initializeToDefaults.call(this)},page:{get:function(){return this.page_},set:function(e){var t=this,n=this.page_;this.page_=e,null==n&&(this.styleSubscription_=i.opt(this.style_,(function(e){return e.subscribe(t,l.FormaStyleChangedMessage.TYPE)})))}},subscribeToStyle:function(e){var t=this;null!=this.page_?this.styleSubscription_=i.opt(e,(function(e){return e.subscribe(t,l.FormaStyleChangedMessage.TYPE)})):this.styleSubscription_=null},postDecode:function(){var e,t=this;c.GroupForma.prototype.postDecode.call(this),i.opt(this.controller,(function(e){return e.kind!=p.RootController.KIND}))&&(this.controller=i.opt(i.opt(this.page.document,(function(e){return e.controller})),(function(e){return e.controllerFactory.createController(p.RootController.KIND,t)}))),(e=i.as(this.controller,p.RootController))&&e.createGridControllerIfNone(),null==this.animation&&this.visit(a.FormaTraversal.PreOrder,(function(e,n,o){return!(e instanceof r||!i.opt(e.animation,(function(e){return null!=e.animationStyle}))||(t.page.animationLibrary.setStillAnimation(t,e.animation.animationStyle),0))})),d.ImageFacade.exitCropMode(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},bounds:{get:function(){return null!=this.setBounds?this.setBounds:g.TheoRect.fromSize(this.page.pageSize)},set:function(e){h.LegacyCoreAssert.isTrue(null!=e,"Can't set a nil root bounds",void 0,"RootForma","RootForma.swift",137),h.LegacyCoreAssert.isTrue(g.TheoRect.fromSize(this.page.pageSize).equal(e),"Root bounds doesn't match the FormaPage pageSize.",void 0,"RootForma","RootForma.swift",138),c.GroupForma._setters.bounds.call(this,e)}},placement:{get:function(){return c.GroupForma._getters.placement.call(this)},set:function(e){h.LegacyCoreAssert.isTrue(e.isIdentity,"RootForma: Someone's trying to set the root forma placement to something other than identity!",void 0,"RootForma","RootForma.swift",146),c.GroupForma._setters.placement.call(this,e)}},contentID:{get:function(){return"root"}},isImage:function(){return!1},isGraphic:function(){return!1},isText:function(){return!1},isShape:function(){return!1},isLogo:function(){return!1},hackGenerateArtificialUpdateEvent:function(){var e=new u.FormaInsertedChildrenEvent(this,[],0);this.beginUpdate(e),this.endUpdate(e)},boundsInCoordSpace:function(e){return this.bounds.transform(e)},visible:{get:function(){var e;if(e=this.finalFrame){var t=!1,n=g.TheoRect.Zero;return this.visitAll(a.FormaTraversal.PreOrder,(function(e){var o;e instanceof r||((o=e.finalFrame)&&(n=n.unionWith(o)),e.isImage()&&(t=!0))})),!t||!n.contains(e)}return!1}},rootStyleDeprecated_:{get:function(){return i.as(this.get(r.PROPERTY_ROOT_STYLE_DEPRECATED),l.FormaStyle)}},fillColorDeprecated_:{get:function(){return i.as(this.get(r.PROPERTY_FILLCOLOR_DEPRECATED),m.SolidColor)}}}}),r)},K17h:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("VQVe"),l=n("gXiO"),u=n("FNB+"),c=n("cmoc"),d=n("ZK0l"),h=n("iCxV"),p=n("c+uM"),f=n("7Ta2"),m=n("enh0"),g=n("Vm85"),y=n("8t9B"),_=n("sIWg"),T=n("RkYL"),v=n("zjod");i.TextLine=(r=function(){this.words=[],this.shadows=[],this.bounds=_.TheoRect.Zero,this.isKnockout=!1},a.defineClass({name:"TextLine",ctor:r}),r),i.MotionUtils=(o=function(){l.CoreObject.call(this)},a.defineClass({name:"MotionUtils",ctor:o,superName:"CoreObject",statics:{SAME_LINE_THRESHOLD:20,sortTextLines:function(e){var t=a.clone(e);return a.sortInPlace(t,(function(e,t){return e.bounds.minY<t.bounds.minY})),t},findTextLines2:function(e){var t=g.TextFacade.getTextLook(e),n=[];if(p.LockupStyle.isKnockoutLook(t)&&!h.Host.textModelUtils.usePGMRenderer()){var r=e.boundsInCoordSpace(e.totalPlacement),s=new i.TextLine;s.words.push(e),s.isKnockout=!0,s.bounds=r||_.TheoRect.Zero,n.push(s)}else{var l={};e.visitAll(u.FormaTraversal.PreOrder,(function(e){var t;if(t=a.as(e,m.TextForma)){for(var n=!1,r=Math.floor(t.baselineBoundsInCoordSpace(t.placement).maxY),s=a.iter(l,!0);!s.done;s.next()){var u=s.key;if(Math.abs(u-r)<o.SAME_LINE_THRESHOLD){n=!0,r=u;break}}var c=t.boundsInCoordSpace(t.totalPlacement);if(n)l[r].bounds=l[r].bounds.unionWith(c),l[r].words.push(t);else{var d=new i.TextLine;d.words.push(t),d.bounds=c||_.TheoRect.Zero,l[r]=d}}}));for(var c=a.sort(a.keys(l,"numeric")),d=a.iter(c);!d.done;d.next()){var f=d.value;n.push(l[f])}}return n},findTextLines:function(e){var t=g.TextFacade.getTextLook(e),n=[];if(p.LockupStyle.isKnockoutLook(t)&&t!=p.LockupTextLook.KnockoutOnly&&!h.Host.textModelUtils.usePGMRenderer()){var r=[];r.push(e),n.push(r)}else{var o={};e.visitAll(u.FormaTraversal.PreOrder,(function(e){var t;(t=a.as(e,m.TextForma))&&(null==o[t.rowIndex]?o[t.rowIndex]=[a.as(e,u.Forma)]:o[t.rowIndex].push(e))}));for(var i=a.sort(a.keys(o,"numeric")),s=a.iter(i);!s.done;s.next()){var l=s.value;n.push(o[l])}}return n},getTitleLockups:function(e){if(0==e.length)return[];for(var t=a.clone(e),n={},r=a.iter(t);!r.done;r.next()){var o=r.value,i=(new f.RoleSuggester).getRole(o).role;n[o.formaID]=i}a.sortInPlace(t,(function(e,t){return e.controller.currentHeightScale>t.controller.currentHeightScale}));var s,l=t.shift(),u=[l],c=[];if(s=a.as(l.controller,y.TypeLockupController))for(var d=a.iter(t);!d.done;d.next()){var h;if(o=d.value,h=a.as(o.controller,y.TypeLockupController)){var p=h.getCurrentFontSize(),m=s.getCurrentFontSize();Math.abs(p-m)/Math.min(p,m)<.05?u.push(o):c.push(o)}}return[u,c]},getGifDur:function(e){var t,n,r=0;return e.isSticker()&&(n=a.as(e,v.VideoForma))&&(r=(t=a.opt(n.videoContentNode,(function(e){return e.duration.seconds})))||null!=t?t:0),r},determineLoopDur:function(e,t){var n=o.getGifDur(e);if(n>0){var r=t/n;n*=Math.ceil(r)}return n},createOpacityStyle:function(e,t){var n;if(!(e instanceof v.VideoForma||e instanceof c.FrameForma)&&(n=e.controller)){var r=a.as(n,d.GroupController);a.opt(r,(function(e){return e.beginBlockedUpdate()}));var o=e.style.clone();n.applyOpacity(t);var i,s=e.style.clone();return(i=a.as(s,p.LockupStyle))&&(i.textOpacity=t,i.backingOpacity=t),e.applyStyle(o),a.opt(r,(function(e){return e.endBlockedUpdate()})),s}var l=e.style.clone();return l.opacity=t,l},getCurrentAnimationStyle:function(e){return a.opt(a.opt(e,(function(e){return e.firstPage.root.animation})),(function(e){return e.animationStyle}))},invalidateAnimation:function(e){a.opt(e.firstPage.root.animation,(function(e){return e.invalidate()}))},isCurrentAnimationValid:function(e){var t;return!!(t=a.opt(e,(function(e){return e.firstPage.root.animation})))&&t.valid&&!t.animationStyle.modifiesFormaTree},determineTotalDuration:function(e){return a.opt(e.root.animation,(function(e){return e.animationStyle.endTime}))||T.TheoTime.Zero},getFrameTimes:function(e){var t,n=[],r=0,o=1,i=s.AnimationStyle.DEFAULT_TIMESCALE;(t=e.firstPage.animationController.animationStyle)?(r=t.endTime.value,i=t.endTime.timescale,o=a.toInt(t.endTime.timescale/s.AnimationStyle.DEFAULT_TIMESCALE)):e.firstPage.root.visitAll(u.FormaTraversal.PreOrder,(function(e){var t,n;(t=a.as(e,v.VideoForma))&&null!=(n=a.opt(t.videoContentNode,(function(e){return e.duration.value})))&&n>r&&(r=n)}));for(var l=a.iter(a.stride(0,r,o));!l.done;l.next()){var c=l.value;n.push(new T.TheoTime(c,i))}return n}}}),o)},K9Oa:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("ylxa"),l=n("iCxV"),u=n("3DEm"),c=n("sIWg");o.PageFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"PageFacade",ctor:r,superName:"CoreObject",statics:{kMinPageDimension:50,kMaxPageDimension:6e3,getMinPageDimensionForUnits:function(e,t){var n=r.getNumDecimalPlacesForUnits(e),o=r.unitsToPixelsFactor(e,t),a=r.kMinPageDimension/o;if(0!=n){var s=1/Math.pow(10,i.toDouble(n)),l=.5/Math.pow(10,i.toDouble(n));a=u.MathUtils.nearestMultiple(a+l,s)}return a},getMaxPageDimensionForUnits:function(e,t){var n=r.getNumDecimalPlacesForUnits(e),o=r.unitsToPixelsFactor(e,t),a=r.kMaxPageDimension/o;if(0!=n){var s=1/Math.pow(10,i.toDouble(n)),l=.5/Math.pow(10,i.toDouble(n));a=u.MathUtils.nearestMultiple(a-l,s)}return a},pageDimensionIsInRange:function(e,t,n){return!r.pageDimensionIsTooSmall(e,t,n)&&!r.pageDimensionIsTooLarge(e,t,n)},pageDimensionIsTooSmall:function(e,t,n){var o=r.convertStringToPixelsValue(e,t,n),i=r.getMinPageDimensionForUnits(t,n);return o<r.unitsToPixelsFactor(t,n)*i},pageDimensionIsTooLarge:function(e,t,n){var o=r.convertStringToPixelsValue(e,t,n),i=r.getMaxPageDimensionForUnits(t,n);return o>r.unitsToPixelsFactor(t,n)*i},setPageDesignSize:function(e,t){e.setPageSizeFromDesignSize(t)},getNumDecimalPlacesForUnits:function(e){var t=0;return e==s.PageExportFormat.INCHES?t=2:e==s.PageExportFormat.MILLIMETERS&&(t=1),t},unitsToPixelsFactor:function(e,t){return e==s.PageExportFormat.MILLIMETERS?s.FormaPageExportData.MM_TO_INCHES*t:e==s.PageExportFormat.INCHES?t:1},convertStringToPixelsValue:function(e,t,n){var o;return((o=i.opt(l.Host.locale,(function(t){return t.convertStringToNumber(e)})))||null!=o?o:i.toDouble(e))*r.unitsToPixelsFactor(t,n)},convertPixelsToUnitsString:function(e,t,n){var o,a=e/r.unitsToPixelsFactor(t,n),s=r.getNumDecimalPlacesForUnits(t);if(null!=l.Host.locale)return o=l.Host.locale.formatNumber(a,s);if((o=i.toString("%."+s+"f",a)).includes("."))for(;o.endsWith("0");)o=o.substr(0,o.length-1);return o.endsWith(".")&&(o=o.substr(0,o.length-1)),o},aspectRatioIsVeryTallOrWide:function(e){var t=c.TheoRect.fromSize(e);return t.aspectRatio>=5||t.aspectRatio<=.2}}}),r)},KkVW:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("4/a+");o.MotionEntryDropIn=(r=function(){this.srcId="MotionSrcDropIn",this.logic=new a.MotionLogicDur,this.args={st:0,dur:1.5}},i.defineClass({name:"MotionEntryDropIn",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},KsJe:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("cZuM"),s=n("Z25M"),l=n("wc1n"),u=n("dNmX"),c=n("c+uM"),d=n("TkOd"),h=n("K0Rh"),p=n("7Ta2"),f=n("djAF"),m=n("8t9B");o.LockupStyleFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e.root,this.forma_=e,this.lockupController_=i.as(this.forma_.controller,m.TypeLockupController),this.forFeatures_=i.clone(t),this.featureEvals_=[],this.lockupAttributes=d.lockupStyleToLockupStyleAttributes(this.forma_.style,e.page.document),l.FeatureExtractor.call(this),null!=this.lockupController_&&(this.initFeatures(),this.evaluateFeatures())},i.defineClass({name:"LockupStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Role",[this.evaluateRole,l.FeatureType.Categorical]],["BoundingBox",[this.evaluateBoundingBox,l.FeatureType.Complex]],["BackgroundColors",[this.evaluateBackgroundColors,l.FeatureType.Complex]],["ImageCount",[this.evaluateImageCount,l.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,l.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,l.FeatureType.Numerical]],["TextHeight",[this.evaluateTextHeight,l.FeatureType.Numerical]],["TextWidth",[this.evaluateTextWidth,l.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,l.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,l.FeatureType.Numerical]],["AspectRatio",[this.evaluateAspectRatio,l.FeatureType.Numerical]],["BackgroundType",[this.evaluateBackgroundType,l.FeatureType.Categorical]],["AverageHue",[this.evaluateAverageHue,l.FeatureType.Numerical]],["AverageLightness",[this.evaluateLightness,l.FeatureType.Numerical]],["LightnessSpread",[this.evaluateLightnessSpread,l.FeatureType.Numerical]],["PercentageArea",[this.evaluatePercentageArea,l.FeatureType.Numerical]],["PercentageAreaAllLockups",[this.evaluateAllLockPercentageArea,l.FeatureType.Numerical]],["LockupSymmetryX",[this.evaluateXSymmetry,l.FeatureType.Numerical]],["LockupSymmetryY",[this.evaluateYSymmetry,l.FeatureType.Numerical]],["DistanceXFromCenter",[this.evaluateXDistanceFromCenter,l.FeatureType.Numerical]],["TextString",[this.evaluateTextString,l.FeatureType.Categorical]],["CenterX",[this.evaluateCenterX,l.FeatureType.Numerical]],["CenterY",[this.evaluateCenterY,l.FeatureType.Numerical]],["CharacterCount",[this.evaluateCharacterCount,l.FeatureType.Numerical]],["LineHeight",[this.evaluateLineHeight,l.FeatureType.Numerical]],["WordCount",[this.evaluateWordCount,l.FeatureType.Numerical]],["Font",[this.evaluateStyleFont,l.FeatureType.Categorical]],["BackingShape",[this.evaluateStyleBackingShape,l.FeatureType.Categorical]],["TextLook",[this.evaluateStyleTextLook,l.FeatureType.Categorical]],["Layout",[this.evaluateStyleLayout,l.FeatureType.Categorical]],["PrimaryColor",[this.evaluateStylePrimaryColor,l.FeatureType.Categorical]],["SecondaryColor",[this.evaluateStyleSecondaryColor,l.FeatureType.Categorical]],["ShapeFilled",[this.evaluateStyleShapeFilled,l.FeatureType.Numerical]],["TextOpacity",[this.evaluateStyleTextOpacity,l.FeatureType.Numerical]],["BackingOpacity",[this.evaluateStyleBackingOpacity,l.FeatureType.Numerical]],["Padding",[this.evaluateStylePadding,l.FeatureType.Numerical]],["ShadowAngle",[this.evaluateStyleShadowAngle,l.FeatureType.Numerical]],["ShadowOffsetY",[this.evaluateStyleShadowOffsetY,l.FeatureType.Numerical]],["Spacing",[this.evaluateStyleSpacing,l.FeatureType.Numerical]],["StrokeWeight",[this.evaluateStyleStokeWeight,l.FeatureType.Numerical]],["Tracking",[this.evaluateStyleTracking,l.FeatureType.Numerical]],["HasMSL",[this.evaluateHasMSL,l.FeatureType.Numerical]],["CollisionPercentage",[this.evaluatePercentageOverlappingWithOtherLockupsAndShapes,l.FeatureType.Numerical]],["SurroundingAlignment",[this.evaluateSurroundingAlignment,l.FeatureType.Complex]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateWordCount:function(e){return i.toDouble(e.lockupController_.wordCount())},evaluateLineHeight:function(e){var t=e.lockupController_.averageLineHeight;return null!=t?t:0},evaluateCharacterCount:function(e){return i.toDouble(e.lockupController_.text.length)},evaluateRole:function(e){return(new p.RoleSuggester).getRole(e.forma_).role},evaluateBoundingBox:function(e){return s.DesignFeatureUtils.getFormaBoundingBox(e.forma_)},evaluateBackgroundColors:function(e){return this.setColorsBehindLockup(e),e.colorsBehindLockup.map((function(e){return e.hex}),this)},evaluateImageCount:function(e){return s.DesignFeatureUtils.getImageCount(e.root_)},evaluateShapeCount:function(e){return s.DesignFeatureUtils.getShapeCount(e.root_)},evaluateTextCount:function(e){return s.DesignFeatureUtils.getTextCount(e.root_)},evaluateTextHeight:function(e){return s.DesignFeatureUtils.getFormaHeight(e.forma_)},evaluateTextWidth:function(e){return s.DesignFeatureUtils.getFormaWidth(e.forma_)},evaluateBackgroundType:function(e){for(var t="root",n=i.clone(e.root_.filterWithCallback((function(e){return(e.isBackgroundImage()||e.kind==f.ShapeForma.KIND||e.kind==h.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable}))),r=i.iter(n);!r.done;r.next()){var o=r.value;o.isBackgroundImage()&&o.finalFrame.outsetXY(20,20).contains(e.forma_.finalFrame)?t="image":o.kind==f.ShapeForma.KIND&&(t="shape")}return t},evaluateAverageHue:function(e){var t=0,n=0,r=0,o=0;this.setColorsBehindLockup(e);for(var a=i.iter(e.colorsBehindLockup);!a.done;a.next()){var s=a.value.asLAB;t+=s.l*s.l,n+=s.a*s.a,r+=s.b*s.b,o+=s.alpha*s.alpha}var l=i.toDouble(e.colorsBehindLockup.length);return t=Math.sqrt(t/l),n=Math.sqrt(n/l),r=Math.sqrt(r/l),o=Math.sqrt(o/l),new u.LABColor(t,n,r,o).hue},evaluateAspectRatio:function(e){var t=s.DesignFeatureUtils.getFormaHeight(e.forma_),n=s.DesignFeatureUtils.getFormaWidth(e.forma_);return i.toDouble(n/t)},evaluateLightness:function(e){var t=0,n=0,r=0,o=0;this.setColorsBehindLockup(e);for(var a=i.iter(e.colorsBehindLockup);!a.done;a.next()){var s=a.value.asLAB;t+=s.l*s.l,n+=s.a*s.a,r+=s.b*s.b,o+=s.alpha*s.alpha}var l=i.toDouble(e.colorsBehindLockup.length);return t=Math.sqrt(t/l),n=Math.sqrt(n/l),r=Math.sqrt(r/l),o=Math.sqrt(o/l),new u.LABColor(t,n,r,o).asRGB.lightness},evaluateLightnessSpread:function(e){return this.setColorsBehindLockup(e),e.lockupController_.getBackgroundLightnessSpread(e.colorsBehindLockup)},evaluatePercentageArea:function(e){return s.DesignFeatureUtils.formaPercentageArea(e.forma_)},evaluateAllLockPercentageArea:function(e){for(var t=0,n=i.clone(e.forma_.page.root.filterWithCallback((function(e){return e.isTypeLockup()}))),r=i.iter(n);!r.done;r.next()){var o=r.value;t+=s.DesignFeatureUtils.formaPercentageArea(o)}return t},evaluateXSymmetry:function(e){return s.DesignFeatureUtils.getSymmAsymm([e.forma_.finalFrame],!0)},evaluateYSymmetry:function(e){return s.DesignFeatureUtils.getSymmAsymm([e.forma_.finalFrame],!1)},evaluateXDistanceFromCenter:function(e){var t,n,r=-1;return(t=e.forma_.finalFrame)&&(n=e.root_.finalFrame)&&(r=t.center.distanceTo(n.center)),r},evaluateTextString:function(e){return e.lockupController_.text},evaluateCenterX:function(e){return s.DesignFeatureUtils.getFormaCenterX(e.forma_)},evaluateCenterY:function(e){return s.DesignFeatureUtils.getFormaCenterY(e.forma_)},evaluatePageWidth:function(e){return s.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return s.DesignFeatureUtils.getPageHeight(e.root_)},evaluateStyleShapeFilled:function(e){return e.forma_.style.textBacked?1:0},evaluateStyleTextOpacity:function(e){return e.lockupAttributes.textOpacity},evaluateStyleBackingOpacity:function(e){return e.lockupAttributes.backingOpacity},evaluateStylePadding:function(e){return e.lockupAttributes.padding},evaluateStyleShadowAngle:function(e){return e.lockupAttributes.shadowAngle},evaluateStyleShadowOffsetY:function(e){return e.lockupAttributes.shadowOffset},evaluateStyleSpacing:function(e){return e.lockupAttributes.spacing},evaluateStyleStokeWeight:function(e){return e.lockupAttributes.strokeWeight},evaluateStyleTracking:function(e){return e.lockupAttributes.tracking},evaluateHasMSL:function(e){var t=i.clone(e.forma_.style.characterStyles);return 0!=i.count(t)?1:0},evaluateStyleFont:function(e){return i.toString(e.lockupAttributes.font)},evaluateStyleBackingShape:function(e){return e.lockupAttributes.backing},evaluateStyleTextLook:function(e){return e.lockupAttributes.textLook},evaluateStyleLayout:function(e){return e.lockupAttributes.layout},evaluateStylePrimaryColor:function(e){return e.lockupAttributes.primaryColor},evaluateStyleSecondaryColor:function(e){return e.lockupAttributes.secondaryColor},setColorsBehindLockup:function(e){null==e.colorsBehindLockup&&(e.colorsBehindLockup=i.clone(e.lockupController_.getBackgroundColors()))},evaluatePercentageOverlappingWithOtherLockupsAndShapes:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isTypeLockup()||e.kind==f.ShapeForma.KIND&&!e.isGridCell()}))),n=1,r=null,o=[],a=i.iter(t);!a.done;a.next()){var l=a.value;l.kind==f.ShapeForma.KIND&&e.forma_.formaID==s.DesignFeatureUtils.getTypeLockupParentFormaIDofShape(l.parent)?l.finalFrame.area>n&&(n=(r=l.finalFrame).area):l.formaID!=e.forma_.formaID&&o.push(l.finalFrame)}null==r&&(n=(r=e.forma_.finalFrame).area);for(var u=0,c=i.iter(o);!c.done;c.next()){var d=c.value.intersectionWith(r);null!=d&&(u+=d.area)}return u/n},evaluateSurroundingAlignment:function(e){var t=c.LockupAlignment.UNSET,n=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))).filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(n.length>1){var r=i.clone(e.forma_.controller.alignmentDetector.detectFormaAlignments(a.AlignmentDetector.DISTANCE_THRESHOLD)),o=i.clone(s.DesignFeatureUtils.getLockupsWithin(e.forma_,n,800)),l=i.clone(s.DesignFeatureUtils.getSetSimm(o,r)),u=i.clone(s.DesignFeatureUtils.getAlignmentConcensus(l));if(u[i.first(i.keys(u))]>.5){var d=i.first(i.keys(u));d==a.describeAlignmentType(a.AlignmentType.Left)?t=c.LockupAlignment.Left:d==a.describeAlignmentType(a.AlignmentType.Right)?t=c.LockupAlignment.Right:d==a.describeAlignmentType(a.AlignmentType.CenterX)&&(t=c.LockupAlignment.Center)}}return t}}}),r)},L19Y:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("kYI4");o.TheoBrandkitUtils=(r=function(){a.BrandingFacade.call(this)},i.defineClass({name:"TheoBrandkitUtils",ctor:r,superName:"BrandingFacade",statics:{isDocumentBranded:function(e,t){return a.BrandingFacade.isDocumentBranded(e,t)}}}),r)},LCGV:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("QbzR"),l=n("Zifs");o.TextStyle=(r=function(){},i.defineClass({name:"TextStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"TextStyle"}},KIND:{get:function(){return"TextStyle"}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_70dd(l.SolidColor.WHITE)},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_866e,e,t)},init_70dd:function(e){i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,r.KIND,s.FormaStyle.OPACITY_DEFAULT,a.ColorTable.createWithOneSolidColor(e))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},colorLibrary:{get:function(){return s.FormaStyle._getters.colorLibrary.call(this)},set:function(e){this.setColorLibraryWithoutSubscribing(e)}},colorTableSupportsRole:function(e){return e==a.ColorRole.FieldPrimary||e==a.ColorRole.FieldSecondary||e==a.ColorRole.Border||e==a.ColorRole.Shadow}}}),r)},LGJg:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("A6KL"),s=n("fNpk"),l=n("1NAc"),u=n("qSCS");o.VectorContentNode=(r=function(){},i.defineClass({name:"VectorContentNode",ctor:r,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"vector"}},SCHEMA_CLASS_NAME:{get:function(){return"VectorContentNode"}},factory:{get:function(){return function(e,t,n,o){var l=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),a.GroupContentNode);return s.LegacyCoreAssert.isTrue(null!=l,"Content nodes need a parent",void 0,"VectorContentNode","VectorContentNode.swift",16),r.init_3144(e,t,n,l)}}},USAGE_TAG:"usage_reported",PROPERTY_SIZE:"size",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,u.URLBasedContentNode,u.URLBasedContentNode.prototype.init_3144,e,t,n,r)},init_26a9:function(e,t){i.super_init(this,u.URLBasedContentNode,u.URLBasedContentNode.prototype.init_c3fa,e,"vector",t),this.set(r.PROPERTY_SIZE,l.TheoSize.Zero)},init_5972:function(e,t){i.super_init(this,u.URLBasedContentNode,u.URLBasedContentNode.prototype.init_8b5c,e,"vector",t),this.set(r.PROPERTY_SIZE,l.TheoSize.Zero)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},size:{get:function(){return this.get(r.PROPERTY_SIZE)},set:function(e){this.set(r.PROPERTY_SIZE,e)}},isUsageReported:function(){var e=this.getTag(r.USAGE_TAG);return null!=e&&"true"==e},setUsageReported:function(e){this.setTag(r.USAGE_TAG,e?"true":"false")},getUsageID:function(){return i.opt(this.mediaMetadata,(function(e){return e.assetID}))}}}),r)},"LP+A":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("iSwi"),l=n("LqGn");o.RetargetLayoutOption=i.defineEnum("RetargetLayoutOption",{UNSET:-1,DisableLayout:0,EnableLayout:1}),o.DesignSuggestionFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"DesignSuggestionFacade",ctor:r,superName:"CoreObject",statics:{createSuggestionsFromTemplate:function(e,t,n,r,a,u){void 0===a&&(a=10),void 0===u&&(u=o.RetargetLayoutOption.UNSET);var c=new s.RetargetSuggester(t,n,e,r),d=i.clone(c.createSuggestions()).filter((function(e){return e instanceof l.RetargetSuggestion}),this).map((function(e){return e}),this);return u!=o.RetargetLayoutOption.UNSET?d=d.filter((function(e){return e.layoutUpdate==(u==o.RetargetLayoutOption.EnableLayout)}),this):s.RetargetSuggester.shouldAttemptLayoutSuggestion(t)||(d=d.filter((function(e){return 0==e.layoutUpdate}),this)),d.slice(0,Math.min(d.length,a))}}}),r)},LcYy:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("iCxV"),l=n("fNpk"),u=n("Quhx"),c=n("9YN4");i.DocumentHistory=(r=function(){},o={},a.defineClass({name:"DocumentHistory",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"DocumentHistory",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),c.TheoDocument);return l.LegacyCoreAssert.isTrue(null!=i,"DocumentHistory needs a parent document",void 0,"DocumentHistory","DocumentHistory.swift",15),r.init_7e49(e,n,i)}),o.factory},set:function(e){o.factory=e}},PROPERTY_ENTRIES:"entries",PATH:"document-history",MAX_HISTORY_SIZE:100,_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_7e49:function(e,t,n){this.parent_=n,a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_3181,n.database,t,e)},init_d0e4:function(e){this.parent_=e,a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_11e0,e.database),this.set(u.PostDCXObject.PROPERTY_PATH,r.PATH),this.postEntry("initialized")},className:{get:function(){return r.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},entries:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_ENTRIES),["Array","String"]))||null!=e?e:[]}},postEntry:function(e){var t,n,o,i=this.database.beginTransaction("updateHistory",null),l=a.clone(this.entries);l.length>=r.MAX_HISTORY_SIZE&&l.shift();var u="when:'"+((t=a.opt(s.Host.logging,(function(e){return e.timeStamp()})))||null!=t?t:"?")+"';platform:'"+((n=a.opt(s.Host.logging,(function(e){return e.platformID()})))||null!=n?n:"?")+" ("+((o=a.opt(s.Host.logging,(function(e){return e.additionalPlatformInfo()})))||null!=o?o:"?")+")';format#:"+a.toString(c.TheoDocument.CURRENT_VERSION)+";operation:'"+e+"'";l.push(u),this.set(r.PROPERTY_ENTRIES,l),i.mergeWithPrevious()},entryCount:{get:function(){return this.entries.length}},entryAt:function(e){return e<0||e>=this.entries.length?(a.opt(s.Host.logging,(function(e){return e.warning("entryAt: Invalid index requested, returning empty string")})),""):this.entries[e]},forEachEntry:function(e){for(var t=a.iter(this.entries);!t.done;t.next())e(t.value)},clear:function(){this.set(r.PROPERTY_ENTRIES,[])}}}),r)},ML5t:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("hndY"),s=n("fNpk");o.FormaPagePGMSource=(r=function(e){this.caches_={},this.page=e},i.defineClass({name:"FormaPagePGMSource",ctor:r,superName:"PGMSource",props:{getCache:function(e){var t,n,r=e.asString,o=e.backgroundOpacityOverride<1;if(t=this.caches_[r])return t;if(n=this.page){var i=new a.FormaPGMCache(n,e,o);return o||(this.caches_[r]=i),i}return s.LegacyCoreAssert.fail("FormaPagePGMSource.getGraph: page is out of scope",void 0,"FormaPagePGMSource.getCache","FormaPagePGMSource.swift",46),null},getGraph:function(e){var t;if(t=this.getCache(e)){var n=t.getGraph();return t.adhoc&&t.destroy(),n}return null},getGraphForForma:function(e,t){var n;if(n=this.getCache(t)){var r=n.getGraphForForma(e);return n.adhoc&&n.destroy(),r}return null}}}),r)},MWx2:function(e,t,n){var r,o=t,i=n("oAGj");o.HandleFacade=(r=function(){},i.defineClass({name:"HandleFacade",ctor:r}),r)},MYNe:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.LayerFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"LayerFacade",ctor:r,superName:"CoreObject",statics:{sortInZOrder:function(e){var t=i.clone(e);return i.sortInPlace(t,(function(e,t){return r.getZOrder(e)<r.getZOrder(t)})),t},getZOrder:function(e){var t;return(t=e.controller)?t.getZOrder():0},setZOrder:function(e,t){i.opt(t.controller,(function(t){return t.setZOrder(e)}))},getMinLayerIndex:function(e){var t;return(t=e.controller)?t.getMinLayerIndex():0},getReorderableLayerCount:function(e){var t;return(t=e.controller)?t.getReorderableLayerCount():0},checkForContiguousChunk:function(e,t){var n=i.clone(r.sortInZOrder(t)),o=r.getMinLayerIndex(t[0]),a=r.getReorderableLayerCount(t[0])+o-1,s=0,l=0;if("backward"==e||"back"==e){if(r.getZOrder(n[0])==o)for(var u=i.iter(i.range(1,n.length-1,!0));!u.done;u.next()){var c=n[f=u.value],d=n[f-1];if(r.getZOrder(c)-r.getZOrder(d)!=1)break;s+=1}if(0!=s)return i.dropFirst(n,s+1)}else if("forward"==e||"front"==e){var h=i.last(n);if(r.getZOrder(h)==a)for(var p=i.iter(i.range(1,n.length-1,!0).reversed());!p.done;p.next()){var f;if(c=n[f=p.value],d=n[f-1],r.getZOrder(c)-r.getZOrder(d)!=1)break;l+=1}if(0!=l)return i.dropLast(n,l+1)}return n}}}),r),o.ZOrderEnum=i.defineEnum("ZOrderEnum",{Forward:"forward",Backward:"backward",Front:"front",Back:"back"})},N5RB:function(e,t,n){var r,o,i,a,s,l=t,u=n("oAGj"),c=n("SpAV"),d=n("fVJ2"),h=n("13MC"),p=n("ZhwN"),f=n("iCxV"),m=n("8vXU"),g=n("rxGp"),y=n("fNpk");l.IDatabase=u.defineProtocol("IDatabase",{host:"IDBObject",deletedObject:"IDBObject",transactionDepth:"Integer",beginTransaction:"(String, IDBState) -> ITransaction",endTransaction:"(ITransaction) -> Void",addListener:"(IDatabaseListener) -> Void",removeListener:"(IDatabaseListener) -> Void",appliedState:"IDBState",mutableState:"IDBMutableState",immutableState:"IDBState",beginBranch:"(String, IDBState, Boolean) -> IDBState",applyBranch:"(String) -> Void",branch:"String",getState:"(String) -> IDBState",newState:"(String, IDBState) -> (String, IDBMutableState)",commitState:"(IDBMutableState) -> Void",commitAndMergeState:"(IDBMutableState) -> Void",abandonState:"(IDBMutableState) -> Void",stateChanged:"(IDBState) -> Void",objectStateChanged:"(IDBObjectState) -> Void",getBranch:"(String, IDBState) -> Array<IDBState>",getBranchHead:"(String) -> IDBState",getObject:"(String) -> DBObject",createObject:"(String, IDBLink) -> DBObject",addObject:"(String, DBObject) -> Void",stageObjectState:"(String, String, IDBObjectState) -> Void",removeObject:"(String) -> Void"}),l.IDatabaseListener=u.defineProtocol("IDatabaseListener",{onBeginTransaction:"(IDatabase, ITransaction) -> Void",onEndTransaction:"(IDatabase, ITransaction) -> Void",onStateChanged:"(IDatabase, IDBState) -> Void",onObjectStateChanged:"(IDatabase, IDBObjectState) -> Void"}),l.PostDBInitialTransaction=(r=function(e,t,n){var r;void 0===n&&(n=null);var o=e.newState((r=n)||null!=r?r:l.PostDB.undoBranchID,null);this.name=t,this.parentDB_=e,this.state=o.state},u.defineClass({name:"PostDBInitialTransaction",ctor:r,statics:{_implements:function(e){return"ITransaction"==e}},props:{parent:{get:function(){return null}},child:{get:function(){return null}},depth:{get:function(){return null==this.parent?1:this.parent.depth+1}},description:{get:function(){return null==this.parent?this.name:this.parent.description+", "+this.name}},end:function(){this.parentDB_.commitState(this.state),this.parentDB_.endTransaction(this)},mergeWithPrevious:function(){this.parentDB_.commitAndMergeState(this.state),this.parentDB_.endTransaction(this)},rollback:function(){this.parentDB_.abandonState(this.state),this.parentDB_.endTransaction(this)}}}),r),l.WeakListener=(o=function(){},u.defineClass({name:"WeakListener",ctor:o,props:{init_cbb0:function(e,t){this.listener_=e,this.db_=t},onBeginTransaction:function(e){var t=this;null!=this.db_&&u.opt(this.listener_,(function(n){return n.onBeginTransaction(t.db_,e)}))},onEndTransaction:function(e){var t=this;null!=this.db_&&u.opt(this.listener_,(function(n){return n.onEndTransaction(t.db_,e)}))},onStateChanged:function(e){var t=this;null!=this.db_&&u.opt(this.listener_,(function(n){return n.onStateChanged(t.db_,e)}))},onObjectStateChanged:function(e){var t=this;null!=this.db_&&u.opt(this.listener_,(function(n){return n.onObjectStateChanged(t.db_,e)}))},init_implicit:function(e,t){this.listener_=e,this.db_=t},clone:function(){return o.init_implicit(this.listener_,this.db_)}}}),o),l.WeakState=(i=function(){},u.defineClass({name:"WeakState",ctor:i,props:{init_9ed3:function(e){this.state=e},init_implicit:function(e){this.state=e},clone:function(){return i.init_implicit(this.state)}}}),i),l.PostDocumentState=(a=function(e){this.state_=e},u.defineClass({name:"PostDocumentState",ctor:a,statics:{_implements:function(e){return"IDocumentState"==e}},props:{state:{get:function(){return this.state_}},stateGUID:{get:function(){return this.state.guid}},updateStateFromDatabase:function(e){var t;(t=e.getState(this.stateGUID))&&(this.state_=t)}}}),a),l.PostDB=(s=function(){this.initialTransaction_=null,this.initialized_=!1,this.listeners_=[],this.states_={},this.branches_={},this.appliedState_=null,this.hostObjectID_=null,this.objects_={},this.objectInitialStates_={},this.objectTypes_={},this.deletedObject_=null,this.rootState=null,this.currentState=null,this.stateManagerTransactions=[]},u.defineClass({name:"PostDB",ctor:s,statics:{undoBranchID:"undo",_implements:function(e){return"IDatabase"==e||"IDocumentStateManager"==e}},props:{deletedObject:{get:function(){return null==this.deletedObject_&&(this.deletedObject_=new d.DBDeletedObject(this)),this.deletedObject_}},transaction:{get:function(){return this.initialized_?u.opt(this.mutableState,(function(e){return e.parentTransaction})):this.initialTransaction_}},transactionDepth:{get:function(){var e;return(e=u.opt(this.transaction,(function(e){return e.depth})))||null!=e?e:0}},transactionStackDescription:{get:function(){var e;return(e=u.opt(this.transaction,(function(e){return e.description})))||null!=e?e:""}},defaultTransactionState:{get:function(){return this.appliedState_||this.stateFromDocumentState(this.currentState)||this.branches_[this.branch]}},beginTransaction:function(e,t){var n;if(n=t||this.mutableState||this.defaultTransactionState){var r="["+(null!=n.transaction?n.transaction.description+", ":"")+"+"+e+"]";return f.Host.logging.logForCategory(g.LogCategories.kTransaction,"transaction: begin "+r,m.LogLevelEnum.INFO_LEVEL),n.beginTransaction(e)}return y.LegacyCoreAssert.isTrue(0==u.count(this.branches_),"If we can't find a transaction state, our branches should be empty",void 0,"PostDB.beginTransaction","Database.swift",263),y.LegacyCoreAssert.isTrue(null==this.initialTransaction_&&0==this.initialized_,"Database already initialized. Why couldn't we find a transaction state?",void 0,"PostDB.beginTransaction","Database.swift",264),this.initialTransaction_=new l.PostDBInitialTransaction(this,e),this.initialTransaction_},beginBranch:function(e,t,n){y.LegacyCoreAssert.isTrue(t instanceof h.DBState||null==t&&this.immutableState instanceof h.DBState,"The database may only be branched from an immutable state.",void 0,"PostDB.beginBranch","Database.swift",270);var r=p.GUIDUtils.makeGUID(),o=t||this.immutableState,i=h.DBState.init_62ed(o,e,r,{});return n&&(i.apply(),this.appliedState_=i),this.branches_[e]=i,i},applyBranch:function(e){var t;(t=this.getBranchHead(e))&&(t.apply(),this.appliedState_=t)},branch:{get:function(){var e;return(e=u.opt(this.appliedState_,(function(e){return e.branch})))||null!=e?e:s.undoBranchID}},endTransaction:function(e){f.Host.logging.logForCategory(g.LogCategories.kTransaction,"transaction: end   "+e.description,m.LogLevelEnum.INFO_LEVEL);for(var t=u.iter(this.listeners_);!t.done;t.next())t.value.onEndTransaction(e);e===this.initialTransaction_&&(this.initialTransaction_=null,this.initialized_=!0)},addListener:function(e){this.removeListener(e),this.listeners_.push(l.WeakListener.init_cbb0(e,this))},removeListener:function(e){this.listeners_=this.listeners_.filter((function(t){return null!=t.listener_&&t.listener_!==e}),this)},appliedState:{get:function(){return this.appliedState_}},mutableState:{get:function(){return this.initialized_?u.opt(this.appliedState_,(function(e){return e.mutableState})):u.opt(this.initialTransaction_,(function(e){return e.state}))}},immutableState:{get:function(){for(var e=this.defaultTransactionState;u.is(e,h.IDBMutableState);)e=u.opt(e,(function(e){return e.basedOn}));return e}},getState:function(e){return u.opt(this.states_[e],(function(e){return e.state}))},newState:function(e,t){var n=p.GUIDUtils.makeGUID(),r=t||this.defaultTransactionState,o=null==t||this.appliedState_===t&&u.opt(this.appliedState_,(function(t){return t.branch==e})),i=null!=r?h.DBMutableState.init_1198(r,e,n):h.DBMutableState.init_4be2(this,e,n);if(o)for(var a=u.iter(i.objectStates);!a.done;a.next())a.value.apply(null);return this.states_[n]=u.clone(l.WeakState.init_9ed3(i)),o&&(this.branches_[e]=i,this.appliedState_=i),{guid:n,state:i}},commitState:function(e){this.initialized_&&y.LegacyCoreAssert.isTrue(u.opt(e.basedOn,(function(e){return null!=e.transaction})),"commitState transaction stack underflow",void 0,"PostDB.commitState","Database.swift",361);var t,n,r=e,o=r.guid,i=r.branch,a=r.basedOn,s=e===this.appliedState_;if(0==u.count(r.objectStates)&&null!=a)this.branches_[i]=a,u.removeKey(this.states_,o);else if(t=u.as(a,h.IDBMutableState))t.flattenFrom(e),this.branches_[i]=t,u.removeKey(this.states_,o);else{var d=e.commit();this.branches_[i]=d,this.states_[o]=u.clone(l.WeakState.init_9ed3(d))}s&&((n=this.branches_[i])?(u.opt(this.host_,(function(e){return e.willApplyDatabaseState(n)})),u.opt(u.as(n,h.DBState),(function(e){return e.applyInternal(!1)})),this.appliedState_=n,u.opt(this.host_,(function(e){return e.didApplyDatabaseState(n)}))):(this.appliedState_=null,c.CoreAssert.fail("Database: no state to apply?",void 0,"PostDB.commitState","Database.swift",397)))},commitAndMergeState:function(e){var t=this;if(this.initialized_&&y.LegacyCoreAssert.isTrue(u.opt(e.basedOn,(function(e){return null!=e.transaction})),"commitAndMergeState transaction stack underflow",void 0,"PostDB.commitAndMergeState","Database.swift",404),s=u.as(e,h.DBMutableState)){var n,r=s.branch,o=e===this.appliedState_,i=s.guid;if(n=u.as(s.basedOn,h.IDBMutableState)){if(n.flattenFrom(e),this.branches_[r]=n,o){for(var a=u.iter(n.objectStates);!a.done;a.next()){var s;(s=a.value).apply(null)}this.appliedState_=n}u.removeKey(this.states_,s.guid)}else{var c,d,p,f={};if(c=s.basedOn){for(var m=u.iter(c.objectStates);!m.done;m.next()){var g=m.key,_=m.value;g!=this.hostObjectID_&&null==this.objects_[g]||(y.LegacyCoreAssert.isFalse(_ instanceof h.DBObjectMutableState,"Immutable database states should not contain mutable object state",void 0,"PostDB.commitAndMergeState","Database.swift",431),f[g]=_)}u.removeKey(this.states_,c.guid),i=c.guid}if(s.forEachInCommitList((function(e,n){var r,o;if(r=t.getObject(e))if(o=f[e]){var i,a;if(n!==o&&((i=u.as(o,h.IDBObjectAncestorState))&&(a=u.as(n,h.IDBObjectDerivedState))?y.LegacyCoreAssert.isTrue(i.isAncestorOf(a),"Merging descendant database states shouldn't merge non-descendant object states",void 0,"PostDB.commitAndMergeState","Database.swift",446):y.LegacyCoreAssert.fail("Expected to merge a derived state into an ancestor state",void 0,"PostDB.commitAndMergeState","Database.swift",449)),T=u.as(o,h.DBChildObjectState))for(var s=u.clone(T.diff(n)),l=u.iter(s);!l.done;l.next()){var c,d=l.key;(c=l.value[1])?T.setProperty(d,c):T.removeProperty(d)}else{var p,m={},g=[];u.append(g,u.keys(o.properties)),u.keys(n.properties).forEach((function(e){g.includes(e)||g.push(e)})),g.forEach((function(e){m[e]=n.getProperty(e)})),(p=u.as(u.opt(u.as(o,h.IDBObjectDerivedState),(function(e){return e.basedOn})),h.DBObjectState))?(f[e]=h.DBObjectState.init_9f95(p,m),r.state=f[e]):(f[e]=h.DBObjectState.init_2a9a(r,m),r.state=f[e])}}else{var _,T,v;(_=u.as(n,h.DBObjectMutableState))?f[e]=_.assign(r):(T=u.as(n,h.DBChildObjectState))?f[e]=T:(v=u.as(n,h.DBObjectState))&&(f[e]=v)}})),u.removeKey(this.states_,s.guid),d=u.as(u.opt(s.basedOn,(function(e){return e.basedOn})),h.DBMutableState)){var T=h.DBMutableState.init_62ed(d,r,i,f);this.branches_[r]=T}else(p=u.as(u.opt(s.basedOn,(function(e){return e.basedOn})),h.DBState))?this.branches_[r]=h.DBState.init_62ed(p,r,i,f):this.branches_[r]=h.DBState.init_40bf(this,r,i,f);if(this.states_[i]=u.clone(l.WeakState.init_9ed3(this.branches_[r])),u.opt(this.currentState,(function(e){return e.updateStateFromDatabase(t)})),o){for(var v=u.iter(this.branches_[r].objectStates);!v.done;v.next())(_=v.value).apply(null);this.appliedState_=this.branches_[r]}}}},abandonState:function(e){var t,n=e,r=e===this.appliedState_,o=n.branch,i=n.basedOn;e.abandon(),this.branches_[o]=i,r&&(t=this.branches_[o])&&(u.opt(this.host_,(function(e){return e.willApplyDatabaseState(t)})),t.apply(),this.appliedState_=t,u.opt(this.host_,(function(e){return e.didApplyDatabaseState(t)})))},stateChanged:function(e){for(var t=u.iter(this.listeners_);!t.done;t.next())t.value.onStateChanged(e)},objectStateChanged:function(e){for(var t=u.iter(this.listeners_);!t.done;t.next())t.value.onObjectStateChanged(e)},getBranch:function(e,t){var n,r=[];if(n=this.branches_[e]){var o=u.opt(t,(function(e){return e.guid}));r.splice(0,0,n);for(var i=r[0].basedOn;null!=i&&(r.splice(0,0,i),i.guid!=o);)i=r[0].basedOn}return r},getBranchHead:function(e){return this.branches_[e]},getObject:function(e){return e==this.hostObjectID_?this.host_:this.objects_[e]},createObject:function(e,t){var n=this.getObject(e);return null==n&&(this.instantiateObject(e,t),n=this.objects_[e]),n},setAddedObjectState:function(e,t){var n;(n=u.as(t,h.IDBObjectAncestorState))?u.opt(this.mutableState,(function(t){return t.addNewObject(e,h.DBObjectMutableState.init_226b(n))})):u.opt(this.mutableState,(function(n){return n.addNewObject(e,t)}))},addObject:function(e,t){var n,r,o;if(t instanceof d.DBHostObject?(y.LegacyCoreAssert.isTrue(null==this.hostObjectID_,"Host object already added",void 0,"PostDB.addObject","Database.swift",599),this.hostObjectID_=e):this.objects_[e]=t,n=this.objectInitialStates_[e])if(u.removeKey(this.objectInitialStates_,e),u.removeKey(this.objectTypes_,e),o=u.as(n,h.DBObjectMutableState)){var i=o.assign(t);this.setAddedObjectState(t,i)}else this.setAddedObjectState(t,n);else if(r=u.as(t.state,h.DBChildObjectState)){var a;if(t.persisted||t.persistToDatabase(this,e),null!=(a=u.opt(this.mutableState,(function(e){return e.branch}))))for(var s=u.iter(this.getBranch(a,null));!s.done;s.next()){var l,c=s.value;(l=u.as(c,h.DBMutableState))&&l.addNewObject(t,r)}}else y.LegacyCoreAssert.isTrue(null!=this.mutableState,"Adding an object without a staged state to an immutable database",void 0,"PostDB.addObject","Database.swift",628),t.initialized||(t.state=t.emptyState),this.setAddedObjectState(t,t.initialState)},stageObjectState:function(e,t,n){this.objectInitialStates_[e]=n,this.objectTypes_[e]=t},removeObject:function(e){u.removeKey(this.objects_,e),u.removeKey(this.objectInitialStates_,e),u.removeKey(this.objectTypes_,e),null!=this.mutableState&&this.mutableState.removeObject(e)},host:{get:function(){return this.host_},set:function(e){y.LegacyCoreAssert.isTrue(null==this.host_,"Host already set",void 0,"PostDB","Database.swift",654),this.host_=e}},instantiateObject:function(e,t){var n,r,o,i;(n=this.objectInitialStates_[e])&&null!=(r=this.objectTypes_[e])&&null!=(o=d.DBHostObject.factory(r))&&(u.removeKey(this.objectInitialStates_,e),u.removeKey(this.objectTypes_,e),(i=u.as(o(e,this,n,t),d.DBObject))&&(i instanceof d.DBHostObject?(y.LegacyCoreAssert.isTrue(null==this.hostObjectID_,"Host object already added",void 0,"PostDB.instantiateObject","Database.swift",669),this.hostObjectID_=e):null==this.objects_[e]&&(this.objects_[e]=i)))},stateFromDocumentState:function(e){var t=this;return y.LegacyCoreAssert.isTrue(null==e||null!=this.states_[e.stateGUID],"Document state removed from the database",void 0,"PostDB.stateFromDocumentState","Database.swift",686),u.opt(e,(function(e){return e.updateStateFromDatabase(t)})),u.opt(e,(function(e){return e.state}))},resetStates:function(){var e;(e=this.branches_[s.undoBranchID])&&(this.rootState=new l.PostDocumentState(e),this.currentState=this.rootState)},getRootState:function(){return this.rootState},beginNewState:function(e){this.stateManagerTransactions.push(this.beginTransaction(e,this.mutableState||this.appliedState_||this.stateFromDocumentState(this.currentState)))},endNewState:function(){var e,t=this.stateManagerTransactions.pop(),n=t.name,r=(e=u.opt(u.opt(u.opt(this.mutableState,(function(e){return e.basedOn})),(function(e){return e.transaction})),(function(e){return e.name})))||null!=e?e:"nil";return y.LegacyCoreAssert.isTrue(t===u.opt(u.opt(this.mutableState,(function(e){return e.basedOn})),(function(e){return e.transaction})),"endNewState ending state manager transaction ["+n+"] that isn't the active transaction ["+r+"]",void 0,"PostDB.endNewState","Database.swift",709),t.end(),null==this.mutableState&&(y.LegacyCoreAssert.isTrue(this.appliedState_===this.branches_[s.undoBranchID],"Current state is not the branch head after a transaction",void 0,"PostDB.endNewState","Database.swift",713),this.currentState=new l.PostDocumentState(this.branches_[s.undoBranchID])),this.currentState},setCurrentState:function(e){var t,n;(t=u.as(e,l.PostDocumentState))&&u.opt(this.currentState,(function(e){return e.stateGUID!=t.stateGUID}))&&(n=this.stateFromDocumentState(t))&&(u.opt(this.host_,(function(e){return e.willApplyDatabaseState(n)})),this.currentState=t,n.apply(),this.appliedState_=n,u.opt(this.host_,(function(e){return e.didApplyDatabaseState(n)})))},getNewStateNestingDepth:function(){return this.stateManagerTransactions.length}}}),s)},NxMp:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("cmoc"),l=n("pnSN"),u=n("iCxV"),c=n("fdtz"),d=n("K0Rh"),h=n("djAF"),p=n("kSRw"),f=n("enh0"),m=n("WWR6"),g=n("zjod");o.FormaFactory=i.defineProtocol("FormaFactory",{createForma:"(FormaPage, String) -> Forma"}),o.DefaultFormaFactory=(r=function(){this.constructors_={},this.constructors_[d.RootForma.KIND]=function(e,t){return d.RootForma.init_7186(e)},this.constructors_[f.TextForma.KIND]=function(e,t){return f.TextForma.init_7186(e)},this.constructors_[c.ImageForma.KIND]=function(e,t){return c.ImageForma.init_7186(e)},this.constructors_[m.VectorForma.KIND]=function(e,t){return m.VectorForma.init_7186(e)},this.constructors_[l.GroupForma.KIND]=function(e,t){return l.GroupForma.init_7fcf(e,t)},this.constructors_[p.SmartGroupForma.KIND]=function(e,t){return l.GroupForma.init_7fcf(e,l.GroupForma.KIND)},this.constructors_[s.FrameForma.KIND]=function(e,t){return s.FrameForma.init_7186(e)},this.constructors_[h.ShapeForma.KIND]=function(e,t){return h.ShapeForma.init_7186(e)},this.constructors_[g.VideoForma.KIND]=function(e,t){return g.VideoForma.init_7186(e)},a.CoreObject.call(this)},i.defineClass({name:"DefaultFormaFactory",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"FormaFactory"==e}},props:{createForma:function(e,t){var n=this.constructors_[t];return null==n?(i.opt(u.Host.logging,(function(e){return e.warning("createForma: No constructor for kind "+t+" available.")})),null):n(e,t)}}}),r)},O60Y:function(e,t,n){var r,o=t,i=n("oAGj");o.IDBLink=i.defineProtocol("IDBLink",{database:"IDatabase",referenceID:"String",backLink:"IDBLink",dereference:"() -> DBObject"}),o.DBLink=(r=function(){this.keepAlive_=null},i.defineClass({name:"DBLink",ctor:r,statics:{_implements:function(e){return"IDBLink"==e}},props:{init_8408:function(e,t,n){this.objID_=e,this.db_=t,this.backLinkID_=n},init_14fa:function(e,t){this.objID_=e.id,this.db_=e.persisted?e.database:null,this.backLinkID_=t,this.keepAlive_=e},database:{get:function(){return this.db_}},referenceID:{get:function(){return this.objID_}},backLink:{get:function(){return null!=this.backLinkID_?r.init_8408(this.backLinkID_,this.db_,this.objID_):null}},dereference:function(){var e;return(e=this.keepAlive_)?e:(this.keepAlive_=this.db_.createObject(this.objID_,this),this.keepAlive_)}}}),r)},O8XL:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("0wFF"),l=n("cZuM"),u=n("gXiO"),c=n("wNKJ"),d=n("FNB+"),h=n("iCxV"),p=n("fNpk"),f=n("tGKA"),m=n("3DEm");i.DistributeType=a.defineEnum("DistributeType",{HorizontalSpace:0,LeftEdge:1,CenterX:2,RightEdge:3,VerticalSpace:4,TopEdge:5,CenterY:6,BottomEdge:7,Row:8,Column:9}),i.describeDistributeType=function(e){switch(e){case 0:return"HorizontalSpace";case 1:return"LeftEdge";case 2:return"CenterX";case 3:return"RightEdge";case 4:return"VerticalSpace";case 5:return"TopEdge";case 6:return"CenterY";case 7:return"BottomEdge";case 8:return"Row";case 9:return"Column"}},i.FormaGeometryInfo=(r=function(){this.minEdge=99999999.9,this.maxEdge=-99999999.9,this.totalObjectSpan=0,this.interiorFormaeSortedByPosition=[]},a.defineClass({name:"FormaGeometryInfo",ctor:r,props:{getNumFormae:function(){return a.eq(d._equality_Forma_Forma,this.firstForma,this.lastForma)?this.interiorFormaeSortedByPosition.length+1:this.interiorFormaeSortedByPosition.length+2}}}),r),i.AlignmentFacade=(o=function(){u.CoreObject.call(this)},a.defineClass({name:"AlignmentFacade",ctor:o,superName:"CoreObject",statics:{arrangeFormae:function(e,t){a.opt(h.Host.logging,(function(n){return n.logToAnalytics(s.AnalyticsConstants.kAnalyticsFormaeArranged,{contextualData1:"horizontal: "+e,contextualData2:"formae count: "+t.length})})),o.distributeOrArrangeFormae(e?i.DistributeType.Row:i.DistributeType.Column,t),o.rescueFormae(t)},distributeFormae:function(e,t){a.opt(h.Host.logging,(function(n){return n.logToAnalytics(s.AnalyticsConstants.kAnalyticsFormaeDistributed,{contextualData1:"type: "+i.describeDistributeType(e),contextualData2:"formae count: "+t.length})})),p.LegacyCoreAssert.isTrue(t.length>2,"not enough formae to distribute",void 0,"AlignmentFacade.distributeFormae","AlignmentFacade.swift",79),p.LegacyCoreAssert.isTrue(e!=i.DistributeType.Row&&e!=i.DistributeType.Column,"Use arrangeFormae to do row/column layout",void 0,"AlignmentFacade.distributeFormae","AlignmentFacade.swift",80),o.distributeOrArrangeFormae(e,t),o.rescueFormae(t)},alignFormae:function(e,t){e==l.AlignmentType.CenterX||e==l.AlignmentType.CenterY?o.alignCenters(e,t):o.alignEdges(e,t),o.rescueFormae(t)},rescueFormae:function(e){for(var t=a.iter(e);!t.done;t.next()){var n=t.value;c.DragFacade.rescueFormaToPageBounds(n)}},calculateFormaGeometryInfo:function(e,t){p.LegacyCoreAssert.isTrue(t.length>=2,"Not enough forma to distribute",void 0,"AlignmentFacade.calculateFormaGeometryInfo","AlignmentFacade.swift",105);for(var n=new i.FormaGeometryInfo,r=a.iter(t);!r.done;r.next()){var s=r.value.controller.getUserPerceivedFrame();if(null!=s)switch(e){case 0:case 1:case 2:case 3:case 8:n.minEdge=m.MathUtils.minDouble(n.minEdge,s.minX),n.maxEdge=m.MathUtils.maxDouble(n.maxEdge,s.maxX),n.totalObjectSpan+=s.maxX-s.minX;break;case 4:case 5:case 6:case 7:case 9:n.minEdge=m.MathUtils.minDouble(n.minEdge,s.minY),n.maxEdge=m.MathUtils.maxDouble(n.maxEdge,s.maxY),n.totalObjectSpan+=s.maxY-s.minY}}var l=a.sort(t,(function(t,n){var r=t.controller.getUserPerceivedFrame(),o=n.controller.getUserPerceivedFrame();if(null!=r&&null!=o)switch(e){case 0:case 1:case 2:case 3:case 8:return r.minX<o.minX;case 4:case 5:case 6:case 7:case 9:return r.minY<o.minY}return!1}));n.firstForma=a.first(l),n.lastForma=a.last(l);for(var u=a.iter(l);!u.done;u.next()){var c=u.value,h=c.controller.getUserPerceivedFrame(),f=n.firstForma.controller.getUserPerceivedFrame(),g=n.lastForma.controller.getUserPerceivedFrame();switch(e){case 0:case 1:case 2:case 3:case 8:o.isVeryClose(f.minX,h.minX)&&h.width>f.width&&(n.firstForma=c),(h.maxX>g.maxX||o.isVeryClose(h.maxX,g.maxX)&&h.width>g.width)&&(n.lastForma=c);break;case 4:case 5:case 6:case 7:case 9:o.isVeryClose(f.minY,h.minY)&&h.height>f.height&&(n.firstForma=c),(h.maxY>g.maxY||o.isVeryClose(h.maxY,g.maxY)&&h.height>g.height)&&(n.lastForma=c)}}return a.remove(l,n.firstForma),a.eq(d._equality_Forma_Forma,n.firstForma,n.lastForma)||a.remove(l,n.lastForma),n.interiorFormaeSortedByPosition=a.clone(l),n},distributeOrArrangeFormae:function(e,t){var n=o.calculateFormaGeometryInfo(e,t);p.LegacyCoreAssert.isTrue(null!=n.firstForma,"expected to have a firstForma computed",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",189),p.LegacyCoreAssert.isTrue(null!=n.lastForma,"expected to have a lastForma computed",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",190),p.LegacyCoreAssert.isTrue(n.getNumFormae()==t.length,"expected sorted formae to match formae list",void 0,"AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",191),e==i.DistributeType.Row||e==i.DistributeType.Column||e==i.DistributeType.VerticalSpace||e==i.DistributeType.HorizontalSpace?o.distributeSpaceOrMakeRowColumn(n,e):o.distributeEdges(n,e)},distributeEdges:function(e,t){p.LegacyCoreAssert.isTrue(e.getNumFormae()>=3,"expected at least 3 items to distribute",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",201),p.LegacyCoreAssert.isTrue(t==i.DistributeType.LeftEdge||t==i.DistributeType.CenterX||t==i.DistributeType.RightEdge||t==i.DistributeType.TopEdge||t==i.DistributeType.CenterY||t==i.DistributeType.BottomEdge,"unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",202);var n=0,r=0,o=e.firstForma.controller.getUserPerceivedFrame(),s=e.lastForma.controller.getUserPerceivedFrame();switch(p.LegacyCoreAssert.isTrue(null!=o&&null!=s,"expecting formae to have frames",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",209),t){case 1:n=o.minX,r=s.minX;break;case 5:n=o.minY,r=s.minY;break;case 3:n=o.maxX,r=s.maxX;break;case 7:n=o.maxY,r=s.maxY;break;case 2:n=(o.maxX+o.minX)/2,r=(s.maxX+s.minX)/2;break;case 6:n=(o.maxY+o.minY)/2,r=(s.maxY+s.minY)/2;break;default:p.LegacyCoreAssert.fail("unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",230)}for(var l=(r-n)/a.toDouble(e.getNumFormae()-1),u=n+l,c=a.iter(e.interiorFormaeSortedByPosition);!c.done;c.next()){var d=c.value,h=d.controller.getUserPerceivedFrame();if(null!=h){var m=0,g=0;switch(t){case 1:m=u-h.minX,u=h.minX+m+l;break;case 3:m=u-h.maxX,u=h.maxX+m+l;break;case 5:g=u-h.minY,u=h.minY+g+l;break;case 7:g=u-h.maxY,u=h.maxY+g+l;break;case 2:var y=(h.maxX+h.minX)/2;u=y+(m=u-y)+l;break;case 6:var _=(h.maxY+h.minY)/2;u=_+(g=u-_)+l;break;default:p.LegacyCoreAssert.fail("unexpected distribute type",void 0,"AlignmentFacade.distributeEdges","AlignmentFacade.swift",270)}if(0!=m||0!=g){var T=new f.Matrix2D(1,0,0,1,m,g);a.opt(d.controller,(function(e){return e.move(T)}))}}}},isVeryClose:function(e,t){return m.MathUtils.absDouble(e-t)<1e-4},getRequiredShiftAmount:function(e,t,n){var r=0;if(n==i.DistributeType.Row||n==i.DistributeType.Column){var o,s,l=e.totalObjectSpan+t*a.toDouble(e.getNumFormae()-1),u=e.firstForma.controller.getUserPerceivedFrame();n==i.DistributeType.Row?(o=u.minX+l,s=e.firstForma.page.pageSize.width):(o=u.minY+l,s=e.firstForma.page.pageSize.height),o>s&&(r=l>s?n==i.DistributeType.Row?-1*u.minX:-1*u.minY:s-o)}return r},getFormaSpacingForRowCol:function(e,t){var n=e.totalObjectSpan/(10*a.toDouble(e.getNumFormae())),r=e.totalObjectSpan/(5*a.toDouble(e.getNumFormae())),i=e.totalObjectSpan/(2*a.toDouble(e.getNumFormae()));return t<0?0:o.isVeryClose(t,n)?r:o.isVeryClose(t,r)?i:o.isVeryClose(t,i)?0:n},distributeSpaceOrMakeRowColumn:function(e,t){var n,r;p.LegacyCoreAssert.isTrue(t==i.DistributeType.Row||t==i.DistributeType.Column||t==i.DistributeType.VerticalSpace||t==i.DistributeType.HorizontalSpace,"wrong distribute type",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",353);var s,l=(e.maxEdge-e.minEdge-e.totalObjectSpan)/a.toDouble(e.getNumFormae()-1),u=e.interiorFormaeSortedByPosition.concat();t!=i.DistributeType.Row&&t!=i.DistributeType.Column||(u.push(e.lastForma),l=o.getFormaSpacingForRowCol(e,l)),s=t==i.DistributeType.Row||t==i.DistributeType.HorizontalSpace?((n=a.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxX})))||null!=n?n:0)+l:((r=a.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxY})))||null!=r?r:0)+l;var c=o.getRequiredShiftAmount(e,l,t);0!=c&&u.splice(0,0,e.firstForma);for(var h=a.iter(u);!h.done;h.next()){var m=h.value,g=m.controller.getUserPerceivedFrame();if(null!=g){var y=0,_=0;if(a.eq(d._equality_Forma_Forma,m,e.firstForma)&&!a.eq(d._equality_Forma_Forma,m,e.lastForma)?(p.LegacyCoreAssert.isTrue(0!=c,"shouldn't be moving first element",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",394),t==i.DistributeType.Row?(y=c,s=g.maxX+y+l):(p.LegacyCoreAssert.isTrue(t==i.DistributeType.Column,"Shouldn't have a shift unless we're doing Row or Column layout",void 0,"AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",400),_=c,s=g.maxY+_+l)):t==i.DistributeType.Row||t==i.DistributeType.HorizontalSpace?(y=s-g.minX,s=g.maxX+y+l):(_=s-g.minY,s=g.maxY+_+l),0!=y||0!=_){var T=new f.Matrix2D(1,0,0,1,y,_);a.opt(m.controller,(function(e){return e.move(T)}))}}}},alignCenters:function(e,t){p.LegacyCoreAssert.isTrue(e==l.AlignmentType.CenterX||e==l.AlignmentType.CenterY,"alignCenters called with non-center alignment type",void 0,"AlignmentFacade.alignCenters","AlignmentFacade.swift",430);for(var n=99999999.9,r=-99999999.9,o=a.iter(t);!o.done;o.next())null!=(c=(u=o.value).controller.getUserPerceivedFrame())&&(e==l.AlignmentType.CenterX?(n=m.MathUtils.minDouble(n,c.minX),r=m.MathUtils.maxDouble(r,c.maxX)):(n=m.MathUtils.minDouble(n,c.minY),r=m.MathUtils.maxDouble(r,c.maxY)));for(var i=(n+r)/2,s=a.iter(t);!s.done;s.next()){var u,c;if(null!=(c=(u=s.value).controller.getUserPerceivedFrame())){var d=0,h=0;if(e==l.AlignmentType.CenterX?d=i-(c.minX+c.maxX)/2:h=i-(c.minY+c.maxY)/2,0!=d||0!=h){var g=new f.Matrix2D(1,0,0,1,d,h);a.opt(u.controller,(function(e){return e.move(g)}))}}}},alignEdges:function(e,t){var n=99999999.9;e!=l.AlignmentType.Right&&e!=l.AlignmentType.Bottom||(n*=-1);for(var r=a.iter(t);!r.done;r.next())null!=(s=(i=r.value).controller.getUserPerceivedFrame())&&(e==l.AlignmentType.Left?n=m.MathUtils.minDouble(n,s.minX):e==l.AlignmentType.Right?n=m.MathUtils.maxDouble(n,s.maxX):e==l.AlignmentType.Top?n=m.MathUtils.minDouble(n,s.minY):e==l.AlignmentType.Bottom?n=m.MathUtils.maxDouble(n,s.maxY):p.LegacyCoreAssert.fail("align to type not yet implemented",{type:e},"AlignmentFacade.alignEdges","AlignmentFacade.swift",493));for(var o=a.iter(t);!o.done;o.next()){var i,s;if(null!=(s=(i=o.value).controller.getUserPerceivedFrame())){var u=0,c=0;if(e==l.AlignmentType.Left?u=n-s.minX:e==l.AlignmentType.Right?u=n-s.maxX:e==l.AlignmentType.Top?c=n-s.minY:e==l.AlignmentType.Bottom&&(c=n-s.maxY),0!=u||0!=c){var d=new f.Matrix2D(1,0,0,1,u,c);a.opt(i.controller,(function(e){return e.move(d)}))}}}}}}),o)},ODYV:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("9oQN"),l=n("9BFu");i.RelayoutEvaluationScore=(r=function e(t){this.rejectThreshold=-1,this.scoreLog="",this.overlapInitial_={},this.outOfBoundsInitial_={},this.orderInitial_={},this.sizesInitial_={},this.initialEmptySpace_=0,this.root_=t,this.floating_=a.clone(t.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),l.WeightedScore.call(this,e.Features.NUM_FEAT),this.initFeatures()},o={},a.defineClass({name:"RelayoutEvaluationScore",ctor:r,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===o.Features&&(o.Features=a.defineEnum("Features",{TEXT_MIN_SIZE:1,GRAPHIC_MIN_SIZE:2,EMPTY_SPACE_DIFF:3,NUM_FEAT:4})),o.Features}},_implements:function(e){return"DocumentEvaluationScore"==e}},props:{initFeatures:function(){this.setFeatureName(r.Features.TEXT_MIN_SIZE,"Text Min Size"),this.setFeatureName(r.Features.GRAPHIC_MIN_SIZE,"Graphic Min Size"),this.setFeatureName(r.Features.EMPTY_SPACE_DIFF,"Empty Size"),this.setWeight(r.Features.TEXT_MIN_SIZE,-1e3),this.setWeight(r.Features.GRAPHIC_MIN_SIZE,-100),this.setWeight(r.Features.EMPTY_SPACE_DIFF,-3),this.setFeature(r.Features.TEXT_MIN_SIZE,0),this.setFeature(r.Features.GRAPHIC_MIN_SIZE,0),this.setFeature(r.Features.EMPTY_SPACE_DIFF,0),this.sizesInitial_=a.clone(s.EvaluationUtils.getFormaSizes(this.floating_)),this.initialEmptySpace_=s.EvaluationUtils.getEmptySpace(this.root_)},evaluateDocument:function(){this.floating_=this.floating_.filter((function(e){return null!=e.root}),this);var e=s.EvaluationUtils.evaluateSizeDifferences(this.floating_,this.sizesInitial_,s.EvaluationUtils.getFormaSizes(this.floating_)),t=e.textDiff,n=e.graphicDiff;this.setFeature(r.Features.TEXT_MIN_SIZE,t),this.setFeature(r.Features.GRAPHIC_MIN_SIZE,n);var o=s.EvaluationUtils.getEmptySpace(this.root_);this.setFeature(r.Features.EMPTY_SPACE_DIFF,Math.max(o-this.initialEmptySpace_,0))},print:function(){return this.asString},reject:function(){return this.score<this.rejectThreshold},evalScore:function(){return this.score}}}),r)},OdB2:function(e,t,n){var r,o,i,a,s,l,u,c,d=t,h=n("oAGj"),p=n("90dd");d.FormaPageView=h.defineProtocol("FormaPageView",{beginViewUpdate:"(FormaUpdateEvent) -> AnyObject",endViewUpdate:"(AnyObject) -> Void",getViewportTransform:"() -> Matrix2D",beginUserResize:"() -> Void",endUserResize:"() -> Void"}),d.FormaBeginUpdateMessage=(r=function e(t,n){this.event=n,p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"FormaBeginUpdateMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaBeginUpdateMessage"}}}}),r),d.FormaEndUpdateMessage=(o=function e(t,n){this.event=n,p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"FormaEndUpdateMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaEndUpdateMessage"}}}}),o),d.PageSizeUpdateMessage=(i=function e(t,n){this.newSize=n,p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"PageSizeUpdateMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"PageSizeUpdateMessage"}}}}),i),d.BeginFormaDragMessage=(a=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"BeginFormaDragMessage",ctor:a,superName:"TheoMessage",statics:{TYPE:{get:function(){return"BeginFormaDragMessage"}}}}),a),d.FormaDragMessage=(s=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"FormaDragMessage",ctor:s,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaDragMessage"}}}}),s),d.EndFormaDragMessage=(l=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"EndFormaDragMessage",ctor:l,superName:"TheoMessage",statics:{TYPE:{get:function(){return"EndFormaDragMessage"}}}}),l),d.BeginFormaResizeMessage=(u=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"BeginFormaResizeMessage",ctor:u,superName:"TheoMessage",statics:{TYPE:{get:function(){return"BeginFormaResizeMessage"}}}}),u),d.EndFormaResizeMessage=(c=function e(t){p.TheoMessage.call(this,e.TYPE,t)},h.defineClass({name:"EndFormaResizeMessage",ctor:c,superName:"TheoMessage",statics:{TYPE:{get:function(){return"EndFormaResizeMessage"}}}}),c)},P83h:function(e,t,n){var r,o,i,a,s,l,u,c,d,h,p,f,m,g,y,_,T,v,C,P,S,D,A,E,R,F,b,I,O,k,N,M,L=t,x=n("oAGj");L.FormaUpdateEvent=(r=function(e,t){this.duration=0,this.type=e,this.forma=t},x.defineClass({name:"FormaUpdateEvent",ctor:r,superName:"CoreObject"}),r),L.TextPlacementEvent=(o=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"TextPlacementEvent",ctor:o,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"TextPlacementEvent"}}}}),o),L.FormaTransformChangedEvent=(i=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaTransformChangedEvent",ctor:i,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaTransformChangedEvent"}}}}),i),L.FormaCreatedEvent=(a=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaCreatedEvent",ctor:a,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaCreatedEvent"}}}}),a),L.FormaNullChangedEvent=(s=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaNullChangedEvent",ctor:s,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaNullChangedEvent"}}}}),s),L.FormaAnimationTransactionEvent=(l=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaAnimationTransactionEvent",ctor:l,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAnimationTransactionEvent"}}}}),l),L.FormaHierarchyChangedEvent=(u=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaHierarchyChangedEvent",ctor:u,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaHierarchyChangedEvent"}}}}),u),L.FormaChildrenEvent=(c=function(e,t,n,r){this._children=n,this.index=r,L.FormaUpdateEvent.call(this,L.FormaInsertedChildrenEvent.TYPE,t)},x.defineClass({name:"FormaChildrenEvent",ctor:c,superName:"FormaUpdateEvent",props:{children:{get:function(){return this._children.concat()}},forEachChild:function(e){this._children.forEach(e)}}}),c),L.FormaInsertedChildrenEvent=(d=function e(t,n,r){L.FormaChildrenEvent.call(this,e.TYPE,t,n,r)},x.defineClass({name:"FormaInsertedChildrenEvent",ctor:d,superName:"FormaChildrenEvent",statics:{TYPE:{get:function(){return"FormaInsertedChildrenEvent"}}}}),d),L.FormaInsertedAuxiliariesEvent=(h=function e(t,n,r){this.auxiliaries=n,this.index=r,L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaInsertedAuxiliariesEvent",ctor:h,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaInsertedAuxiliariesEvent"}}}}),h),L.FormaRemovedChildrenEvent=(p=function e(t,n,r){L.FormaChildrenEvent.call(this,e.TYPE,t,n,r)},x.defineClass({name:"FormaRemovedChildrenEvent",ctor:p,superName:"FormaChildrenEvent",statics:{TYPE:{get:function(){return"FormaRemovedChildrenEvent"}}}}),p),L.FormaRemovedAuxiliariesEvent=(f=function e(t,n,r){this.auxiliaries=n,this.index=r,L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaRemovedAuxiliariesEvent",ctor:f,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaRemovedAuxiliariesEvent"}}}}),f),L.FormaGeometryChangedEvent=(m=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaGeometryChangedEvent",ctor:m,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaGeometryChangedEvent"}}}}),m),L.FormaBoundsInvalidatedEvent=(g=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaBoundsInvalidatedEvent",ctor:g,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaBoundsInvalidatedEvent"}}}}),g),L.FormaPathChangedEvent=(y=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaPathChangedEvent",ctor:y,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaPathChangedEvent"}}}}),y),L.FormaColorChangedEvent=(_=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaColorChangedEvent",ctor:_,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaColorChangedEvent"}}}}),_),L.FormaStrokeChangedEvent=(T=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaStrokeChangedEvent",ctor:T,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaStrokeChangedEvent"}}}}),T),L.FormaFillRuleChangedEvent=(v=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaFillRuleChangedEvent",ctor:v,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaFillRuleChangedEvent"}}}}),v),L.FormaContentChangedEvent=(C=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaContentChangedEvent",ctor:C,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaContentChangedEvent"}}}}),C),L.FormaCutoutChangedEvent=(P=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaCutoutChangedEvent",ctor:P,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaCutoutChangedEvent"}}}}),P),L.FormaStyleChangedEvent=(S=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaStyleChangedEvent",ctor:S,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaStyleChangedEvent"}}}}),S),L.AnimationStyleChangedEvent=(D=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"AnimationStyleChangedEvent",ctor:D,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationStyleChangedEvent"}}}}),D),L.AnimationTimeChangedEvent=(A=function e(t,n){this.time=n,L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"AnimationTimeChangedEvent",ctor:A,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationTimeChangedEvent"}}}}),A),L.AnimationStateChangedEvent=(E=function e(t,n){this.state=n,L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"AnimationStateChangedEvent",ctor:E,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationStateChangedEvent"}}}}),E),L.FormaAnimationChangedEvent=(R=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaAnimationChangedEvent",ctor:R,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAnimationChangedEvent"}}}}),R),L.FormaAlignmentChangedEvent=(F=function e(t,n,r){this.activeSnaplines=x.clone(n),this.nearbySnaplines=x.clone(r),L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaAlignmentChangedEvent",ctor:F,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAlignmentChangedEvent"}}}}),F),L.FormaApplyMaskEvent=(b=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaApplyMaskEvent",ctor:b,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaApplyMaskEvent"}}}}),b),L.FormaVideoStateChangedEvent=(I=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaVideoStateChangedEvent",ctor:I,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaVideoStateChangedEvent"}}}}),I),L.FormaVideoTimeChangedEvent=(O=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaVideoTimeChangedEvent",ctor:O,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaVideoTimeChangedEvent"}}}}),O),L.FormaGroupEvent=(k=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaGroupEvent",ctor:k,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaGroupEvent"}}}}),k),L.FormaUngroupEvent=(N=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaUngroupEvent",ctor:N,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaUngroupEvent"}}}}),N),L.FormaForceRerenderPseudoChangeEvent=(M=function e(t){L.FormaUpdateEvent.call(this,e.TYPE,t)},x.defineClass({name:"FormaForceRerenderPseudoChangeEvent",ctor:M,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaForceRerenderPseudoChangeEvent"}}}}),M)},Pn67:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("YeWL");o.MotionEntryNone=(r=function(){this.srcId="",this.logic=new a.MotionLogicClear,this.args={st:0,dur:1}},i.defineClass({name:"MotionEntryNone",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},Puiz:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("RO7T"),s=n("lWlM"),l=n("iCxV"),u=n("BAdM"),c=n("CqFS");o.PREFIX_CP="cp:",o.PREFIX_AC="ac:",o.JSONNodeDecoder=(r=function(e,t){this.node_=t,a.BaseNodeDecoder.call(this,e)},i.defineClass({name:"JSONNodeDecoder",ctor:r,superName:"BaseNodeDecoder",statics:{_implements:function(e){return"IImportDataObject"==e}},props:{getPropertyOnNode:function(e){return i.as(this.node_[e],"AnyObject")},forEachChild:function(e){var t,n=0;if(t=i.as(this.node_[c.PROPERTY_KEY_CHILDREN],["Array","Any"]))for(var o=i.iter(t);!o.done;o.next()){var a,s=o.value;(a=i.as(s,["Dictionary","String","Any"]))&&(e(new r(this.branch_,a),n),n+=1)}},forEachComponent:function(e){var t,n=0;if(null!=(t=i.as(this.property(c.PROPERTY_KEY_EXTERNAL_URL),"String"))){var r,a,d,h=null;if(t.startsWith(o.PREFIX_CP))null!=(r=i.opt(l.Host.brandkitManager,(function(e){return e.getFilePathForEncodedURL(t)})))?null!=(a=i.opt(l.Host.persistUtils,(function(e){return e.mimeTypeForFileAtPath(r)})))&&null!=(d=i.opt(l.Host.persistUtils,(function(e){return e.fileUrlForPath(r)})))?h=u.JSONComponentDecoder.init_f390(i.opt(l.Host.resourceUtils,(function(e){return e.makeGUID()})),null,this.id,a,null,d):i.opt(l.Host.logging,(function(e){return e.warning("Could not open downloaded file at "+r+"!")})):i.opt(l.Host.logging,(function(e){return e.warning("Do not have a CP file for "+t+"!")}));else if(t.startsWith(o.PREFIX_AC)){var p=t.substr(o.PREFIX_AC.length).split("/")[1];(f=this.branch_.getComponentWithId(p))?h=new s.DCXComponentDecoder(this.branch_,f):i.opt(l.Host.logging,(function(e){return e.warning("No component with id "+p+"!")}))}else if(t.startsWith(c.PREFIX_COMPONENT)){var f;p=t.substr(c.PREFIX_COMPONENT.length).split("/")[1],(f=this.branch_.getComponentWithId(p))?h=new s.DCXComponentDecoder(this.branch_,f):i.opt(l.Host.logging,(function(e){return e.warning("No component with id "+p+"!")}))}else i.opt(l.Host.logging,(function(e){return e.warning("Unrecognized external URL format: "+t+"!")}));null!=h?(e(h,n),n+=1):i.opt(l.Host.logging,(function(e){return e.warning("No component found for "+t)}))}}}}),r)},Q1H8:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("Bqrm"),s=n("pnSN"),l=n("cbNz"),u=n("jC54"),c=n("9BFu");o.DesignScore=(r=function(e){this.versionNumber=1,this.rejectThreshold=-10,this.dataset="DefaultDesignScore",this.root_=e;for(var t,n,r={},o=i.clone(new a.DesignConstraintFeatureExtractor(this.root_).numericalFeatures),u=i.iter(i.keys(o));!u.done;u.next())r[p=u.value]=o[p];if((t=this.root_.controller.getGridController())&&(n=i.as(t.forma,s.GroupForma)))for(var d=i.clone(new l.GridStyleFeatureExtractor(n).numericalFeatures),h=i.iter(i.keys(d));!h.done;h.next()){var p;r[p=h.value]=d[p]}c.WeightedScore.call(this,i.count(r)),this.writeDoubleFeatureDict(this.dataset,r)},i.defineClass({name:"DesignScore",ctor:r,superName:"WeightedScore",props:{writeDoubleFeatureDict:function(e,t){var n=this,r=0;i.each(t,(function(t,o){var i=u.ModelWeightLibrary.getData(e,t);n.setFeatureName(r,t),n.setMean(r,i.mean),n.setStd(r,i.std),n.setWeight(r,i.weight),n.setFeature(r,o),r+=1}))},reject:function(){return this.score<this.rejectThreshold}}}),r)},QBb7:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("90dd");a.ITransaction=s.defineProtocol("ITransaction",{name:"String",description:"String",parent:"ITransaction",child:"ITransaction",depth:"Integer",end:"() -> Void",mergeWithPrevious:"() -> Void",rollback:"() -> Void"}),a.TransactionMessage=(r=function(e,t,n){this.transaction=e,l.TheoMessage.call(this,t,n)},s.defineClass({name:"TransactionMessage",ctor:r,superName:"TheoMessage"}),r),a.TransactionBegunMessage=(o=function e(t,n){a.TransactionMessage.call(this,t,e.TYPE,n)},s.defineClass({name:"TransactionBegunMessage",ctor:o,superName:"TransactionMessage",statics:{TYPE:"DatabaseTransactionBegunMessage"}}),o),a.TransactionEndedMessage=(i=function e(t,n){a.TransactionMessage.call(this,t,e.TYPE,n)},s.defineClass({name:"TransactionEndedMessage",ctor:i,superName:"TransactionMessage",statics:{TYPE:"DatabaseTransactionEndedMessage"}}),i)},QTen:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("ascj"),l=n("uWOl"),u=n("fNpk"),c=n("RkYL");i.VideoStyle=(r=function(){},o={},a.defineClass({name:"VideoStyle",ctor:r,superName:"ImageStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"VideoStyle"}},KIND:{get:function(){return"VideoStyle"}},PROPERTY_VOLUME:"volume",PROPERTY_STARTTIME:"start-time",PROPERTY_DURATION:"duration",volumeOff:0,volumeLow:.3,volumeFull:1,kMaxDuration:{get:function(){return void 0===o.kMaxDuration&&(o.kMaxDuration=c.TheoTime.fromSecondsAsMs(15)),o.kMaxDuration}},kTrimPadding:{get:function(){return void 0===o.kTrimPadding&&(o.kTrimPadding=c.TheoTime.fromSecondsAsMs(3)),o.kTrimPadding}},initialProps:{get:function(){return void 0===o.initialProps&&(o.initialProps={volume:r.volumeFull,"start-time":c.TheoTime.Zero,duration:c.TheoTime.Zero}),o.initialProps}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_d41d()},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){a.super_init(this,l.ImageStyle,l.ImageStyle.prototype.init_866e,e,t)},init_dd5d:function(e,t){for(var n=a.clone(t),o=a.iter(r.initialProps);!o.done;o.next()){var i=o.key,s=o.value;null==e[i]&&null==t[i]&&(n[i]=s)}a.super_init(this,l.ImageStyle,l.ImageStyle.prototype.init_dd5d,e,n)},init_d41d:function(){a.super_init(this,l.ImageStyle,l.ImageStyle.prototype.init_a6fe,r.KIND,l.ImageStyle.DEFAULT_NAME,s.ColorTable.createDefault(),r.initialProps)},volumeLevel:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_VOLUME),"Double"))||null!=e?e:r.volumeFull},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_VOLUME,e),this.notifyAfter()}},startTime:{get:function(){var e,t;return(t=this._transientStartTime)?t:(e=a.as(this.get(r.PROPERTY_STARTTIME),c.TheoTime))||null!=e?e:c.TheoTime.fromSecondsAsMs(0)},set:function(e){u.LegacyCoreAssert.isTrue(null==this._transientStartTime,"Can't set startTime while using transient time",void 0,"VideoStyle","VideoStyle.swift",93),this.notifyBefore(),this.set(r.PROPERTY_STARTTIME,e),this.notifyAfter()}},endTime:{get:function(){return this.startTime.add(this.duration)},set:function(e){this.duration=e.subtract(this.startTime)}},duration:{get:function(){var e,t;return(t=this._transientDuration)?t:(e=a.as(this.get(r.PROPERTY_DURATION),c.TheoTime))||null!=e?e:c.TheoTime.fromSecondsAsMs(0)},set:function(e){u.LegacyCoreAssert.isTrue(null==this._transientDuration,"Can't set startTime while using transient time",void 0,"VideoStyle","VideoStyle.swift",119),this.notifyBefore(),e.seconds>r.kMaxDuration.seconds?this.set(r.PROPERTY_DURATION,r.kMaxDuration):this.set(r.PROPERTY_DURATION,e),this.notifyAfter()}},setTransientTime:function(e,t){var n,r,o=t.safeSubtract(e);(!(n=this._transientStartTime)||!(r=this._transientDuration)||!n.equals(e)||!r.equals(o))&&(this.notifyBefore(),this._transientStartTime=e,this._transientDuration=o,this.notifyAfter())},resetTransientTime:function(){null==this._transientStartTime&&null==this._transientDuration||(this.notifyBefore(),this._transientStartTime=null,this._transientDuration=null,this.notifyAfter())},className:{get:function(){return r.SCHEMA_CLASS_NAME}},match:function(e){var t=this.startTime,n=this.duration;l.ImageStyle.prototype.match.call(this,e),this.startTime=t,this.duration=n},mergeWithImageStyle:function(e){var t,n,o=this,i=null;if(t=e)if(n=a.as(t,r))i=a.as(n.clone(),r),a.opt(i,(function(e){return e.startTime=o.startTime})),a.opt(i,(function(e){return e.duration=o.duration}));else{var s=a.clone(t.state.allProperties),l={volume:this.volumeLevel,"start-time":this.startTime,duration:this.duration,kind:r.KIND};(i=r.init_dd5d(s,l)).colorLibrary=t.colorLibrary}return i},downgradeToImageStyle:function(){var e={kind:l.ImageStyle.KIND};return l.ImageStyle.init_dd5d(this.state.allProperties,e)}}}),r)},Qb69:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("fVJ2"),l=n("dJuF");i.TheoDocumentData=(r=function(){},o={},a.defineClass({name:"TheoDocumentData",ctor:r,superName:"DBObject",statics:{SCHEMA_CLASS_NAME:"TheoDocumentData",codec:{get:function(){return void 0===o.codec&&(o.codec=l.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,l.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},PROPERTY_SHARE_DATA:"shareData",PROPERTY_SCOPE:"scope",_implements:function(e){return"IDBObject"==e}},props:{init_866e:function(e,t){a.super_init(this,s.DBObject,s.DBObject.prototype.init_866e,e,t)},init_d41d:function(){a.super_init(this,s.DBObject,s.DBObject.prototype.init_dd5d,{},{})},className:{get:function(){return r.SCHEMA_CLASS_NAME}},hasBeenPublished:{get:function(){return null!=this.shareData}},listed:{get:function(){return"public"==this.scope},set:function(e){var t=null;this.persisted&&(t=this.database.beginTransaction("scope",null)),this.scope=e?"public":"private",a.opt(t,(function(e){return e.mergeWithPrevious()}))}},shareData:{get:function(){return a.as(this.get(r.PROPERTY_SHARE_DATA),["Dictionary","String","String"])}},scope:{get:function(){var e;return(e=a.opt(this.shareData,(function(e){return e[r.PROPERTY_SCOPE]})))||null!=e?e:""},set:function(e){var t={};null!=this.shareData&&(t=a.clone(this.shareData)),t[r.PROPERTY_SCOPE]=e,this.set(r.PROPERTY_SHARE_DATA,t)}}}}),r)},QbzR:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("ascj"),u=n("dJuF"),c=n("cmoc"),d=n("4mVB"),h=n("ZhwN"),p=n("Qlvz"),f=n("SDdr"),m=n("fNpk"),g=n("Quhx"),y=n("Zifs"),_=n("90dd");a.FormaBlendMode=s.defineEnum("FormaBlendMode",{Normal:0,Screen:1,Multiply:2,Overlay:3,SoftLight:4,HardLight:5,ColorDodge:6,ColorBurn:7,Darken:8,Lighten:9,Difference:10,Exclusion:11,Hue:12,Saturation:13,Color:14,Luminosity:15}),a.FormaStyle=(r=function(){this.notifyDepth_=0},o={},s.defineClass({name:"FormaStyle",ctor:r,superName:"PostPublishingObject",statics:{SCHEMA_CLASS_NAME:{get:function(){return"FormaStyle"}},SCHEMA_ALL_TYPES_NAME:"FormaStyleTypes",codec:{get:function(){return void 0===o.codec&&(o.codec=u.DBPropertyCodec.registerCodec(r.SCHEMA_ALL_TYPES_NAME,u.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},OPACITY_DEFAULT:1,OPACITY_UNSET:-1,PROPERTY_KIND:"kind",PROPERTY_OPACITY:"opacity",PROPERTY_COLORS:"color-table",PROPERTY_FILTER:"filter",PROPERTY_ADJUSTMENTS:"adjustments",PROPERTY_BLENDMODE:"blend-mode",BLEND_MODE_NORMAL:"normal",BLEND_MODE_SCREEN:"screen",BLEND_MODE_MULTIPLY:"multiply",BLEND_MODE_OVERLAY:"overlay",BLEND_MODE_SOFTLIGHT:"softlight",BLEND_MODE_HARDLIGHT:"hardlight",BLEND_MODE_COLORDODGE:"colordodge",BLEND_MODE_COLORBURN:"colorburn",BLEND_MODE_DARKEN:"darken",BLEND_MODE_LIGHTEN:"lighten",BLEND_MODE_DIFFERENCE:"difference",BLEND_MODE_EXCLUSION:"exclusion",BLEND_MODE_HUE:"hue",BLEND_MODE_SATURATION:"saturation",BLEND_MODE_COLOR:"color",BLEND_MODE_LUMINOSITY:"luminosity",PROPERTY_COLORS_DEPRECATED:"colors",KIND:{get:function(){return"FormaStyle"}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_5afe(r.KIND,r.OPACITY_DEFAULT,l.ColorTable.createWithOneSolidColor(y.SolidColor.ZERO))},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_5afe:function(e,t,n,o,i,u){void 0===o&&(o=null),void 0===i&&(i=null),void 0===u&&(u=null);var c={kind:e,opacity:t,"color-table":n||l.ColorTable.createDefault(),adjustments:i||p.ImageAdjustments.createDefault()};if(null!=o&&(c[r.PROPERTY_FILTER]=o),null!=u)for(var d=s.iter(u);!d.done;d.next()){var h=d.key,f=d.value;c[h]=f}s.super_init(this,g.PostPublishingObject,g.PostPublishingObject.prototype.init_dd5d,{},c),null!=o&&(o.style=this),this.beforeMsg_=new a.FormaStyleChangedMessage(this,!1),this.afterMsg_=new a.FormaStyleChangedMessage(this,!0),this.colors.owner=this},init_866e:function(e,t){var n;s.super_init(this,g.PostPublishingObject,g.PostPublishingObject.prototype.init_866e,e,t),(n=s.as(this.get(r.PROPERTY_FILTER),f.ImageFilter))&&(n.style=this),null==s.as(this.get(r.PROPERTY_COLORS),l.ColorTable)&&this.set(r.PROPERTY_COLORS,l.ColorTable.createDefault()),null==s.as(this.get(r.PROPERTY_ADJUSTMENTS),p.ImageAdjustments)&&this.set(r.PROPERTY_ADJUSTMENTS,p.ImageAdjustments.createDefault()),this.beforeMsg_=new a.FormaStyleChangedMessage(this,!1),this.afterMsg_=new a.FormaStyleChangedMessage(this,!0),this.colors.owner=this},init_dd5d:function(e,t){var n,o=s.clone(t);null==e[r.PROPERTY_COLORS]&&null==t[r.PROPERTY_COLORS]&&(o[r.PROPERTY_COLORS]=l.ColorTable.createDefault()),null==e[r.PROPERTY_ADJUSTMENTS]&&null==t[r.PROPERTY_ADJUSTMENTS]&&(o[r.PROPERTY_ADJUSTMENTS]=p.ImageAdjustments.createDefault()),s.super_init(this,g.PostPublishingObject,g.PostPublishingObject.prototype.init_dd5d,e,o),(n=s.as(this.get(r.PROPERTY_FILTER),f.ImageFilter))&&(n.style=this),this.beforeMsg_=new a.FormaStyleChangedMessage(this,!1),this.afterMsg_=new a.FormaStyleChangedMessage(this,!0),this.colors.owner=this},didChangeState:function(e){var t=this;g.PostPublishingObject.prototype.didChangeState.call(this,e),s.opt(this.filter,(function(e){return e.style=t}))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},filter:{get:function(){return s.as(this.get(r.PROPERTY_FILTER),f.ImageFilter)},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_FILTER,e),this.notifyAfter()}},adjustments:{get:function(){return s.as(this.get(r.PROPERTY_ADJUSTMENTS),p.ImageAdjustments)},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_ADJUSTMENTS,e),this.notifyAfter()}},opacity:{get:function(){var e;return(e=s.as(this.get(r.PROPERTY_OPACITY),"Double"))||null!=e?e:r.OPACITY_DEFAULT},set:function(e){e!=this.opacity&&(this.notifyBefore(),this.set(r.PROPERTY_OPACITY,e),this.notifyAfter())}},blendMode:{get:function(){var e;switch((e=s.as(this.get(r.PROPERTY_BLENDMODE),"String"))||null!=e?e:r.BLEND_MODE_NORMAL){case"screen":return a.FormaBlendMode.Screen;case"multiply":return a.FormaBlendMode.Multiply;case"overlay":return a.FormaBlendMode.Overlay;case"softlight":return a.FormaBlendMode.SoftLight;case"hardlight":return a.FormaBlendMode.HardLight;case"colordodge":return a.FormaBlendMode.ColorDodge;case"colorburn":return a.FormaBlendMode.ColorBurn;case"darken":return a.FormaBlendMode.Darken;case"lighten":return a.FormaBlendMode.Lighten;case"difference":return a.FormaBlendMode.Difference;case"exclusion":return a.FormaBlendMode.Exclusion;case"hue":return a.FormaBlendMode.Hue;case"saturation":return a.FormaBlendMode.Saturation;case"color":return a.FormaBlendMode.Color;case"luminosity":return a.FormaBlendMode.Luminosity;default:return a.FormaBlendMode.Normal}},set:function(e){if(e!=this.blendMode){switch(this.notifyBefore(),e){case 1:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_SCREEN);break;case 2:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_MULTIPLY);break;case 3:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_OVERLAY);break;case 4:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_SOFTLIGHT);break;case 5:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_HARDLIGHT);break;case 6:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_COLORDODGE);break;case 7:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_COLORBURN);break;case 8:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_DARKEN);break;case 9:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_LIGHTEN);break;case 10:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_DIFFERENCE);break;case 11:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_EXCLUSION);break;case 12:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_HUE);break;case 13:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_SATURATION);break;case 14:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_COLOR);break;case 15:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_LUMINOSITY);break;default:this.set(r.PROPERTY_BLENDMODE,r.BLEND_MODE_NORMAL)}this.notifyAfter()}}},colorLibrary:{get:function(){return this.colorLibrary_},set:function(e){this.colorLibrary_=e,s.opt(this.colors_,(function(t){return t.library=e}))}},clearColorLibrarySub:function(){s.opt(this.colors_,(function(e){return e.library=null})),this.colorLibrary_=null},setColorLibraryWithoutSubscribing:function(e){this.colorLibrary_=e,this.colors.setColorLibraryWithoutSubscribing(e)},colors_:{get:function(){return s.as(this.get(r.PROPERTY_COLORS),l.ColorTable)},set:function(e){this.set(r.PROPERTY_COLORS,e)}},colors:{get:function(){var e,t;return(e=this.colors_)?e:((t=this.owner_)?m.LegacyCoreAssert.fail("Getting a nil color table from forma style",{kind:t.kind,id:t.id},"FormaStyle","FormaStyle.swift",325):m.LegacyCoreAssert.fail("Getting a nil color table from style with nil forma",void 0,"FormaStyle","FormaStyle.swift",327),l.ColorTable.createDefault())}},dispose:function(){this.colorLibrary=null},owner:{get:function(){return this.owner_},set:function(e){this.owner_=e}},clone:function(){var e,t,n=s.as(this.fork(h.GUIDUtils.makeGUID()),r);return(e=n)&&(e.set(r.PROPERTY_COLORS,s.opt(this.colors_,(function(e){return e.clone()}))||l.ColorTable.createDefault()),e.colors.owner=n,e.colorLibrary=this.colorLibrary),(t=s.as(n,d.GridStyle))&&(t.moveableShift=s.as(this,d.GridStyle).moveableShift),n},cloneToDatabase:function(e){var t=this,n=s.as(this.forkToDatabase(h.GUIDUtils.makeGUID(),!1,e,null),r);return null!=n&&this.persisted&&this.database===e&&(n.colorLibrary=this.colorLibrary),s.opt(n,(function(e){return e.set(r.PROPERTY_COLORS,s.opt(t.colors_,(function(e){return e.clone()}))||l.ColorTable.createDefault())})),s.opt(n,(function(e){return e.colors.owner=n})),s.opt(n,(function(e){return e.colors.library=s.opt(n,(function(e){return e.colorLibrary}))})),n},detachFromDatabase:function(){return this.cloneToDatabase(null)},match:function(e){var t=s.clone(e.state.allProperties);this.notifyBefore(),this.matchProperties(t),this.notifyAfter()},asString:{get:function(){return""}},notifyBefore:function(){this.notifyDepth_+=1,1==this.notifyDepth_&&this.publish(this.beforeMsg_)},notifyAfter:function(){m.LegacyCoreAssert.isTrue(this.notifyDepth_>0,"notifyAfter called but notify depth is not positive",void 0,"FormaStyle.notifyAfter","FormaStyle.swift",425),1==this.notifyDepth_&&this.publish(this.afterMsg_),this.notifyDepth_-=1},colorTableBeforeChanged:function(){this.notifyBefore()},colorTableAfterChanged:function(){this.notifyAfter()},colorTableSupportsRole:function(e){return e==l.ColorRole.FieldPrimary},canColorEntriesBeEmpty:function(){var e;return!(e=this.owner_)||e.kind==c.FrameForma.KIND}}}),r),a.FormaStyleChangedMessage=(i=function e(t,n){this.isBefore=!n,this.isAfter=n,_.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"FormaStyleChangedMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaStyleChangedMessage"}}}}),i)},QgZx:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("SpAV"),s=n("gXiO"),l=n("iCxV"),u=n("fNpk"),c=n("9YN4");o.FontOrigin=i.defineEnum("FontOrigin",{UNKNOWN_ORIGIN:0,USER_CHOSEN:1,STARTUP:2,ACTIVATE_MISSING:3}),o.describeFontOrigin=function(e){switch(e){case 0:return"unknown";case 1:return"user-chosen";case 2:return"startup";case 3:return"activate-missing"}},o.FontSource=i.defineEnum("FontSource",{UNKNOWN_SOURCE:0,WEB_FONT:1,EMBEDDED:2,SPARK_PROVIDED:3,USER_UPLOAD:4,TYPEKIT_FREE:5,TYPEKIT_PREMIUM:6}),o.describeFontSource=function(e){switch(e){case 0:return"unknown";case 1:return"web";case 2:return"embedded";case 3:return"spark";case 4:return"user-upload";case 5:return"typekit-free";case 6:return"typekit-premium"}},o.FontAvailability=i.defineEnum("FontAvailability",{UNKNOWN:0,LOADABLE:1,LOADED:2,NOT_LOADABLE:3}),o.FontEmbeddability=i.defineEnum("FontEmbeddability",{INSTALLABLE:0,RESTRICTED:2,PREVIEW_AND_PRINT:4,EDITABLE:8,NO_SUBSETTING:256,BITMAP_ONLY:512}),i.gvar(o,"fontDescriptorStrings",(function(){return{familyName:function(e,t){e.familyName=t},displaySample:function(e,t){e.displaySample=t},label:function(e,t){e.label=t},postScriptName:function(e,t){e.postScriptName=t},macPostScriptName:function(e,t){e.macPostScriptName=t},filename:function(e,t){e.filename=t},family:function(e,t){e.family=t},original_family:function(e,t){e.original_family=t},faceName:function(e,t){e.faceName=t},category:function(e,t){e.category=t},subfamilyName:function(e,t){e.subfamilyName=t},preferredFamilyName:function(e,t){e.preferredFamilyName=t},preferredSubfamilyName:function(e,t){e.preferredSubfamilyName=t},cssName:function(e,t){e.cssName=t},tkSyncId:function(e,t){e.tkSyncId=t},tkWebId:function(e,t){e.tkWebId=t},style:function(e,t){e.style=t}}})),i.gvar(o,"fontDescriptorDoubles",(function(){return{capAccentRatio:function(e,t){e.capAccentRatio=t},capRatio:function(e,t){e.capRatio=t},meanAccentRatio:function(e,t){e.meanAccentRatio=t},meanRatio:function(e,t){e.meanRatio=t},ascentRatio:function(e,t){e.ascentRatio=t},baselineOffsetRatio:function(e,t){e.baselineOffsetRatio=t},tailRatio:function(e,t){e.tailRatio=t},descentRatio:function(e,t){e.descentRatio=t},italicAngle:function(e,t){e.italicAngle=t},popularity:function(e,t){e.popularity=t}}})),i.gvar(o,"fontDescriptorInts",(function(){return{weight:function(e,t){e.weight=t},source:function(e,t){var n;e.source=(n=o.FontSource.toCaseValue(t))||null!=n?n:o.FontSource.UNKNOWN_SOURCE},formality:function(e,t){e.formality=t},blackness:function(e,t){e.blackness=t},drama:function(e,t){e.drama=t},width:function(e,t){e.width=t},usWidthClass:function(e,t){e.usWidthClass=t},usWeightClass:function(e,t){e.usWeightClass=t},fsType:function(e,t){e.fsType=t}}})),i.gvar(o,"fontDescriptorBools",(function(){return{allCapsAllowed:function(e,t){e.allCapsAllowed=t},displayAllowed:function(e,t){e.displayAllowed=t},bodyAllowed:function(e,t){e.bodyAllowed=t},serif:function(e,t){e.serif=t},slab:function(e,t){e.slab=t},handdrawn:function(e,t){e.handdrawn=t},calligraphic:function(e,t){e.calligraphic=t},decorative:function(e,t){e.decorative=t},square:function(e,t){e.square=t},geometric:function(e,t){e.geometric=t},italic:function(e,t){e.italic=t}}})),o.FontDescriptor=(r=function(e){this.displayFamilyName_="",this.displayFaceName_="",this._source=o.FontSource.UNKNOWN_SOURCE,this.availability=o.FontAvailability.LOADABLE,this._spaceWidthRatio=0,this.capAccentRatio=0,this.capRatio=0,this.meanAccentRatio=0,this.meanRatio=0,this.ascentRatio=0,this.baselineOffsetRatio=0,this.tailRatio=0,this.descentRatio=0,this.italicAngle=0,this.displaySample="",this.upperCaseCharsDict={},this.lowerCaseCharsDict={},this.capAccentCharsDict={},this.capCharsDict={},this.ascentCharsDict={},this.meanAccentCharsDict={},this.meanCharsDict={},this.baseCharsDict={},this.tailCharsDict={},this.descentCharsDict={},this.characterFeatures={},this.label="",this.postScriptName="",this.macPostScriptName="",this.filename="",this.family="",this.original_family="",this.category="",this.familyName="",this.subfamilyName="",this.preferredFamilyName="",this.preferredSubfamilyName="",this.faceName="",this.cssName="",this.tkSyncId="",this.tkWebId="",this.style="",this.popularity=0,this.weight=0,this.formality=0,this.blackness=0,this.drama=0,this.width=0,this.usWidthClass=0,this.usWeightClass=0,this.fsType=0,this.allCapsAllowed=!1,this.displayAllowed=!1,this.bodyAllowed=!1,this.serif=!1,this.slab=!1,this.handdrawn=!1,this.calligraphic=!1,this.decorative=!1,this.square=!1,this.geometric=!1,this.italic=!1,s.CoreObject.call(this);for(var t=i.iter(o.fontDescriptorStrings);!t.done;t.next()){var n=t.key,r=t.value;null!=(f=e[n])&&r(this,f)}for(var l=i.iter(o.fontDescriptorDoubles);!l.done;l.next())n=l.key,r=l.value,null!=(f=e[n])&&r(this,f);for(var u=i.iter(o.fontDescriptorInts);!u.done;u.next())if(n=u.key,r=u.value,null!=(f=e[n]))if("weight"==n&&null!=i.as(f,"String")){var c=f,d=i.isEmpty(c)?0:i.toInt(c);r(this,d>0?d:400)}else if("source"==n){var h=f;this.source=null!=o.FontSource.toCaseValue(h)?o.FontSource.toCaseValue(h):o.FontSource.UNKNOWN_SOURCE}else r(this,f);for(var p=i.iter(o.fontDescriptorBools);!p.done;p.next()){var f;n=p.key,r=p.value,null!=(f=e[n])&&r(this,f)}for(var m=e.uppercaseChars,g=e.lowercaseChars,y=e.capAccentChars,_=e.capChars,T=e.ascentChars,v=e.meanAccentChars,C=e.meanChars,P=e.baseChars,S=e.tailChars,D=e.descentChars,A=i.clone(i.as(e.characterFeatures,["Dictionary","String","Double"])),E=i.iter(i.chars(m));!E.done;E.next()){var R=E.value;this.upperCaseCharsDict[R]=!0}for(var F=i.iter(i.chars(g));!F.done;F.next()){var b=F.value;this.lowerCaseCharsDict[b]=!0}for(var I=i.iter(i.chars(y));!I.done;I.next()){var O=I.value;this.capAccentCharsDict[O]=!0}for(var k=i.iter(i.chars(_));!k.done;k.next()){var N=k.value;this.capCharsDict[N]=!0}for(var M=i.iter(i.chars(T));!M.done;M.next()){var L=M.value;this.ascentCharsDict[L]=!0}for(var x=i.iter(i.chars(v));!x.done;x.next()){var B=x.value;this.meanAccentCharsDict[B]=!0}for(var w=i.iter(i.chars(C));!w.done;w.next()){var G=w.value;this.meanCharsDict[G]=!0}for(var Y=i.iter(i.chars(P));!Y.done;Y.next()){var U=Y.value;this.baseCharsDict[U]=!0}for(var j=i.iter(i.chars(S));!j.done;j.next()){var V=j.value;this.tailCharsDict[V]=!0}for(var H=i.iter(i.chars(D));!H.done;H.next()){var K=H.value;this.descentCharsDict[K]=!0}if(null!=A)for(var W=i.iter(i.keys(A));!W.done;W.next()){var X=W.value;this.characterFeatures[X]=A[X]}0==this.meanRatio&&(a.CoreAssertDebugOnly.fail("FontDescriptor::init - meanRatio is 0 for font "+this.postScriptName+" with variationId "+i.toString(e.variationId),void 0,"FontDescriptor.init","FontDescriptor.swift",432),this.meanRatio=.5,this.capRatio<=0&&(this.capRatio=.75,this.ascentRatio=.75,this.meanAccentRatio=.75,this.capAccentRatio=.75,this.tailRatio=0,this.baselineOffsetRatio=0))},i.defineClass({name:"FontDescriptor",ctor:r,superName:"CoreObject",statics:{PROPERTY_POSTSCRIPT_NAME:"postscript-name",PROPERTY_SOURCE:"source",decodeJson:function(e,t){var n=i.as(e,["Dictionary","String","Any"]);if(null==n)return u.LegacyCoreAssert.fail("FontDescriptorAttribute: Data is missing or not a dictionary",void 0,"FontDescriptor.decodeJson","FontDescriptor.swift",472),null;var a=n[r.PROPERTY_POSTSCRIPT_NAME],s=l.Host.fontProvider.descriptorForPostScriptName(a,i.as(t,c.TheoDocument));return s.postScriptName==a&&s.availability==o.FontAvailability.LOADED||t.recordMissingFont(a),s}},props:{displayFamilyName:{get:function(){return""==this.displayFamilyName_&&(this.displayFamilyName_=this.preferredFamilyName),""==this.displayFamilyName_&&(this.displayFamilyName_=this.familyName),""==this.displayFamilyName_&&(this.displayFamilyName_=this.family),""==this.displayFamilyName_&&(this.displayFamilyName_=this.postScriptName),this.displayFamilyName_},set:function(e){this.displayFamilyName_=e}},displayFaceName:{get:function(){return""==this.displayFaceName_&&(this.displayFaceName_=this.preferredSubfamilyName),""==this.displayFaceName_&&(this.displayFaceName_=this.subfamilyName),""==this.displayFaceName_&&(this.displayFaceName_=this.faceName),""==this.displayFaceName_&&(this.displayFaceName_=this.label),""==this.displayFaceName_&&(this.displayFaceName_=this.postScriptName),this.displayFaceName_},set:function(e){this.displayFaceName_=e}},touaName:{get:function(){return this.displayFamilyName+" "+this.displayFaceName}},source:{get:function(){return this._source},set:function(e){this._source==o.FontSource.EMBEDDED?e!=o.FontSource.EMBEDDED&&i.info("Font "+this.postScriptName+" is already marked as EMBEDDED. Ignoring new font source"):this._source=e}},privateSetFontSource:function(e){this._source=e},spaceWidthRatio:{get:function(){if(0==this._spaceWidthRatio){var e=l.Host.textModelUtils.measureBoundsForLayout(" ",this,100,0);this._spaceWidthRatio=e.width/100}return this._spaceWidthRatio}},resolveFamily:function(){return this.family!=this.cssName||""==this.original_family?this.family:this.original_family},isEqual:function(e){var t=i.as(e,r);return null!=t&&this.postScriptName==t.postScriptName},encodeJson:function(){var e={};return e[r.PROPERTY_POSTSCRIPT_NAME]=this.postScriptName,e[r.PROPERTY_SOURCE]=o.describeFontSource(this.source),e}}}),r),o._equality_FontDescriptor_FontDescriptor=function(e,t){return e.isEqual(t)}},QgdZ:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("7Pku"),s=n("w/+j"),l=n("pnSN"),u=n("Bqrn"),c=n("fNpk"),d=n("c+uM"),h=n("tGKA"),p=n("T8w7"),f=n("Ird5"),m=n("jfma"),g=n("dmHI"),y=n("vTQu"),_=n("yjxF"),T=n("Aj79"),v=n("g6aL"),C=n("Zifs"),P=n("djAF"),S=n("3HaQ"),D=n("enh0"),A=n("8Quq");o.TypeLockupToPGMMapper=(r=function(){u.GroupFormaToPGMMapper.call(this)},i.defineClass({name:"TypeLockupToPGMMapper",ctor:r,superName:"GroupFormaToPGMMapper",statics:{usesPageAnchoredStyle:function(e){var t;if(t=i.as(e.style,d.LockupStyle)){var n=t.backing;return n==d.LockupBacking.BannerHorizontal||n==d.LockupBacking.BannerVertical||n==d.LockupBacking.Banner||n==d.LockupBacking.Knockout}return!1},getPGMForTypeLockup:function(e,t,n){var r=0,o=0,a=function t(a){var u,h,p,g=null,y=null,E=null,R=null;if(u=i.as(a,l.GroupForma)){var F=null,b=null,I=null,O=null;u.childrenAsArray.forEach((function(e){var n=t(e),r=n.shapeRef,o=n.bottomTextRef,i=n.textRef,a=n.knockoutRef;null!=r&&(null==F&&(F=[]),F.push(r)),null!=o&&(null==b&&(b=[]),b.push(o)),null!=i&&(null==I&&(I=[]),I.push(i)),null!=a&&(null==O&&(O=[]),O.push(a))})),null!=F&&(g=s.FormaToPGMUtils.applyAnimations(e,u,new T.PGMReference(new v.PGMSimpleGroup(u.formaID+"-shapes",new _.PGMNodeMetadata(u.formaID,"group"),f.PGMAnimationList.EMPTY,F),m.PGMCompositingParams.smartInit(u.placement)))),null!=b&&(y=s.FormaToPGMUtils.applyAnimations(e,u,new T.PGMReference(new v.PGMSimpleGroup(u.formaID+"-bottomTexts",new _.PGMNodeMetadata(u.formaID,"group"),f.PGMAnimationList.EMPTY,b),m.PGMCompositingParams.smartInit(u.placement)))),null!=I&&(E=s.FormaToPGMUtils.applyAnimations(e,u,new T.PGMReference(new v.PGMSimpleGroup(u.formaID+"-texts",new _.PGMNodeMetadata(u.formaID,"group"),f.PGMAnimationList.EMPTY,I),m.PGMCompositingParams.smartInit(u.placement,u.style.opacity)))),null!=O&&(R=s.FormaToPGMUtils.applyAnimations(e,u,new T.PGMReference(new v.PGMSimpleGroup(u.formaID+"-knockouts",new _.PGMNodeMetadata(u.formaID,"group"),f.PGMAnimationList.EMPTY,O),m.PGMCompositingParams.smartInit(u.placement))))}else if(h=i.as(a,D.TextForma)){r+=1;var k=h.textLook,N=h.fontStrokeWidth,M=new m.PGMCompositingParams(h.placement,h.style.opacity);switch(c.LegacyCoreAssert.isTrue(!d.LockupStyle.isKnockoutLook(k)||k==d.LockupTextLook.KnockoutAndFill||k==d.LockupTextLook.KnockoutAndShadow||i.eq(C._equality_SolidColor_SolidColor,h.fontColor,C.SolidColor.BLACK),"did not set the fill color to black for knockout looks that don't fill",void 0,"TypeLockupToPGMMapper.getPGMForTypeLockup","TypeLockupToPGMMapper.swift",192),k){case 0:var L=A.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt#"+r);if(E=new T.PGMReference(L,M),e.asDynamic){var x=s.FormaToPGMUtils.createAnimations(E,h);E=E.withAnimations(x)}break;case 1:R=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(A.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt#"+r),M));break;case 2:case 6:R=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(A.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt-ko#"+r,C.SolidColor.BLACK),M)),E=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(A.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt-fg#"+r),M));break;case 9:N>0?y=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(A.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt-bg#"+r),M)):R=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(A.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt-ko#"+r),M));break;default:E=s.FormaToPGMUtils.applyAnimations(e,h,new T.PGMReference(A.TextFormaToPGMMapper.getPGMNodeForTextForma(e,h,n+"-txt#"+r),M))}}else(p=i.as(a,P.ShapeForma))&&(o+=1,g=s.FormaToPGMUtils.applyAnimations(e,p,S.ShapeFormaToPGMMapper.makePGMRefForShape(e,p,n+"-shp#"+o)));return{shapeRef:g,bottomTextRef:y,textRef:E,knockoutRef:R}}(t),u=a.shapeRef,E=a.bottomTextRef,R=a.textRef,F=a.knockoutRef,b=i.clone(i.opt(i.as(i.opt(u,(function(e){return e.child})),v.PGMSimpleGroup),(function(e){return e.children}))),I=i.clone(i.opt(i.as(i.opt(E,(function(e){return e.child})),v.PGMSimpleGroup),(function(e){return e.children}))),O=i.clone(i.opt(i.as(i.opt(R,(function(e){return e.child})),v.PGMSimpleGroup),(function(e){return e.children}))),k=i.clone(i.opt(i.as(i.opt(F,(function(e){return e.child})),v.PGMSimpleGroup),(function(e){return e.children})));if(null!=k&&null!=b){var N=new v.PGMSimpleGroup(n+"-mask",new _.PGMNodeMetadata(t.formaID,"mask"),f.PGMAnimationList.EMPTY,k),M=new v.PGMSimpleGroup(n+"-art",new _.PGMNodeMetadata(t.formaID,"art"),f.PGMAnimationList.EMPTY,b);if(null!=O||null!=I){var L=[];null!=I&&L.push(new T.PGMReference(new v.PGMSimpleGroup(n+"-bg",new _.PGMNodeMetadata(t.formaID,"text-on-bottom-of-knockout"),f.PGMAnimationList.EMPTY,I))),L.push(new T.PGMReference(new g.PGMFilter(n+"-ko",new _.PGMNodeMetadata(t.formaID,"shape-knocked-out-by-text"),f.PGMAnimationList.EMPTY,[new T.PGMReference(M),new T.PGMReference(N)],new y.PGMMaskFilterSpec(C.SolidColor.WHITE))));var x=[],B=m.PGMCompositingParams.smartInit(h.Matrix2D.Identity,p.OpacityFacade.getShapeOpacityForForma(t));return x.push(new T.PGMReference(new v.PGMSimpleGroup(n+"-ssg",new _.PGMNodeMetadata(t.formaID,"shape-shadow-group-on-knockout"),f.PGMAnimationList.EMPTY,L),B)),null!=O&&x.push(new T.PGMReference(new v.PGMSimpleGroup(n+"-fg",new _.PGMNodeMetadata(t.formaID,"text-on-top-of-knockout"),f.PGMAnimationList.EMPTY,O))),new v.PGMSimpleGroup(n,new _.PGMNodeMetadata(t.formaID,"lockup-sandwich"),f.PGMAnimationList.EMPTY,x)}var w=[];return w.push(new T.PGMReference(new v.PGMSimpleGroup(n+"-sg",new _.PGMNodeMetadata(t.formaID,"simple-shape-group"),f.PGMAnimationList.EMPTY,b),m.PGMCompositingParams.smartInit(h.Matrix2D.Identity,p.OpacityFacade.getShapeOpacityForForma(t)))),M=new v.PGMSimpleGroup(n+"-art",new _.PGMNodeMetadata(t.formaID,"art"),f.PGMAnimationList.EMPTY,w),new g.PGMFilter(n,new _.PGMNodeMetadata(t.formaID,"simple-text-knockout"),f.PGMAnimationList.EMPTY,[new T.PGMReference(M),new T.PGMReference(N)],new y.PGMMaskFilterSpec(C.SolidColor.WHITE))}var G=[];return null!=b&&G.push(new T.PGMReference(new v.PGMSimpleGroup(n+"-sg",new _.PGMNodeMetadata(t.formaID,"simple-shape-group"),f.PGMAnimationList.EMPTY,b),m.PGMCompositingParams.smartInit(h.Matrix2D.Identity,p.OpacityFacade.getShapeOpacityForForma(t)))),null!=O&&(G=G.concat(O)),new v.PGMSimpleGroup(n,new _.PGMNodeMetadata(t.formaID,"simple-lockup"),f.PGMAnimationList.EMPTY,G)}},props:{makePGMRef:function(e,t,n,o){var i=a.FormaToPGMMapper.mapBlendMode(e);return s.FormaToPGMUtils.applyAnimations(t,e,new T.PGMReference(r.getPGMForTypeLockup(t,e,e.formaID),new m.PGMCompositingParams(e.placement,e.style.opacity,i)))},canDoSimpleTransformUpdate:function(e){return!r.usesPageAnchoredStyle(e.forma)}}}),r)},Qlvz:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("fNpk");o.ImageAdjustments=(r=function e(t,n,r,o,i,a,s,l,u,c,d,h){void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=0),void 0===d&&(d=0),void 0===h&&(h=0),this.name=e.NAME,this.blur_=t,this.sharpness_=n,this.contrast_=l,this.saturation_=i,this.brightness_=a,this.exposure_=s,this.contrast_=l,this.shadows_=r,this.highlights_=o,this.warmth_=u,this.tint_=c,this.fade_=d,this.vibrance_=h},i.defineClass({name:"ImageAdjustments",ctor:r,superName:"CoreObject",statics:{NAME:{get:function(){return"ImageAdjustments"}},PROPERTY_NAME:"name",PROPERTY_BLUR:"blur",PROPERTY_SHARPNESS:"sharpness",PROPERTY_SHADOWS:"shadows",PROPERTY_HIGHLIGHTS:"highlights",PROPERTY_SATURATION:"saturation",PROPERTY_BRIGHTNESS:"brightness",PROPERTY_EXPOSURE:"exposure",PROPERTY_CONTRAST:"contrast",PROPERTY_WARMTH:"warmth",PROPERTY_TINT:"tint",PROPERTY_FADE:"fade",PROPERTY_VIBRANCE:"vibrance",createDefault:function(){return new r(0,0,0,0,0,0,0,0,0,0,0,0)},decodeJson:function(e){if(null==e)return null;var t;if(t=i.as(e,["Dictionary","String","Any"])){var n=r.createDefault();return n.decodeFromJson(t),n}return a.LegacyCoreAssert.fail("ImageFilter.decodeJson: could not create style",void 0,"ImageAdjustments.decodeJson","ImageAdjustments.swift",222),null}},props:{blur:{get:function(){return this.blur_}},scaledBlur:{get:function(){return this.blur_/3}},sharpness:{get:function(){return this.sharpness_}},scaledSharpness:{get:function(){return this.sharpness_/3}},shadows:{get:function(){return this.shadows_}},highlights:{get:function(){return this.highlights_}},saturation:{get:function(){return this.saturation_}},brightness:{get:function(){return this.brightness_}},exposure:{get:function(){return this.exposure_}},contrast:{get:function(){return this.contrast_}},warmth:{get:function(){return this.warmth_}},tint:{get:function(){return this.tint_}},fade:{get:function(){return this.fade_}},vibrance:{get:function(){return this.vibrance_}},copyWithNewValues:function(e,t,n,o,i,a,s,l,u,c,d,h){var p,f,m,g,y,_,T,v,C,P,S,D;return void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===h&&(h=null),new r((p=e)||null!=p?p:this.blur_,(f=t)||null!=f?f:this.sharpness_,(m=n)||null!=m?m:this.shadows_,(g=o)||null!=g?g:this.highlights_,(y=i)||null!=y?y:this.saturation_,(_=a)||null!=_?_:this.brightness_,(T=s)||null!=T?T:this.exposure_,(v=l)||null!=v?v:this.contrast_,(C=u)||null!=C?C:this.warmth_,(P=c)||null!=P?P:this.tint_,(S=d)||null!=S?S:this.fade_,(D=h)||null!=D?D:this.vibrance_)},copyWithNewValue:function(e,t){switch(t){case"blur":return this.copyWithNewValues(e);case"sharpness":return this.copyWithNewValues(void 0,e);case"shadows":return this.copyWithNewValues(void 0,void 0,e);case"highlights":return this.copyWithNewValues(void 0,void 0,void 0,e);case"saturation":return this.copyWithNewValues(void 0,void 0,void 0,void 0,e);case"brightness":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,e);case"exposure":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,e);case"contrast":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);case"warmth":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);case"tint":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);case"fade":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);case"vibrance":return this.copyWithNewValues(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e);default:return this.copyWithNewValues()}},encodeJson:function(){var e={};return e[r.PROPERTY_NAME]=this.name,e[r.PROPERTY_BLUR]=this.blur_,e[r.PROPERTY_SHARPNESS]=this.sharpness_,e[r.PROPERTY_SHADOWS]=this.shadows_,e[r.PROPERTY_HIGHLIGHTS]=this.highlights_,e[r.PROPERTY_SATURATION]=this.saturation_,e[r.PROPERTY_BRIGHTNESS]=this.brightness_,e[r.PROPERTY_EXPOSURE]=this.exposure_,e[r.PROPERTY_CONTRAST]=this.contrast_,e[r.PROPERTY_WARMTH]=this.warmth_,e[r.PROPERTY_TINT]=this.tint_,e[r.PROPERTY_FADE]=this.fade_,e[r.PROPERTY_VIBRANCE]=this.vibrance_,e},decodeFromJson:function(e){var t,n,o,a,s,l,u,c,d,h,p,f,m;this.name=(t=i.as(e[r.PROPERTY_NAME],"String"))||null!=t?t:"",this.blur_=(n=i.as(e[r.PROPERTY_BLUR],"Double"))||null!=n?n:0,this.sharpness_=(o=i.as(e[r.PROPERTY_SHARPNESS],"Double"))||null!=o?o:0,this.shadows_=(a=i.as(e[r.PROPERTY_SHADOWS],"Double"))||null!=a?a:0,this.highlights_=(s=i.as(e[r.PROPERTY_HIGHLIGHTS],"Double"))||null!=s?s:0,this.saturation_=(l=i.as(e[r.PROPERTY_SATURATION],"Double"))||null!=l?l:0,this.brightness_=(u=i.as(e[r.PROPERTY_BRIGHTNESS],"Double"))||null!=u?u:0,this.exposure_=(c=i.as(e[r.PROPERTY_EXPOSURE],"Double"))||null!=c?c:0,this.contrast_=(d=i.as(e[r.PROPERTY_CONTRAST],"Double"))||null!=d?d:1,this.warmth_=(h=i.as(e[r.PROPERTY_WARMTH],"Double"))||null!=h?h:0,this.tint_=(p=i.as(e[r.PROPERTY_TINT],"Double"))||null!=p?p:0,this.fade_=(f=i.as(e[r.PROPERTY_FADE],"Double"))||null!=f?f:0,this.vibrance_=(m=i.as(e[r.PROPERTY_VIBRANCE],"Double"))||null!=m?m:0},clone:function(){return r.decodeJson(this.encodeJson())},equals:function(e){return this.blur==i.opt(e,(function(e){return e.blur}))&&this.sharpness==i.opt(e,(function(e){return e.sharpness}))&&this.shadows==i.opt(e,(function(e){return e.shadows}))&&this.highlights==i.opt(e,(function(e){return e.highlights}))&&this.saturation==i.opt(e,(function(e){return e.saturation}))&&this.brightness==i.opt(e,(function(e){return e.brightness}))&&this.exposure==i.opt(e,(function(e){return e.exposure}))&&this.contrast==i.opt(e,(function(e){return e.contrast}))&&this.warmth==i.opt(e,(function(e){return e.warmth}))&&this.tint==i.opt(e,(function(e){return e.tint}))&&this.fade==i.opt(e,(function(e){return e.fade}))&&this.vibrance==i.opt(e,(function(e){return e.vibrance}))},isDefault:function(){return 0==this.blur&&0==this.sharpness&&0==this.shadows&&0==this.highlights&&0==this.saturation&&0==this.brightness&&0==this.exposure&&0==this.contrast&&0==this.warmth&&0==this.tint&&0==this.fade&&0==this.vibrance},setEnabledKeys:function(e){0!=this.blur&&(e[r.PROPERTY_BLUR]=!0),0!=this.sharpness&&(e[r.PROPERTY_SHARPNESS]=!0),0!=this.shadows&&(e[r.PROPERTY_SHADOWS]=!0),0!=this.highlights&&(e[r.PROPERTY_HIGHLIGHTS]=!0),0!=this.saturation&&(e[r.PROPERTY_SATURATION]=!0),0!=this.brightness&&(e[r.PROPERTY_BRIGHTNESS]=!0),0!=this.exposure&&(e[r.PROPERTY_EXPOSURE]=!0),0!=this.contrast&&(e[r.PROPERTY_CONTRAST]=!0),0!=this.warmth&&(e[r.PROPERTY_WARMTH]=!0),0!=this.tint&&(e[r.PROPERTY_TINT]=!0),0!=this.vibrance&&(e[r.PROPERTY_VIBRANCE]=!0)},asString:{get:function(){return r.PROPERTY_BLUR+": "+this.blur+r.PROPERTY_SHARPNESS+": "+this.sharpness+r.PROPERTY_SHADOWS+": "+this.shadows+r.PROPERTY_HIGHLIGHTS+": "+this.highlights+r.PROPERTY_SATURATION+": "+this.saturation+r.PROPERTY_BRIGHTNESS+": "+this.brightness+r.PROPERTY_EXPOSURE+": "+this.exposure+r.PROPERTY_CONTRAST+": "+this.contrast+r.PROPERTY_WARMTH+": "+this.warmth+r.PROPERTY_TINT+": "+this.tint+r.PROPERTY_FADE+": "+this.fade+r.PROPERTY_VIBRANCE+": "+this.vibrance}}}}),r)},Quhx:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("fVJ2"),l=n("MO6F");i.PostPublishingObject=(r=function(){this.publishing_=new l.TheoBasePublishing},a.defineClass({name:"PostPublishingObject",ctor:r,superName:"DBObject",statics:{_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3f7c:function(e){a.super_init(this,s.DBObject,s.DBObject.prototype.init_3f7c,e),this.publishing_.owner=this},init_866e:function(e,t){a.super_init(this,s.DBObject,s.DBObject.prototype.init_866e,e,t),this.publishing_.owner=this},init_dd5d:function(e,t){a.super_init(this,s.DBObject,s.DBObject.prototype.init_dd5d,e,t),this.publishing_.owner=this},init_11e0:function(e){a.super_init(this,s.DBObject,s.DBObject.prototype.init_11e0,e),this.publishing_.owner=this},init_3181:function(e,t,n){a.super_init(this,s.DBObject,s.DBObject.prototype.init_3181,e,t,n),this.publishing_.owner=this},init_5079:function(e,t,n,r){a.super_init(this,s.DBObject,s.DBObject.prototype.init_5079,e,t,n,r),this.publishing_.owner=this},init_9a09:function(e){a.super_init(this,s.DBObject,s.DBObject.prototype.init_67b3,e),this.publishing_.owner=this},subscribeWithCallback:function(e,t){return this.publishing_.subscribeWithCallback(e,t)},subscribe:function(e,t){return this.publishing_.subscribe(e,t)},unsubscribe:function(e){return this.publishing_.unsubscribe(e)},publish:function(e){this.publishing_.publish(e)}}}),r),i.PostDCXObject=(o=function(){},a.defineClass({name:"PostDCXObject",ctor:o,superName:"PostPublishingObject",statics:{PROPERTY_TYPE:"type",PROPERTY_PATH:"path",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{uuid:{get:function(){return this.id}},type:{get:function(){return a.as(this.get(o.PROPERTY_TYPE),"String")}},path:{get:function(){return a.as(this.get(o.PROPERTY_PATH),"String")}},init_3f7c:function(e){a.super_init(this,i.PostPublishingObject,i.PostPublishingObject.prototype.init_3f7c,e)},init_866e:function(e,t){a.super_init(this,i.PostPublishingObject,i.PostPublishingObject.prototype.init_866e,e,t)},init_dd5d:function(e,t){a.super_init(this,i.PostPublishingObject,i.PostPublishingObject.prototype.init_dd5d,e,t)},init_11e0:function(e){a.super_init(this,i.PostPublishingObject,i.PostPublishingObject.prototype.init_11e0,e)},init_3181:function(e,t,n){a.super_init(this,i.PostPublishingObject,i.PostPublishingObject.prototype.init_3181,e,t,n)},init_5079:function(e,t,n,r){a.super_init(this,i.PostPublishingObject,i.PostPublishingObject.prototype.init_5079,e,t,n,r)},init_9a09:function(e){a.super_init(this,i.PostPublishingObject,i.PostPublishingObject.prototype.init_9a09,e)}}}),o)},"R0Y+":function(e,t,n){var r,o,i,a=t,s=n("oAGj");a.SolidColorWithRole=(r=function(e,t){this.role=e,this.color=t},s.defineClass({name:"SolidColorWithRole",ctor:r}),r),a.TheoColorWithRole=(o=function(e,t){this.role=e,this.color=t},s.defineClass({name:"TheoColorWithRole",ctor:o}),o),a.ThemeColorWithRole=(i=function(e,t){this.role=e,this.color=t},s.defineClass({name:"ThemeColorWithRole",ctor:i}),i)},R19c:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("s/Zj");o.MoaColorMatrix=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"MoaColorMatrix",ctor:r,superName:"CoreObject",statics:{applyVibranceToColorMatrix:function(e,t){var n=Math.max(-100,Math.min(100,t)),o=n/100;r.MoaColorMatrixAdjustVibrance(e,o=n<0?1-o*o:1+1.8*o*o)},MoaColorMatrixAdjustVibrance:function(e,t){var n=1+.7*(t-1),o=t,a=45*Math.PI/180,l=35.26*Math.PI/180,u=s.MoaTransform.init_d41d();u.preRotateX(a),u.preRotateY(-l),u.preScaleXY(n,o),u.preRotateY(l),u.preRotateX(-a);for(var c=i.repeat(0,12),d=i.iter(i.range(0,11,!0));!d.done;d.next()){var h=d.value;c[h]=u.transformMatrix[h]}r.MoaColorMatrixMultiply(e,c)},applySaturationToColorMatrix:function(e,t){var n=Math.max(-100,Math.min(100,t)),o=n/100;r.MoaColorMatrixAdjSaturation(e,o=n<0?1-o*o:1+1.5*o*o)},MoaColorMatrixAdjSaturation:function(e,t){var n=.213*(1-t),o=.715*(1-t),i=.072*(1-t);r.MoaColorMatrixMultiply(e,[n+t,o,i,0,n,o+t,i,0,n,o,i+t,0])},MoaColorMatrixMultiply:function(e,t){var n=i.repeat(0,12);n[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8],n[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9],n[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10],n[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8],n[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9],n[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10],n[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8],n[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9],n[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10],n[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3],n[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7],n[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11];for(var r=i.iter(i.range(0,11,!0));!r.done;r.next()){var o=r.value;e[o]=n[o]}}}}),r)},RBTN:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("Bqrn");o.GridToPGMMapper=(r=function(){a.GroupFormaToPGMMapper.call(this)},i.defineClass({name:"GridToPGMMapper",ctor:r,superName:"GroupFormaToPGMMapper",props:{makePGMRef:function(e,t,n,r){return a.GroupFormaToPGMMapper.prototype.makePGMRef.call(this,e,t,n,r)}}}),r)},RO7T:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ytEx"),s=n("gXiO"),l=n("3OP7"),u=n("fNpk");o.BaseNodeDecoder=(r=function(e){this.branch_=e,s.CoreObject.call(this)},i.defineClass({name:"BaseNodeDecoder",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IImportDataObject"==e}},props:{id:{get:function(){return i.as(this.getPropertyOnNode(a.PROPERTY_KEY_ID),"String")}},name:{get:function(){return i.as(this.getPropertyOnNode(a.PROPERTY_KEY_NAME),"String")}},type:{get:function(){return i.as(this.getPropertyOnNode(a.PROPERTY_KEY_TYPE),"String")}},path:{get:function(){return i.as(this.getPropertyOnNode(a.PROPERTY_KEY_PATH),"String")}},getPropertyOnNode:function(e){return u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeDecoder.getPropertyOnNode","BaseNodeDecoder.swift",35),null},optionalStringProperty:function(e){return i.as(this.property(e),"String")},stringProperty:function(e,t){var n;return(n=i.as(this.property(e),"String"))||null!=n?n:t},numberProperty:function(e,t){var n;return(n=i.as(this.property(e),"Double"))||null!=n?n:t},intProperty:function(e,t){var n;return(n=i.as(this.property(e),"Int"))||null!=n?n:t},booleanProperty:function(e,t){var n;return(n=i.as(this.property(e),"Bool"))||null!=n?n:t},optionalBooleanProperty:function(e){return i.as(this.property(e),"Bool")},property:function(e){var t=l.DocumentPersistenceFactory.namespacedPropertyName(e);return i.as(this.getPropertyOnNode(t),"AnyObject")},forEachChild:function(e){u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeDecoder.forEachChild","BaseNodeDecoder.swift",69)},forEachComponent:function(e){u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeDecoder.forEachComponent","BaseNodeDecoder.swift",73)}}}),r)},SAU6:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("C654");o.MotionEntryStackedRoot=(r=function(){this.srcId="",this.logic=new a.MotionLogicStackedRoot,this.args={lineDur:.3,delay:.5,fadeInDur:.5,endPadDur:3.5}},i.defineClass({name:"MotionEntryStackedRoot",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},SDdr:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("dJuF"),l=n("ZhwN"),u=n("Quhx");i.ImageFilter=(r=function(){},o={},a.defineClass({name:"ImageFilter",ctor:r,superName:"PostPublishingObject",statics:{SCHEMA_CLASS_NAME:{get:function(){return"ImageFilter"}},SCHEMA_ALL_TYPES_NAME:"ImageFilterTypes",codec:{get:function(){return void 0===o.codec&&(o.codec=s.DBPropertyCodec.registerCodec(r.SCHEMA_ALL_TYPES_NAME,s.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},KIND:{get:function(){return"ImageFilter"}},PROPERTY_KIND:"kind",PROPERTY_NAME:"name",createDefault:function(){return r.init_37f0(void 0,r.KIND,{})},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_866e:function(e,t){a.super_init(this,u.PostPublishingObject,u.PostPublishingObject.prototype.init_866e,e,t)},init_dd5d:function(e,t){a.super_init(this,u.PostPublishingObject,u.PostPublishingObject.prototype.init_dd5d,e,t)},init_37f0:function(e,t,n){void 0===e&&(e="");var o=a.clone(n);o[r.PROPERTY_KIND]=t,o[r.PROPERTY_NAME]=e,a.super_init(this,u.PostPublishingObject,u.PostPublishingObject.prototype.init_dd5d,{},o)},clone:function(){return a.as(this.fork(l.GUIDUtils.makeGUID()),r)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},name:{get:function(){return this.get(r.PROPERTY_NAME)}},style:{get:function(){return this.style_},set:function(e){this.style_=e}},colors:{get:function(){return a.opt(this.style,(function(e){return e.colors}))}},equals:function(e){return this.name==a.opt(e,(function(e){return e.name}))},asString:{get:function(){return"Filter: "+this.name+" "+this.kind}}}}),r),i.AlphaBlendFilter=function(){var e=function(){},t={};return a.defineClass({name:"AlphaBlendFilter",ctor:e,superName:"ImageFilter",statics:{SCHEMA_CLASS_NAME:{get:function(){return"AlphaBlendFilter"}},PROPERTY_MIX:"mix",PROPERTY_FILTER_1:"filter1",PROPERTY_FILTER_2:"filter2",factory:{get:function(){return void 0===t.factory&&(t.factory=function(t,n,r,o){return e.init_866e(r,t)}),t.factory},set:function(e){t.factory=e}},createDefault:function(){return e.init_fa22(void 0,1,null,null)},KIND:{get:function(){return"AlphaBlend"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_866e:function(e,t){a.super_init(this,i.ImageFilter,i.ImageFilter.prototype.init_866e,e,t)},init_fa22:function(t,n,r,o){void 0===t&&(t="");var s={mix:n};null!=r&&(s[e.PROPERTY_FILTER_1]=r.clone()),null!=o&&(s[e.PROPERTY_FILTER_2]=o.clone()),a.super_init(this,i.ImageFilter,i.ImageFilter.prototype.init_37f0,t,e.KIND,s),null!=r&&a.opt(this.filter1,(function(e){return e.style=r.style})),null!=o&&a.opt(this.filter2,(function(e){return e.style=o.style}))},className:{get:function(){return e.SCHEMA_CLASS_NAME}},mix:{get:function(){var t;return(t=a.as(this.get(e.PROPERTY_MIX),"Double"))||null!=t?t:1},set:function(t){a.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_MIX,t),a.opt(this.style,(function(e){return e.notifyAfter()}))}},filter1:{get:function(){return a.as(this.get(e.PROPERTY_FILTER_1),i.ImageFilter)},set:function(t){a.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_FILTER_1,t),a.opt(this.style,(function(e){return e.notifyAfter()}))}},filter2:{get:function(){return a.as(this.get(e.PROPERTY_FILTER_2),i.ImageFilter)},set:function(t){a.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_FILTER_2,t),a.opt(this.style,(function(e){return e.notifyAfter()}))}},equals:function(t){var n;return!!(n=a.as(t,e))&&(null==n.filter1&&null==this.filter1||null==n.filter2&&null==this.filter2?null!=n.filter1?n.filter1.equals(this.filter1):null==n.filter2||n.filter2.equals(this.filter2):!(null==n.filter1&&null!=this.filter1||null==n.filter2&&null!=this.filter2||null!=n.filter1&&null==this.filter1||null!=n.filter2&&null==this.filter2)&&(this.filter1.equals(n.filter1)&&this.filter2.equals(n.filter2)&&this.mix==n.mix))},asString:{get:function(){return i.ImageFilter._getters.asString.call(this)+" "+this.mix+" 1:["+(null!=this.filter1?this.filter1.asString:"nil")+"] 2:["+(null!=this.filter2?this.filter2.asString:"nil")+"]"}}}}),e}(),i.CompositeFilter=function(){var e=function(){},t={};return a.defineClass({name:"CompositeFilter",ctor:e,superName:"ImageFilter",statics:{SCHEMA_CLASS_NAME:{get:function(){return"CompositeFilter"}},PROPERTY_MIX:"mix",PROPERTY_BLEND:"blend",PROPERTY_GRAYSCALE:"grayscale",PROPERTY_CONTRAST:"contrast",PROPERTY_COLOR_OPERATION:"color-operation",PROPERTY_SATURATION_OFFSET:"saturation-offset",PROPERTY_BRIGHTNESS_OFFSET:"brightness-offset",PROPERTY_BLUR_RADIUS:"blur-radius",PROPERTY_REDUCE_CONTRAST:"reduce-contrast",factory:{get:function(){return void 0===t.factory&&(t.factory=function(t,n,r,o){return e.init_866e(r,t)}),t.factory},set:function(e){t.factory=e}},createDefault:function(){return e.init_514f(void 0,void 0,void 0,"")},KIND:{get:function(){return"CompositeFilter"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_866e:function(t,n){var r;a.super_init(this,i.ImageFilter,i.ImageFilter.prototype.init_866e,t,n),"duotone"==this.blend&&this.set(e.PROPERTY_BLEND,"normal"),((r=a.as(this.get(e.PROPERTY_REDUCE_CONTRAST),"Bool"))||null!=r)&&r&&this.set(e.PROPERTY_CONTRAST,.5)},init_514f:function(t,n,r,o,s,l,u,c,d,h){void 0===t&&(t=null),void 0===n&&(n=""),void 0===r&&(r=1),void 0===o&&(o="normal"),void 0===s&&(s=!1),void 0===l&&(l=1),void 0===u&&(u=null),void 0===c&&(c=0),void 0===d&&(d=0),void 0===h&&(h=0);var p={mix:r,blend:o,grayscale:s,contrast:l,"saturation-offset":c,"brightness-offset":d,"blur-radius":h};null!=u&&(p[e.PROPERTY_COLOR_OPERATION]=u),a.super_init(this,i.ImageFilter,i.ImageFilter.prototype.init_37f0,n,e.KIND,p),this.style=t},className:{get:function(){return e.SCHEMA_CLASS_NAME}},mix:{get:function(){var t;return(t=a.as(this.get(e.PROPERTY_MIX),"Double"))||null!=t?t:1},set:function(t){a.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_MIX,t),a.opt(this.style,(function(e){return e.notifyAfter()}))}},blend:{get:function(){var t;return(t=a.as(this.get(e.PROPERTY_BLEND),"String"))||null!=t?t:"normal"},set:function(t){a.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_BLEND,t),a.opt(this.style,(function(e){return e.notifyAfter()}))}},grayscale:{get:function(){var t;return!(!(t=a.as(this.get(e.PROPERTY_GRAYSCALE),"Bool"))&&null==t)&&t},set:function(t){a.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_GRAYSCALE,t),a.opt(this.style,(function(e){return e.notifyAfter()}))}},contrast:{get:function(){var t;return(t=a.as(this.get(e.PROPERTY_CONTRAST),"Double"))||null!=t?t:1},set:function(t){a.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_CONTRAST,t),a.opt(this.style,(function(e){return e.notifyAfter()}))}},blurRadius:{get:function(){var t;return(t=a.as(this.get(e.PROPERTY_BLUR_RADIUS),"Double"))||null!=t?t:0},set:function(t){a.opt(this.style,(function(e){return e.notifyBefore()})),this.set(e.PROPERTY_BLUR_RADIUS,t),a.opt(this.style,(function(e){return e.notifyAfter()}))}},colorOperation:{get:function(){var t;return(t=a.as(this.get(e.PROPERTY_COLOR_OPERATION),"String"))||null!=t?t:""}},saturation:{get:function(){var t;return a.toString((t=a.as(this.get(e.PROPERTY_SATURATION_OFFSET),"Double"))||null!=t?t:0)}},brightness:{get:function(){var t;return a.toString((t=a.as(this.get(e.PROPERTY_BRIGHTNESS_OFFSET),"Double"))||null!=t?t:0)}},equals:function(t){var n;return!!(n=a.as(t,e))&&(this.name==a.opt(t,(function(e){return e.name}))&&this.mix==n.mix&&this.blurRadius==n.blurRadius)},asString:{get:function(){return i.ImageFilter._getters.asString.call(this)+" "+this.mix+" blend:"+this.blend+" grayscale:"+this.grayscale+" contrast:"+this.contrast+" blurRadius:"+this.blurRadius+" colorOperation:"+this.colorOperation+" saturation:"+this.saturation+" brightness:"+this.brightness}}}}),e}()},SmK9:function(e,t,n){var r,o,i,a,s,l,u,c,d,h,p,f,m,g,y,_,T,v,C,P,S,D,A,E,R=t,F=n("oAGj"),b=n("fVJ2"),I=n("dJuF"),O=n("13MC"),k=n("iCxV"),N=n("3hwA"),M=n("fNpk"),L=n("9YN4");R.DBSchemaType=F.defineEnum("DBSchemaType",{UnknownType:"unknown",BooleanType:"boolean",NumberType:"number",IntegerType:"integer",StringType:"string",ObjectType:"object",ArrayType:"array"}),R.DBSchemaValue=(r=function(){},F.defineClass({name:"DBSchemaValue",ctor:r,statics:{fromBool:function(e){return r.init_4199(R.DBSchemaType.BooleanType,e,null)},fromDouble:function(e){return r.init_4199(R.DBSchemaType.NumberType,e,null)},fromInt:function(e){return r.init_4199(R.DBSchemaType.IntegerType,e,null)},fromString:function(e){return r.init_4199(R.DBSchemaType.StringType,e,null)},fromClass:function(e,t){return r.init_4199(R.DBSchemaType.ObjectType,t,e)},fromArray:function(e){return r.init_4199(R.DBSchemaType.ArrayType,e,null)},fromDict:function(e){return r.init_4199(R.DBSchemaType.ObjectType,e,null)},emptyValue:function(e){return r.init_4199(R.DBSchemaType.UnknownType,null,e)}},props:{init_4199:function(e,t,n){this.schemaType=e,this.value_=t,this.className_=n,this.isDefault_=!1},init_e1d9:function(e,t,n,r){this.schemaType=e,this.value_=t,this.className_=n,this.isDefault_=r},merge:function(e){if(null!=e&&e.schemaType!=R.DBSchemaType.UnknownType)if(M.LegacyCoreAssert.isTrue(this.schemaType==R.DBSchemaType.UnknownType||e.schemaType==this.schemaType,"Mismatched types in merge.",void 0,"DBSchemaValue.merge","DBSchema.swift",54),(this.schemaType==R.DBSchemaType.UnknownType||this.isDefault_)&&(this.isDefault_=e.isDefault_),null==this.className_&&(this.className_=e.className_),this.schemaType==R.DBSchemaType.ArrayType){if(null==this.value_)this.value_=e.value_;else if(null!=e.value_){var t=e.value_.concat(this.value_);this.value_=F.clone(t)}}else if(this.schemaType==R.DBSchemaType.ObjectType){if(null==this.value_)this.value_=e.value_;else if(null!=e.value_){for(var n={},r=F.iter(e.value_);!r.done;r.next()){var o=r.key,i=r.value;n[o]=i}for(var a=F.iter(this.value_);!a.done;a.next())o=a.key,i=a.value,n[o]=i;this.value_=F.clone(n)}}else null!=e.value_&&(this.value_=e.value_),this.schemaType==R.DBSchemaType.UnknownType&&(this.schemaType=e.schemaType)},property:function(e,t,n){var o=null;if(this.schemaType==R.DBSchemaType.ObjectType){for(var i={},a=F.as(F.opt(F.opt(F.as(this.value_,["Dictionary","String",r]),(function(e){return e[R.DBSchema.PROPERTY_ID]})),(function(e){return e.value_})),"String"),s=F.iter(this.value_);!s.done;s.next()){var l=s.key,u=s.value;null!=u.value_&&(i[l]=u.property(l,t,a))}if(null==this.className_||null==i[R.DBSchema.PROPERTY_ID])o=I.DBProperty.dictEncoded(I.DBNamePath.init_b14a(e),i,this.className_);else{for(var c=O.DBObjectMutableState.init_6f66(this.className_),d=i[R.DBSchema.PROPERTY_ID].stringValue,h=F.iter(i);!h.done;h.next()){var p=h.key,f=h.value;c.setProperty(p,f)}t.stageObjectState(d,this.className_,c),o=I.DBProperty.linkProperty(I.DBNamePath.init_b14a(e),d,t,this.className_,n)}}else switch(this.schemaType){case"boolean":o=I.DBProperty.boolEncoded(I.DBNamePath.init_b14a(e),this.value_,this.className_);break;case"integer":o=I.DBProperty.intEncoded(I.DBNamePath.init_b14a(e),this.value_,this.className_);break;case"number":o=I.DBProperty.doubleEncoded(I.DBNamePath.init_b14a(e),this.value_,this.className_);break;case"string":o=I.DBProperty.stringEncoded(I.DBNamePath.init_b14a(e),this.value_,this.className_);break;case"array":var m=F.toSequence(this.value_).map((function(e){return e.element.property(F.toString(e.offset),t,n)}),this);o=I.DBProperty.arrayEncoded(I.DBNamePath.init_b14a(e),m,this.className_);break;default:o=null}return this.isDefault_&&F.opt(o,(function(e){return e.shouldWrite=!1})),o},valuesEqual:function(e){return(this.schemaType==R.DBSchemaType.BooleanType||this.schemaType==R.DBSchemaType.IntegerType||this.schemaType==R.DBSchemaType.NumberType||this.schemaType==R.DBSchemaType.StringType)&&this.value_==e.value_},isEqual:function(e){var t;return!!(t=F.as(e,r))&&t.schemaType==this.schemaType&&t.isDefault_==this.isDefault_&&t.className_==this.className_&&this.valuesEqual(t)}}}),r),R.IDBValidationResult=F.defineProtocol("IDBValidationResult",{value:"DBSchemaValue"}),R.DBValidationResult=(o=function(){},i={},F.defineClass({name:"DBValidationResult",ctor:o,statics:{empty:{get:function(){return void 0===i.empty&&(i.empty=o.init_d41d()),i.empty}},_implements:function(e){return"IDBValidationResult"==e}},props:{init_2063:function(e){this.value=e},init_d41d:function(){this.value=null}}}),o),R.DBValidationError=(a=function(){},F.defineClass({name:"DBValidationError",ctor:a,statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{value:{get:function(){return null}},error:{get:function(){return"Validation failed"}}}}),a),R.DBValidationErrorNotImplemented=(s=function(){R.DBValidationError.call(this)},F.defineClass({name:"DBValidationErrorNotImplemented",ctor:s,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Not implemented"}}}}),s),R.DBValidationErrorNoHost=(l=function(){R.DBValidationError.call(this)},F.defineClass({name:"DBValidationErrorNoHost",ctor:l,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"No host object or host object state"}}}}),l),R.DBValidationErrorType=(u=function(e,t){this.value_=e,this.type_=t},F.defineClass({name:"DBValidationErrorType",ctor:u,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return null!=this.value_?this.value_+" is not of type "+this.type_:"value is nil"}}}}),u),R.DBValidationErrorConstantIntMismatch=(c=function(e,t){this.value_=e,this.constant_=t},F.defineClass({name:"DBValidationErrorConstantIntMismatch",ctor:c,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" != "+this.constant_}}}}),c),R.DBValidationErrorConstantStringMismatch=(d=function(e,t){this.value_=e,this.constant_=t},F.defineClass({name:"DBValidationErrorConstantStringMismatch",ctor:d,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" != "+this.constant_}}}}),d),R.DBValidationErrorIntEnumMismatch=(h=function(e,t){this.value_=e,this.enumeration_=F.clone(t)},F.defineClass({name:"DBValidationErrorIntEnumMismatch",ctor:h,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" not in "+this.enumeration_}}}}),h),R.DBValidationErrorStringEnumMismatch=(p=function(e,t){this.value_=e,this.enumeration_=F.clone(t)},F.defineClass({name:"DBValidationErrorStringEnumMismatch",ctor:p,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" not in "+this.enumeration_}}}}),p),R.DBValidationErrorLimit=(f=function(e,t,n,r){this.value_=e,this.limit_=t,this.less_=n,this.exclusive_=r},F.defineClass({name:"DBValidationErrorLimit",ctor:f,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{comparator:{get:function(){return this.less_?this.exclusive_?"<":"<=":this.exclusive_?">":">="}},error:{get:function(){return this.value_+" "+this.comparator+" "+this.limit_}}}}),f),R.DBValidationErrorMultiple=(m=function(e,t){this.value_=e,this.factor_=t},F.defineClass({name:"DBValidationErrorMultiple",ctor:m,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" is not a multiple of "+this.factor_}}}}),m),R.DBValidationErrorLimitStringLength=(g=function(e,t,n){this.length_=e,this.limit_=t,this.less_=n},F.defineClass({name:"DBValidationErrorLimitStringLength",ctor:g,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{comparator:{get:function(){return this.less_?"<":">"}},error:{get:function(){return"String length "+this.length_+" "+this.comparator+" "+this.limit_}}}}),g),R.DBValidationErrorStringPattern=(y=function(e,t){this.value_=e,this.pattern_=t},F.defineClass({name:"DBValidationErrorStringPattern",ctor:y,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.value_+" does not match pattern "+this.pattern_}}}}),y),R.DBValidationErrorLimitItems=(_=function(e,t,n){this.count_=e,this.limit_=t,this.less_=n},F.defineClass({name:"DBValidationErrorLimitItems",ctor:_,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{comparator:{get:function(){return this.less_?"<":">"}},error:{get:function(){return"Item count "+this.count_+" "+this.comparator+" "+this.limit_}}}}),_),R.DBValidationErrorUniqueItems=(T=function(e){this.arrayValue_=F.clone(e)},F.defineClass({name:"DBValidationErrorUniqueItems",ctor:T,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Items "+this.arrayValue_+" not unique"}}}}),T),R.DBValidationErrorRequiredItem=(v=function(e){this.arrayValue_=F.clone(e)},F.defineClass({name:"DBValidationErrorRequiredItem",ctor:v,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Required item not found in "+this.arrayValue_}}}}),v),R.DBValidationErrorLimitProperties=(C=function(e,t,n){this.count_=e,this.limit_=t,this.less_=n},F.defineClass({name:"DBValidationErrorLimitProperties",ctor:C,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{comparator:{get:function(){return this.less_?"<":">"}},error:{get:function(){return"Property count "+this.count_+" "+this.comparator+" "+this.limit_}}}}),C),R.DBValidationErrorRequiredProperty=(P=function(e,t){this.value_=e,this.propertyName_=t},F.defineClass({name:"DBValidationErrorRequiredProperty",ctor:P,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Required property "+this.propertyName_+" not found in "+this.value_}}}}),P),R.DBValidationErrorPropertyError=(S=function(e,t,n){var r;this.propertyError_=e,this.propertyName_=t,this.className_=(r=n)||null!=r?r:""},F.defineClass({name:"DBValidationErrorPropertyError",ctor:S,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.className_+"."+this.propertyName_+" does not match schema rule: "+this.propertyError_.error}}}}),S),R.DBValidationErrorCompound=(D=function(e){this.errors_=F.clone(e)},F.defineClass({name:"DBValidationErrorCompound",ctor:D,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return this.errors_.reduce((function(e,t){return e+".."+t.error+"\n"}),"Validation failed:\n")}}}}),D),R.DBValidationErrorMultipleMatches=(A=function(e,t){this.matches_=F.clone(e),this.errors_=F.clone(t)},F.defineClass({name:"DBValidationErrorMultipleMatches",ctor:A,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){for(var e=this.matches_.length+" rules match:\n",t=F.iter(this.errors_);!t.done;t.next())e+=".."+t.value+"\n";return e}}}}),A),R.DBValidationErrorNegation=(E=function(){R.DBValidationError.call(this)},F.defineClass({name:"DBValidationErrorNegation",ctor:E,superName:"DBValidationError",statics:{_implements:function(e){return"IDBValidationResult"==e}},props:{error:{get:function(){return"Validation passed (negation failed)"}}}}),E),R.Rule=function(){var e=function e(t,n,r){var o=this;this.rawSchema_=F.clone(t),this.filename_=n,this.pathToObject_=r,this._ref=F.as(this.rawSchema_[e._REF],"String"),this._refsResolved=!1,this._schema=F.as(this.rawSchema_[e._SCHEMA],"String"),this._id=F.as(this.rawSchema_[e._ID],"String"),this._comment=F.as(this.rawSchema_[e._COMMENT],"String"),this.title=F.as(this.rawSchema_[e.TITLE],"String"),this.description=F.as(this.rawSchema_[e.DESCRIPTION],"String"),this.dependencies=e.fromJSON(F.as(this.rawSchema_[e.DEPENDENCIES],["Dictionary","String","Any"]),n,r+"/"+e.DEPENDENCIES),this.definitions=F.clone(e.fromDefinitions(F.as(this.rawSchema_[e.DEFINITIONS],["Dictionary","String",["Dictionary","String","Any"]]),n,r+"/"+e.DEFINITIONS)),this.typeArray=F.clone(e.typesFromSchema(t)),this.defaultValue=this.rawSchema_[e.DEFAULT],this.readOnly=F.as(this.rawSchema_[e.READ_ONLY],"Bool"),this.examples=F.clone(F.as(this.rawSchema_[e.EXAMPLES],["Array","Any"])),this.multipleOf=F.as(this.rawSchema_[e.MULTIPLE_OF],"Double"),this.maximum=F.as(this.rawSchema_[e.MAXIMUM],"Double"),this.exclusiveMaximum=F.as(this.rawSchema_[e.EXCLUSIVE_MAXIMUM],"Double"),this.minimum=F.as(this.rawSchema_[e.MINIMUM],"Double"),this.exclusiveMinimum=F.as(this.rawSchema_[e.EXCLUSIVE_MINIMUM],"Double"),this.maxLength=F.as(this.rawSchema_[e.MAX_LENGTH],"Int"),this.minLength=F.as(this.rawSchema_[e.MIN_LENGTH],"Int"),this.pattern=F.as(this.rawSchema_[e.PATTERN],"String"),this.tupleItems=F.clone(F.opt(F.as(this.rawSchema_[e.ITEMS],["Array",["Dictionary","String","Any"]]),(function(t){return t.map((function(t){return e.fromJSON(t,n,r+"/"+e.ITEMS)}),o)}))),this.items=null==this.tupleItems?e.fromJSON(F.as(this.rawSchema_[e.ITEMS],["Dictionary","String","Any"]),n,r+"/"+e.ITEMS):null,this.additionalItems=e.fromJSON(F.as(this.rawSchema_[e.ADDITIONAL_ITEMS],["Dictionary","String","Any"]),n,r+"/"+e.ADDITIONAL_ITEMS),this.maxItems=F.as(this.rawSchema_[e.MAX_ITEMS],"Int"),this.minItems=F.as(this.rawSchema_[e.MIN_ITEMS],"Int"),this.uniqueItems=F.as(this.rawSchema_[e.UNIQUE_ITEMS],"Bool"),this.contains=e.fromJSON(F.as(this.rawSchema_[e.CONTAINS],["Dictionary","String","Any"]),n,r+"/"+e.CONTAINS),this.properties=F.clone(e.fromDefinitions(F.as(this.rawSchema_[e.PROPERTIES],["Dictionary","String",["Dictionary","String","Any"]]),n,r+"/"+e.PROPERTIES)),this.maxProperties=F.as(this.rawSchema_[e.MAX_PROPERTIES],"Int"),this.minProperties=F.as(this.rawSchema_[e.MIN_PROPERTIES],"Int"),this.requiredProperties=F.clone(F.as(this.rawSchema_[e.REQUIRED],["Array","String"])),this.additionalProperties=e.fromJSON(F.as(this.rawSchema_[e.ADDITIONAL_PROPERTIES],["Dictionary","String","Any"]),n,r+"/"+e.ADDITIONAL_PROPERTIES),this.patternProperties=F.clone(e.fromDefinitions(F.as(this.rawSchema_[e.PATTERN_PROPERTIES],["Dictionary","String",["Dictionary","String","Any"]]),n,r+"/"+e.PATTERN_PROPERTIES)),this.propertyNames=e.fromJSON(F.as(this.rawSchema_[e.PROPERTY_NAMES],["Dictionary","String","Any"]),n,r+"/"+e.PROPERTY_NAMES),this.constant=this.rawSchema_[e.CONST],this.enumeration=F.clone(F.as(this.rawSchema_[e.ENUM],["Array","Any"])),this.format=F.as(this.rawSchema_[e.FORMAT],"String"),this.contentMediaType=F.as(this.rawSchema_[e.CONTENT_MEDIA_TYPE],"String"),this.contentEncoding=F.as(this.rawSchema_[e.CONTENT_ENCODING],"String"),this.ifRule=e.fromJSON(F.as(this.rawSchema_[e.IF],["Dictionary","String","Any"]),n,r+"/"+e.IF),this.thenRule=e.fromJSON(F.as(this.rawSchema_[e.THEN],["Dictionary","String","Any"]),n,r+"/"+e.THEN),this.elseRule=e.fromJSON(F.as(this.rawSchema_[e.ELSE],["Dictionary","String","Any"]),n,r+"/"+e.ELSE),this.allOf=F.clone(F.opt(F.as(this.rawSchema_[e.ALL_OF],["Array",["Dictionary","String","Any"]]),(function(t){return t.map((function(t){return e.fromJSON(t,n,r+"/"+e.ALL_OF)}),o)}))),this.anyOf=F.clone(F.opt(F.as(this.rawSchema_[e.ANY_OF],["Array",["Dictionary","String","Any"]]),(function(t){return t.map((function(t){return e.fromJSON(t,n,r+"/"+e.ANY_OF)}),o)}))),this.oneOf=F.clone(F.opt(F.as(this.rawSchema_[e.ONE_OF],["Array",["Dictionary","String","Any"]]),(function(t){return t.map((function(t){return e.fromJSON(t,n,r+"/"+e.ONE_OF)}),o)}))),this.notRule=e.fromJSON(F.as(this.rawSchema_[e.NOT],["Dictionary","String","Any"]),n,r+"/"+e.NOT),this.className=F.as(this.rawSchema_[e.CLASS_NAME],"String"),this.manifestProperties=F.clone(F.as(this.rawSchema_[e.MANINFEST_PROPERTIES],["Array","String"])),this.readData=F.as(this.rawSchema_[e.READ_DATA],"Bool"),this.reified_=!1,this.simplified_=!1},t={};return F.defineClass({name:"Rule",ctor:e,statics:{_SCHEMA:{get:function(){return void 0===t._SCHEMA&&(t._SCHEMA="$schema"),t._SCHEMA}},_ID:{get:function(){return void 0===t._ID&&(t._ID="$id"),t._ID}},_REF:{get:function(){return void 0===t._REF&&(t._REF="$ref"),t._REF}},_COMMENT:{get:function(){return void 0===t._COMMENT&&(t._COMMENT="$comment"),t._COMMENT}},TITLE:"title",DESCRIPTION:"description",DEFINITIONS:"definitions",DEPENDENCIES:"dependencies",TYPE:"type",DEFAULT:"default",READ_ONLY:"readOnly",EXAMPLES:"examples",MULTIPLE_OF:"multipleOf",MAXIMUM:"maximum",EXCLUSIVE_MAXIMUM:"exclusiveMaximum",MINIMUM:"minimum",EXCLUSIVE_MINIMUM:"exclusiveMinimum",MAX_LENGTH:"maxLength",MIN_LENGTH:"minLength",PATTERN:"pattern",ITEMS:"items",ADDITIONAL_ITEMS:"additionalItems",MAX_ITEMS:"maxItems",MIN_ITEMS:"minItems",UNIQUE_ITEMS:"uniqueItems",CONTAINS:"contains",PROPERTIES:"properties",MAX_PROPERTIES:"maxProperties",MIN_PROPERTIES:"minProperties",REQUIRED:"required",ADDITIONAL_PROPERTIES:"additionalProperties",PATTERN_PROPERTIES:"patternProperties",PROPERTY_NAMES:"propertyNames",CONST:"const",ENUM:"enum",FORMAT:"format",CONTENT_MEDIA_TYPE:"contentMediaType",CONTENT_ENCODING:"contentEncoding",IF:"if",THEN:"then",ELSE:"else",ALL_OF:"allOf",ANY_OF:"anyOf",ONE_OF:"oneOf",NOT:"not",CLASS_NAME:"className",MANINFEST_PROPERTIES:"manifest-properties",READ_DATA:"read-data",rulesFromSchemata:function(t){for(var n={},r=F.iter(t);!r.done;r.next()){var o=r.key,i=r.value;n[o]=new e(i,o,o+"#")}return n},definitionsFromSchemata:function(t){var n=F.clone(e.rulesFromSchemata(t)),r=F.clone(n),o=null,i=null;i=function(t,n){var o;if(o=n.definitions)for(var a=F.iter(o);!a.done;a.next()){var s=a.key,l=a.value,u=t+"/"+s;l.definedName=s,r[u]=l,i(u+"/"+e.DEFINITIONS,l)}};for(var a=F.iter(n);!a.done;a.next()){var s=a.key,l=a.value;i(s+"#/"+e.DEFINITIONS,l)}o=function(e){return null!=e?(F.opt(r[e],(function(e){return e.resolveRefs(o)})),r[e]):null};for(var u=F.iter(r);!u.done;u.next()){(l=u.value).resolveRefs(o)}for(var c=F.iter(r);!c.done;c.next()){(l=c.value).reify()}for(var d=F.iter(r);!d.done;d.next()){(l=d.value).simplify()}return r},fromJSON:function(t,n,r){return null!=t?new e(t,n,r):null},fromDefinitions:function(t,n,r){if(null!=t){for(var o={},i=F.iter(t);!i.done;i.next()){var a=i.key,s=i.value;o[a]=new e(s,n,r+"/"+a)}return o}return null},typesFromSchema:function(t){var n,r,o;if(null!=(r=F.as(t[e.TYPE],"String"))){var i=R.DBSchemaType.toCaseValue(r);return null!=i?[i]:null}return(o=F.as(t[e.TYPE],["Array","String"]))?o.map((function(e){return(n=R.DBSchemaType.toCaseValue(e))||null!=n?n:R.DBSchemaType.UnknownType}),this):null}},props:{getRequiredProperties:function(){return this.requiredProperties},getPropertyRule:function(e){return F.opt(this.properties,(function(t){return t[e]}))},schemaType:{get:function(){var e;return(e=this.type)||null!=e?e:R.DBSchemaType.UnknownType}},schemaTypeName:{get:function(){var e;return(e=this.className)||null!=e?e:this.definedName}},reify:function(){var e=this,t=this.reifiedRule;if(!t.reified_){if(t.reified_=!0,t.dependencies=F.opt(t.dependencies,(function(e){return e.reify()})),t.items=F.opt(t.items,(function(e){return e.reify()})),t.additionalItems=F.opt(t.additionalItems,(function(e){return e.reify()})),t.contains=F.opt(t.contains,(function(e){return e.reify()})),t.additionalProperties=F.opt(t.additionalProperties,(function(e){return e.reify()})),t.propertyNames=F.opt(t.propertyNames,(function(e){return e.reify()})),t.ifRule=F.opt(t.ifRule,(function(e){return e.reify()})),t.thenRule=F.opt(t.thenRule,(function(e){return e.reify()})),t.elseRule=F.opt(t.elseRule,(function(e){return e.reify()})),t.notRule=F.opt(t.notRule,(function(e){return e.reify()})),t.tupleItems=F.clone(F.opt(t.tupleItems,(function(t){return t.map((function(e){return e.reify()}),e)}))),t.allOf=F.clone(F.opt(t.allOf,(function(t){return t.map((function(e){return e.reify()}),e)}))),t.anyOf=F.clone(F.opt(t.anyOf,(function(t){return t.map((function(e){return e.reify()}),e)}))),t.oneOf=F.clone(F.opt(t.oneOf,(function(t){return t.map((function(e){return e.reify()}),e)}))),null!=t.definitions)for(var n=F.iter(t.definitions);!n.done;n.next()){var r=n.key,o=n.value;t.definitions[r]=o.reify()}if(null!=t.properties)for(var i=F.iter(t.properties);!i.done;i.next()){r=i.key,o=i.value;t.properties[r]=o.reify()}if(null!=t.patternProperties)for(var a=F.iter(t.patternProperties);!a.done;a.next()){r=a.key,o=a.value;t.patternProperties[r]=o.reify()}}return t},simplify:function(){if(!this.simplified_){if(this.simplified_=!0,null!=this.allOf){for(;0==!this.allOf.length;)this.merge(this.allOf.pop());this.allOf=null}if(null==this.constant&&null!=this.enumeration&&1==this.enumeration.length&&(this.constant=this.enumeration[0]),null==this.type&&null!=this.typeArray&&1==this.typeArray.length&&(this.type=this.typeArray[0]),this.stringConstant=F.as(this.constant,"String"),this.intConstant=F.as(this.constant,"Int"),this.stringEnumeration=F.clone(F.as(this.enumeration,["Array","String"])),this.intEnumeration=F.clone(F.as(this.enumeration,["Array","Int"])),F.opt(this.dependencies,(function(e){return e.simplify()})),F.opt(this.items,(function(e){return e.simplify()})),F.opt(this.additionalItems,(function(e){return e.simplify()})),F.opt(this.contains,(function(e){return e.simplify()})),F.opt(this.additionalProperties,(function(e){return e.simplify()})),F.opt(this.propertyNames,(function(e){return e.simplify()})),F.opt(this.ifRule,(function(e){return e.simplify()})),F.opt(this.thenRule,(function(e){return e.simplify()})),F.opt(this.elseRule,(function(e){return e.simplify()})),F.opt(this.notRule,(function(e){return e.simplify()})),F.opt(this.tupleItems,(function(e){return e.forEach((function(e){return e.simplify()}))})),F.opt(this.allOf,(function(e){return e.forEach((function(e){return e.simplify()}))})),F.opt(this.anyOf,(function(e){return e.forEach((function(e){return e.simplify()}))})),F.opt(this.oneOf,(function(e){return e.forEach((function(e){return e.simplify()}))})),null!=this.definitions)for(var e=F.iter(this.definitions);!e.done;e.next()){e.value.simplify()}if(null!=this.properties)for(var t=F.iter(this.properties);!t.done;t.next()){t.value.simplify()}if(null!=this.patternProperties)for(var n=F.iter(this.patternProperties);!n.done;n.next()){n.value.simplify()}}},merge:function(t){var n,r,o,i,a,s,l,u,c,d,h,p,f,m,g,y,_,T,v,C,P,S,D;if(this._id=(n=this._id)||null!=n?n:t._id,this._comment=(r=this._comment)||null!=r?r:t._comment,this.title=(o=this.title)||null!=o?o:t.title,this.description=(i=this.description)||null!=i?i:t.description,this.typeArray=F.clone(this.typeArray||t.typeArray),this.defaultValue=(a=this.defaultValue)||null!=a?a:t.defaultValue,this.readOnly=(s=this.readOnly)||null!=s?s:t.readOnly,this.examples=F.clone(this.examples||t.examples),this.multipleOf=(l=this.multipleOf)||null!=l?l:t.multipleOf,this.maximum=(u=this.maximum)||null!=u?u:t.maximum,this.exclusiveMaximum=(c=this.exclusiveMaximum)||null!=c?c:t.exclusiveMaximum,this.minimum=(d=this.minimum)||null!=d?d:t.minimum,this.exclusiveMinimum=(h=this.exclusiveMinimum)||null!=h?h:t.exclusiveMinimum,this.maxLength=(p=this.maxLength)||null!=p?p:t.maxLength,this.minLength=(f=this.minLength)||null!=f?f:t.minLength,this.pattern=(m=this.pattern)||null!=m?m:t.pattern,this.tupleItems=F.clone(this.tupleItems||t.tupleItems),this.maxItems=(g=this.maxItems)||null!=g?g:t.maxItems,this.minItems=(y=this.minItems)||null!=y?y:t.minItems,this.uniqueItems=(_=this.uniqueItems)||null!=_?_:t.uniqueItems,this.contains=this.contains||t.contains,this.maxProperties=(T=this.maxProperties)||null!=T?T:t.maxProperties,this.minProperties=(v=this.minProperties)||null!=v?v:t.minProperties,this.additionalProperties=this.additionalProperties||t.additionalProperties,this.propertyNames=this.propertyNames||t.propertyNames,this.constant=(C=this.constant)||null!=C?C:t.constant,this.enumeration=F.clone(this.enumeration||t.enumeration),this.format=(P=this.format)||null!=P?P:t.format,this.contentMediaType=F.as(this.rawSchema_[e.CONTENT_MEDIA_TYPE],"String"),this.contentEncoding=F.as(this.rawSchema_[e.CONTENT_ENCODING],"String"),this.ifRule=this.ifRule||t.ifRule,this.thenRule=this.thenRule||t.thenRule,this.elseRule=this.elseRule||t.elseRule,this.className=(S=this.className)||null!=S?S:t.className,this.readData=(D=this.readData)||null!=D?D:t.readData,null!=t.dependencies&&(null==this.dependencies?this.dependencies=t.dependencies:F.opt(this.dependencies,(function(e){return e.merge(t.dependencies)}))),null!=t.definitions)if(null==this.definitions)this.definitions=F.clone(t.definitions);else for(var A=F.iter(t.definitions);!A.done;A.next()){var E=A.key,R=A.value;null==this.definitions[E]&&(this.definitions[E]=R)}if(null!=t.items&&(null==this.items?this.items=t.items:F.opt(this.items,(function(e){return e.merge(t.items)}))),null!=t.additionalItems&&(null==this.additionalItems?this.additionalItems=t.additionalItems:F.opt(this.additionalItems,(function(e){return e.merge(t.additionalItems)}))),null!=t.properties)if(null==this.properties)this.properties=F.clone(t.properties);else for(var b=F.iter(t.properties);!b.done;b.next()){var I=b.key,O=b.value;null==this.properties[I]&&(this.properties[I]=O)}if(null!=t.patternProperties)if(null==this.patternProperties)this.patternProperties=F.clone(t.patternProperties);else for(var k=F.iter(t.patternProperties);!k.done;k.next()){var N=k.key;O=k.value;null==this.patternProperties[N]&&(this.patternProperties[N]=O)}null!=t.notRule&&(null==this.notRule?this.notRule=t.notRule:F.opt(this.notRule,(function(e){return e.merge(t.notRule)}))),null!=t.allOf&&(null==this.allOf?this.allOf=F.clone(t.allOf):this.allOf=this.allOf.concat(t.allOf)),null!=t.anyOf&&(null==this.anyOf?this.anyOf=F.clone(t.anyOf):this.anyOf=this.anyOf.concat(t.anyOf)),null!=t.oneOf&&(null==this.oneOf?this.oneOf=F.clone(t.oneOf):this.oneOf=this.oneOf.concat(t.oneOf)),null!=t.manifestProperties&&(null==this.manifestProperties?this.manifestProperties=F.clone(t.manifestProperties):this.manifestProperties=F.clone(F.opt(this.manifestProperties,(function(e){return e.concat(t.manifestProperties)})))),null!=t.requiredProperties&&(null==this.requiredProperties?this.requiredProperties=F.clone(t.requiredProperties):this.requiredProperties=F.clone(F.opt(this.requiredProperties,(function(e){return e.concat(t.requiredProperties)}))))},resolveRefs:function(e){if(!this._refsResolved){if(this._refsResolved=!0,null!=this._ref){var t=this._ref.startsWith("#")?this.filename_+this._ref:this._ref;this._refRule=e(t)}if(F.opt(this.dependencies,(function(t){return t.resolveRefs(e)})),null!=this.definitions)for(var n=F.iter(this.definitions);!n.done;n.next()){n.value.resolveRefs(e)}if(F.opt(this.items,(function(t){return t.resolveRefs(e)})),F.opt(this.tupleItems,(function(t){return t.forEach((function(t){return t.resolveRefs(e)}))})),F.opt(this.additionalItems,(function(t){return t.resolveRefs(e)})),F.opt(this.contains,(function(t){return t.resolveRefs(e)})),null!=this.properties)for(var r=F.iter(this.properties);!r.done;r.next()){r.value.resolveRefs(e)}if(F.opt(this.additionalProperties,(function(t){return t.resolveRefs(e)})),null!=this.patternProperties)for(var o=F.iter(this.patternProperties);!o.done;o.next()){o.value.resolveRefs(e)}F.opt(this.propertyNames,(function(t){return t.resolveRefs(e)})),F.opt(this.ifRule,(function(t){return t.resolveRefs(e)})),F.opt(this.thenRule,(function(t){return t.resolveRefs(e)})),F.opt(this.elseRule,(function(t){return t.resolveRefs(e)})),F.opt(this.allOf,(function(t){return t.forEach((function(t){return t.resolveRefs(e)}))})),F.opt(this.anyOf,(function(t){return t.forEach((function(t){return t.resolveRefs(e)}))})),F.opt(this.oneOf,(function(t){return t.forEach((function(t){return t.resolveRefs(e)}))})),F.opt(this.notRule,(function(t){return t.resolveRefs(e)}))}},reifiedRule:{get:function(){return 1==F.count(this.rawSchema_)&&null!=this.rawSchema_[e._REF]&&this._refRule||this}},isValid:function(e){return null!=this.validate(e).value},validateProperty:function(e){if(e instanceof I.DBDeletedProperty)return R.DBValidationResult.empty;var t;if(t=F.as(e.objValue,b.DBObject)){var n=F.clone(t.state.allProperties);return n[R.DBSchema.PROPERTY_ID]=I.DBProperty.stringProperty(I.DBNamePath.init_b14a(R.DBSchema.PROPERTY_ID),t.id),this.validate(n)}return this.validate(e.value)},validate:function(e){var t,n,r=this;if(n=F.as(e,I.DBProperty))return this.validateProperty(n);if(null!=this._refRule)return this._refRule.validate(e);var o=null;if(null!=this.className&&(null==o?o=this.emptyClass(e).value:F.opt(o,(function(t){return t.merge(r.emptyClass(e).value)}))),null!=this.constant){var i,a=this.validateConstant(e);if(i=F.as(a,R.DBValidationError))return i;null==o?o=a.value:F.opt(o,(function(e){return e.merge(a.value)}))}else if(null!=this.enumeration){var s,l=this.validateEnumeration(e);if(s=F.as(l,R.DBValidationError))return s;null==o?o=l.value:F.opt(o,(function(e){return e.merge(l.value)}))}if(null!=this.type){var u,c,d=null;switch(this.type){case"boolean":d=this.validateBoolean(e);break;case"integer":d=this.validateInteger(e);break;case"number":d=this.validateNumber(e);break;case"string":d=this.validateString(e);break;case"array":d=this.validateArray(e);break;case"object":d=this.validateObject(e);break;case"unknown":return this.fail(e)}if(u=F.as(d,R.DBValidationError))return u;(c=F.opt(d,(function(e){return e.value})))&&(null==o?o=c:F.opt(o,(function(e){return e.merge(c)})))}else if(null!=this.typeArray){var h,p=this.validateTypes(e);if(h=F.as(p,R.DBValidationError))return h;null==o?o=p.value:F.opt(o,(function(e){return e.merge(p.value)}))}if(null!=this.anyOf||null!=this.oneOf||null!=this.ifRule&&null!=this.thenRule||null!=this.notRule){var f,m=this.validateCompounds(e);if(f=F.as(m,R.DBValidationError))return f;null==o?o=m.value:F.opt(o,(function(e){return e.merge(m.value)}))}return null!=this.defaultValue&&(null==o?o=this.validateDefault(e).value:F.opt(o,(function(t){return t.merge(r.validateDefault(e).value)}))),(!(t=this.readData)&&null==t||t)&&null!=o?R.DBValidationResult.init_2063(o):R.DBValidationResult.empty},fail:function(e){return new R.DBValidationError},pass:function(e){return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.UnknownType,e,this.className))},emptyClass:function(e){return R.DBValidationResult.init_2063(R.DBSchemaValue.emptyValue(this.className))},validateDefault:function(e){var t;return null==e?R.DBValidationResult.init_2063(R.DBSchemaValue.init_e1d9((t=this.type)||null!=t?t:R.DBSchemaType.UnknownType,this.defaultValue,this.className,!0)):R.DBValidationResult.init_2063(R.DBSchemaValue.emptyValue(this.className))},validateConstant:function(e){var t,n,r,o;return null!=(t=this.intConstant)?null!=e?null!=(r=F.as(e,"Int"))?r==t?R.DBValidationResult.init_2063(R.DBSchemaValue.fromInt(r)):new R.DBValidationErrorConstantIntMismatch(r,t):new R.DBValidationErrorType(e,R.DBSchemaType.IntegerType):R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.IntegerType,null,null)):null!=(n=this.stringConstant)?null!=e?null!=(o=F.as(e,"String"))?o==n?R.DBValidationResult.init_2063(R.DBSchemaValue.fromString(o)):new R.DBValidationErrorConstantStringMismatch(o,n):new R.DBValidationErrorType(e,R.DBSchemaType.StringType):R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.StringType,null,null)):new R.DBValidationErrorNotImplemented},validateEnumeration:function(e){var t,n,r,o;return(t=this.intEnumeration)?null!=(r=F.as(e,"Int"))?t.includes(r)?R.DBValidationResult.init_2063(R.DBSchemaValue.fromInt(r)):new R.DBValidationErrorIntEnumMismatch(r,t):new R.DBValidationErrorType(e,R.DBSchemaType.IntegerType):(n=this.stringEnumeration)?null!=e?null!=(o=F.as(e,"String"))?n.includes(o)?R.DBValidationResult.init_2063(R.DBSchemaValue.fromString(o)):new R.DBValidationErrorStringEnumMismatch(o,n):new R.DBValidationErrorType(e,R.DBSchemaType.StringType):R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.StringType,null,null)):new R.DBValidationErrorNotImplemented},validateTypes:function(e){for(var t=[],n=F.iter(this.typeArray);!n.done;n.next()){var r,o=null;switch(n.value){case"boolean":o=this.validateBoolean(e);break;case"integer":o=this.validateInteger(e);break;case"number":o=this.validateNumber(e);break;case"string":o=this.validateString(e);break;case"array":o=this.validateArray(e);break;case"object":o=this.validateObject(e);break;case"unknown":t.push(this.fail(e))}if(F.opt(o,(function(e){return null!=e.value})))return o;(r=F.as(o,R.DBValidationError))&&t.push(r)}return new R.DBValidationErrorCompound(t)},validateBoolean:function(e){var t;return null!=e?null!=(t=F.as(e,"Bool"))?R.DBValidationResult.init_2063(R.DBSchemaValue.fromBool(t)):new R.DBValidationErrorType(e,R.DBSchemaType.BooleanType):R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.BooleanType,null,null))},validateInteger:function(e){if(null!=e){var t;if(null!=(t=F.as(e,"Int"))){if(null!=this.maximum&&F.toDouble(t)>this.maximum)return new R.DBValidationErrorLimit(t,this.maximum,!1,!1);if(null!=this.exclusiveMaximum&&F.toDouble(t)>=this.exclusiveMaximum)return new R.DBValidationErrorLimit(t,this.maximum,!1,!0);if(null!=this.minimum&&F.toDouble(t)<this.minimum)return new R.DBValidationErrorLimit(t,this.minimum,!0,!1);if(null!=this.exclusiveMinimum&&F.toDouble(t)<=this.exclusiveMinimum)return new R.DBValidationErrorLimit(t,this.minimum,!0,!0);var n;if(null!=(n=this.multipleOf)){var r=F.toDouble(t),o=r/n;if(o!=Math.floor(o))return new R.DBValidationErrorMultiple(r,n)}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromInt(t))}return new R.DBValidationErrorType(e,R.DBSchemaType.IntegerType)}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.IntegerType,null,null))},validateNumber:function(e){if(null!=e){var t;if(null!=(t=F.as(e,"Double"))){if(null!=this.maximum&&t>this.maximum)return new R.DBValidationErrorLimit(t,this.maximum,!1,!1);if(null!=this.exclusiveMaximum&&t>=this.exclusiveMaximum)return new R.DBValidationErrorLimit(t,this.maximum,!1,!0);if(null!=this.minimum&&t<this.minimum)return new R.DBValidationErrorLimit(t,this.minimum,!0,!1);if(null!=this.exclusiveMinimum&&t<=this.exclusiveMinimum)return new R.DBValidationErrorLimit(t,this.minimum,!0,!0);var n;if(null!=(n=this.multipleOf)){var r=t/n;if(r!=Math.floor(r))return new R.DBValidationErrorMultiple(t,n)}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromDouble(t))}return new R.DBValidationErrorType(e,R.DBSchemaType.NumberType)}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.NumberType,null,null))},validateString:function(e){var t,n=this;if(null!=e){var r;if(null!=(r=F.as(e,"String"))){if(null!=this.maxLength&&r.length>this.maxLength)return new R.DBValidationErrorLimitStringLength(r.length,this.maxLength,!1);if(null!=this.minLength&&r.length<this.minLength)return new R.DBValidationErrorLimitStringLength(r.length,this.minLength,!0);if(null!=this.pattern)if(!(!(t=F.opt(k.Host.schema,(function(e){return e.matches(r,n.pattern)})))&&null==t||t))return new R.DBValidationErrorStringPattern(r,this.pattern);return R.DBValidationResult.init_2063(R.DBSchemaValue.fromString(r))}return new R.DBValidationErrorType(e,R.DBSchemaType.StringType)}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.StringType,null,null))},validateArray:function(e){var t;if(null!=e){var n;if(n=F.as(e,["Array","Any"])){var r,o,i,a=[];if(null!=this.maxItems&&n.length>this.maxItems)return new R.DBValidationErrorLimitItems(n.length,this.maxItems,!1);if(null!=this.minItems&&n.length<this.minItems)return new R.DBValidationErrorLimitItems(n.length,this.minItems,!0);if(r=this.tupleItems)for(var s=F.iter(F.range(0,n.length,!1));!s.done;s.next()){var l=s.value;if(l>=r.length){var u;if(!(u=this.additionalItems))return new R.DBValidationErrorLimitItems(n.length,r.length,!1);var c=u.validate(n[l]);if(d=F.as(c,R.DBValidationError))return d;(m=c.value)&&a.push(m)}else{var d,h=r[l].validate(n[l]);if(d=F.as(h,R.DBValidationError))return d;(m=h.value)&&a.push(m)}}else if(o=this.items)for(var p=F.iter(n);!p.done;p.next()){var f,m,g=p.value,y=o.validate(g);if(f=F.as(y,R.DBValidationError))return f;(m=y.value)&&a.push(m)}if(((t=this.uniqueItems)||null!=t)&&t)for(var _=[],T=F.iter(a);!T.done;T.next()){e=T.value;if(_.filter((function(t){return e.isEqual(t)}),this).length>0)return new R.DBValidationErrorUniqueItems(n);_.push(e)}if(i=this.contains){for(var v=!1,C=F.iter(n);!C.done;C.next()){g=C.value;if(i.isValid(g)){v=!0;break}}if(!v)return new R.DBValidationErrorRequiredItem(n)}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromArray(a))}return new R.DBValidationErrorType(e,R.DBSchemaType.ArrayType)}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.ArrayType,null,null))},validateObject:function(e){var t,n,r,o=this;if(null!=e){var i,a,s,l,u,c={};if(null!=this.maxProperties)if((i=F.as(e,["Dictionary","String","Any"]))&&F.count(i)>this.maxProperties)return new R.DBValidationErrorLimitProperties(F.count(i),this.maxProperties,!1);if(null!=this.minProperties)if((i=F.as(e,["Dictionary","String","Any"]))&&F.count(i)<this.minProperties)return new R.DBValidationErrorLimitProperties(F.count(i),this.minProperties,!0);if(I=this.requiredProperties)if(s=F.as(e,N.IImportDataObject))for(var d=F.iter(I);!d.done;d.next()){if((g=d.value)!=R.DBSchema.PROPERTY_ID&&g!=R.DBSchema.PROPERTY_TYPE&&g!=R.DBSchema.PROPERTY_NAME&&g!=R.DBSchema.PROPERTY_PATH&&null==s.property(g))return new R.DBValidationErrorRequiredProperty(s,g)}else if(F.is(e,N.IImportDataComponent))for(var h=F.iter(I);!h.done;h.next()){if((g=h.value)!=R.DBSchema.PROPERTY_ID&&g!=R.DBSchema.PROPERTY_NAME&&g!=R.DBSchema.PROPERTY_PATH&&g!=R.DBSchema.PROPERTY_MIME_TYPE&&g!=R.DBSchema.PROPERTY_ETAG&&g!=R.DBSchema.PROPERTY_URL)return new R.DBValidationErrorRequiredProperty(e,g)}else if(i=F.as(e,["Dictionary","String","Any"]))for(var p=F.iter(I);!p.done;p.next()){if(null==i[g=p.value])return new R.DBValidationErrorRequiredProperty(i,g)}else if(null!=e)return new R.DBValidationErrorType(e,R.DBSchemaType.ObjectType);if((a=this.propertyNames)&&(u=F.as(e,["Dictionary","String","Any"])))for(var f=F.iter(F.keys(u));!f.done;f.next()){var m,g=f.value,y=a.validate(g);if(m=F.as(y,R.DBValidationError))return m}if(s=F.as(e,N.IImportDataObject)){if(null!=this.properties){var _=[];(I=this.requiredProperties)&&(_=F.clone(I)),F.append(_,F.keys(this.properties).filter((function(e){return!(((t=F.opt(o.requiredProperties,(function(t){return t.includes(e)})))||null!=t)&&t)}),this));for(var T=F.iter(_);!T.done;T.next()){var v=T.value,C=this.properties[v],P=null;if(v==R.DBSchema.PROPERTY_ID)null!=(b=s.id)&&(P=C.validate(b));else if(v==R.DBSchema.PROPERTY_TYPE){null!=(b=s.type)&&(P=C.validate(b))}else if(v==R.DBSchema.PROPERTY_NAME){null!=(b=s.name)&&(P=C.validate(b))}else if(v==R.DBSchema.PROPERTY_PATH){null!=(b=s.path)&&(P=C.validate(b))}else if(v==R.DBSchema.PROPERTY_CHILDREN){var S=[];s.forEachChild((function(e,t){return S.splice(t,0,e)})),P=C.validate(S)}else if(v==R.DBSchema.PROPERTY_COMPONENTS){var D=[];s.forEachComponent((function(e,t){return D.splice(t,0,e)})),P=C.validate(D)}else if(null!=(e=s.property(v)))P=C.validate(e);else if(null!=C.defaultValue){null!=(L=C.validate(null)).value&&(P=L)}if(K=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(K,v,this.className);(E=F.opt(P,(function(e){return e.value})))&&(c[v]=E)}}}else if(l=F.as(e,N.IImportDataComponent)){if(null!=this.properties){_=[];(I=this.requiredProperties)&&(_=F.clone(I)),F.append(_,F.keys(this.properties).filter((function(e){return!(((n=F.opt(o.requiredProperties,(function(t){return t.includes(e)})))||null!=n)&&n)}),this));for(var A=F.iter(_);!A.done;A.next()){var E;v=A.value,C=this.properties[v],P=null;if(v==R.DBSchema.PROPERTY_ID)null!=(b=l.id)&&(P=C.validate(b));else if(v==R.DBSchema.PROPERTY_NAME){null!=(b=l.name)&&(P=C.validate(b))}else if(v==R.DBSchema.PROPERTY_PATH){null!=(b=l.path)&&(P=C.validate(b))}else if(v==R.DBSchema.PROPERTY_MIME_TYPE){null!=(b=l.mimeType)&&(P=C.validate(b))}else if(v==R.DBSchema.PROPERTY_ETAG){null!=(b=l.etag)&&(P=C.validate(b))}else if(v==R.DBSchema.PROPERTY_URL){var b;null!=(b=l.url)&&(P=C.validate(b))}if(K=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(K,v,this.className);(E=F.opt(P,(function(e){return e.value})))&&(c[v]=E)}}}else if(u=F.as(e,["Dictionary","String","Any"])){if(null!=this.properties){var I;if(I=this.requiredProperties)for(var O=F.iter(I);!O.done;O.next()){if(null==(e=u[g=O.value]))return new R.DBValidationErrorRequiredProperty(u,g);P=this.properties[g].validate(e);if(K=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(K,g,this.className);(W=P.value)&&(c[g]=W)}for(var M=F.iter(this.properties);!M.done;M.next()){g=M.key,C=M.value;if(null==c[g])if(null!=(e=u[g])){P=C.validate(e);if(K=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(K,g,this.className);(W=P.value)&&(c[g]=W)}else if(null!=C.defaultValue){var L,x;(x=(L=C.validate(null)).value)&&(c[g]=x)}}}var B;if(B=this.patternProperties)for(var w=F.iter(B);!w.done;w.next())for(var G=w.key,Y=(C=w.value,F.keys(u).filter((function(e){return null==c[e]&&!(!(r=F.opt(k.Host.schema,(function(t){return t.matches(e,G)})))&&null==r)&&r}),this)),U=F.iter(Y);!U.done;U.next()){v=U.value,P=C.validate(u[v]);if(K=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(K,v,this.className);(W=P.value)&&(c[v]=W)}var j,V=F.keys(u).filter((function(e){return null==c[e]}),this);if(j=this.additionalProperties)for(var H=F.iter(V);!H.done;H.next()){var K,W;v=H.value,P=j.validate(u[v]);if(K=F.as(P,R.DBValidationError))return new R.DBValidationErrorPropertyError(K,v,this.className);(W=P.value)&&(c[v]=W)}}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromDict(c))}return R.DBValidationResult.init_2063(R.DBSchemaValue.init_4199(R.DBSchemaType.ObjectType,null,null))},validateAnyOf:function(e,t){var n;if(n=t){for(var r=[],o=F.iter(n);!o.done;o.next()){var i,a=o.value.validate(e);if(!(i=F.as(a,R.DBValidationError)))return a;r.push(i)}return new R.DBValidationErrorCompound(r)}return new R.DBValidationError},validateOneOf:function(e,t){var n;if(n=t){for(var r=[],o=[],i=0,a=null,s=F.iter(n);!s.done;s.next()){var l,u=s.value,c=u.validate(e);if((l=F.as(c,R.DBValidationError))?r.push(l):(a=c,i+=1,o.push(u.pathToObject_)),i>1)break}return 1==i?a:new R.DBValidationErrorMultipleMatches(o,r)}return new R.DBValidationError},validateCompounds:function(e){var t,n;if(M.LegacyCoreAssert.isTrue(null==this.allOf,"Rules should be simplified before validation",void 0,"Rule.validateCompounds","DBSchema.swift",1668),t=this.anyOf)return this.validateAnyOf(e,t);if(n=this.oneOf)return this.validateAnyOf(e,n);if(null!=this.notRule){var r=!0;return this.notRule.validate(e)instanceof R.DBValidationError&&(r=!1),r?new R.DBValidationErrorNegation:R.DBValidationResult.init_2063(R.DBSchemaValue.emptyValue(this.className))}if(null!=this.ifRule&&null!=this.thenRule){if(!(this.ifRule.validate(e)instanceof R.DBValidationError))return this.thenRule.validate(e);if(null!=this.elseRule)return this.elseRule.validate(e)}return R.DBValidationResult.init_2063(R.DBSchemaValue.emptyValue(this.className))},codec:{get:function(){var e=null!=this.definedName?I.DBPropertyCodec.typeCodec(this.definedName):null;if(null==e){if(this.schemaType==R.DBSchemaType.BooleanType)e=I.DBPropertyCodec.boolCodec();else if(this.schemaType==R.DBSchemaType.IntegerType||null!=this.intConstant||null!=this.intEnumeration)e=I.DBPropertyCodec.intCodec();else if(this.schemaType==R.DBSchemaType.NumberType)e=I.DBPropertyCodec.doubleCodec();else if(this.schemaType==R.DBSchemaType.StringType||null!=this.stringConstant||null!=this.stringEnumeration)e=I.DBPropertyCodec.stringCodec();else if(this.schemaType==R.DBSchemaType.ArrayType){if(null!=this.tupleItems){var t=this.tupleItems.map((function(e){return e.codec}),this);null!=this.additionalItems&&t.push(this.additionalItems.codec),e=I.DBPropertyCodec.tupleCodec(t)}else if(null!=this.items){var n=this.items.codec;e=I.DBPropertyCodec.arrayCodec(n)}}else if(this.schemaType==R.DBSchemaType.ObjectType)if(null!=this.definedName&&F.opt(this.properties,(function(e){return null!=e.id})))e=I.DBPropertyCodec.objectCodec(this.definedName);else{var r={};if(null!=this.properties)for(var o=F.iter(this.properties);!o.done;o.next()){var i=o.key,a=o.value;r[i]=a.codec}e=I.DBPropertyCodec.dictionaryCodec(r)}M.LegacyCoreAssert.isTrue(null!=e,"Failed to generate a codec.",{rule:this},"Rule","DBSchema.swift",1737)}return e}},propertyCodecs:{get:function(){var e={};if(null!=this.properties)for(var t=F.iter(this.properties);!t.done;t.next()){var n=t.key,r=t.value;n==R.DBSchema.PROPERTY_CHILDREN?e[n]=I.DBPropertyCodec.arrayCodec(I.DBPropertyCodec.objectCodec()):e[n]=r.codec}return e}},propertyRules:{get:function(){return this.properties||{}}},getCodecChain:function(e,t){var n,r=[],o=F.clone(e),i=o.shift(),a=t.getProperty(i);if(i==R.DBSchema.PROPERTY_CHILDREN){var s=I.DBPropertyCodec.arrayCodec(I.DBPropertyCodec.objectCodec());null==a&&(a=I.DBProperty.arrayProperty(I.DBNamePath.init_b14a(i),[])),r.push([s,a]),M.LegacyCoreAssert.isTrue(0==o.length,"Need to figure out property chains for database links; objects with child-states should be direct objects",void 0,"Rule.getCodecChain","DBSchema.swift",1777)}else{var l;if(l=F.opt(this.properties,(function(e){return e[i]}))){var u=l,c=function(e,t,n){var o=e.codec,i=e.schemaType;null==(a=n())&&(a=i==R.DBSchemaType.ArrayType?I.DBProperty.arrayProperty(I.DBNamePath.init_b14a(t),[]):I.DBProperty.dictProperty(I.DBNamePath.init_b14a(t),{})),r.push([o,a]),u=e},d=function(e,t){var n=F.toInt(t);return null!=e&&e.isArray&&n<e.arrayPropertyCount?e.getArrayProperty(n):null};for(c(l,i,(function(){return a}));0==!o.length;){var h,p,f,m,g,y=u.schemaType,_=o.shift(),T=null;if(null!=(h=F.last(r))&&(T=h[1]),y==R.DBSchemaType.ArrayType)if(p=u.tupleItems){if(null!=(m=F.toInt(_)))m<p.length?c(p[m],_,(function(){return d(T,_)})):(g=u.additionalItems)&&c(g,_,(function(){return d(T,_)}))}else(f=u.items)&&c(f,_,(function(){return d(T,_)}));else if(y==R.DBSchemaType.ObjectType){var v,C;if(v=F.opt(u.properties,(function(e){return e[_]})))c(v,_,(function(){return F.opt(T,(function(e){return e.getDictionaryProperty(_)}))}));else if(C=u.patternProperties)for(var P=F.iter(C);!P.done;P.next()){var S=P.key,D=P.value;((n=F.opt(k.Host.schema,(function(e){return e.matches(_,S)})))||null!=n)&&n&&c(D,_,(function(){return F.opt(T,(function(e){return e.getDictionaryProperty(_)}))}))}}else M.LegacyCoreAssert.fail("Childless schema type in codec chain",{schemaType:y},"Rule.getCodecChain","DBSchema.swift",1839)}}}return r}}}),e}(),R.DBSchema=function(){var e=function(){this.propertyCodecs={}},t={};return F.defineClass({name:"DBSchema",ctor:e,statics:{schemaVersion:"http://json-schema.org/draft-04/schema",PROPERTY_ID:"id",PROPERTY_TYPE:"type",PROPERTY_NAME:"name",PROPERTY_PATH:"path",PROPERTY_CHILDREN:"children",PROPERTY_COMPONENTS:"components",PROPERTY_MIME_TYPE:"mimeType",PROPERTY_ETAG:"etag",PROPERTY_URL:"url",PROPERTY_REF:{get:function(){return void 0===t.PROPERTY_REF&&(t.PROPERTY_REF="$ref"),t.PROPERTY_REF}},currentSchema:{get:function(){return void 0===t.currentSchema&&(t.currentSchema=e.init_2af7(L.TheoDocument.CURRENT_VERSION)),t.currentSchema},set:function(e){t.currentSchema=e}},getPropertyRules:function(t){var n;return(n=e.currentSchema.rulesByName[t])?n.propertyRules:{}},getCodecChain:function(t,n){var r,o=[];return(r=e.currentSchema.rulesByName[n.className])&&(o=F.clone(r.getCodecChain(t,n))),o},getManifestProperties:function(t){return F.opt(e.currentSchema.rulesByName[t],(function(e){return e.manifestProperties}))},getValidator:function(t){var n=F.clone(e.getPropertyRules(t));return function(e){for(var t={},r=F.iter(n);!r.done;r.next()){var o,i=r.key,a=r.value;if((o=e.getProperty(i))&&o.shouldWrite){var s,l=a.validateProperty(o);if(s=F.as(l,R.DBValidationError))return s;t[i]=l.value}}return R.DBValidationResult.init_2063(R.DBSchemaValue.fromDict(t))}},getSerializer:function(t){var n=F.clone(e.getPropertyRules(t)),r=F.clone(e.getManifestProperties(t));return function(e,t){for(var o=F.iter(F.keys(n));!o.done;o.next()){var i=o.value;(s=e.getProperty(i))&&s.shouldWrite&&t(i,s,!1)}if(null!=r&&0==!r.length)for(var a=F.iter(r);!a.done;a.next()){var s;i=a.value;(s=e.getProperty(i))&&t(i,s,!0)}}},getArrayWriter:function(t,n,r){return function(o,i,a){var s,l;if(i.shouldWrite)if(null!=(s=i.className)&&(l=n.getObjectStateByID(i.linkID))){var u=e.getDictionaryWriter(m={},n,r);e.getSerializer(s)(l,u),t.push(m)}else switch(i.schemaType){case"boolean":var c;null!=(c=i.boolValue)&&t.push(c);break;case"integer":var d;null!=(d=i.intValue)&&t.push(d);break;case"number":var h;null!=(h=i.doubleValue)&&t.push(h);break;case"string":var p;null!=(p=i.stringValue)&&t.push(p);break;case"array":if(i.isArray){var f=[];u=e.getArrayWriter(f,n,r);i.forEachArrayProperty((function(e,t){return u("",t,!1)})),t.push(f)}break;case"object":if(i.isDictionary){var m;u=e.getDictionaryWriter(m={},n,r);i.forEachDictionaryProperty((function(e,t){return u(e,t,!1)})),t.push(m)}break;case"unknown":M.LegacyCoreAssert.fail("Cannot write a property of unknown type",void 0,"DBSchema.getArrayWriter","DBSchema.swift",2019)}}},getDictionaryWriter:function(t,n,r){return function(o,i,a){var s,l;if(i.shouldWrite)if(null!=(s=i.className)&&(l=n.getObjectStateByID(i.linkID))){var u=e.getDictionaryWriter(d={},n,r);e.getSerializer(s)(l,u),t[o]=d}else switch(i.schemaType){case"boolean":t[o]=i.boolValue;break;case"integer":t[o]=i.intValue;break;case"number":t[o]=i.doubleValue;break;case"string":t[o]=i.stringValue;break;case"array":if(i.isArray){var c=[];u=e.getArrayWriter(c,n,r);i.forEachArrayProperty((function(e,t){return u("",t,!1)})),t[o]=c}break;case"object":if(i.isDictionary){var d;u=e.getDictionaryWriter(d={},n,r);i.forEachDictionaryProperty((function(e,t){return u(e,t,!1)})),t[o]=d}break;case"unknown":M.LegacyCoreAssert.fail("Cannot write a property of unknown type",void 0,"DBSchema.getDictionaryWriter","DBSchema.swift",2071)}}},getDataObjectWriter:function(t,n,r,o){return function(i,a,s){if(a.shouldWrite)if(i==e.PROPERTY_ID){var l=F.opt(F.opt(r.getObjectStateByID(n),(function(t){return t.getProperty(e.PROPERTY_PATH)})),(function(e){return e.stringValue}));M.LegacyCoreAssert.isTrue(a.stringValue==n||n==l,"Saving object with ID",{objID:n,property:a.stringValue},"DBSchema.getDataObjectWriter","DBSchema.swift",2090)}else if(i!=e.PROPERTY_PATH||s)if(i!=e.PROPERTY_NAME||s)if(i!=e.PROPERTY_TYPE||s)if(i!=e.PROPERTY_COMPONENTS||s)if(i!=e.PROPERTY_CHILDREN||s){var u=a.className,c=a.objValue;if(null!=u&&null!=c){var d=e.getDictionaryWriter(m={},r,o);e.getSerializer(u)(r.getObjectStateByID(a.linkID),d),s?t.setManifestProperty(i,m,!0):t.setProperty(i,m)}else switch(a.schemaType){case"boolean":var h;null!=(h=a.boolValue)?s?t.setManifestProperty(i,F.as(h,"AnyObject"),!0):t.setBooleanProperty(i,h):t.setOptionalBooleanProperty(i,null);break;case"integer":s?t.setManifestProperty(i,F.as(a.intValue,"AnyObject"),!0):t.setIntProperty(i,a.intValue);break;case"number":s?t.setManifestProperty(i,F.as(a.doubleValue,"AnyObject"),!0):t.setNumberProperty(i,a.doubleValue);break;case"string":var p;null!=(p=a.stringValue)?s?t.setManifestProperty(i,F.as(p,"AnyObject"),!0):t.setStringProperty(i,p):t.setOptionalStringProperty(i,null);break;case"array":if(a.isArray){var f=[];d=e.getArrayWriter(f,r,o);a.forEachArrayProperty((function(e,t){return d("",t,!1)})),s?t.setManifestProperty(i,f,!0):t.setProperty(i,f)}break;case"object":if(a.isDictionary){var m;d=e.getDictionaryWriter(m={},r,o);a.forEachDictionaryProperty((function(e,t){return d(e,t,!1)})),s?t.setManifestProperty(i,m,!0):t.setProperty(i,m)}break;case"unknown":M.LegacyCoreAssert.fail("Cannot write a property of unknown type",void 0,"DBSchema.getDataObjectWriter","DBSchema.swift",2209)}}else a.isArray&&a.forEachArrayProperty((function(n,i){var a=F.as(i.objValue,b.DBObject);if(null!=a){var s=r.getObjectState(a);e.getSerializer(a.className)(s,e.getDataObjectWriter(t.appendChild(a.id),a.id,r,o))}}));else a.isArray&&a.forEachArrayProperty((function(n,r){if(r.isDictionary){var o=F.opt(r.getDictionaryProperty(e.PROPERTY_ID),(function(e){return e.stringValue})),i=F.opt(r.getDictionaryProperty(e.PROPERTY_URL),(function(e){return e.stringValue})),a=F.opt(r.getDictionaryProperty(e.PROPERTY_MIME_TYPE),(function(e){return e.stringValue}));null!=o&&null!=i&&null!=a&&t.appendComponent(o,i,a)}}));else{var g;null!=(g=a.stringValue)&&t.setType(g)}else{var y;null!=(y=a.stringValue)&&t.setName(y)}else t.setPath(a.stringValue);else s&&t.setManifestProperty(i,null,!0)}}},props:{getPropertyCodec:function(t,n){var r;return(r=e.currentSchema.propertyCodecs[n])&&r[t]||F.opt(this.getPropertyCodecs(n),(function(e){return e[t]}))},getPropertyCodecs:function(e){var t,n=F.clone(this.propertyCodecs[e]);null==n&&((t=this.rulesByName[e])&&(n=F.clone(t.propertyCodecs),this.propertyCodecs[e]=F.clone(n)));return n},init_2af7:function(e){this.init_f987(e,k.Host.schema.getRoot(e),k.Host.schema.rootFile,k.Host.schema.getFiles(e))},init_f987:function(e,t,n,r){for(var o=F.clone(R.Rule.definitionsFromSchemata(r)),i={},a=F.iter(o);!a.done;a.next()){var s,l=a.key,u=a.value;if(l.includes("#"))null!=(s=u.definedName)&&(i[s]=u)}this.rules=F.clone(o),this.rulesByName=F.clone(i),this.rootFile=n,this.formatVersion=e,this.rootSchema=F.clone(t),this.rootSchemaFile=n,this.auxiliarySchemata=F.clone(r),this.description=F.as(this.rootSchema.description,"String")},schemaForReference:function(e){var t,n=e.split("#"),r=n[0],o=null;if(t=F.isEmpty(r)?this.rootSchema:this.auxiliarySchemata[r]){o=F.clone(t);for(var i=n[1].split("/"),a=F.iter(i.filter((function(e){return!F.isEmpty(e)}),this));!a.done;a.next()){var s,l=a.value;o=(s=F.as(F.opt(o,(function(e){return e[l]})),["Dictionary","String","Any"]))?F.clone(s):null}}return o},validateAndRead:function(e,t,n){var r,o,i=this.rules[this.rootFile],a=F.opt(i,(function(t){return t.validate(e)})),s=F.opt(a,(function(e){return e.value}));return(o=F.as(a,R.DBValidationError))&&(F.opt(k.Host.logging,(function(e){return e.warning("Validation encountered errors: "+o.error)})),n([o])),(r=F.opt(F.opt(s,(function(e){return e.property("",t,null)})),(function(e){return e.linkID})))||null!=r?r:""},referenceSchema:function(t,n){return e.init_f987(this.formatVersion,t,n,this.auxiliarySchemata)},type:function(t){var n,r,o,i,a,s=R.DBSchemaType.UnknownType,l=F.as(t.className,"String"),u=null;(null!=(n=F.as(t.type,"String"))&&null!=(r=R.DBSchemaType.toCaseValue(n))&&(s=r,u=this),s==R.DBSchemaType.UnknownType&&null!=t.enum)&&((o=F.as(t.enum,["Array","Any"]))&&(o.length>0&&F.is(o[0],"String")?s=R.DBSchemaType.StringType:o.length>0&&F.is(o[0],"Int")&&(s=R.DBSchemaType.IntegerType)));if(s==R.DBSchemaType.UnknownType||s==R.DBSchemaType.ObjectType&&null==l)if(null!=(i=F.as(t[e.PROPERTY_REF],"String"))){var c,d=R.DBSchemaType.UnknownType,h=null,p=null,f=i.startsWith("#")?this.rootSchemaFile+i:i;if(c=this.schemaForReference(f)){var m=f.split("#")[0],g=f.split("/");if(l=F.last(g),m==this.rootSchemaFile){var y=this.type(c);d=y[0],h=y[1],p=y[2]}else{var _=this.referenceSchema(c,m).type(c);d=_[0],h=_[1],p=_[2]}}s==R.DBSchemaType.UnknownType&&(s=d),null==l&&(l=h),null==u&&(u=p)}else if(a=F.as(t.allOf,["Array",["Dictionary","String","Any"]]))for(var T=F.iter(a);!T.done;T.next()){var v=T.value,C=this.type(v),P=C[0],S=C[1],D=C[2];s==R.DBSchemaType.UnknownType&&(s=P),null==l&&(l=S),null==u&&(u=D)}return[s,l,u]},findValue:function(t,n){var r,o=n[t];if(null==o&&null!=(r=F.as(n[e.PROPERTY_REF],"String"))){var i,a=r.startsWith("#")?this.rootSchemaFile+r:r;(i=this.schemaForReference(a))&&(o=this.findValue(t,i))}return o},allProperties:function(t){M.LegacyCoreAssert.isTrue(null==t.anyOf&&null==t.oneOf,"Specific type should be known by this point or a custom codec is needed.",void 0,"DBSchema.allProperties","DBSchema.swift",2385);var n,r,o,i={};if((n=F.as(t.properties,["Dictionary","String",["Dictionary","String","Any"]]))&&(i=F.clone(n)),r=F.as(t.allOf,["Array",["Dictionary","String","Any"]]))for(var a=F.iter(r);!a.done;a.next())for(var s=a.value,l=F.iter(this.allProperties(s));!l.done;l.next()){var u=l.key,c=l.value;i[u]=F.clone(c)}if(null!=(o=F.as(t[e.PROPERTY_REF],"String"))){var d,h=o.startsWith("#")?this.rootSchemaFile+o:o;if(d=this.schemaForReference(h))for(var p=F.iter(this.allProperties(d));!p.done;p.next()){u=p.key;var f=p.value;null==i[u]&&(i[u]=F.clone(f))}}return i},schemaAttribute:function(t,n){M.LegacyCoreAssert.isTrue(null==n.anyOf&&null==n.oneOf,"Specific type should be known by this point or a custom codec is needed.",void 0,"DBSchema.schemaAttribute","DBSchema.swift",2417);var r,o,i=n[t];if(null==i&&(r=F.as(n.allOf,["Array",["Dictionary","String","Any"]])))for(var a=F.iter(r);!a.done;a.next()){var s,l=a.value;if(null!=(s=this.schemaAttribute(t,l))){i=s;break}}if(null==i&&null!=(o=F.as(n[e.PROPERTY_REF],"String"))){var u,c,d=o.startsWith("#")?this.rootSchemaFile+o:o;if(u=this.schemaForReference(d))null!=(c=this.schemaAttribute(t,u))&&(i=c)}return i}}}),e}()},SpAV:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("gXiO"),u=n("iCxV");a.CoreAssert=(r=function(){l.CoreObject.call(this)},s.defineClass({name:"CoreAssert",ctor:r,superName:"CoreObject",statics:{disableAssertionFailuresForTestingPurposesOnly:!1,fail:function(e,t,n,r,o){void 0===t&&(t={}),void 0===n&&(n="CoreAssert.fail"),void 0===r&&(r="CoreAssert.swift"),void 0===o&&(o=24),a.CoreAssertHelper.fail(e,t,n,r,o,!1)},isTrue:function(e,t,n,r,o,i){void 0===n&&(n={}),void 0===r&&(r="CoreAssert.isTrue"),void 0===o&&(o="CoreAssert.swift"),void 0===i&&(i=39),a.CoreAssertHelper.isTrue(e,t,n,r,o,i,!1)},isFalse:function(e,t,n,r,o,i){void 0===n&&(n={}),void 0===r&&(r="CoreAssert.isFalse"),void 0===o&&(o="CoreAssert.swift"),void 0===i&&(i=53),a.CoreAssertHelper.isFalse(e,t,n,r,o,i,!1)}}}),r),a.CoreAssertDebugOnly=(o=function(){l.CoreObject.call(this)},s.defineClass({name:"CoreAssertDebugOnly",ctor:o,superName:"CoreObject",statics:{fail:function(e,t,n,r,o){void 0===t&&(t={}),void 0===n&&(n="CoreAssertDebugOnly.fail"),void 0===r&&(r="CoreAssert.swift"),void 0===o&&(o=67),a.CoreAssertHelper.fail(e,t,n,r,o,!0)},isTrue:function(e,t,n,r,o,i){void 0===n&&(n={}),void 0===r&&(r="CoreAssertDebugOnly.isTrue"),void 0===o&&(o="CoreAssert.swift"),void 0===i&&(i=77),a.CoreAssertHelper.isTrue(e,t,n,r,o,i,!0)},isFalse:function(e,t,n,r,o,i){void 0===n&&(n={}),void 0===r&&(r="CoreAssertDebugOnly.isFalse"),void 0===o&&(o="CoreAssert.swift"),void 0===i&&(i=86),a.CoreAssertHelper.isFalse(e,t,n,r,o,i,!0)}}}),o),a.CoreAssertHelper=(i=function(){},s.defineClass({name:"CoreAssertHelper",ctor:i,statics:{SWIFT_FILE_SUFFIX:".swift",fail:function(e,t,n,r,o,l){var c;if(!a.CoreAssert.disableAssertionFailuresForTestingPurposesOnly){var d,h=r.split("/"),p=s.last(h);null!=(d=p)&&d.includes(i.SWIFT_FILE_SUFFIX)&&(p=d.substr(0,d.length-i.SWIFT_FILE_SUFFIX.length));var f="'"+e+"' "+((c=p)||null!=c?c:"")+":"+o+":"+n;s.opt(u.Host.logging,(function(e){return e.logAssertFailure(f,t)})),s.opt(u.Host.lifetime,(function(t){return t.terminate(l,e)}))}},isTrue:function(e,t,n,r,o,a,s){e||i.fail(t,n,r,o,a,s)},isFalse:function(e,t,n,r,o,a,s){e&&i.fail(t,n,r,o,a,s)}}}),i)},T6jX:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("0wFF"),s=n("6h7+"),l=n("gXiO"),u=n("ascj"),c=n("Z25M"),d=n("4JYN"),h=n("FNB+"),p=n("6ZWm"),f=n("QgZx"),m=n("cmoc"),g=n("G1DZ"),y=n("QbzR"),_=n("9Lk3"),T=n("ZK0l"),v=n("ZhwN"),C=n("iCxV"),P=n("8vXU"),S=n("Qlvz"),D=n("NkBu"),A=n("U010"),E=n("q5zr"),R=n("fdtz"),F=n("lmwz"),b=n("uWOl"),I=n("rxGp"),O=n("fNpk"),k=n("c+uM"),N=n("tGKA"),M=n("VkKB"),L=n("T8w7"),x=n("uxH+"),B=n("AxS/"),w=n("K0Rh"),G=n("7Ta2"),Y=n("Zifs"),U=n("djAF"),j=n("EoOi"),V=n("9YN4"),H=n("enh0"),K=n("Vm85"),W=n("DaVl"),X=n("voyk"),z=n("8t9B"),q=n("oKlP"),Z=n("oKI3"),J=n("sIWg"),Q=n("qSCS"),$=n("LGJg"),ee=n("WWR6"),te=n("zjod"),ne=n("mxdD");o.OPACITY_LOG_SCALE=5,o.TheoDocumentUtils=(r=function(){l.CoreObject.call(this)},i.defineClass({name:"TheoDocumentUtils",ctor:r,superName:"CoreObject",statics:{DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD:20,HIGH_DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD:100,getAvgGlyphAreaSortedText:function(e){for(var t=i.clone(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()}))),n=[],r=i.iter(t);!r.done;r.next()){var o,a=r.value;if(o=i.as(a.controller,z.TypeLockupController)){var s=0,l=0;if(a.visit(h.FormaTraversal.PreOrder,(function(e,t,n){var r,o;return(r=i.as(e,H.TextForma))&&(o=r.finalFrame)&&(s+=o.area,l+=r.rangeInLockup.length),!1})),l>0){var u=s/i.toDouble(l),c=i.replaceAll(o.text,"\n"," ").split(" ").filter((function(e){return!i.isEmpty(e)}),this).join(" ");i.isEmpty(c)||n.push({text:c,avgGlyphArea:u})}}}return i.sort(n,(function(e,t){return e.avgGlyphArea>t.avgGlyphArea})).map((function(e){return e.text}),this)},synthesizeTitle:function(e){var t=i.clone(r.getAvgGlyphAreaSortedText(e));return t.length>0?t[0]:V.TheoDocument.DEFAULT_NAME},synthesizeDescription:function(e){return r.getAvgGlyphAreaSortedText(e).join(" ")},getFrameString:function(e,t){void 0===t&&(t=!1);var n=i.clone(e.totalPlacement.transformPoints(e.bounds.points));e.isTypeLockup()&&t&&(n=i.clone(e.totalPlacement.transformPoints(e.childrenBoundsInCoordSpace(N.Matrix2D.Identity).points)));for(var r=[],o=i.iter(n);!o.done;o.next()){var a=o.value,s=i.toString(i.toInt(Math.round(a.x))),l=i.toString(i.toInt(Math.round(a.y)));r.push(s+","+l)}return r.join(",")},getCellBackgroundShape:function(e){var t;if(t=F.ImageFacade.getFrameForForma(e)){var n,r;if((n=i.as(t.controller,p.FrameController))&&n.hasCutout&&(n.floating||n.hasBackgroundColor))return t;if(r=i.as(i.opt(t.parent,(function(e){return e.controller})),_.GridController)){var o=r.getCellBackgroundShape(t);if(null!=o)return o}}return null},getCellBackgroundImage:function(e){if(e.controller.floating)return null;var t;if(t=i.as(i.opt(e.parent,(function(e){return e.controller})),_.GridController)){var n=t.getCellBackgroundImage(e);if(null!=n)return n}return null},updateConstrainedImageInfo:function(e){var t=[],n=[],r=[],o=[];e.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(e){var a,s;(a=i.as(e,R.ImageForma))&&(s=i.opt(a.contentNode,(function(e){return e.mediaMetadata})))&&s.sourceName==M.MediaMetadata.kMediaStockSourceName&&null!=s.assetID&&null!=s.licenseType&&(s.licenseType==M.MediaMetadata.kMediaStockLicenseTypeNone?t.includes(s.assetID)||t.push(s.assetID):s.licenseType==M.MediaMetadata.kMediaStockLicenseTypeStandard?n.includes(s.assetID)||n.push(s.assetID):s.licenseType==M.MediaMetadata.kMediaStockLicenseTypeExtended?r.includes(s.assetID)||r.push(s.assetID):s.licenseType==M.MediaMetadata.kMediaStockLicenseTypeLimited?o.includes(s.assetID)||o.push(s.assetID):O.LegacyCoreAssert.fail("unknown image license type",void 0,"TheoDocumentUtils.updateConstrainedImageInfo","TheoDocumentUtils.swift",169))}));var a={stockImages:{unlicensed:t,standard:n,extended:r,limited:o}},s=e.beginTransaction("updateConstrainedImageInfo");e.setConstrainedImages(a),s.mergeWithPrevious()},containsLicensedImage:function(e){return 0==!r.licensedStockImageIDs(e).length},licensedStockImageIDs:function(e){var t,n,r,o,a=[];return(t=e.constrainedImages[V.TheoDocument.PROPERTY_STOCK_IMAGES])&&((n=t[V.TheoDocument.PROPERTY_STANDARD])&&i.append(a,n),(r=t[V.TheoDocument.PROPERTY_EXTENDED])&&i.append(a,r),(o=t[V.TheoDocument.PROPERTY_LIMITED])&&i.append(a,o)),a},limitedLicensedStockImageIDs:function(e){var t=i.clone(e.constrainedImages);return i.clone(i.opt(t[V.TheoDocument.PROPERTY_STOCK_IMAGES],(function(e){return e[V.TheoDocument.PROPERTY_LIMITED]})))||[]},unlicensedStockImageIDs:function(e){var t=i.clone(e.constrainedImages);return i.clone(i.opt(t[V.TheoDocument.PROPERTY_STOCK_IMAGES],(function(e){return e[V.TheoDocument.PROPERTY_UNLICENSED]})))||[]},allStockImageIDs:function(e){return r.licensedStockImageIDs(e).concat(r.unlicensedStockImageIDs(e))},createImageFeatures:function(e){e.content.root.visitAll((function(e){var t;(t=i.as(e,E.ImageContentNode))&&(t.isMask||t.createImageFeatures())}))},getFontSourceUsage:function(e){for(var t=[],n=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var r,o=n.value;if(r=i.as(o.style,k.LockupStyle)){var a;if(a=r.font){var s=f.describeFontSource(a.fontData.source);t.includes(s)||t.push(s)}for(var l=i.iter(r.characterStyles);!l.done;l.next()){var u;(u=l.value.font)&&(s=f.describeFontSource(u.fontData.source),t.includes(s)||t.push(s))}}}return t},getUsedFontNames:function(e){for(var t=[],n=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var r,o=n.value;if(r=i.as(o.style,k.LockupStyle)){var a;if(a=r.font){var s=a.fontData.postScriptName;t.includes(s)||t.push(s)}for(var l=i.iter(r.characterStyles);!l.done;l.next()){var u;(u=l.value.font)&&(s=u.fontData.postScriptName,t.includes(s)||t.push(s))}}}return i.sort(t)},getImageTraitsForExportAnalytics:function(e){var t=0,n=0,o=0,s=0,l=0,u=[],c={},d={},p=r.licensedStockImageIDs(e).length;e.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(a){var p,f,m;if((p=i.as(a,R.ImageForma))&&(f=i.as(p.style,b.ImageStyle))){var g,y,_=r.getImageStyleDescription(e,f);_==b.ImageStyle.NAME_NONE||u.includes(_)||(_==b.ImageStyle.NAME_NEWDUOTONE?u.splice(0,0,_):u.push(_)),F.ImageFacade.getCutoutModeForForma(p)!=A.CutoutMode.Off&&(o+=1,F.ImageFacade.hasRefinedCutout(p)&&(l+=1)),(g=F.ImageFacade.getMaskForForma(p))&&(c[g.id]=!0),(y=f.adjustments)&&y.setEnabledKeys(d),n+=1}else a.hasIntent(h.Forma.INTENT_ICON)&&(t+=1);(m=i.as(a.parent,h.Forma))&&i.as(m.parent,w.RootForma)&&(s+=1)}));var f="";f=0==u.length?b.ImageStyle.NAME_NONE:"["+u.join(",")+"]";var m=i.sort(i.keys(c)).map((function(e){return e}),this),g=0==m.length?a.AnalyticsConstants.kAnalyticsGenericNone:"["+m.join(", ")+"]",y=1==d[S.ImageAdjustments.PROPERTY_BLUR]?"[blur]":a.AnalyticsConstants.kAnalyticsGenericNone,_=i.sort(i.keys(d)).filter((function(e){return e!=S.ImageAdjustments.PROPERTY_BLUR}),this);return{imageFilterUsages:f,effects:y,enhancements:0==_.length?a.AnalyticsConstants.kAnalyticsGenericNone:"["+_.join(", ")+"]",cropShapeIds:g,numCutout:o,numRefinedCutout:l,numImages:n,numStockImages:p,numIcons:t,layerCount:s}},getImageStyleDescription:function(e,t){var n=t.name;if(n==b.ImageStyle.NAME_NEWDUOTONE){var r=new d.DuotonePreset(t.colors.fieldShadows||Y.SolidColor.BLACK,t.colors.fieldHighlights||Y.SolidColor.WHITE),o=e.firstPage.imageFilterLibrary.getDuotonePresetIndex(r);if(-1==o)n+=a.AnalyticsConstants.kAnalyticsDataDuotoneCustom;else{var s=e.firstPage.imageFilterLibrary.getDuotonePresetAtIndex(o);i.eq(d._equality_DuotonePreset_DuotonePreset,s,r)?n+=a.AnalyticsConstants.kAnalyticsDataDuotonePreset:n+=a.AnalyticsConstants.kAnalyticsDataDuotoneSwap}}return n},getDocumentGroupDescription:function(e){var t,n=i.clone(e.firstPage.root.filterWithCallback((function(e){return!(!(t=i.opt(e.controller,(function(e){return e.userGroup})))&&null==t)&&t})));if(0==n.length)return"none";for(var r=0,o=0,a=0,s=i.iter(n);!s.done;s.next()){var l,u=s.value;null==(l=u.getTag(h.Forma.TAG_CREATED_FROM_REMIX))||"true"!=l?g.FormaSourceUtils.isDesignIngredient(u.source)?a+=1:o+=1:r+=1}return r+","+o+","+a},logExportDNAEvent:function(e){var t,n=r.getAppliedVariationTemplateId(e),o=e.isExported,s=r.getImageTraitsForExportAnalytics(e),l={contextualData1:"hasGroup:"+r.getDocumentGroupDescription(e),contextualData2:a.AnalyticsConstants.kAnalyticsDataFilterType+":"+s.imageFilterUsages,contextualData3:"effects:"+s.effects,contextualData4:"enhancements:"+s.enhancements,contextualData5:"blendModeType:"+L.OpacityFacade.getBlendModeUseForAnalytics(e),contextualData6:"hasCutout:"+s.numCutout,contextualData7:"hasCustomizedCutout:"+s.numRefinedCutout,contextualData8:"crop:"+s.cropShapeIds,contextualData9:"designFilterID:"+((t=n)||null!=t?t:"none"),contextualData10:"hasTextLayout:"+r.getTextLayoutsString(e),contextualData11:"hasImage:"+s.numImages,contextualData12:"hasIcon:"+s.numIcons,contextualData13:"layerCount:"+s.layerCount,contextualData14:"hasStockImages:"+s.numStockImages,contextualData15:"isReExport:"+o};i.opt(C.Host.logging,(function(e){return e.logToAnalytics(a.AnalyticsConstants.kAnalyticsDataProjectExportCompletedDNA,l)}))},getAllDesignIngredientIDsAndTypes:function(e){var t=[];return e.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(e){var n;null!=(n=e.source)&&g.FormaSourceUtils.isDesignIngredient(n)&&t.push(s.BadgeFacade.getDesignIngredientIDAndType(n))})),t},getFirstDesignIngredientID:function(e){var t,n=null;return e.firstPage.root.visit(h.FormaTraversal.PreOrder,(function(e,t,r){var o;return!(null==(o=e.source)||!g.FormaSourceUtils.isDesignIngredient(o)||(n=s.BadgeFacade.getDesignIngredientIDAndType(o).id,0))})),(t=n)||null!=t?t:"none"},getBackgroundImageCount:function(e){var t=0;return e.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(e){e.isBackgroundImage()&&(t+=1)})),t},getAppliedVariationTemplateId:function(e){return e.content.root.getTag(B.RootContentNode.THEME_ID_TAG)},getAppliedLayoutId:function(e){return i.opt(i.opt(i.opt(i.as(e.firstPage.root.controller,x.RootController),(function(e){return e.getGridController()})),(function(e){return e.gridStyle})),(function(e){return e.name}))},getMetadataEvents:function(e,t,n){var o;void 0===n&&(n=!1);var a=e.firstPage,s=a.sizeID,l="";null!=a.animationController.animationStyle&&(l=a.animationController.animationStyle.asString);var c,d,p=a.colorLibrary.paletteID,f=e.content.root.getTag(B.RootContentNode.THEME_ID_TAG),y=e.content.root.getTag(B.RootContentNode.DOCUMENT_SOURCE_TYPE_TAG),T=e.content.root.getTag(B.RootContentNode.DOCUMENT_SOURCE_ID_TAG),S="default",D=0,A=0,E=i.clone(a.root.filterByControllerKind(_.GridController.KIND));E.length>0&&(c=i.as(E[0].controller,_.GridController))&&(d=c.gridStyle)&&(S=d.name,D=c.spacing,A=c.margin);var F=null!=p?a.colorLibrary.paletteID:"",O=null!=f?f:"",k=null!=T?T:"",N=null!=y?y:"",M=[],L=[],x=[],G=[],Y=[],j="",V=0;a.root.visitAll(h.FormaTraversal.PreOrder,(function(e){if(null!=e.bounds){var t,a="id:"+e.formaID.substr(0,8),s=n?a:"",l=r.getFrameString(e),c="";(t=e.style.colors.color(u.ColorRole.FieldPrimary))&&(c=t.rgbHex);var d,h,p,f,y,_="";if((d=e.style.colors.color(u.ColorRole.FieldSecondary))&&(_=d.rgbHex),h=i.as(e,R.ImageForma)){var T="",v="",C="",P="",S="",D="";i.opt(h.parent,(function(e){return e.kind==m.FrameForma.KIND}))&&(l=r.getFrameString(e.parent)),(ie=i.as(h.style,b.ImageStyle))&&(P=ie.name);var A,E,F,I=h.contentNode,O=i.opt(I,(function(e){return e.mediaMetadata}));if(i.opt(h.parent,(function(e){return e.kind==m.FrameForma.KIND}))){var k=i.clone(h.placement.inverse.transformPoints(h.parent.bounds.points)),N=Math.round(h.bounds.width),B=Math.round(h.bounds.height);C=Math.round(1e3*N/B)/1e3+",";for(var H=[],K=i.iter(k);!K.done;K.next()){var W=K.value,X=i.toString(Math.round(1e3*W.x/N)/1e3),q=i.toString(Math.round(1e3*W.y/B)/1e3);H.push(X+","+q)}C+=H.join(",")}null!=(ue=i.opt(O,(function(e){return e.searchTerm})))&&(v=ue,null!=(A=i.opt(O,(function(e){return e.sourceURL})))&&(T=A)),null!=(E=i.opt(O,(function(e){return e.sourceName})))&&(S=E),null!=(F=i.opt(O,(function(e){return e.licenseType})))&&(D=F);var Z,J="img";(Z=i.as(e,te.VideoForma))&&(ne.VideoFacade.formaIsLivePhoto(Z)&&(J="lp"),null!=i.opt(Z.videoContentNode,(function(e){return e.isGIF}))&&(J="gif"),Z.isSticker()&&(V+=1)),T.includes("https://pixabay.com")&&(T=T.substr("https://pixabay.com".length,T.length-"https://pixabay.com".length));var Q="",ee=i.clone(i.opt(I,(function(e){return e.imageColorData})));if(null!=ee){i.sortInPlace(ee,(function(e,t){return e.coverage>t.coverage}));for(var re=[],oe=i.iter(ee);!oe.done;oe.next()){var ie,ae,se=oe.value;(ie=i.as(h.style,b.ImageStyle))&&(ae=i.opt(i.opt(I,(function(e){return e.image})),(function(e){return e.getFilterColor(se.rgbColor,ie)})))&&(re.push(ae.rgbHex),re.push(i.toString(Math.round(1e3*se.coverage)/1e3)))}Q=re.join(",")}var le=s+"frame:'"+l+"',crop:'"+C+"',filt:'"+P+"',type:'"+J+"',";v.length>0&&(le+="search:'"+i.toString(v)+"',"),T.length>0&&(le+="url:'"+i.toString(T)+"',"),S.length>0&&(le+="sourceType:'"+i.toString(S)+"',"),D.length>0&&(le+="licenseType:'"+i.toString(D)+"',"),c.length>0&&(le+="c1:'"+i.toString(c)+"',"),_.length>0&&(le+="c2:'"+i.toString(_)+"',"),le+=Q+"'",M.push(le)}else if(e instanceof w.RootForma)j=s+"frame:'"+l+"', color1:'"+c+"'";else if(p=i.as(e,U.ShapeForma)){if(null!=p.controller){var ue,ce,de=s+"frame:'"+l+"', color1:'"+c+"', intent:'"+((o=p.intent)||null!=o?o:"")+"'",he=i.as(p.contentNode,$.VectorContentNode);O=i.opt(he,(function(e){return e.mediaMetadata})),null!=(ue=i.opt(O,(function(e){return e.searchTerm})))&&(de+=" searchTerm:'"+ue+"'"),null!=(ce=i.opt(O,(function(e){return e.sourceURL})))&&(de+=" iconURL:'"+ce+"'"),L.push(de)}}else if((f=i.as(e.controller,z.TypeLockupController))&&null!=e.finalFrame){var pe=r.getLockupMetaDataString(e);if(x.push(pe),f.getCharacterStyleRanges().length>0){var fe=r.getMSLockupMetaDataString(e);G.push(fe)}}if(null!=(y=e.source)&&g.FormaSourceUtils.isDesignIngredient(e.source)){var me=a+" src:"+y;Y.push(me)}}}));var H=v.GUIDUtils.makeGUID(),K=[],W=a.colorLibraryController.getCurrentThemeHexString(),X=a.colorLibraryController.getNumThemeColorKeys(),q=t?"1":"0",Z="size:"+s+", w:"+i.toString(a.pageSize.width);Z+=", h:"+i.toString(a.pageSize.height)+", text:"+i.toString(x.length),Z+=", images:"+i.toString(M.length)+", stickers:"+i.toString(V)+", layout:'"+S,Z+="', marg:"+i.toString(A)+", spac:"+i.toString(D),Z+=", DIs:"+Y.length,Z+=", theme:'"+O+"', anim:'"+l,Z+="', source:'"+k+"', type:'"+N,Z+="', wm:"+q+",char:"+i.toString(G.length);var J="numColors:"+X+", paletteID:'"+F+"', palette:'"+W+"'";if(K.push([H,i.toString(K.length),"document",Z]),K.push([H,i.toString(K.length),"document",J]),K.push([H,i.toString(K.length),"background",j]),C.Host.logging.isCategoryEnabled(I.LogCategories.kDocMetadata,P.LogLevelEnum.INFO_LEVEL))for(var Q=i.iter(K);!Q.done;Q.next()){var ee=Q.value;i.info(ee[0]+" "+ee[1]+" "+ee[2]+" "+ee[3]+", length: "+ee[3].length)}return K},getDesignDecompositionJson:function(e,t){var n,o,a,s,l;void 0===t&&(t=null),i.clone(e.firstPage.root.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));var c,d,p=e.firstPage,f=p.sizeID,g=p.colorLibrary.paletteID,y=e.content.root.getTag(B.RootContentNode.THEME_ID_TAG),v=e.content.root.getTag(B.RootContentNode.DOCUMENT_SOURCE_TYPE_TAG),C=e.content.root.getTag(B.RootContentNode.DOCUMENT_SOURCE_ID_TAG),P="default",S=0,D=0,A=i.clone(p.root.filterByControllerKind(_.GridController.KIND));A.length>0&&(c=i.as(A[0].controller,_.GridController))&&(d=c.gridStyle)&&(P=d.name,S=c.spacing,D=c.margin);var E=null!=g?p.colorLibrary.paletteID:"",F=null!=y?y:"",I=null!=C?C:"",O=null!=v?v:"",k=[],N=[],M=[],L={},x=[];p.root.visitAll(h.FormaTraversal.PreOrder,(function(e){if(null!=e.bounds){var t,l=e.formaID.substr(0,8),c=r.getFrameString(e,!0),d="";(t=e.style.colors.color(u.ColorRole.FieldPrimary))&&(d=t.rgbHex);var p,f="";(p=e.style.colors.color(u.ColorRole.FieldSecondary))&&(f=p.rgbHex);var g=(n=i.opt(e.parent,(function(e){return e.formaID.substr(0,8)})))||null!=n?n:"";i.opt(i.opt(e.parent,(function(e){return e.controller})),(function(e){return e.kind==_.GridController.KIND}))&&(g=(o=i.opt(e.root,(function(e){return e.formaID.substr(0,8)})))||null!=o?o:"root");var y,v,C,P,S=i.toString((a=i.opt(e.parent,(function(t){return t.indexOfChild(e)})))||null!=a?a:0),D={};if(e.bounds){var A=e.totalPlacement.calculateTransformValuesSKRT();D.xscale=i.toString(A.xscale),D.yscale=i.toString(A.yscale),D.tx=i.toString(A.tx),D.ty=i.toString(A.ty),D.rotCosine=i.toString(A.rotCosine),D.rotSine=i.toString(A.rotSine)}if(y=i.as(e,R.ImageForma)){var E="",F="",I="",O="",B="",G="",Y="";i.opt(y.parent,(function(e){return e.kind==m.FrameForma.KIND}))&&(c=r.getFrameString(e.parent),Y=y.parent.formaID.substr(0,8)),(ae=i.as(y.style,b.ImageStyle))&&(O=ae.name);var j,V,H,K=y.contentNode,W=i.opt(K,(function(e){return e.mediaMetadata}));if(i.opt(y.parent,(function(e){return e.kind==m.FrameForma.KIND}))){var X=i.clone(y.placement.inverse.transformPoints(y.parent.bounds.points)),q=Math.round(y.bounds.width),Z=Math.round(y.bounds.height);I=Math.round(1e3*q/Z)/1e3+",";for(var J=[],Q=i.iter(X);!Q.done;Q.next()){var ee=Q.value,te=i.toString(Math.round(1e3*ee.x/q)/1e3),ne=i.toString(Math.round(1e3*ee.y/Z)/1e3);J.push(te+","+ne)}I+=J.join(",")}null!=(de=i.opt(W,(function(e){return e.searchTerm})))&&(F=de,null!=(j=i.opt(W,(function(e){return e.sourceURL})))&&(E=j)),null!=(V=i.opt(W,(function(e){return e.sourceName})))&&(B=V),null!=(H=i.opt(W,(function(e){return e.licenseType})))&&(G=H);var re=i.clone(i.opt(K,(function(e){return e.imageColorData})));if(null!=re){i.sortInPlace(re,(function(e,t){return e.coverage>t.coverage}));for(var oe=[],ie=i.iter(re);!ie.done;ie.next()){var ae,se,le=ie.value;(ae=i.as(y.style,b.ImageStyle))&&(se=i.opt(i.opt(K,(function(e){return e.image})),(function(e){return e.getFilterColor(le.rgbColor,ae)})))&&(oe.push(se.rgbHex),oe.push(i.toString(Math.round(1e3*le.coverage)/1e3)))}oe.join(",")}var ue={};ue.id=l,ue.bounds=e.bounds.asString,ue.transform=i.clone(D),ue.frame=c,ue.crop=I,ue.filter=O,ue.parent=g,ue.index=S,ue.hasAlpha=y.hasAlpha(),ue.cropID=Y,F.length>0&&(ue.search=i.toString(F)),E.length>0&&(ue.url=i.toString(E)),B.length>0&&(ue.sourceType=i.toString(B)),G.length>0&&(ue.licenseType=i.toString(G)),d.length>0&&(ue.color1=i.toString(d)),f.length>0&&(ue.color2=i.toString(f)),k.push(ue)}else if(e instanceof w.RootForma)(L={}).id=l,L.frame=c,L.color=d,L.bounds=e.bounds.asString,L.transform=i.clone(D);else if(v=i.as(e,U.ShapeForma)){if(null!=v.controller){var ce={};ce.id=l,ce.bounds=e.bounds.asString,ce.transform=i.clone(D),ce.frame=c,ce.color=d,ce.intent=(s=v.intent)||null!=s?s:"",ce.parent=g,ce.index=S;var de,he,pe=i.as(v.contentNode,$.VectorContentNode);W=i.opt(pe,(function(e){return e.mediaMetadata})),null!=(de=i.opt(W,(function(e){return e.searchTerm})))&&(ce.searchTerm=de),null!=(he=i.opt(W,(function(e){return e.sourceURL})))&&(ce.iconURL=he),N.push(ce)}}else if(C=i.as(e.controller,z.TypeLockupController)){if(null!=e.finalFrame){if(null==C.contentNode)return;var fe=i.clone(r.getLockupMetaDataJSON(e));null!=fe&&(fe.bounds=e.bounds.asString,fe.transform=i.clone(D),fe.parent=g,fe.index=S,C.getCharacterStyleRanges().length>0&&(fe.highlightStyle=i.clone(r.getMSLockupMetaDataJson(e))),M.push(fe))}}else if((P=i.as(e.controller,T.GroupController))&&P.userGroup){var me={};me.id=l,me.bounds=e.bounds.asString,me.transform=i.clone(D),me.frame=c,me.parent=g,me.index=S;for(var ge=[],ye=i.iter(e.visitAsArray(h.FormaTraversal.JustChildren));!ye.done;ye.next()){var _e=ye.value;ge.push(_e.formaID.substr(0,8))}me.children=ge.join(","),x.push(me)}}}));var G={};return G.id=(l=t)||null!=l?l:e.id,G.sizeID=f,G.width=i.toString(p.pageSize.width),G.height=i.toString(p.pageSize.height),G.layout=P,G.margin=i.toString(D),G.spacing=i.toString(S),G.themeID=F,G.source=I,G.type=O,G.paletteID=E,G.palette=p.colorLibraryController.getCurrentThemeHexString(),k.length>0&&(G.images=i.clone(k)),M.length>0&&(G.text=i.clone(M)),N.length>0&&(G.shapes=i.clone(N)),x.length>0&&(G.groups=i.clone(x)),G.background=i.clone(L),G},getLockupMetaDataString:function(e){var t,n="",o=r.getFrameString(e);if(t=i.as(e.controller,z.TypeLockupController)){var a,s=t.text,l="";(a=i.opt(i.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData})))&&(l=a.postScriptName);var c,d,h=t.lockupStyle.backingShapeID,p=t.lockupStyle.textLookAsString,f=t.lockupStyle.layoutType,m="",g="";(c=t.lockupStyle.colors.color(u.ColorRole.FieldPrimary))&&(m=c.rgbHex),t.lockupStyle.backing!=k.LockupBacking.None&&(d=t.lockupStyle.colors.color(u.ColorRole.FieldSecondary))&&(g=d.rgbHex);var y=Math.round(1e3*t.lockupStyle.currentTextOpacity)/1e3,_=Math.round(1e3*t.lockupStyle.currentBackingOpacity)/1e3,T=t.lockupStyle.textBacked?"1":"0",v=e.formaID.substr(0,8),C=Math.round(1e3*t.lockupStyle.shadowAngle)/1e3,P=Math.round(1e3*t.lockupStyle.shadowOffset)/1e3,S=Math.round(1e3*t.lockupStyle.spacing)/1e3,D=Math.round(1e3*t.lockupStyle.padding)/1e3,A=Math.round(1e3*t.lockupStyle.tracking)/1e3,E=Math.round(1e3*t.lockupStyle.strokeWeight)/1e3;n="id:'"+v+"', ft:'"+l,n+="', sh:'"+h+"', lk:'"+p,n+="', ly:'"+f+"', ln:"+i.toString(s.length),n+=", lh:"+i.toString(Math.round(t.avgLineHeight))+", fr:'"+o,n+="', ta:"+i.toString(y)+", ba:"+i.toString(_),n+=", c1:'"+m+"', c2:'"+g,n+=", fl:'"+T+"', bc:''";var R=i.clone((new G.RoleSuggester).getRole(e));n+=" r:'"+G.RoleSuggester.getShortLabel(R.role)+"', rc:"+Math.round(1e3*R.confidence)/1e3,n+=" sa:'"+i.toString(C)+"', so:'"+i.toString(P),n+="', sp:'"+i.toString(S)+"', pd:'"+i.toString(D),n+="', tr:'"+i.toString(A)+"', sw:'",n+=i.toString(E)+"'"}return n},getLockupMetaDataJSON:function(e){var t,n=r.getFrameString(e,!0);if(t=i.as(e.controller,z.TypeLockupController)){var o,a=t.contentNode.text,s="";(o=i.opt(i.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData})))&&(s=o.postScriptName);var l,c,d=t.lockupStyle.backingShapeID,h=t.lockupStyle.textLookAsString,p=t.lockupStyle.layoutType,f="",m="";(l=t.lockupStyle.colors.color(u.ColorRole.FieldPrimary))&&(f=l.rgbHex),t.lockupStyle.backing!=k.LockupBacking.None&&(c=t.lockupStyle.colors.color(u.ColorRole.FieldSecondary))&&(m=c.rgbHex);var g,y=Math.round(1e3*t.lockupStyle.currentTextOpacity)/1e3,_=Math.round(1e3*t.lockupStyle.currentBackingOpacity)/1e3,T=(t.lockupStyle.textBacked,"");(g=t.getBackgroundColor())&&(T=g.rgbHex);var v=e.formaID.substr(0,8),C=Math.round(1e3*t.lockupStyle.shadowAngle)/1e3,P=Math.round(1e3*t.lockupStyle.shadowOffset)/1e3,S=Math.round(1e3*t.lockupStyle.spacing)/1e3,D=Math.round(1e3*t.lockupStyle.padding)/1e3,A=Math.round(1e3*t.lockupStyle.tracking)/1e3,E=Math.round(1e3*t.lockupStyle.strokeWeight)/1e3,R={};return R.id=v,R.font=s,R.backingShape=d,R.look=h,R.layout=p,R.text=a,R.avgFontSize=i.toString(Math.round(t.getAverageFontSize())),R.frame=n,R.backingOpacity=i.toString(_),R.textOpacity=i.toString(y),R.color1=f,R.color2=m,R.backgroundColor=T,R.shadowAngle=i.toString(C),R.shadowOffset=i.toString(P),R.spacing=i.toString(S),R.padding=i.toString(D),R.tracking=i.toString(A),R.strokeWeight=i.toString(E),R}return null},getMSLockupMetaDataString:function(e){var t,n="";if(t=i.as(e.controller,z.TypeLockupController)){n="id:'"+e.formaID.substr(0,8)+"'";for(var r=i.iter(t.lockupStyle.characterStyles);!r.done;r.next()){var o,a,s,l=r.key,c=r.value;n+=", chStyle:'"+l+"'",(o=i.opt(c.font,(function(e){return e.fontData})))&&(n+=", chFont:'"+o.postScriptName+"'"),c.backing!=k.LockupBacking.UNSET&&(n+=", chShape:'"+c.backingShapeID+"'"),c.textLook!=k.LockupTextLook.UNSET&&(n+=", chLook:'"+c.textLookAsString+"'"),c.textOpacity!=y.FormaStyle.OPACITY_UNSET&&(n+=", chTextOpacity:'"+c.textOpacity+"'"),c.backingOpacity!=y.FormaStyle.OPACITY_UNSET&&(n+=", chBackOpacity:'"+c.backingOpacity+"'"),(a=c.colors.color(u.ColorRole.FieldPrimary))&&(n+=", chColor1:'"+a.rgbHex+"'"),c.backing!=k.LockupBacking.None&&(s=c.colors.color(u.ColorRole.FieldSecondary))&&(n+=", chColor2:'"+s.rgbHex+"'")}}return n},getMSLockupMetaDataJson:function(e){var t,n={};if(t=i.as(e.controller,z.TypeLockupController))for(var r=e.formaID.substr(0,8),o=i.iter(t.lockupStyle.characterStyles);!o.done;o.next()){var a,s=o.key,l=o.value;n.id=r,n.styleName=s,(a=i.opt(l.font,(function(e){return e.fontData})))&&(n.font=a.postScriptName),l.backing!=k.LockupBacking.UNSET&&(n.backingShape=l.backingShapeID),l.textLook!=k.LockupTextLook.UNSET&&(n.textLook=l.textLookAsString),l.textOpacity!=y.FormaStyle.OPACITY_UNSET&&(n.textOpacity=i.toString(l.textOpacity)),l.backingOpacity!=y.FormaStyle.OPACITY_UNSET&&(n.backingOpacity=i.toString(l.backingOpacity));var c,d,h="",p="";(c=l.colors.color(u.ColorRole.FieldPrimary))&&(h=c.rgbHex,n.color1=h),l.backing!=k.LockupBacking.None&&(d=l.colors.color(u.ColorRole.FieldSecondary))&&(p=d.rgbHex,n.color2=p)}return n},sliderToOpacityMapping:function(e){return Math.log(e*(o.OPACITY_LOG_SCALE-1)+1)/Math.log(o.OPACITY_LOG_SCALE)},opacityToSliderMapping:function(e){return(Math.exp(e*Math.log(o.OPACITY_LOG_SCALE))-1)/(o.OPACITY_LOG_SCALE-1)},sliderToSpacingPaddingMapping:function(e){return e},spacingPaddingToSliderMapping:function(e){return e},pruneOrphanedContent:function(e){if(0!=e.allowPrune){var t=e.beginTransaction("prune_orphaned_content"),n={};e.firstPage.root.visitAll(h.FormaTraversal.PreOrderWithAuxiliaries,(function(e){var t,r;null!=(t=e.contentID)&&(n[t]=!0),(r=i.as(e,te.VideoForma))&&(n[r.videoContentID]=!0)}));var r=[];e.content.root.visitAll((function(t){t!=e.content.root&&null==n[t.id]&&r.push(t)}));for(var o=i.iter(r);!o.done;o.next()){var a,s=o.value;(a=s.parent)&&a.removeChild(s),s.releaseResources()}t.mergeWithPrevious()}},getUnreportedUsedIcons:function(e){var t=[];e.content.root.visitAll((function(e){var n;if(n=i.as(e,$.VectorContentNode)){var r=n.getUsageID();null!=r&&n.isUsageReported()&&!t.includes(r)&&t.push(r)}}));var n=[],r=e.beginTransaction("updateIconUsage");return e.content.root.visitAll((function(e){var r;if(r=i.as(e,$.VectorContentNode)){var o=r.getUsageID();null!=o&&(r.isUsageReported()||(t.includes(o)?r.setUsageReported(!0):n.includes(o)||n.push(o)))}})),r.mergeWithPrevious(),n},reportedIconUsage:function(e,t){e.content.root.visitAll((function(e){var n;if(n=i.as(e,$.VectorContentNode)){var r=n.getUsageID();null!=r&&t.includes(r)&&n.setUsageReported(!0)}}))},dumpDocumentInfo:function(e,t){if(null!=e){i.info("Document '"+e.documentName+"' "+t+". Document history:"),e.history.forEachEntry((function(e){return i.info("  "+e)}));for(var n=i.clone(e.firstPage.colorLibraryController.getThemeColorKeys()),o=i.iter(n);!o.done;o.next()){var a=o.value,s=e.firstPage.colorLibraryController.getSolidColorForKey(a);i.info("Theme color:"+a+" value:"+i.toString(i.opt(s,(function(e){return e.asString}))))}i.info("Document formae:"),e.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(e){var t=r.getFormaNestingDepthString(e)+"  Forma kind: "+e.kind+" "+i.toString(i.opt(e.controller,(function(e){return e.kind})));null!=e.bounds&&(t+=" size: "+Math.round(e.bounds.width)+" x "+Math.round(e.bounds.height));var n=e.style.colors.colorID(u.ColorRole.FieldPrimary);if(null!=n&&(t+=" primary color:"+n),e.kind==H.TextForma.KIND)t+=" text: '"+e.text;else if(e.kind==U.ShapeForma.KIND)t+=" shapeID: '"+i.toString(e.shapeLibraryID);else if(e.kind==R.ImageForma.KIND){var o=e.contentNode;t+=null!=o?" Image size:"+o.pixelWidth+" x "+o.pixelHeight:"[Failed to find ContentNode for image]"}t+=" id: "+e.formaID+", contentID: "+i.toString(e.contentID)+", parent id: "+i.toString(i.opt(e.parent,(function(e){return e.formaID}))),i.info(t)})),i.info("Document Content:"),e.content.root.visitAll((function(e){if(null!=i.as(e,Q.URLBasedContentNode)){var t=e;i.info("  Node kind:"+t.kind+" id:"+t.id+" url:"+i.toString(t.url)+" source:"+i.toString(i.opt(t.mediaMetadata,(function(e){return e.sourceName})))+" assetID:"+i.toString(i.opt(t.mediaMetadata,(function(e){return e.assetID}))))}else i.info("  Node kind:"+e.kind+" id:"+e.id)}))}},duplicateDocForSize:function(e,t){if(null!=e){var n=r.duplicateDocument(e);return n.firstPage.setPageSizeFromDesignSize(t),n}return null},duplicateDocsForResizes:function(e,t){var n=[];if(null!=e)for(var o=i.iter(t);!o.done;o.next()){var a=o.value,s=r.duplicateDocument(e),l=s.beginTransaction("setPageSizeFromDesignSize");s.firstPage.setPageSizeFromDesignSize(a),l.end(),n.push(s)}return n},duplicateDocForGrid:function(e,t){if(null!=e){var n=r.duplicateDocument(e);null!=e.controller&&e.controller.inAutomaticLayoutInteractionMode&&i.opt(n.controller,(function(e){return e.setAutomaticLayoutInteractionMode()}));var o=i.as(n.firstPage.root.controller,x.RootController);i.opt(o,(function(e){return e.createGridControllerIfNone()}));var a=i.opt(o,(function(e){return e.getGridController()}));return i.opt(a,(function(e){return e.applyStyle(t,0)})),n}return null},duplicateDocsForGrids:function(e,t){var n=[];if(null!=e)for(var o=i.iter(t);!o.done;o.next()){var a=o.value,s=r.duplicateDocument(e);null!=e.controller&&e.controller.inAutomaticLayoutInteractionMode&&i.opt(s.controller,(function(e){return e.setAutomaticLayoutInteractionMode()}));var l=i.as(s.firstPage.root.controller,x.RootController);i.opt(l,(function(e){return e.createGridControllerIfNone()}));var u=i.opt(l,(function(e){return e.getGridController()}));i.opt(u,(function(e){return e.applyStyle(a,0)})),n.push(s)}return n},getFormaNestingDepthString:function(e){for(var t="",n=e.parent;null!=n;)t+="  ",n=n.parent;return t},duplicateDocument:function(e){C.Host.imageAnalysis.useCache(!0);var t=new X.TheoJSONEncoder;e.encode(t);var n=new W.TheoJSONDecoder(t.json());return V.TheoDocument.init_209f(n,null)},mapFontSource:function(e){switch(e){case 0:return"unknown";case 1:case 2:case 3:return"spark-provided";case 4:return"user-uploaded";case 5:case 6:return"tk-synced"}},addFontFromStyle:function(e,t){if(null!=e.font){for(var n=e.font.fontData,o={postScriptName:n.postScriptName,source:r.mapFontSource(n.source)},a=!1,s=i.iter(t);!s.done;s.next()){var l=s.value;if(l.postScriptName==o.postScriptName&&l.source==o.source){a=!0;break}}a||t.push(o)}},getFontsUsed:function(e){for(var t=[],n=i.clone(e.firstPage.root.filterByControllerKind(z.TypeLockupController.KIND)),o=i.iter(n);!o.done;o.next()){var a,s=o.value;if(a=i.as(s.style,k.LockupStyle)){r.addFontFromStyle(a,t);for(var l=i.iter(a.characterStyles);!l.done;l.next()){var u=l.value;r.addFontFromStyle(u,t)}}}return t},getNumVideos:function(e){for(var t=0,n=i.iter(e.firstPage.root.visitAsArray(h.FormaTraversal.PreOrder));!n.done;n.next())n.value instanceof te.VideoForma&&(t+=1);return t},getContentCountsString:function(e){var t,n,r=0,o=0,a=0,s=0,l=0,u=0,c=0,d=0;return e.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(e){var p,f=!1;if(e.hasIntent(h.Forma.INTENT_LOGO)&&(l+=1,f=!0),e.hasIntent(h.Forma.INTENT_ICON)&&(s+=1),!(t=i.opt(e.controller,(function(e){return e.userGroup})))&&null==t||!t||((n=i.opt(e.controller,(function(e){return e.userGroupChild})))||null!=n)&&n||(d+=1),e.controller instanceof z.TypeLockupController)a+=1;else if(p=i.as(e,te.VideoForma)){var m=!1;p.isSticker()&&(c+=1,m=!0),m||(u+=1)}else e instanceof R.ImageForma&&!f&&(e.parent.controller.floating?o+=1:r+=1)})),"[text:"+a+", image:"+r+", floatingImage:"+o+", icon:"+s+", logo:"+l+", sticker:"+c+", video:"+u+", group:"+d+"]"},getExtendedContentCountsString:function(e){var t=0,n=[];return e.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(e){var r;null!=(r=e.source)&&g.FormaSourceUtils.isDesignIngredient(r)&&n.push(s.BadgeFacade.getDesignIngredientIDAndType(r)),e instanceof R.ImageForma&&!e.hasIntent(h.Forma.INTENT_LOGO)&&F.ImageFacade.getCutoutModeForForma(e)==A.CutoutMode.BackgroundRemoval&&(t+=1)})),"[1TapLockup:"+n.length+", removeBg:"+t+"]"},getTextLayoutsString:function(e){var t,n={};if(t=i.as(e.firstPage.root,w.RootForma))for(var r=i.iter(c.DesignFeatureUtils.getLockupsInDesign(t));!r.done;r.next()){var o,a=r.value;if(o=i.as(a.style,k.LockupStyle))switch(o.layout){case 5:o.alignment==k.LockupAlignment.Right?n.letterGridRight=1:o.alignment==k.LockupAlignment.Center?n.letterGridCenter=1:n.letterGridLeft=1;break;case 0:n.magic=1;break;case 6:o.pathID==Z.TextPathID.SemiCircleDown?n.semiCircle=1:o.pathID==Z.TextPathID.SemiCircleUp?n.invertedSemiCircle=1:n.circle=1;break;case 7:var s=K.TextFacade.getCategoryForAutoAlignment(o.alignment);s==j.TypographyLayoutCategory.DropCap?n.autoDropCap=1:s==j.TypographyLayoutCategory.Triplet?n.autoTriplet=1:s==j.TypographyLayoutCategory.Rotate?n.autoRotate=1:s==j.TypographyLayoutCategory.RotateFit&&(n.autoRotateFit=1)}}return"["+i.sort(i.keys(n)).map((function(e){return e}),this).join(", ")+"]"},unionFinalFrame:function(e){if(0==e.length)return null;for(var t=e[0].finalFrame,n=i.iter(e);!n.done;n.next()){var r=n.value;t=t.unionWith(r.finalFrame)}return t},validateDoc:function(e,t){void 0===t&&(t="");var n,r,o=this;function a(a,s){var l={};e.content.root.visitAll((function(e){var t,n={kind:e.kind,id:e.id};(t=i.as(e,Q.URLBasedContentNode))&&(n.componentID=t.componentID,n.mimeType=t.mimeType,n.url=t.url),l[e.id]=i.clone(n)}));var u,c=i.clone(e.firstPage.root.filterWithCallback((function(e){return e.kind==R.ImageForma.KIND||e.kind==ee.VectorForma.KIND||e.kind==U.ShapeForma.KIND}))).map((function(e){return{formaID:e.formaID,kind:e.kind,contentID:e.contentID}}),o),d=i.clone(i.as({errorMsg:a,location:t,docID:e.uuid,forma:s,formaID:s.formaID,contentID:(n=s.contentID)||null!=n?n:"",allContent:l,allFormae:c},["Dictionary","String","Any"]));return(u=i.opt(e.controller,(function(e){return e.undoRedoMgr})))&&(d.undoRedoState={currentState:u.debugDescribeCurrentState(),last5States:u.timeline.states.map((function(e){return(r=i.opt(e.action,(function(e){return e.description})))||null!=r?r:""}),o),nextUndo:u.getUndoDescription(),nextRedo:u.getRedoDescription()}),d}i.opt(C.Host.logging,(function(e){return e.info("validateDoc: validating document...")}));for(var s=i.clone(e.firstPage.root.filterByControllerKind(D.ImageController.KIND)),l=i.iter(s);!l.done;l.next()){var u,c=l.value;if(u=i.as(c,R.ImageForma)){if(null==u.contentID)return a("forma has no contentID",u);var d,h,p=e.content.nodeByID(u.contentID);if(null==p)return a("could not locate content node for image forma",u);if((d=i.as(p,Q.URLBasedContentNode))&&null==d.url)return a("content node has no url",u);if((h=u.contentNode)&&h.id!=u.contentID)return a("cached content node does not match contentID",u)}}return null},debugFormaPath:function(e){for(var t=e,n=[];null!=t;){var r,o;r=(o=t.controller)?"(id="+t.id+",kind="+t.kind+",controller="+o.kind+")":"(id="+t.id+",kind="+t.kind+")",n.splice(0,0,r),t=i.opt(t,(function(e){return e.parent}))}return n.join("/")},scaleAndCenterFormasInDoc:function(e){var t=e.firstPage.root,n=i.clone(t.filterWithCallback((function(e){return null!=e.controller&&!_.GridController.isBackgroundColoredCell(e)&&(e.kind==U.ShapeForma.KIND||e.isTypeLockup())}))),r=J.TheoRect.Zero,o=n.map((function(e){return e.controller.getUserPerceivedFrame()}),this);r=o.reduce((function(e,t){return e.unionWith(t)}),o[0]);var a=J.TheoRect.fromXYWH(i.toDouble(15),i.toDouble(15),t.finalFrame.width-30,t.finalFrame.height-30),s=Math.min(a.height/r.height,a.width/r.width),l=N.Matrix2D.translation(a.origin),u=(a.width-s*r.width)/2,c=(a.height-s*r.height)/2;n.forEach((function(e){e.bounds=e.bounds.scale(s,q.TheoPoint.ZERO);var t=e.totalPlacement,n=(t.tx-r.minX)*s+u,o=(t.ty-r.minY)*s+c;e.placement=new N.Matrix2D(t.a,t.b,t.c,t.d,n,o).concat(l)}))},enableFastHeuristicsForComplexPage:function(e,t){return void 0===t&&(t=!1),e.root.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})).length>(t?r.HIGH_DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD:r.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD)},getIntersectingGraphics:function(e){var t,n;return(t=e.finalFrame)&&(n=e.root)?n.filterWithCallback((function(e){var n,r;return!(!(n=e.finalFrame)||!(r=n.intersectionWith(t)))&&e.isGraphic()&&e.kind!=R.ImageForma.KIND&&e.kind!=w.RootForma.KIND&&r.area/t.area>.01})):[]}}}),r)},T8w7:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("FNB+"),l=n("QbzR"),u=n("X0GW"),c=n("lmwz"),d=n("uxH+"),h=n("8t9B");o.OpacityFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"OpacityFacade",ctor:r,superName:"CoreObject",statics:{applyOpacity:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r=n.value;i.opt(r.controller,(function(t){return t.applyOpacity(e)}))}},getOpacityForForma:function(e){var t;return(t=i.opt(e.controller,(function(e){return e.currentOpacity})))||null!=t?t:1},applyTextOpacity:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r=n.value;i.opt(i.as(r.controller,h.TypeLockupController),(function(t){return t.applyTextOpacity(e)}))}},applyShapeOpacity:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r=n.value;i.opt(i.as(r.controller,h.TypeLockupController),(function(t){return t.applyShapeOpacity(e)}))}},getShapeOpacityForForma:function(e){var t;return(t=i.as(e.controller,h.TypeLockupController))?t.currentShapeOpacity:l.FormaStyle.OPACITY_UNSET},applyBackgroundOpacity:function(e,t){var n;(n=i.as(t.root.controller,d.RootController))&&n.setBackgroundTransparency(e)},getBackgroundOpacity:function(e){var t;return(t=i.as(e.root.controller,d.RootController))?t.getBackgroundTransparency():1},applyBlendMode:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r=n.value;i.opt(r.controller,(function(t){return t.applyBlendMode(e)}))}},getBlendModeForForma:function(e){return e.style.blendMode},formaHasNonNormalBlendMode:function(e){return r.getBlendModeForForma(e)!=l.FormaBlendMode.Normal},formaCanHaveBlendMode:function(e){var t,n,r=!1;return u.GroupFacade.isInsideUserGroup(e)||(e.isImage()?(t=c.ImageFacade.getFrameFormaForForma(e))&&(n=t.controller)&&(r=!e.isVideo()&&!e.isLogo()&&!e.isSticker()&&n.floating):e.isShape()&&(r=!e.isGridCell())),r},getBlendModeUseForAnalytics:function(e){var t=!1,n=!1;return e.firstPage.root.visitAll(s.FormaTraversal.PreOrder,(function(e){if(r.formaCanHaveBlendMode(e)){var o=r.getBlendModeForForma(e);o==l.FormaBlendMode.Multiply?t=!0:o==l.FormaBlendMode.Screen&&(n=!0)}})),t&&n?"multiply,screen":t?"multiply":n?"screen":"none"}}}),r)},T9pj:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.ErrorMessageConstants=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"ErrorMessageConstants",ctor:r,superName:"CoreObject",statics:{kDefaultBadRequestError:"Bad request",kSaveImageToDBError:"Failed to save image component",kAuthError:"Authorization failed",kRequestTimedout:"Request timed out",kServiceNotFound:"Service not found",kServiceUnavailableError:"Service is unavailable",kNoNetworkConnection:"No Internet connection",kBadResponse:"Bad server response",kServiceUnreachableError:"Service unreachable",kUnknownError:"Unexpected error occurred",kAddTextMissingFontError:"kAddTextMissingFontError"}}),r)},TbN7:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("90dd");a.InsertedSwatchesMessage=(r=function e(t,n,r){this.index=n,this.swatches=s.clone(r),l.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"InsertedSwatchesMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"InsertedSwatchesMessage"}}}}),r),a.RemovedSwatchesMessage=(o=function e(t,n,r){this.index=n,this.swatches=s.clone(r),l.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"RemovedSwatchesMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"RemovedSwatchesMessage"}}}}),o),a.ReplacedSwatchesMessage=(i=function e(t,n){this.oldSwatches=s.clone(n),l.TheoMessage.call(this,e.TYPE,t)},s.defineClass({name:"ReplacedSwatchesMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ReplacedSwatchesMessage"}}}}),i)},URxh:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("VQVe"),u=n("dJuF"),c=n("ZhwN"),d=n("tGKA"),h=n("Quhx"),p=n("x4Gy"),f=n("RkYL"),m=n("xm77");a.KeyFrame=(r=function(e,t,n,r,o,i){this.renderRuns=new p.RenderRuns,void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=!1),this.time_=e,this.timingFunction_=t,this.placement_=n||d.Matrix2D.Identity,this.bounds_=r,this.style_=s.opt(o,(function(e){return e.clone()})),this.relativePlacement_=i},s.defineClass({name:"KeyFrame",ctor:r,superName:"CoreObject",statics:{makeFromTimeAndStyle:function(e,t){return new r(e,m.TimingFunctionType.Linear,d.Matrix2D.Identity,null,t)}},props:{time:{get:function(){return this.time_}},timingFunction:{get:function(){return this.timingFunction_}},placement:{get:function(){return this.placement_}},style:{get:function(){return this.style_}},bounds:{get:function(){return this.bounds_}},relativePlacement:{get:function(){return this.relativePlacement_}},stillKeyframe:{get:function(){return null==this.style&&this.placement.equal(d.Matrix2D.Identity)&&null==this.bounds}}}}),r),a.FormaAnimation=(o=function(){this.valid_=!0},i={},s.defineClass({name:"FormaAnimation",ctor:o,superName:"PostDCXObject",statics:{KIND:{get:function(){return"FormaAnimation"}},SCHEMA_CLASS_NAME:"FormaAnimation",codec:{get:function(){return void 0===i.codec&&(i.codec=u.DBPropertyCodec.registerCodec(o.SCHEMA_CLASS_NAME,u.DBPropertyCodec.directObjectCodec(o.SCHEMA_CLASS_NAME))),i.codec}},factory:{get:function(){return function(e,t,n,r){return o.init_866e(n,e)}}},PROPERTY_KIND:"kind",PROPERTY_START_TIME:"start-time",PROPERTY_END_TIME:"end-time",PROPERTY_KEY_FRAMES:"key-frames",PROPERTY_ANIMATION_STYLE:"animation-style",createDefault:function(){return o.init_9e82(l.AnimationStyle.init_b946(),f.TheoTime.Zero,f.TheoTime.Zero,[])},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_9e82:function(e,t,n,r){this.persistedKeyFrames_=s.clone(r),s.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_dd5d,{},{"start-time":t,"end-time":n,"animation-style":e.clone(),"key-frames":r,kind:o.KIND})},init_866e:function(e,t){s.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_866e,e,t)},init_dd5d:function(e,t){s.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_dd5d,e,t)},didChangeState:function(e){h.PostDCXObject.prototype.didChangeState.call(this,e),null!=e[o.PROPERTY_KEY_FRAMES]&&(this.persistedKeyFrames_=null),this.invalidate()},willCommitState:function(){h.PostDCXObject.prototype.willCommitState.call(this),null!=this.pendingKeyFrames_&&(this.set(o.PROPERTY_KEY_FRAMES,this.pendingKeyFrames_),this.persistedKeyFrames_=s.clone(this.pendingKeyFrames_),this.pendingKeyFrames_=null)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},startTime:{get:function(){var e;return(e=s.as(this.get(o.PROPERTY_START_TIME),f.TheoTime))||null!=e?e:f.TheoTime.Zero},set:function(e){this.set(o.PROPERTY_START_TIME,e)}},endTime:{get:function(){var e;return(e=s.as(this.get(o.PROPERTY_END_TIME),f.TheoTime))||null!=e?e:f.TheoTime.Zero},set:function(e){this.set(o.PROPERTY_END_TIME,e)}},persistedKeyFrames:{get:function(){var e;return null==this.persistedKeyFrames_&&(this.persistedKeyFrames_=s.clone((e=s.as(this.get(o.PROPERTY_KEY_FRAMES),["Array",a.KeyFrame]))||null!=e?e:[])),this.persistedKeyFrames_}},keyFrames:{get:function(){return this.pendingKeyFrames_||this.persistedKeyFrames},set:function(e){this.pendingKeyFrames_=s.clone(e)}},animationStyle:{get:function(){return this.get(o.PROPERTY_ANIMATION_STYLE)}},clone:function(){return this.fork(c.GUIDUtils.makeGUID())},invalidate:function(){this.valid_=!1},valid:{get:function(){return this.valid_}}}}),o)},V3yt:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("yGNn"),s=n("iCxV");o.FontFacade=(r=function(){},i.defineClass({name:"FontFacade",ctor:r,statics:{ensureFontLoaded:function(e){switch(e.availability){case 1:var t;return(t=s.Host.fontProvider)?new a.CorePromise((function(n,r){return t.loadFont(e,(function(){return n(e)}),(function(){return r("could not load font")}))})):a.CorePromise.reject("Host.fontProvider not available; can't load font.");case 2:return a.CorePromise.resolve(e);case 3:return a.CorePromise.reject("font cannot be loaded");case 0:return a.CorePromise.reject("font unknown loadable")}}}}),r)},VJ9E:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("QgZx"),s=n("iCxV"),l=n("3lr5"),u=n("fNpk");o.TheoFont=(r=function(){this.roleOrder=["headline-font","body-font","body-font-italic","body-font-bold","body-font-bold-italic","secondary-font"]},i.defineClass({name:"TheoFont",ctor:r,superName:"CoreObject",statics:{SPARK_FONT_ROLE_HEADLINE:"headline-font",SPARK_FONT_ROLE_BODY:"body-font",SPARK_FONT_ROLE_BODY_ITALIC:"body-font-italic",SPARK_FONT_ROLE_BODY_BOLD:"body-font-bold",SPARK_FONT_ROLE_BODY_BOLD_ITALIC:"body-font-bold-italic",SPARK_FONT_ROLE_SECONDARY:"secondary-font",SPARK_FONT_ROLE_CUSTOM:"custom",decodeJson:function(e,t){if(null==e)return null;var n=i.as(e,["Dictionary","String","Any"]);if(null==n)return u.LegacyCoreAssert.fail("TheoFont.decodeJson: object passed isn't a dictionary",void 0,"TheoFont.decodeJson","TheoFont.swift",106),null;var o,s=i.as(n[a.FontDescriptor.PROPERTY_POSTSCRIPT_NAME],"String");if(o=a.FontDescriptor.decodeJson(e,t)){if(s==o.postScriptName){var l=i.as(n.sparkElementID,"String"),c=i.clone(i.as(n.sparkRoles,["Array","String"]));return r.init_9e5c(o,l,c)}return r.init_9e5c(o)}return null}},props:{init_9e5c:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),this.fontData=e,this.sparkElementID=t,this.sparkRoles=i.clone(n)},init_a314:function(e){this.sparkElementID=e.id,this.sparkRoles=i.clone(e.acRoles);var t,n,r=s.Host.fontProvider.getIncludedFonts(l.ANY_DOCUMENT);(t=e.descriptor)?null!=(n=r.indexOf(t))?this.fontData=r.fontAt(n):(i.opt(s.Host.logging,(function(e){return e.warning("Failed to find brandkit font "+t.postScriptName+" in list of available fonts, using 0th")})),this.fontData=r.fontAt(0)):"faux-font"==e.sourceType?(i.opt(s.Host.logging,(function(e){return e.warning("TheoFont: Failed to find synthesized brandkit font in list of available fonts, using 0th font")})),this.fontData=r.fontAt(0)):(i.opt(s.Host.logging,(function(e){return e.warning("TheoFont: Failed to find brandkit font in list of available fonts, using 0th font")})),this.fontData=r.fontAt(0))},isSparkFont:function(){return null!=this.sparkRoles||null!=this.sparkElementID},getSparkFontRole:function(){if(null==this.sparkRoles)return null;for(var e=i.iter(this.roleOrder);!e.done;e.next()){var t=e.value;if(this.sparkRoles.includes(t))return t}return null},hasSparkFontRole:function(e){return null!=this.sparkRoles&&this.sparkRoles.includes(e)},encodeJson:function(){var e=this.fontData.encodeJson();return null!=this.sparkElementID&&(e.sparkElementID=this.sparkElementID),null!=this.sparkRoles&&(e.sparkRoles=i.clone(this.sparkRoles)),e},isEqual:function(e){var t;return!!(t=i.as(e,r))&&t.fontData.isEqual(this.fontData)&&t.sparkElementID==this.sparkElementID&&t.getSparkFontRole()==this.getSparkFontRole()}}}),r),o._equality_TheoFont_TheoFont=function(e,t){return e.isEqual(t)}},VQVe:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("dJuF"),l=n("ZhwN"),u=n("Quhx"),c=n("RkYL");i.AnimationStyleCategory=a.defineEnum("AnimationStyleCategory",{None:"none",Text:"text",Image:"image"}),i.AnimationStyle=(r=function(){this.hasDeprecatedProperties=!1},o={},a.defineClass({name:"AnimationStyle",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"AnimationStyle",codec:{get:function(){return void 0===o.codec&&(o.codec=s.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,s.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},DEFAULT_TIMESCALE:{get:function(){return 30}},DEFAULT_START:{get:function(){return new c.TheoTime(0,r.DEFAULT_TIMESCALE)}},NOOP_DURATION:{get:function(){return new c.TheoTime(0,r.DEFAULT_TIMESCALE)}},DEFAULT_DURATION:{get:function(){return new c.TheoTime(75,r.DEFAULT_TIMESCALE)}},STILL_DURATION:{get:function(){return new c.TheoTime(60,r.DEFAULT_TIMESCALE)}},END_GIF_DURATION:{get:function(){return new c.TheoTime(150,r.DEFAULT_TIMESCALE)}},GIF_DURATION:{get:function(){return new c.TheoTime(150,r.DEFAULT_TIMESCALE)}},FADE_DURATION:{get:function(){return new c.TheoTime(30,r.DEFAULT_TIMESCALE)}},COLOR_SWAP_DURATION:{get:function(){return new c.TheoTime(180,r.DEFAULT_TIMESCALE)}},PROPERTY_NAME:"name",PROPERTY_VARIANT:"variant",PROPERTY_VARIANT_COUNT:"variant-count",PROPERTY_START_TIME:"start-time",PROPERTY_END_TIME:"end-time",PROPERTY_LOOPING:"looping",PROPERTY_CATEGORY:"category",DEPRECATED_PROPERTY_TEXT_STYLE:"text-style",DEPRECATED_PROPERTY_IMAGE_STYLE:"image-style",NAME_NO_STYLE:"None",NAME_TYPE:"Type",LETTER_APPEAR_VARIANT:10,LETTER_RANDOM_FADE_VARIANT:11,LETTER_APPEAR_FADE_VARIANT:12,NAME_FLICKER:"Flicker",NAME_GROW:"Grow",NAME_FADE:"Fade",NAME_DYNAMIC:"Dynamic",WORD_ZOOM_IN_VARIANT:0,WORD_CENTERED_VARIANT:1,WORD_APPEAR_VARIANT:2,NAME_COLORSWAP:"ColorSwap",NAME_SLIDE:"Slide",NAME_ZOOM:"Zoom",NAME_PAN:"Pan",NAME_GRAYSCALE:"Greyscale",NAME_BLUR:"Blur",NAME_COLOR:"Color",NAME_FILL:"Fill",noStyleAsString:function(){return r.NAME_NO_STYLE+"_0"},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_866e:function(e,t){a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_866e,e,t),this.hasDeprecatedProperties=null!=this.initialState.getProperty(r.DEPRECATED_PROPERTY_IMAGE_STYLE)||null!=this.initialState.getProperty(r.DEPRECATED_PROPERTY_TEXT_STYLE)},init_dd5d:function(e,t){a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_dd5d,e,t)},init_b946:function(e,t){void 0===e&&(e=r.NAME_NO_STYLE),void 0===t&&(t=i.AnimationStyleCategory.None),a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_dd5d,{},{name:e,variant:0,"variant-count":1,"start-time":new c.TheoTime(0,r.DEFAULT_DURATION.timescale),"end-time":r.DEFAULT_DURATION,looping:!1,category:t})},init_e14f:function(e,t,n,o,s){void 0===o&&(o=i.AnimationStyleCategory.None),void 0===s&&(s=!1),a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_dd5d,{},{name:e,variant:t,"variant-count":n,"start-time":new c.TheoTime(0,r.DEFAULT_DURATION.timescale),"end-time":r.DEFAULT_DURATION,looping:s,category:o})},init_d915:function(e,t,n,r,o,s,l){void 0===s&&(s=i.AnimationStyleCategory.None),void 0===l&&(l=!1),a.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_dd5d,{},{name:e,variant:t,"variant-count":n,"start-time":r,"end-time":o,looping:l,category:s})},className:{get:function(){return r.SCHEMA_CLASS_NAME}},willCommitState:function(){var e,t;this.hasDeprecatedProperties&&this.persisted&&(null==a.as(this.get(r.PROPERTY_CATEGORY),"String")&&(((e=a.as(this.get(r.DEPRECATED_PROPERTY_TEXT_STYLE),"Bool"))||null!=e)&&e?this.set(r.PROPERTY_CATEGORY,i.AnimationStyleCategory.Text):((t=a.as(this.get(r.DEPRECATED_PROPERTY_IMAGE_STYLE),"Bool"))||null!=t)&&t?this.set(r.PROPERTY_CATEGORY,i.AnimationStyleCategory.Image):this.set(r.PROPERTY_CATEGORY,i.AnimationStyleCategory.None)),this.removeProperty(r.DEPRECATED_PROPERTY_TEXT_STYLE),this.removeProperty(r.DEPRECATED_PROPERTY_IMAGE_STYLE),this.hasDeprecatedProperties=!1),u.PostDCXObject.prototype.willCommitState.call(this)},name:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_NAME),"String"))||null!=e?e:"None"}},startTime:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_START_TIME),c.TheoTime))||null!=e?e:new c.TheoTime(0,r.DEFAULT_DURATION.timescale)},set:function(e){this.set(r.PROPERTY_START_TIME,e)}},endTime:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_END_TIME),c.TheoTime))||null!=e?e:r.DEFAULT_DURATION},set:function(e){this.set(r.PROPERTY_END_TIME,e)}},variant:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_VARIANT),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_VARIANT,e)}},variantCount:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_VARIANT_COUNT),"Int"))||null!=e?e:1},set:function(e){this.set(r.PROPERTY_VARIANT_COUNT,e)}},textStyle:{get:function(){return this.category==i.AnimationStyleCategory.Text}},imageStyle:{get:function(){return this.category==i.AnimationStyleCategory.Image}},category:{get:function(){var e,t,n,o;return null!=(o=a.as(this.get(r.PROPERTY_CATEGORY),"String"))?(e=i.AnimationStyleCategory.toCaseValue(o))||null!=e?e:i.AnimationStyleCategory.None:((t=a.as(this.get(r.DEPRECATED_PROPERTY_TEXT_STYLE),"Bool"))||null!=t)&&t?i.AnimationStyleCategory.Text:((n=a.as(this.get(r.DEPRECATED_PROPERTY_IMAGE_STYLE),"Bool"))||null!=n)&&n?i.AnimationStyleCategory.Image:i.AnimationStyleCategory.None}},looping:{get:function(){var e;return!(!(e=a.as(this.get(r.PROPERTY_LOOPING),"Bool"))&&null==e)&&e},set:function(e){this.set(r.PROPERTY_LOOPING,e)}},modifiesFormaTree:{get:function(){return this.name==r.NAME_FLICKER||this.name==r.NAME_TYPE||this.name==r.NAME_FADE}},isNewTextAnimation:{get:function(){return this.name==r.NAME_TYPE||this.name==r.NAME_DYNAMIC||this.name==r.NAME_FLICKER||this.name==r.NAME_COLORSWAP}},clone:function(){return this.fork(l.GUIDUtils.makeGUID())},equals:function(e){return e.name==this.name&&e.variant==this.variant},asString:{get:function(){return this.name+"_"+this.variant}},isNoStyle:function(){return this.name==r.NAME_NO_STYLE}}}),r)},Vfmf:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("SpAV"),s=n("gXiO"),l=n("FNB+"),u=n("iCxV"),c=n("8vXU"),d=n("7pIX"),h=n("fdtz"),p=n("rxGp"),f=n("VkKB"),m=n("T6jX");o.PreflightResultCode=i.defineEnum("PreflightResultCode",{success:0,internetConnectionRequired:1,sharedDocumentOnMobile:2,containsPaidItems:3,containsUnlicensableItems:4,downgradedUserNeedsLimitedEntitlement:5,requiresLimitedEntitlement:6,paidImagesNotAllowedInTemplates:7,limitedImagesNotAllowedInTemplates:8,freeImagesNotAllowedInTemplates:9,parameterError:10,metadataError:11,licensingError:12,exceededQuotaError:13}),o.OperationType=i.defineEnum("OperationType",{openOwned:0,openShared:1,duplicateOwned:2,duplicateShared:3,publishPrivateTemplate:4,publishPublicTemplate:5,remixTemplate:6}),o.StockWorkflowUtils=(r=function(){s.CoreObject.call(this)},i.defineClass({name:"StockWorkflowUtils",ctor:r,superName:"CoreObject",statics:{kResultCodeKey:"result_code",kUnlicensedAssetListKey:"unlicensedAssetIDs",kStockMetadataPremiumLevelIDKey:"premium_level_id",kStockMetadataIsLicensedKey:"is_licensed",kLicenseResultLicenseDataKey:"licenseData",kLicenseResultLicenseNameKey:"license",kLicenseNameStandard:"Standard",kLicenseNameLimited:"Limited",kLicenseNameExtended:"Extended",kLicenseResultLicenseErrorKey:"error",kAdobeStockExceededQuotaErrorValue:"202",alwaysRetryLicense:!1,kNoUnlicensedAssets:{Standard:[],Limited:[]},preflightAndLicenseImagesForOperation:function(e,t,n,a,s,l,c){var h,p=u.Host.stockLicense.getUserEntitlement();if(e==o.OperationType.openOwned||e==o.OperationType.duplicateOwned)return 0==i.clone(m.TheoDocumentUtils.limitedLicensedStockImageIDs(t)).length?void l(o.PreflightResultCode.success):p==d.StockUserEntitlement.onlyGlobalFree||p==d.StockUserEntitlement.onlyFree?void c(o.PreflightResultCode.downgradedUserNeedsLimitedEntitlement):void l(o.PreflightResultCode.success);s?c(o.PreflightResultCode.internetConnectionRequired):e!=o.OperationType.publishPrivateTemplate&&e!=o.OperationType.publishPublicTemplate?a&&e==o.OperationType.openShared||e==o.OperationType.duplicateShared?c(o.PreflightResultCode.sharedDocumentOnMobile):(o.OperationType.openShared,u.Host.stockLicense.asyncGetMetadataForAssetIDs(n,(function(n){var s,u=i.clone(r.preflightOnlineDocumentOperation(e,t,n,p,a)),d=(h=i.as(u[r.kResultCodeKey],o.PreflightResultCode))||null!=h?h:o.PreflightResultCode.metadataError;d!=o.PreflightResultCode.success?c(d):(s=i.as(u[r.kUnlicensedAssetListKey],["Dictionary","String",["Array","String"]]))?r.obtainNecessaryLicenses(t,s,n,(function(n,i){e!=o.OperationType.openShared&&r.updateLicensesAndMediaMetadata(t,n,i),l(o.PreflightResultCode.success)}),(function(e){return c(e)})):l(o.PreflightResultCode.success)}),(function(e){return c(o.PreflightResultCode.metadataError)}))):r.preflightPublishTemplateOperation(e,t,n,p,a,l,c)},obtainNecessaryLicenses:function(e,t,n,a,s){u.Host.stockLicense.asyncGetLicensesForAssetIDs(t,(function(e){return a(e,n)}),(function(e,t){var n;if(e=o.PreflightResultCode.licensingError,n=t)for(var a=i.iter(i.values(n));!a.done;a.next()){var l,u,c=a.value;if((l=i.as(c,["Dictionary","String","Any"]))&&null!=(u=i.as(l[r.kLicenseResultLicenseErrorKey],"String"))&&u==r.kAdobeStockExceededQuotaErrorValue){e=o.PreflightResultCode.exceededQuotaError;break}}s(e)}))},getErrorResult:function(e){return{result_code:e,unlicensedAssetIDs:r.kNoUnlicensedAssets}},getSuccessResult:function(e){var t;return void 0===e&&(e=null),(t=e)?{result_code:o.PreflightResultCode.success,unlicensedAssetIDs:t}:{result_code:o.PreflightResultCode.success}},preflightOnlineDocumentOperation:function(e,t,n,a,s){if(0==n.length)return r.getErrorResult(o.PreflightResultCode.parameterError);for(var l,u={Standard:[],Limited:[]},c=r.alwaysRetryLicense||e==o.OperationType.duplicateShared,h=null,p=i.iter(n);!p.done;p.next()){var m,g,y,_=p.value;if(null!=(m=i.as(_.id,"Int"))&&null!=(g=i.as(_[r.kStockMetadataPremiumLevelIDKey],"Int"))&&null!=(y=i.as(_[r.kStockMetadataIsLicensedKey],"String"))){var T=!i.isEmpty(y),v="Limited"==y,C=g==f.MediaMetadata.StockLicensePremiumLevel.Free,P=g==f.MediaMetadata.StockLicensePremiumLevel.Premium,S=!C&&!P;if(T){if(v)if(a==d.StockUserEntitlement.onlyGlobalFree||a==d.StockUserEntitlement.onlyFree){if(!C){h=i.clone(r.getErrorResult(o.PreflightResultCode.downgradedUserNeedsLimitedEntitlement));break}i.opt(u[r.kLicenseNameStandard],(function(e){return e.push(i.toString(m))}))}else c&&i.opt(u[r.kLicenseNameLimited],(function(e){return e.push(i.toString(m))}))}else if(C)i.opt(u[r.kLicenseNameStandard],(function(e){return e.push(i.toString(m))}));else if(P){if(a==d.StockUserEntitlement.onlyGlobalFree||a==d.StockUserEntitlement.onlyFree){h=i.clone(r.getErrorResult(o.PreflightResultCode.requiresLimitedEntitlement));break}i.opt(u[r.kLicenseNameLimited],(function(e){return e.push(i.toString(m))}))}else if(S){h=i.clone(r.getErrorResult(o.PreflightResultCode.containsPaidItems));break}}}return(l=h)?l:r.getSuccessResult(u)},preflightPublishTemplateOperation:function(e,t,n,a,s,l,c){var d,h=this,p=!1;e==o.OperationType.publishPrivateTemplate&&(p=!0),u.Host.stockLicense.asyncGetMetadataForAssetIDs(n,(function(e){for(var t=!1,a=!1,s=i.iter(n);!s.done;s.next()){var u,m,g=s.value;if(!(u=i.clone(e.find((function(e){return g==i.toString((d=i.as(e.id,"Int"))||null!=d?d:0)}),h))))return void c(o.PreflightResultCode.metadataError);if(null!=(m=i.as(u[r.kStockMetadataPremiumLevelIDKey],"Int")))switch(m){case f.MediaMetadata.StockLicensePremiumLevel.Free:break;case f.MediaMetadata.StockLicensePremiumLevel.Premium:t=!0;break;default:a=!0}}var y=o.PreflightResultCode.success;a?y=o.PreflightResultCode.paidImagesNotAllowedInTemplates:t&&!p&&(y=o.PreflightResultCode.limitedImagesNotAllowedInTemplates),y==o.PreflightResultCode.success?l(o.PreflightResultCode.success):c(y)}),(function(e){return c(o.PreflightResultCode.metadataError)}))},updateLicensesAndMediaMetadata:function(e,t,n){for(var o,s,d,g=null,y={},_=i.iter(n);!_.done;_.next()){var T,v=_.value;null!=(T=i.as(v.id,"Int"))&&(y[i.toString(T)]=i.clone(v))}e.firstPage.root.visitAll(l.FormaTraversal.PreOrder,(function(n){var s,l;if((s=i.as(n,h.ImageForma))&&(l=i.opt(s.contentNode,(function(e){return e.mediaMetadata})))){var d,m,y,_=s.contentNode;if(l.sourceName==f.MediaMetadata.kMediaStockSourceName&&null!=l.assetID&&null!=l.licenseType&&null!=(d=l.assetID)&&(m=i.as(t[d],["Dictionary","String","Any"])))if(y=i.as(m[r.kLicenseResultLicenseDataKey],["Dictionary","String","Any"])){var T=i.as(y[r.kLicenseResultLicenseNameKey],"String"),v=f.MediaMetadata.kMediaStockLicenseTypeNone;switch(T){case"Limited":v=f.MediaMetadata.kMediaStockLicenseTypeLimited;break;case"Standard":v=f.MediaMetadata.kMediaStockLicenseTypeStandard;break;case"Extended":a.CoreAssertDebugOnly.fail("StockWorkflowUtils.updateLicensesAndMediaMetadata assetID: "+d+" has unexpected license name: "+r.kLicenseNameExtended,void 0,"StockWorkflowUtils.updateLicensesAndMediaMetadata","StockWorkflowUtils.swift",434),v=f.MediaMetadata.kMediaStockLicenseTypeExtended;break;default:a.CoreAssertDebugOnly.fail("StockWorkflowUtils.updateLicensesAndMediaMetadata assetID: "+d+" has unrecognized license name: "+((o=T)||null!=o?o:"<none>"),void 0,"StockWorkflowUtils.updateLicensesAndMediaMetadata","StockWorkflowUtils.swift",437),v=f.MediaMetadata.kMediaStockLicenseTypeNone}if(l.licenseType!=v){var C=l;null==g&&(g=e.beginTransaction("updateStockImageLicenseMetadataTransaction")),C.licenseType=v,_.mediaMetadata=C}}else i.opt(u.Host.logging,(function(e){return e.logForCategory(p.LogCategories.kStockImage,"StockWorkflowUtils.updateLicensesAndMediaMetadata: missing newLicenseData",c.LogLevelEnum.WARN_LEVEL)}))}})),(s=g)&&(i.opt(u.Host.logging,(function(e){return e.logForCategory(p.LogCategories.kStockImage,"markConstrainedImagesAsUnlicensed, metadata change required",c.LogLevelEnum.INFO_LEVEL)})),s.mergeWithPrevious(),m.TheoDocumentUtils.updateConstrainedImageInfo(e)),(d=i.opt(e.controller,(function(e){return e.saveMgr})))?d.requestSave(!0,!0):a.CoreAssert.fail("updateImageLicenseMetadata failed to save, no saveMgr",void 0,"StockWorkflowUtils.updateLicensesAndMediaMetadata","StockWorkflowUtils.swift",482)}}}),r)},VkKB:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("gXiO"),l=n("fNpk");i.MediaMetadata=(r=function(){},o={},a.defineClass({name:"MediaMetadata",ctor:r,superName:"CoreObject",statics:{PROPERTY_GROUP_ROOT:"rootProperties",PROPERTY_GROUP_LICENSE:"license",PROPERTY_GROUP_CCL:"ccl",PROPERTY_GROUP_CCLIGHT:"cclight",PROPERTY_SEARCH:"search",PROPERTY_LICENSE_TYPE:"type",PROPERTY_SOURCE_NAME:"source_name",PROPERTY_SOURCE_URL:"source_url",PROPERTY_OWNER:"owner",PROPERTY_SEARCH_PROPS:"search_props",PROPERTY_ASSETID:"asset_id",PROPERTY_CREATOR_USERID:"creator_user_id",PROPERTY_CREATOR_DISPLAYNAME:"creator_display_name",PROPERTY_DESIGN_INTENT:"design_intent",PROPERTY_SOURCE:"source",PROPERTY_TITLE:"photo_name",PROPERTY_TAGS:"tags",PROPERTY_LIBRARY_ID:"library_id",PROPERTY_LIBRARY_NAME:"library_name",PROPERTY_CREATED_DATE:"created_date",PROPERTY_MODIFIED_DATE:"modified_date",kMediaMarketSourceType:"market",kMediaDooploSourceType:"dooplo",kMediaStockSourceType:"adobestock",kMediaGiphySourceType:"giphy",kMediaCCLSourceType:"ccl",kMediaCCLightDesignAssetsSourceType:"cclight",kMediaStockSourceName:"Adobe Stock",kMediaNounProjectSourceName:"The Noun Project",kMediaUnsplashSourceName:"Unsplash",kMediaPixabaySourceName:"pixabay",kMediaBingSourceName:"bing",kMediaGiphySourceName:"GIPHY",kMediaCCLSourceName:"Creative Cloud Libraries",kMediaCCLightDesignAssetsSourceName:"CC Light Design Assets",kMediaStockLicenseTypeNone:"royalty_free",kMediaStockLicenseTypeStandard:"royalty_free_standard",kMediaStockLicenseTypeExtended:"royalty_free_extended",kMediaStockLicenseTypeLimited:"royalty_free_limited",StockLicensePremiumLevel:{get:function(){return void 0===o.StockLicensePremiumLevel&&(o.StockLicensePremiumLevel=a.defineEnum("StockLicensePremiumLevel",{Premium:0,Free:1,PaidLevel2:2,PaidLevel3:3,PaidLevel4:4})),o.StockLicensePremiumLevel}},PROPERTY_STOCK_COLLECTION_TYPE:"stock_collection_type",kMediaStockCollectionTypeFree:"free-stock",kMediaStockCollectionTypeLimited:"limited-stock",DESIGNINTENT_LOGO:"logo",DESIGNINTENT_PATTERN:"pattern",DESIGNINTENT_ICON:"icon",DESIGNINTENT_STICKER:"sticker",DESIGNINTENT_FLOATING_IMAGE:"floating-image",DESIGNINTENT_VIDEO:"video",fromProperties:function(e){var t=a.as(e[r.PROPERTY_SOURCE],"String");return t==r.kMediaMarketSourceType?r.fromMarketProperties(e):t==r.kMediaDooploSourceType?r.fromDooploProperties(e):t==r.kMediaStockSourceType?r.fromStockProperties(e):t==r.kMediaGiphySourceType?r.fromGiphyProperties(e):t==r.kMediaCCLSourceType?r.fromCCLProperties(e):t==r.kMediaCCLightDesignAssetsSourceType?r.fromCCLightDesignAssetsProperties(e):r.init_4d41(void 0,void 0,void 0,void 0,void 0,void 0,t)},fromDooploProperties:function(e){var t=a.as(e[r.PROPERTY_GROUP_ROOT],["Dictionary","String","Any"]),n=a.as(a.opt(t,(function(e){return e[r.PROPERTY_GROUP_LICENSE]})),["Dictionary","String","Any"]);return r.init_4d41(a.as(e[r.PROPERTY_SOURCE],"String"),a.as(e[r.PROPERTY_SEARCH],"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_TITLE]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_TAGS]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_LICENSE_TYPE]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_SOURCE_URL]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_SOURCE_NAME]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_OWNER]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_ASSETID]})),"String"))},fromStockProperties:function(e){var t=a.as(e[r.PROPERTY_GROUP_ROOT],["Dictionary","String","Any"]),n=a.as(a.opt(t,(function(e){return e[r.PROPERTY_GROUP_LICENSE]})),["Dictionary","String","Any"]);return r.init_4d41(a.as(e[r.PROPERTY_SOURCE],"String"),a.as(e[r.PROPERTY_SEARCH],"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_TITLE]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_TAGS]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_LICENSE_TYPE]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_SOURCE_URL]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_SOURCE_NAME]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_OWNER]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_ASSETID]})),"String"))},fromGiphyProperties:function(e){var t=null!=e[r.PROPERTY_LICENSE_TYPE]?a.as(e[r.PROPERTY_LICENSE_TYPE],"String"):"GIPHY Terms and Service";return r.init_4d41(a.as(e[r.PROPERTY_SOURCE],"String"),a.as(e[r.PROPERTY_SEARCH],"String"),a.as(e[r.PROPERTY_TITLE],"String"),a.as(e[r.PROPERTY_TAGS],"String"),t,a.as(e[r.PROPERTY_SOURCE_URL],"String"),a.as(e[r.PROPERTY_SOURCE_NAME],"String"),a.as(e[r.PROPERTY_OWNER],"String"),a.as(e[r.PROPERTY_ASSETID],"String"),null,null,r.DESIGNINTENT_STICKER)},fromMarketProperties:function(e){var t=a.as(e.tags,["Array","Any"]),n=a.opt(t,(function(e){return e.join(",")}));return r.init_4d41(a.as(e[r.PROPERTY_SOURCE],"String"),null,a.as(e.name,"String"),n,null,null,null,null,a.as(e.assetID,"String"),a.as(e.creator_userID,"String"),a.as(e.creator_displayName,"String"),a.as(e.design_intent,"String"))},fromCCLProperties:function(e){var t=a.as(e[r.PROPERTY_GROUP_ROOT],["Dictionary","String","Any"]),n=a.as(a.opt(t,(function(e){return e[r.PROPERTY_GROUP_LICENSE]})),["Dictionary","String","Any"]),o=a.as(a.opt(t,(function(e){return e[r.PROPERTY_GROUP_CCL]})),["Dictionary","String","Any"]);return r.init_4d41(a.as(e[r.PROPERTY_SOURCE],"String"),a.as(e[r.PROPERTY_SEARCH],"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_TITLE]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_TAGS]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_LICENSE_TYPE]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_SOURCE_URL]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_SOURCE_NAME]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_OWNER]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_ASSETID]})),"String"),void 0,void 0,void 0,a.as(a.opt(o,(function(e){return e[r.PROPERTY_LIBRARY_ID]})),"String"),a.as(a.opt(o,(function(e){return e[r.PROPERTY_LIBRARY_NAME]})),"String"),a.as(a.opt(o,(function(e){return e[r.PROPERTY_CREATED_DATE]})),"Double"),a.as(a.opt(o,(function(e){return e[r.PROPERTY_MODIFIED_DATE]})),"Double"))},fromCCLightDesignAssetsProperties:function(e){var t=a.as(e[r.PROPERTY_GROUP_ROOT],["Dictionary","String","Any"]),n=a.as(a.opt(t,(function(e){return e[r.PROPERTY_GROUP_LICENSE]})),["Dictionary","String","Any"]),o=a.as(a.opt(t,(function(e){return e[r.PROPERTY_GROUP_CCLIGHT]})),["Dictionary","String","Any"]);return r.init_4d41(a.as(e[r.PROPERTY_SOURCE],"String"),a.as(e[r.PROPERTY_SEARCH],"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_TITLE]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_TAGS]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_LICENSE_TYPE]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_SOURCE_URL]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_SOURCE_NAME]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_OWNER]})),"String"),a.as(a.opt(n,(function(e){return e[r.PROPERTY_ASSETID]})),"String"),void 0,void 0,a.as(a.opt(o,(function(e){return e[r.PROPERTY_DESIGN_INTENT]})),"String"),void 0,void 0,a.as(a.opt(o,(function(e){return e[r.PROPERTY_CREATED_DATE]})),"Double"),a.as(a.opt(o,(function(e){return e[r.PROPERTY_MODIFIED_DATE]})),"Double"),a.as(a.opt(o,(function(e){return e[r.PROPERTY_SEARCH_PROPS]})),"String"))},decodeJson:function(e){var t;return null==e?null:(t=a.as(e,["Dictionary","String","Any"]))?r.init_4d41(a.as(t[r.PROPERTY_SOURCE],"String"),a.as(t[r.PROPERTY_SEARCH],"String"),a.as(t[r.PROPERTY_TITLE],"String"),a.as(t[r.PROPERTY_TAGS],"String"),a.as(t[r.PROPERTY_LICENSE_TYPE],"String"),a.as(t[r.PROPERTY_SOURCE_URL],"String"),a.as(t[r.PROPERTY_SOURCE_NAME],"String"),a.as(t[r.PROPERTY_OWNER],"String"),a.as(t[r.PROPERTY_ASSETID],"String"),a.as(t[r.PROPERTY_CREATOR_USERID],"String"),a.as(t[r.PROPERTY_CREATOR_DISPLAYNAME],"String"),a.as(t[r.PROPERTY_DESIGN_INTENT],"String"),a.as(t[r.PROPERTY_LIBRARY_ID],"String"),a.as(t[r.PROPERTY_LIBRARY_NAME],"String"),a.as(t[r.PROPERTY_CREATED_DATE],"Double"),a.as(t[r.PROPERTY_MODIFIED_DATE],"Double"),a.as(t[r.PROPERTY_SEARCH_PROPS],"String")):(l.LegacyCoreAssert.fail("Not a dictionary",void 0,"MediaMetadata.decodeJson","MediaMetadata.swift",595),null)}},props:{init_4d41:function(e,t,n,r,o,i,a,l,u,c,d,h,p,f,m,g,y,_){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===h&&(h=null),void 0===p&&(p=null),void 0===f&&(f=null),void 0===m&&(m=null),void 0===g&&(g=null),void 0===y&&(y=null),void 0===_&&(_=null),this.searchSource_=e,this.searchTerm_=t,this.title_=n,this.tags_=r,this.licenseType_=o,this.sourceUrl_=i,this.sourceName_=a,this.ownerName_=l,this.assetID_=u,this.creatorUserID_=c,this.creatorDisplayName_=c,this.designIntent_=h,this.libraryID_=p,this.libraryName_=f,this.createdDate_=m,this.modifiedDate_=g,this.searchProps_=y,this.stockCollectionType_=_,s.CoreObject.call(this)},init_a9d7:function(e,t,n,r,o,i,a,l,u,c,d,h,p,f,m,g,y,_,T){var v,C,P,S,D,A,E,R,F,b,I,O,k,N,M,L,x,B;void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===c&&(c=null),void 0===d&&(d=null),void 0===h&&(h=null),void 0===p&&(p=null),void 0===f&&(f=null),void 0===m&&(m=null),void 0===g&&(g=null),void 0===y&&(y=null),void 0===_&&(_=null),void 0===T&&(T=null),this.searchSource_=(v=t)||null!=v?v:e.searchSource_,this.searchTerm_=(C=n)||null!=C?C:e.searchTerm_,this.title_=(P=r)||null!=P?P:e.title_,this.tags_=(S=o)||null!=S?S:e.tags_,this.licenseType_=(D=i)||null!=D?D:e.licenseType_,this.sourceUrl_=(A=a)||null!=A?A:e.sourceUrl_,this.sourceName_=(E=l)||null!=E?E:e.sourceName_,this.ownerName_=(R=u)||null!=R?R:e.ownerName_,this.assetID_=(F=c)||null!=F?F:e.assetID_,this.creatorUserID_=(b=d)||null!=b?b:e.creatorUserID_,this.creatorDisplayName_=(I=d)||null!=I?I:e.creatorDisplayName_,this.designIntent_=(O=p)||null!=O?O:e.designIntent_,this.libraryID_=(k=f)||null!=k?k:e.libraryID_,this.libraryName_=(N=m)||null!=N?N:e.libraryName_,this.createdDate_=(M=g)||null!=M?M:e.createdDate_,this.modifiedDate_=(L=y)||null!=L?L:e.modifiedDate_,this.searchProps_=(x=_)||null!=x?x:e.searchProps_,this.stockCollectionType_=(B=T)||null!=B?B:e.stockCollectionType_,s.CoreObject.call(this)},getDebugDesc:function(){var e,t,n,r,o,i,a,s,l,u,c,d,h,p,f,m,g,y,_;return"sourceName_: "+((e=this.sourceName_)||null!=e?e:"")+" searchSource_: "+((t=this.searchSource_)||null!=t?t:"")+" searchTerm_: "+((n=this.searchTerm_)||null!=n?n:"")+" designIntent_: "+((r=this.designIntent_)||null!=r?r:"")+" licenseType_: "+((o=this.licenseType_)||null!=o?o:"")+" assetID_: "+((i=this.assetID_)||null!=i?i:"")+" sourceUrl_: "+((a=this.sourceUrl_)||null!=a?a:"")+" sourceName_: "+((s=this.sourceName_)||null!=s?s:"")+" ownerName_: "+((l=this.ownerName_)||null!=l?l:"")+" assetID_: "+((u=this.assetID_)||null!=u?u:"")+" creatorUserID_: "+((c=this.creatorUserID_)||null!=c?c:"")+" creatorDisplayName_: "+((d=this.creatorDisplayName_)||null!=d?d:"")+" designIntent_: "+((h=this.designIntent_)||null!=h?h:"")+" libraryID_: "+((p=this.libraryID_)||null!=p?p:"")+" libraryName_: "+((f=this.libraryName_)||null!=f?f:"")+" createdDate_: "+((m=this.createdDate_)||null!=m?m:0)+" modifiedDate_: "+((g=this.modifiedDate_)||null!=g?g:0)+" searchProps_: "+((y=this.searchProps_)||null!=y?y:"")+" stockCollectionType: "+((_=this.stockCollectionType_)||null!=_?_:"")},isEqualTo:function(e){var t;return!(!(t=a.as(e,r))||this.searchSource!=t.searchSource||this.searchTerm!=t.searchTerm||this.title!=t.title||this.tags!=t.tags||this.licenseType!=t.licenseType||this.sourceURL!=t.sourceURL||this.sourceName!=t.sourceName||this.ownerName!=t.ownerName||this.assetID!=t.assetID||this.creatorUserID!=t.creatorUserID||this.creatorDisplayName!=t.creatorUserID||this.designIntent!=t.designIntent||this.libraryID_!=t.libraryID_||this.libraryName_!=t.libraryName_||this.createdDate_!=t.createdDate_||this.modifiedDate_!=t.modifiedDate_||this.searchProps!=t.searchProps||this.stockCollectionType!=t.stockCollectionType)},copyWithIntent:function(e){return r.init_a9d7(this,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e)},copyWithSource:function(e){return r.init_a9d7(this,void 0,void 0,void 0,void 0,void 0,void 0,e)},searchSource:{get:function(){return this.searchSource_}},searchTerm:{get:function(){return this.searchTerm_}},title:{get:function(){return this.title_}},tags:{get:function(){return this.tags_}},licenseType:{get:function(){return this.licenseType_},set:function(e){this.licenseType_=e}},stockCollectionType:{get:function(){return this.stockCollectionType_},set:function(e){this.stockCollectionType_=e}},sourceName:{get:function(){return this.sourceName_}},sourceURL:{get:function(){return this.sourceUrl_}},ownerName:{get:function(){return this.ownerName_}},assetID:{get:function(){return this.assetID_}},creatorUserID:{get:function(){return this.creatorUserID_}},creatorDisplayName:{get:function(){return this.creatorDisplayName_}},designIntent:{get:function(){return this.designIntent_}},libraryID:{get:function(){return this.libraryID_}},libraryName:{get:function(){return this.libraryName_}},createdDate:{get:function(){return this.createdDate_}},modifiedDate:{get:function(){return this.modifiedDate_}},searchProps:{get:function(){return this.searchProps_}},encodeJson:function(){var e={};return null!=this.searchSource_&&(e[r.PROPERTY_SOURCE]=this.searchSource_),null!=this.searchTerm_&&(e[r.PROPERTY_SEARCH]=this.searchTerm_),null!=this.title_&&(e[r.PROPERTY_TITLE]=this.title_),null!=this.tags&&(e[r.PROPERTY_TAGS]=this.tags_),null!=this.licenseType_&&(e[r.PROPERTY_LICENSE_TYPE]=this.licenseType_),null!=this.sourceName_&&(e[r.PROPERTY_SOURCE_NAME]=this.sourceName_),null!=this.sourceUrl_&&(e[r.PROPERTY_SOURCE_URL]=this.sourceUrl_),null!=this.ownerName_&&(e[r.PROPERTY_OWNER]=this.ownerName_),null!=this.assetID_&&(e[r.PROPERTY_ASSETID]=this.assetID_),null!=this.creatorUserID_&&(e[r.PROPERTY_CREATOR_USERID]=this.creatorUserID_),null!=this.creatorDisplayName_&&(e[r.PROPERTY_CREATOR_DISPLAYNAME]=this.creatorDisplayName_),null!=this.designIntent_&&(e[r.PROPERTY_DESIGN_INTENT]=this.designIntent_),null!=this.libraryID_&&(e[r.PROPERTY_LIBRARY_ID]=this.libraryID_),null!=this.libraryName_&&(e[r.PROPERTY_LIBRARY_NAME]=this.libraryName_),null!=this.createdDate_&&(e[r.PROPERTY_CREATED_DATE]=this.createdDate_),null!=this.modifiedDate_&&(e[r.PROPERTY_MODIFIED_DATE]=this.modifiedDate_),null!=this.searchProps_&&(e[r.PROPERTY_SEARCH_PROPS]=this.searchProps_),e},sourceHasLicense:function(){return this.sourceName==r.kMediaStockSourceName||this.sourceName==r.kMediaPixabaySourceName||this.sourceName==r.kMediaUnsplashSourceName||this.sourceName==r.kMediaNounProjectSourceName||this.sourceName==r.kMediaGiphySourceName||this.sourceName==r.kMediaBingSourceName}}}),r)},Vm85:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("SpAV"),s=n("CWW7"),l=n("gXiO"),u=n("FNB+"),c=n("fWxZ"),d=n("ylxa"),h=n("P83h"),p=n("6Rk9"),f=n("iCxV"),m=n("fNpk"),g=n("c+uM"),y=n("EoOi"),_=n("VJ9E"),T=n("8t9B"),v=n("3UhB"),C=n("oKI3"),P=n("uUew");o.SpacingSequence=i.defineEnum("SpacingSequence",{NextLineSpacing:0,NextShapePadding:1,NextShadowAngle:2,NextLetterTracking:3,NextLineSpacingAndPadding:4}),o.describeSpacingSequence=function(e){switch(e){case 0:return"NextLineSpacing";case 1:return"NextShapePadding";case 2:return"NextShadowAngle";case 3:return"NextLetterTracking";case 4:return"NextLineSpacingAndPadding"}},o.ReplaceTextStrategy=i.defineEnum("ReplaceTextStrategy",{Auto:0,PreventOverlap:1,PreserveWidth:2,Balanced:3}),o.TextFacade=(r=function(){l.CoreObject.call(this)},i.defineClass({name:"TextFacade",ctor:r,superName:"CoreObject",statics:{kPuffyTextThreshold:.12,kEmptyLockupString:"",setText:function(e,t){var n;if(n=i.as(t.controller,T.TypeLockupController)){var r=n.getCurrentFontSize(),o=e;o=v.TypeLockupUtils.fixUpQuotes(o,e),i.opt(n.contentNode,(function(e){return e.replaceText(o)})),n.snapSizeToBounds(),n.snapToClosestExistingSize(r),n.updateGroup()}},setFont:function(e,t,n){void 0===n&&(n=!1);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,T.TypeLockupController))&&(v.TypeLockupUtils.applyFontToController(e,o),n&&o.selectCharStyleForma(),i.opt(o.lockupStyle,(function(e){return e.layout==g.LockupLayout.Auto}))&&o.snapSizeToBounds())}},getFontForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedFont:null},getSecondaryFontForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?i.opt(t.lockupStyle,(function(e){return e.font})):null},replaceMissingFonts:function(e){if(0==!e.missingFontList.length){var t=_.TheoFont.init_9e5c(f.Host.textModelUtils.defaultFont()),n=e.missingFontList.concat([t.fontData.postScriptName]);e.firstPage.root.visitAll(u.FormaTraversal.PreOrder,(function(e){var r;(r=i.as(e.controller,T.TypeLockupController))&&r.replaceFonts(n,t)}))}},getLayoutForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedLockupStyle.layout:g.LockupLayout.UNSET},getAlignmentForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedLockupStyle.alignment:g.LockupAlignment.UNSET},getVerticalAlignmentForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedLockupStyle.verticalAlignment:g.VerticalLockupAlignment.UNSET},setFitContainerToArea:function(e,t){var n;(n=i.as(e.controller,T.TypeLockupController))&&(n.fitContainerToArea=t)},getNextValidGridAlignment:function(e,t){var n=t;return n=n==g.LockupAlignment.Left?g.LockupAlignment.Center:n==g.LockupAlignment.Center?g.LockupAlignment.Right:g.LockupAlignment.Left},getNextValidPathID:function(e,t){var n=t;return n=n<C.TextPathID.Circle||n>=C.TextPathID.SemiCircleDown?C.TextPathID.Circle:C.TextPathID.toCaseValue(n+1)},getNextValidAutoAlignment:function(e,t){return r.getNextValidAutoAlignmentByCategory(e,t,y.TypographyLayoutCategory.ALL)},getNextValidAutoAlignmentByCategory:function(e,t,n){var r,o;return(r=i.as(e.controller,T.TypeLockupController))&&(o=r.lockupStyle)?y.TypographyComposer.getNextValidLayoutAlignment(r.text,o,t,r.charStyleRanges,n,void 0,!0):t},hasValidAutoAlignmentsForCategory:function(e,t){var n;return void 0===t&&(t=y.TypographyLayoutCategory.ALL),!(!(n=i.as(e.controller,T.TypeLockupController))||!y.TypographyComposer.canHandleText(n.text))&&i.clone(y.TypographyComposer.getApplicableLayouts(n.text,n.charStyleRanges,t)).length>0},getCategoryForAutoAlignment:function(e){return y.TypographyComposer.getCategoryForAlignment(e)},getTextPathIDForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedLockupStyle.pathID:C.TextPathID.UNSET},setSessionContainerSizeForForma:function(e){var t;(t=i.as(e.controller,T.TypeLockupController))&&t.styleController.setSessionContainerSize(i.opt(e.frame,(function(e){return e.size})))},setLayoutAndAlignment:function(e,t,n,r,o,a,s){void 0===r&&(r=!1),void 0===o&&(o=C.TextPathID.UNSET),void 0===a&&(a=null),void 0===s&&(s=g.VerticalLockupAlignment.UNSET);for(var l=i.iter(n);!l.done;l.next()){var u,c=l.value;if(u=i.as(c.controller,T.TypeLockupController)){var d,h=u.styleController.targetedLockupStyle.clone();if(u.beginBlockedUpdate(),e!=g.LockupLayout.SKIP&&(u.styleController.targetedLockupStyle.layout=e),t!=g.LockupAlignment.SKIP)e==g.LockupLayout.Auto&&(d=y.TypographyComposer.getWeightingForAlignment(t,u.text,u.charStyleRanges))&&(u.autoTextRanges=i.clone(d)),u.styleController.targetedLockupStyle.alignment=t;null!=s&&s!=g.VerticalLockupAlignment.UNSET&&(u.styleController.targetedLockupStyle.verticalAlignment=s),u.styleController.targetedLockupStyle.pathID=o,u.styleController.targetedLockupStyle.customPath=a,u.styleController.onLayoutChanged(h),u.endBlockedUpdate(),r||u.styleChanged(),r&&(u.styleController.targetedLockupStyle.spacing=i.toDouble(g.LockupLayout.UNSET),u.styleChanged(),u.selectCharStyleForma()),e==g.LockupLayout.Auto&&u.snapSizeToBounds()}}},getLineSpacingForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedLockupStyle.spacing:0},setLineSpacing:function(e,t,n){void 0===n&&(n=!1);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,T.TypeLockupController))&&(o.styleController.targetedLockupStyle.spacing=e,n&&o.styleChanged(),o.styleController.onSpacingChanged())}},setLeading:function(e,t,n){for(var r=i.iter(n);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,T.TypeLockupController))&&(o.setLineSpacingAndBounds(e,t),o.styleController.onSpacingChanged())}},getTrackingForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedLockupStyle.tracking:0},setTracking:function(e,t,n){for(var r=i.iter(n);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,T.TypeLockupController))&&(o.setLetterSpacingAndBounds(e,t),o.styleController.onTrackingChanged())}},getPaddingForForma:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedLockupStyle.padding:0},setPadding:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r,o=n.value;(r=i.as(o.controller,T.TypeLockupController))&&r.styleController.setPaddingFromSlider(e)}},supportsRelativeFontScale:function(e){var t;return!!(t=i.as(e.controller,T.TypeLockupController))&&t.styleController.supportsRelativeFontScale()},getRelativeFontScaleForForma:function(e){var t;if(t=i.as(e.controller,T.TypeLockupController)){var n=t.styleController.targetedLockupStyle.relativeFontScale;return n==g.LockupStyle.UNSET_RELATIVE_FONT_SCALE?y.TypographyComposer.getDefaultRelativeFontScale(t.styleController.targetedLockupStyle.alignment):n}return 1},setRelativeFontScale:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r,o=n.value;(r=i.as(o.controller,T.TypeLockupController))&&(null==r.styleController.getSessionContainerSize()&&r.styleController.setSessionContainerSize(r.size),r.styleController.setRelativeFontScale(e))}},matchNextSize:function(e,t,n){for(var r=0,o=i.iter(n);!o.done;o.next()){var a,s=o.value;(a=i.as(s.controller,T.TypeLockupController))&&(r=a.matchNextSize(e,t))}return r},matchNearestSize:function(e,t,n,r){for(var o=0,a=i.iter(r);!a.done;a.next()){var s,l=a.value;(s=i.as(l.controller,T.TypeLockupController))&&(o=s.setSizeSliderValue(e,t,n))}return o},getLineBreakForForma:function(e){var t;return!!(t=i.as(e.controller,T.TypeLockupController))&&t.styleController.targetedLockupStyle.lineBreakAtCharacterStyleSizeChange},setLineBreak:function(e,t,n){void 0===n&&(n=!1);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,T.TypeLockupController))&&(o.styleController.targetedLockupStyle.lineBreakAtCharacterStyleSizeChange=e,n&&(o.styleChanged(),o.selectCharStyleForma()))}},setNextSpacingSequence:function(e,t){for(var n=i.iter(t);!n.done;n.next()){var r,o=n.value;if(r=i.as(o.controller,T.TypeLockupController))switch(e){case 0:r.styleController.setNextSpacingOption();break;case 1:r.styleController.setNextPaddingOption();break;case 2:r.styleController.setNextShadowAngle();break;case 3:r.styleController.setNextTrackingOption();break;case 4:r.styleController.setNextSpacingAndPaddingOption();break;default:m.LegacyCoreAssert.fail("unhandled spacing sequence",void 0,"TextFacade.setNextSpacingSequence","TextFacade.swift",513)}}},getTextLook:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.targetedTextLook:g.LockupTextLook.Fill},getDefaultLockupBacking:function(e){var t,n=g.LockupBacking.None;return(t=i.as(e.style,g.LockupStyle))&&(n=g.LockupStyle.isPath(t.layout)||g.LockupStyle.isLetterGrid(t.layout)||g.LockupStyle.isAutoLayout(t.layout)?g.LockupBacking.SVGBackground:g.LockupBacking.Rows),n},getDefaultArtworkID:function(e){var t,n="none";return(t=i.as(e.style,g.LockupStyle))&&(n=g.LockupStyle.isPath(t.layout)||g.LockupStyle.isAutoLayout(t.layout)?"square_001":g.LockupStyle.isLetterGrid(t.layout)?"circle_001":"slug"),n},getBackingShape:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?[t.styleController.targetedLockupStyle.backing,t.styleController.targetedLockupStyle.backingArtworkID]:[g.LockupBacking.None,""]},getOutlineStrokeWeightPercent:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.getStrokeWeightPercentForUI():0},getShadowOffsetPercent:function(e){var t;return(t=i.as(e.controller,T.TypeLockupController))?t.styleController.getShadowOffsetPercentForUI():0},setTextLook:function(e,t,n){void 0===n&&(n=!0);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,T.TypeLockupController))&&(o.styleController.setTextLook(e,n),o.styleChanged())}},setTextEffectsAttributes:function(e,t,n,o){for(var a=i.iter(o);!a.done;a.next()){var s,l=a.value;if(s=i.as(l.controller,T.TypeLockupController)){if(!isNaN(e)){s.styleController.targetedStrokeWeight=e;var u=r.getTextLook(l);if(u==g.LockupTextLook.FillAndOutline||u==g.LockupTextLook.FillAndOutline2){var c=r.getCorrectOutlineWithFillTextLook(s.styleController);c!=u&&r.setTextLook(c,[l],!1)}}if(isNaN(t)||(s.styleController.targetedShadowOffset=t,s.styleChanged()),!isNaN(n)){var d=n<0?360+n:n;s.styleController.targetedShadowAngle=d}}}},getTextEffectsAttributes:function(e){for(var t=0,n=0,r=0,o=i.iter(e);!o.done;o.next()){var a,s=o.value;(a=i.as(s.controller,T.TypeLockupController))&&(t=a.styleController.targetedStrokeWeight,n=a.styleController.targetedShadowOffset,r=a.styleController.targetedShadowAngle)}return[t,n,r]},REPLACE_TEXT_EXPANSION_RATIO:.95,REPLACE_TEXT_EXPANSION_MARGIN:10,replaceTextForLockup:function(e,t,n,l,u,c){var d,f,m,_;if(void 0===n&&(n=null),void 0===l&&(l=o.ReplaceTextStrategy.Auto),void 0===u&&(u=null),void 0===c&&(c=null),i.isEmpty(t.trim()))return s.CreationFacade.deleteFormae([e],null),null;if((d=i.as(e.controller,T.TypeLockupController))&&(f=e.finalFrame)&&(m=d.contentNode)&&(_=d.lockupStyle)){var C=t,P=d.text;if(C!=P){var S=new h.FormaTransformChangedEvent(e);e.beginUpdate(S);var D,A=null,E=null,R=i.isEmpty(P.trim()),F=l==o.ReplaceTextStrategy.Auto?r.resolveAutoReplaceTextStrategy(e):l;R||F!=o.ReplaceTextStrategy.PreserveWidth&&F!=o.ReplaceTextStrategy.Balanced||(A=d.getCurrentFontSize(),F==o.ReplaceTextStrategy.Balanced&&(D=d.getParentForPin())&&(E=i.opt(d.getExpansionBounds(D,r.REPLACE_TEXT_EXPANSION_RATIO,r.REPLACE_TEXT_EXPANSION_MARGIN),(function(e){return e.size}))));var b,I,O,k=_.layout,N=u;return null==N&&(g.LockupStyle.layoutSupportsAlignments(k)||1==d.numLines()&&k!=g.LockupLayout.Path)&&(N=d.getPin(!0,!0)),(b=n)&&(a.CoreAssertDebugOnly.isFalse(0==d.charStyleRanges.length&&0==!b.length,"Updating character styles ranges when currently empty",void 0,"TextFacade.replaceTextForLockup","TextFacade.swift",734),d.charStyleRanges=i.clone(b)),C=v.TypeLockupUtils.fixUpQuotes(C,P),d.beginBlockedUpdate(),i.opt(d.lockupStyle,(function(e){return e.layout==g.LockupLayout.Auto}))&&(i.isEmpty(P)?(i.opt(d.lockupStyle,(function(e){return e.alignment=g.LockupAlignment.Left})),i.opt(d.lockupStyle,(function(e){return e.layout=g.LockupLayout.Standard}))):(_.alignment=y.TypographyComposer.getNextValidLayoutAlignment(C,_,_.alignment,void 0,void 0,void 0,!1),_.alignment!=g.LockupAlignment.UNSET?(d.autoTextRanges=i.clone(y.TypographyComposer.getWeightingForAlignment(_.alignment,C)),i.opt(d.lockupStyle,(function(e){return e.alignment=_.alignment}))):(i.opt(d.lockupStyle,(function(e){return e.alignment=g.LockupAlignment.Left})),i.opt(d.lockupStyle,(function(e){return e.layout=g.LockupLayout.Standard}))))),m.replaceText(C),d.endBlockedUpdate(),d.updateGroupWithFontSize(A,E),C!=r.kEmptyLockupString&&(I=N)&&(F==o.ReplaceTextStrategy.Balanced?(d.matchPreviousPin(I,void 0,r.REPLACE_TEXT_EXPANSION_RATIO,r.REPLACE_TEXT_EXPANSION_MARGIN),null!=(O=c)?O(e,f,I.pinPoint):p.GeometryFacade.fitInPage(e,f,I.pinPoint,r.REPLACE_TEXT_EXPANSION_MARGIN)):d.matchPreviousPin(I)),d.snapSizeToBounds(),d.styleController.resetSessionContainerSize(),d.styleController.resetSessionContainerCenter(),e.endUpdate(S),N}i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.updateAnnotations()}))}return null},replaceTextAndPreserveFontSize:function(e,t){r.replaceTextForLockup(e,t,null,o.ReplaceTextStrategy.PreserveWidth)},resolveAutoReplaceTextStrategy:function(e){var t,n;return(t=i.as(e.controller,T.TypeLockupController))&&null!=(n=i.opt(t.lockupStyle,(function(e){return e.layout})))&&n==g.LockupLayout.Standard&&!t.userGroupChild?o.ReplaceTextStrategy.Balanced:o.ReplaceTextStrategy.PreventOverlap},setHightlightMethod:function(e,t,n){void 0===n&&(n=!1);for(var r=i.iter(t);!r.done;r.next()){var o,a=r.value;if(o=i.as(a.controller,T.TypeLockupController)){if(n&&e!=T.HighlightMethod.Numbers)if(e==T.HighlightMethod.Manual)o.clearCharStyle(),o.selectCharStyleForma();else if(o.highlightMethod==e&&e!=T.HighlightMethod.Manual){var s=e;o.highlightMethod=T.HighlightMethod.toCaseValue(s+1)}else e!=T.HighlightMethod.Manual?o.highlightMethod==T.HighlightMethod.OddRows?o.highlightMethod=T.HighlightMethod.Bracket:o.highlightMethod==T.HighlightMethod.Bracket?o.highlightMethod=T.HighlightMethod.InsideBracket:o.highlightMethod==T.HighlightMethod.InsideBracket?o.highlightMethod=T.HighlightMethod.EvenRows:o.highlightMethod=e:o.highlightMethod=e;if(e==T.HighlightMethod.Manual&&n)return;if(n){var l=e==T.HighlightMethod.Numbers,u=e!=T.HighlightMethod.Numbers;o.autoApplyCharStyle(!0,l,u)}else o.applyPredefinedCharStyle(e);n&&o.selectCharStyleForma()}}},setCharStyleMode:function(e,t){var n;(n=i.as(e.controller,T.TypeLockupController))&&(t?(i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),0==n.charStyleRanges.length&&n.styleController.pickVisibleColorsForCharStyle(),n.selectCharStyleForma(),n.autoApplyCharStyle(!1,!1,!1),n.selectCharStyleForma()):i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!1})))},applyCharStyle:function(e,t,n,r,o){var a;return(a=i.as(i.opt(e.lockupForma,(function(e){return e.controller})),T.TypeLockupController))?a.applyCharStyle(e,t,n,r,o):(m.LegacyCoreAssert.fail("cannot applyCharStyle, not a text forma",void 0,"TextFacade.applyCharStyle","TextFacade.swift",915),new P.TextRange(0,0))},adjustCharStyleRanges:function(e,t,n,r){var o;return void 0===r&&(r=null),(o=r||i.opt(i.as(e.controller,T.TypeLockupController),(function(e){return e.charStyleRanges})))?v.TypeLockupUtils.adjustRanges(o,t,n):null},applyTextStyleSuggestion:function(e,t,n,r){var o;if(o=i.as(t.controller,T.TypeLockupController)){var a=o.fitContainerToArea;o.fitContainerToArea=!0;var s=o.applyTextStyleSuggestion(e,n,r);return o.fitContainerToArea=a,s}return m.LegacyCoreAssert.fail("cannot apply text style, not a text forma",void 0,"TextFacade.applyTextStyleSuggestion","TextFacade.swift",949),null},applyNextTextEmphasisSuggestion:function(e,t){var n,r;return(n=i.as(e.controller,T.TypeLockupController))&&(r=t)?n.applyNextTextEmphasisSuggestion(r):(m.LegacyCoreAssert.fail("cannot apply next text emphasis",void 0,"TextFacade.applyNextTextEmphasisSuggestion","TextFacade.swift",963),null)},standardPPI:72,getStandardPageSize:function(e){var t=e.getPageExportData();return new d.FormaPageExportData(t.dimensions,t.format,r.standardPPI).pixelDimensions},toInternalFontSize:function(e,t){var n=r.getStandardPageSize(t),o=c.FormaPage.DEFAULT_PAGE_SIZE;return Math.max(o.width,o.height)*e/Math.max(n.width,n.height)},toUserFontSize:function(e,t){return e/r.toInternalFontSize(1,t)},setFontSize:function(e,t,n){var o;if(o=i.opt(i.first(t),(function(e){return e.page})))for(var a=r.toInternalFontSize(e,o),s=i.iter(t);!s.done;s.next()){var l,u=s.value;(l=i.as(u.controller,T.TypeLockupController))&&l.setFontSize(a,n)}},getStandardFontSizes:function(){return[18,24,36,48,60,132]},getMinimumFontSize:function(e){return void 0===e&&(e=null),12},getMaximumFontSize:function(e){var t;void 0===e&&(e=null);var n=i.clone(e||[]);return 0==!n.length&&null==n.find((function(e){var n=(t=i.opt(i.as(e.style,g.LockupStyle),(function(e){return e.layout})))||null!=t?t:g.LockupLayout.Standard;return!g.LockupStyle.isPath(n)}),this)?200:500},getCorrectOutlineWithFillTextLook:function(e){return e.targetedStrokeWeight>r.kPuffyTextThreshold?g.LockupTextLook.FillAndOutline2:g.LockupTextLook.FillAndOutline},getNewTextLookForOutlineChange:function(e,t,n){var o=e;switch(e){case-2:case-1:case 0:n||(o=r.getCorrectOutlineWithFillTextLook(t));break;case 1:n||(o=g.LockupTextLook.KnockoutAndOutline);break;case 2:n&&(o=g.LockupTextLook.KnockoutOnly);break;case 3:case 4:case 5:n&&(o=g.LockupTextLook.Fill);break;case 6:n||(o=g.LockupTextLook.KnockoutAndOutline);break;case 7:n||(o=g.LockupTextLook.ShadowAndOutline);break;case 8:n&&(o=g.LockupTextLook.Shadow);break;case 9:n||(o=g.LockupTextLook.KnockoutShadowOutline);break;case 10:n&&(o=g.LockupTextLook.Shadow);break;case 11:n&&(o=g.LockupTextLook.KnockoutAndShadow)}return o},getNewTextLookForShadowChange:function(e,t,n){var o=e;switch(e){case-2:case-1:case 0:n||(o=g.LockupTextLook.Shadow);break;case 1:n||(o=g.LockupTextLook.KnockoutAndShadow);break;case 2:n||(o=g.LockupTextLook.KnockoutShadowOutline);break;case 3:n||(o=g.LockupTextLook.ShadowOutlineTransparentText);break;case 4:case 5:n||(o=g.LockupTextLook.ShadowAndOutline);break;case 6:n||(o=g.LockupTextLook.KnockoutAndShadow);break;case 7:n&&(o=g.LockupTextLook.Fill);break;case 8:n&&(o=r.getCorrectOutlineWithFillTextLook(t));break;case 9:n&&(o=g.LockupTextLook.KnockoutOnly);break;case 10:n&&(o=g.LockupTextLook.OutlineOnly);break;case 11:n&&(o=g.LockupTextLook.KnockoutAndOutline)}return o},getNewTextLookForKnockoutChange:function(e,t,n){var o=e;switch(e){case-2:case-1:case 0:n||(o=g.LockupTextLook.KnockoutOnly);break;case 1:n&&(o=g.LockupTextLook.Fill);break;case 2:n&&(o=r.getCorrectOutlineWithFillTextLook(t));break;case 3:break;case 4:case 5:n||(o=g.LockupTextLook.KnockoutAndOutline);break;case 6:n&&(o=g.LockupTextLook.Fill);break;case 7:n||(o=g.LockupTextLook.KnockoutAndShadow);break;case 8:n||(o=g.LockupTextLook.KnockoutShadowOutline);break;case 9:n&&(o=g.LockupTextLook.Shadow);break;case 10:break;case 11:n&&(o=g.LockupTextLook.ShadowAndOutline)}return o},getNewTextLookForTransparentFillChange:function(e,t,n){var o=e;switch(e){case 2:break;case 3:o=r.getCorrectOutlineWithFillTextLook(t);break;case 4:case 5:o=g.LockupTextLook.OutlineOnly;break;case 8:o=g.LockupTextLook.ShadowOutlineTransparentText;break;case 11:break;case 10:o=g.LockupTextLook.ShadowAndOutline}return o}}}),r)},Vvcj:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("TbN7"),l=n("kVgh"),u=n("fNpk"),c=n("Quhx"),d=n("aN2p"),h=n("9YN4");i.ColorThemeDocument=(r=function(){this.swatchFactory_={}},o={},a.defineClass({name:"ColorThemeDocument",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ColorThemeDocument",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),h.TheoDocument);return u.LegacyCoreAssert.isTrue(null!=i,"ColorThemeDocument needs a parent document",void 0,"ColorThemeDocument","ColorThemeDocument.swift",15),r.init_7e49(e,n,i)}),o.factory},set:function(e){o.factory=e}},PROPERTY_CHILDREN:"children",DCXTYPE:{get:function(){return"application/vnd.adobe.theo.color+dcx"}},PATH:{get:function(){return"colortheme"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{swatches_:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_CHILDREN),["Array",l.ColorSwatch]))||null!=e?e:[]},set:function(e){this.set(r.PROPERTY_CHILDREN,e)}},init_7e49:function(e,t,n){this.parent_=n,this.swatchFactory_[d.SimpleSwatch.KIND]=function(e,t){return d.SimpleSwatch.init_d0e4(e)},a.super_init(this,c.PostDCXObject,c.PostDCXObject.prototype.init_3181,n.database,t,e)},init_d0e4:function(e){this.parent_=e,this.swatchFactory_[d.SimpleSwatch.KIND]=function(e,t){return d.SimpleSwatch.init_d0e4(e)},a.super_init(this,c.PostDCXObject,c.PostDCXObject.prototype.init_11e0,e.database),this.set(c.PostDCXObject.PROPERTY_PATH,r.PATH),this.set(c.PostDCXObject.PROPERTY_TYPE,r.DCXTYPE)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},swatchByID:function(e){for(var t=a.iter(this.swatches_);!t.done;t.next()){var n=t.value;if(n.id==e)return n}return null},swatchByTag:function(e,t){for(var n=a.iter(this.swatches_);!n.done;n.next()){var r=n.value;if(r.tag(e)==t)return r}return null},swatchesByTag:function(e){for(var t=[],n=a.iter(this.swatches_);!n.done;n.next()){var r=n.value;null!=r.tag(e)&&t.push(r)}return t},createSwatch:function(e){var t=this.swatchFactory_[e];return null==t?(u.LegacyCoreAssert.fail("ColorThemeDocument: Did not find a constructor",{kind:e},"ColorThemeDocument.createSwatch","ColorThemeDocument.swift",84),null):t(this,e)},insertSwatchesAt:function(e,t){if(e<0||e>this.swatches_.length)return u.LegacyCoreAssert.fail("insertSwatchesAt: index is out of range",{index:e,max:this.swatches_.length},"ColorThemeDocument.insertSwatchesAt","ColorThemeDocument.swift",92),null;for(var n=e,r=a.clone(this.swatches_),o=a.iter(t);!o.done;o.next()){var i=o.value;if(i.parent!=this)return u.LegacyCoreAssert.fail("inserting swatch from different color theme document",void 0,"ColorThemeDocument.insertSwatchesAt","ColorThemeDocument.swift",100),null;r.splice(n,0,i),n+=1}return this.swatches_=a.clone(r),this.publish(new s.InsertedSwatchesMessage(this,e,t)),t},removeSwatchesAt:function(e,t){if(e<0||e+t>this.swatches_.length)return u.LegacyCoreAssert.fail("removeSwatchesAt: index/count out of range",{index:e,count:t,max:this.swatches_.length},"ColorThemeDocument.removeSwatchesAt","ColorThemeDocument.swift",116),null;var n=a.clone(this.swatches_),r=n.splice(e,t);return this.swatches_=a.clone(n),this.publish(new s.RemovedSwatchesMessage(this,e,r)),r},appendSwatch:function(e){return a.opt(this.insertSwatchesAt(this.swatches_.length,[e]),(function(e){return e[0]}))},insertSwatch:function(e,t){return a.opt(this.insertSwatchesAt(e,[t]),(function(e){return e[0]}))},removeSwatch:function(e){var t;return null!=(t=a.indexOf(this.swatches_,e))?a.opt(this.removeSwatchesAt(t,1),(function(e){return e[0]})):null},removeSwatchAt:function(e){return a.opt(this.removeSwatchesAt(e,1),(function(e){return e[0]}))},removeAllSwatches:function(){return this.removeSwatchesAt(0,this.swatches_.length)},replaceAllSwatches:function(e){if(this.swatches_==e)return this.swatches_;var t=a.clone(this.swatches_);return this.swatches_=a.clone(e),this.publish(new s.ReplacedSwatchesMessage(this,e)),t},replaceWithDocument:function(e){for(var t=[],n=a.iter(e.copySwatches());!n.done;n.next()){var r=n.value;this.createSwatch(r.kind).match(r),t.push(r)}this.replaceAllSwatches(t)},copySwatches:function(){return this.swatches_.concat()},swatchAt:function(e){return e<0||e>=this.swatches_.length?null:this.swatches_[e]},swatchCount:{get:function(){return this.swatches_.length}},addColorWithTag:function(e,t,n){var r=this.createSwatch(d.SimpleSwatch.KIND);return r.setTag(t,n),r.color=e,this.appendSwatch(r)},publishForChild:function(e){this.publish(e)}}}),r)},WWR6:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("FNB+"),s=n("fWxZ"),l=n("P83h"),u=n("pnSN"),c=n("fNpk"),d=n("sIWg"),h=n("1NAc"),p=n("LGJg");o.VectorForma=(r=function(){this.cachedBounds_=null},i.defineClass({name:"VectorForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Vector"}},PROPERTY_COLOR:"color",PROPERTY_CONTENTID:"content-id",PROPERTY_SIZE:"size",SCHEMA_CLASS_NAME:{get:function(){return"VectorForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),u.GroupForma),l=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.FormaPage);return c.LegacyCoreAssert.isTrue(null!=a||null!=l,"VectorForma needs a parent group or page",void 0,"VectorForma","VectorForma.swift",23),null!=a?r.init_3144(e,t,n,a):r.init_7dbd(e,t,n,l)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,a.Forma,a.Forma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){i.super_init(this,a.Forma,a.Forma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND}},o=i.clone(t),s=i.iter(n);!s.done;s.next()){var l=s.key,u=s.value;null==t[l]&&(o[l]=u())}i.super_init(this,a.Forma,a.Forma.prototype.init_812f,e,o)},init_7186:function(e){var t={kind:r.KIND};this.init_812f(e,t)},init_d1c9:function(e,t){i.super_init(this,a.Forma,a.Forma.prototype.init_d1c9,e,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==r.PROPERTY_CONTENTID?new l.FormaContentChangedEvent(this):a.Forma.prototype.updateEventForProperty.call(this,e)},contentNode:{get:function(){var e=this;return null==this.contentID?null:i.as(i.opt(this.page.document,(function(t){return t.content.nodeByID(e.contentID)})),p.VectorContentNode)},set:function(e){this.contentID=null==e?null:e.id}},color:{get:function(){return this.get(r.PROPERTY_COLOR)},set:function(e){this.set(r.PROPERTY_COLOR,e)}},size:{get:function(){return i.as(this.get(r.PROPERTY_SIZE),h.TheoSize)},set:function(e){this.set(r.PROPERTY_SIZE,e)}},contentID:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_CONTENTID),"String"))||null!=e?e:""},set:function(e){var t=new l.FormaContentChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_CONTENTID,e),this.cachedBounds_=null,this.endUpdate(t)}},boundsInCoordSpace:function(e){if(null==this.cachedBounds_){var t=this.contentNode;null!=t&&(this.cachedBounds_=d.TheoRect.fromSize(t.size))}return i.opt(this.cachedBounds_,(function(t){return t.transform(e)}))},isGraphic:function(){return!0}}}),r)},X0GW:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("yGNn"),l=n("FNB+"),u=n("ZK0l"),c=n("pnSN"),d=n("6Rk9"),h=n("iCxV"),p=n("fNpk"),f=n("MYNe"),m=n("tGKA"),g=n("JFv5"),y=n("sIWg");o.GroupFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"GroupFacade",ctor:r,superName:"CoreObject",statics:{groupItems:function(e){return 0==e.length?s.CorePromise.resolve([]):(t=r.createGroupFromFormae(e))?(t.intent=l.Forma.INTENT_USER_GROUP,s.CorePromise.resolve(t)):s.CorePromise.reject("couldn't create a group");var t},updateUserGroupBounds:function(e){p.LegacyCoreAssert.isTrue(e.controller.userGroup,"asked to update user group bounds for a group that's not a user group",void 0,"GroupFacade.updateUserGroupBounds","GroupFacade.swift",33);var t=i.clone(e.childrenAsArray);if(t.length>0){for(var n={},r=d.GeometryFacade.unionFrame(t),o=i.iter(t);!o.done;o.next())n[(c=o.value).formaID]=c.finalFrame,e.root.appendChild(c,!0);var a=e.placement.calculateTransformValuesSKRT(),s=m.Matrix2D.rotation(a.rotCosine,a.rotSine).transformPoint(r.origin);e.bounds=y.TheoRect.fromSize(r.size),e.placement=e.placement.translateXY(s.x,s.y);for(var l=i.iter(t);!l.done;l.next()){var u,c=l.value;e.appendChild(c,!0),(u=c.finalFrame)&&(n[c.formaID].equalWithAccuracy(u,.001)||h.Host.logging.warning("error. a child's position changed in updateUserGroupBounds."))}}},updateUserGroupHierarchy:function(e){for(var t,n=e;((t=i.opt(i.opt(n,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=t)&&t;)r.updateUserGroupBounds(n),n=i.opt(n,(function(e){return e.parent}))},createGroupFromFormae:function(e){var t;if(0==e.length)return null;var n,r,o=d.GeometryFacade.unionFrame(e),a=e.concat(),s=i.as(i.opt(i.first(e),(function(e){return e.page.createFormaWithController(c.GroupForma.KIND,u.GroupController.KIND)})),c.GroupForma);if((n=s)&&(r=o)){i.opt(i.opt(i.first(e),(function(e){return e.parent})),(function(e){return e.appendChild(n)})),n.intent=l.Forma.INTENT_USER_GROUP,n.placement=m.Matrix2D.translationXY(r.minX,r.minY),n.bounds=y.TheoRect.fromSize(r.size);var h=n.controller;h.preferredResizeType=g.ResizeLayoutType.Proportional,h.preserveResizeController=!0;for(var p=0,_=i.iter(a);!_.done;_.next()){var T=_.value;p=Math.max(p,(t=i.opt(T.parent,(function(e){return e.indexOfChild(T)})))||null!=t?t:0)}i.opt(n.parent,(function(e){return e.insertChildAt(n,p,!0)}));for(var v=i.iter(f.LayerFacade.sortInZOrder(a));!v.done;v.next())T=v.value,n.appendChild(T,!0);return n}return null},removeAllGroups:function(e){for(var t,n=i.clone(e.filterWithCallback((function(e){return!(!(t=i.opt(e.controller,(function(e){return e.userGroup})))&&null==t)&&t}))),o=i.iter(n);!o.done;o.next()){var a=o.value;r.cleanupGroup(a)}},cleanupGroup:function(e){for(var t,n=i.iter(e.childrenAsArray);!n.done;n.next()){var r=n.value,o=(t=i.opt(e.parent,(function(t){return t.indexOfChild(e)})))||null!=t?t:e.childCount;i.opt(e.parent,(function(e){return e.insertChildAt(r,o,!0)}))}e.removeFromParent()},ungroupItems:function(e){var t,n;if(0==e.length)return s.CorePromise.resolve([]);for(var o=[],a=[],l=[],u=!1,c=i.iter(e);!c.done;c.next()){var d,h=c.value;((t=i.opt(h.controller,(function(e){return e.userGroup})))||null!=t)&&t?(i.append(o,h.childrenAsArray),i.append(l,h.childrenAsArray)):(f=h.controller)&&(d=f.userGroupRoot)&&(u=!0,o.push(h),i.append(l,d.childrenAsArray))}for(var p=i.iter(l);!p.done;p.next()){var f,m,g,y;if((f=(h=p.value).controller)&&(m=h.parent)&&(g=i.opt(h.parent,(function(e){return e.parent})))&&null!=(y=g.indexOfChild(m))&&f.userGroupChild)if(g.insertChildAt(h,y,!0),m.childCount<=1){for(var _=i.iter(m.childrenAsArray);!_.done;_.next()){var T=_.value,v=(n=g.indexOfChild(m))||null!=n?n:g.childCount;g.insertChildAt(T,v,!0),u||o.push(T)}m.removeFromParent()}else a.includes(m)||a.push(m)}for(var C=i.iter(a);!C.done;C.next()){var P=C.value;r.updateUserGroupBounds(P)}return s.CorePromise.resolve(o)},getGroupDepth:function(e){var t,n=0;return e.visit(l.FormaTraversal.PreOrder,(function(e,r,o){return((t=i.opt(e.controller,(function(e){return e.userGroupChild})))||null!=t)&&t&&(n=Math.max(n,r)),!1})),n},isUserGroup:function(e){var t;return!(!(t=i.opt(i.opt(e,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==t)&&t},isInsideUserGroup:function(e){for(var t=e;null!=t&&!r.isUserGroup(t);)t=i.opt(t,(function(e){return e.parent}));return null!=t}}}),r)},YeWL:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("URxh"),s=n("pmb0"),l=n("RkYL");o.MotionLogicClear=(r=function(){},i.defineClass({name:"MotionLogicClear",ctor:r,statics:{_implements:function(e){return"MotionLogic"==e}},props:{apply:function(e,t,n){var r,o,u=(r=i.as(n.st,"Double"))||null!=r?r:0,c=u+((o=i.as(n.dur,"Double"))||null!=o?o:1),d=a.FormaAnimation.init_9e82(s.MotionFacade.getCurrentAnimationStyle(),l.TheoTime.fromSeconds(u),l.TheoTime.fromSeconds(c),t.concat());e.animation=d}}}),r)},Yudi:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("Z25M"),s=n("FNB+"),l=n("wc1n"),u=n("9Lk3"),c=n("fdtz"),d=n("JO5d"),h=n("T6jX"),p=n("3UhB"),f=n("1NAc"),m=n("zjod"),g=n("zjY7");o.RetargetFeatureExtractor=(r=function(e,t,n){void 0===n&&(n=[]),this.root_=e,this.forFeatures_=i.clone(n),this.featureEvals_=[],this.isTemplate_=t,l.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"RetargetFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Size",[this.evaluateDesignSize,l.FeatureType.Complex]],["EditingResolution",[this.evaluateEditingResolution,l.FeatureType.Numerical]],["PublishResolution",[this.evaluatePublishingResolution,l.FeatureType.Numerical]],["LayoutId",[this.evaluateLayoutId,l.FeatureType.Categorical]],["Edges",[this.evaluateEdges,l.FeatureType.Complex]],["Focus",[this.evaluateFocus,l.FeatureType.Complex]],["NumImages",[this.evaluateImageCount,l.FeatureType.Numerical]],["NumRetargetableFloatingImages",[this.evaluateRetargetableFloatingImageCount,l.FeatureType.Numerical]],["NumRetargetableBackgroundImages",[this.evaluateRetargetableBackgroundImageCount,l.FeatureType.Numerical]],["NumShapes",[this.evaluateShapeCount,l.FeatureType.Numerical]],["NumGridsCells",[this.evaluateGridCellCount,l.FeatureType.Numerical]],["NumMoveable",[this.evaluateNumMoveable,l.FeatureType.Numerical]],["LockupStrings",[this.evaluateLockupStrings,l.FeatureType.Complex]],["TextRoles",[this.evaluateTextRoles,l.FeatureType.Complex]],["ShapeRoles",[this.evaluateShapeRoles,l.FeatureType.Complex]],["SalientCoverage",[this.evaluateSalientCoverage,l.FeatureType.Numerical]],["GifsCount",[this.evaluateGifsCount,l.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateDesignSize:function(e){var t=[];return t.push(a.DesignFeatureUtils.getPageWidth(e.root_)),t.push(a.DesignFeatureUtils.getPageHeight(e.root_)),t},evaluateEditingResolution:function(e){return 2},evaluatePublishingResolution:function(e){return 2},evaluateLayoutId:function(e){var t="default",n=i.clone(e.root_.filterByControllerKind(u.GridController.KIND));return n.length>0&&(t=i.as(n[0].controller,u.GridController).gridStyle.name),t},evaluateEdges:function(e){var t=[],n=i.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()})));return n.length>0&&(t=i.clone(n[0].controller.getAverageEdgeGrid(new f.TheoSize(5,5)))),t},evaluateFocus:function(e){var t=i.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()}))),n=[];if(t.length>0){var r,o=t[0];(r=e.getFocusRegion(o))&&(n=i.clone(r.encodeJson()))}return n},getFocusRegion:function(e){var t=null;return e.visitAll(s.FormaTraversal.JustChildren,(function(e){e instanceof c.ImageForma&&null==t&&(t=e.getFocusRegion())})),t},evaluateImageCount:function(e){return a.DesignFeatureUtils.getNonLogoImageCount(e.root_)},evaluateRetargetableFloatingImageCount:function(e){return a.DesignFeatureUtils.getRetargetableFloatingImageCount(e.root_,e.isTemplate_)},evaluateRetargetableBackgroundImageCount:function(e){return a.DesignFeatureUtils.getRetargetableBackgroundImageCount(e.root_,e.isTemplate_)},evaluateNumMoveable:function(e){return i.toDouble(e.root_.filterWithCallback(a.DesignFeatureUtils.isFloating).length)},evaluateLockupStrings:function(e){return p.TypeLockupUtils.getLockupStringsForRoot(e.root_)},evaluateTextRoles:function(e){for(var t=[],n=i.clone(a.DesignFeatureUtils.getLockupsInDesign(e.root_)),r=i.iter(n);!r.done;r.next()){var o=r.value;t.push(a.DesignFeatureUtils.getRoleString(o))}return t},evaluateShapeRoles:function(e){var t=[];if(h.TheoDocumentUtils.enableFastHeuristicsForComplexPage(e.root_.page))return t;for(var n=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==d.ShapeController.KIND&&!e.isGridCell()}))),r=i.iter(n);!r.done;r.next()){var o=r.value;t.push(a.DesignFeatureUtils.getRoleString(o))}return t},evaluateShapeCount:function(e){return i.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==d.ShapeController.KIND&&!e.isGridCell()})).length)},evaluateSalientCoverage:function(e){for(var t=i.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()}))),n=0,r=i.iter(t);!r.done;r.next()){var o,a,s,l=r.value;(o=e.root_.finalFrame)&&(a=e.getFocusRegion(l))&&(s=a.intersectionWith(o))&&(n+=s.area/o.area)}return n},evaluateVisualGroupInfo:function(e){var t={},n=i.clone(e.root_.filterWithCallback((function(e){var t,n;return!(null==e.controller||!e.controller.floating||e.controller.userGroup||e.isLogo()||e.kind==c.ImageForma.KIND||!(t=i.opt(e.root,(function(e){return e.finalFrame})))||!(n=e.finalFrame))&&t.intersects(n)})));if(n.length>2*h.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD&&(n=n.slice(0,2*h.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD)),n.length>0){var r=new g.VisualStructureDetector(n,e.root_).inferVisualStructure();return i.opt(r,(function(e){return e.encodeToJson()}))||t}return t},evaluateGridCellCount:function(e){return i.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isGridCell()})).length)},evaluateGifsCount:function(e){var t=i.clone(e.root_.filterWithCallback((function(e){return e.kind==m.VideoForma.KIND})));return i.toDouble(t.length)}}}),r)},YxjU:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("URxh"),s=n("tGKA"),l=n("K17h"),u=n("oKlP"),c=n("RkYL"),d=n("xm77");o.MotionSourceFadeInV=(r=function(){},i.defineClass({name:"MotionSourceFadeInV",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=c.TheoTime.Zero,r=c.TheoTime.fromSeconds(1),o=s.Matrix2D.translation(new u.TheoPoint(0,-400)),i=s.Matrix2D.Identity,h=l.MotionUtils.createOpacityStyle(e,0),p=e.style.clone();return t.push(new a.KeyFrame(n,d.TimingFunctionType.EaseInOut,o,null,h)),t.push(new a.KeyFrame(r,d.TimingFunctionType.EaseInOut,i,null,p)),t}}}),r)},Z25M:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("cZuM"),s=n("gXiO"),l=n("FNB+"),u=n("6ZWm"),c=n("cmoc"),d=n("G1DZ"),h=n("fdtz"),p=n("lmwz"),f=n("fNpk"),m=n("c+uM"),g=n("tGKA"),y=n("7Ta2"),_=n("JO5d"),T=n("djAF"),v=n("8t9B"),C=n("sIWg");o.DesignFeatureUtils=(r=function(){s.CoreObject.call(this)},i.defineClass({name:"DesignFeatureUtils",ctor:r,superName:"CoreObject",statics:{evaluateRootEmptySpace:function(e){for(var t=i.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),n={},r={},o=i.iter(t);!o.done;o.next()){var a=o.value,s=a.controller.visualParent;null==r[s.formaID]&&(r[s.formaID]=s),null==n[s.formaID]&&(n[s.formaID]=[]),n[s.formaID].push(a)}for(var l=[],u=i.iter(n);!u.done;u.next()){for(var c=u.key,d=u.value,h=0,p=i.iter(d);!p.done;p.next())h+=p.value.finalFrame.area;null!=r[c].finalFrame&&h>0&&l.push(h/r[c].finalFrame.area)}return 0==l.length?0:1-i.min(l)},getSymmAsymmForForma:function(e,t,n){void 0===n&&(n=0);for(var o=[],a=i.iter(e);!a.done;a.next()){var s=a.value;o.push(s.finalFrame)}return r.getSymmAsymm(o,t,n)},getSymmAsymm:function(e,t,n){var o;void 0===n&&(n=0);for(var a=0,s=i.iter(e);!s.done;s.next())for(var l=s.value,u=t?new C.TheoRect(l.minX,1-l.maxY,l.maxX,1-l.minY):new C.TheoRect(1-l.maxX,l.minY,1-l.minX,l.maxY),c=i.iter(e);!c.done;c.next()){var d=c.value,h=r.frameIntersection(d,u);a+=(o=i.opt(h,(function(e){return e.area})))||null!=o?o:0}return e.length>0?a:n},frameIntersection:function(e,t){var n=null;return Math.max(e.minX,t.minX)<Math.min(e.maxX,t.maxX)&&Math.max(e.minY,t.minY)<Math.min(e.maxY,t.maxY)&&(n=new C.TheoRect(Math.max(e.minX,t.minX),Math.max(e.minY,t.minY),Math.min(e.maxX,t.maxX),Math.min(e.maxY,t.maxY))),n},getImageCount:function(e){return i.toDouble(e.filterWithCallback((function(e){return e instanceof h.ImageForma})).length)},getNonLogoImageCount:function(e){return i.toDouble(e.filterWithCallback((function(e){var t;return!!(t=i.as(e,c.FrameForma))&&!t.isLogo()})).length)},getPossibleBackgroundImageCount:function(e){return i.toDouble(e.filterWithCallback((function(e){return p.ImageFacade.isPotentialBackgroundImage(e)})).length)},isRetargetableFloatingImage:function(e,t){return void 0===t&&(t=!1),r.isRetargetableImage(e,t)&&p.ImageFacade.isFloatingImage(e)},isRetargetableBackgroundImage:function(e,t){return void 0===t&&(t=!1),r.isRetargetableImage(e,t)&&!p.ImageFacade.isFloatingImage(e)},isRetargetableImageFromUserDesign:function(e){return r.isRetargetableImage(e,!1)},isRetargetableImageFromTemplate:function(e){return r.isRetargetableImage(e,!0)},isRetargetableImage:function(e,t){var n,o,a;if(void 0===t&&(t=!1),a=i.as(e,c.FrameForma)){if(a.isSticker()||a.isLogo())return!1;if(((n=i.opt(a.source,(function(e){return e.includes(d.FormaSourceNamespace.DesignVariation)})))||null!=n)&&n)return!1;if(((o=i.opt(i.opt(e,(function(e){return e.controller})),(function(e){return e.userGroupMember})))||null!=o)&&o)return!1;var s,l,h;if((s=p.ImageFacade.getImageFormaForForma(a))&&(l=s.boundsInCoordSpace(g.Matrix2D.Identity))&&(h=i.as(a.controller,u.FrameController))){if(l.width<50||l.height<50)return!1;if(s.hasAlpha()&&!h.hasCutout)return!1;if(t&&r.isDecorativeTemplateBackground(a))return!1}return!0}return!1},isDecorativeTemplateBackground:function(e){var t;if(t=i.as(e,c.FrameForma)){var n=i.opt(t.finalFrame,(function(e){return e.intersectionWith(t.root.finalFrame)}))||C.TheoRect.Zero;if(t.isBackgroundImage()||n.area/t.root.finalFrame.area>.75)for(var o=i.clone(t.root.filterWithCallback((function(e){var t;return!!(t=e.controller)&&t.floating&&!t.userGroup}))),a=i.iter(o);!a.done;a.next()){var s,l=a.value;if(l!=t&&l.isGraphic()&&(s=l.finalFrame.intersectionWith(t.finalFrame))&&s.area/l.finalFrame.area>.75&&r.isRetargetableFloatingImage(l,!1))return!0}}return!1},getRetargetableFloatingImageCount:function(e,t){return void 0===t&&(t=!1),i.toDouble(e.filterWithCallback((function(e){return r.isRetargetableFloatingImage(e,t)})).length)},getRetargetableBackgroundImageCount:function(e,t){return void 0===t&&(t=!1),i.toDouble(e.filterWithCallback((function(e){return r.isRetargetableBackgroundImage(e,t)})).length)},getTextCount:function(e){return i.toDouble(e.filterWithCallback((function(e){return e.isTypeLockup()})).length)},getShapeCount:function(e){return i.toDouble(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==_.ShapeController.KIND&&!e.isGridCell()})).length)},getFormaBoundingBox:function(e){for(var t=[],n=i.clone(e.totalPlacement.transformPoints(e.bounds.points)),r=i.iter(n);!r.done;r.next()){var o=r.value;t.push(o.x),t.push(o.y)}return t},formaPercentageArea:function(e){var t,n=0;if(t=e.bounds){var r=i.clone(e.totalPlacement.transformPoints(t.points)),o=r[3].x-r[0].x,a=r[3].y-r[0].y,s=e.page.pageSize.height;n=o*a/(e.page.pageSize.width*s)}return n},getFormaCenterX:function(e){var t=i.clone(e.totalPlacement.transformPoints(e.bounds.points));return(t[0].x+t[3].x)/2/e.page.pageSize.width},getFormaCenterY:function(e){var t=i.clone(e.totalPlacement.transformPoints(e.bounds.points));return(t[0].y+t[3].y)/2/e.page.pageSize.height},getPageWidth:function(e){return e.page.pageSize.width},getPageHeight:function(e){return e.page.pageSize.height},getFormaHeight:function(e){var t=i.clone(e.totalPlacement.transformPoints(e.bounds.points)),n=t[1].distanceTo(t[0]);return f.LegacyCoreAssert.isTrue(n>=0,"width is negative",void 0,"DesignFeatureUtils.getFormaHeight","DesignFeatureUtils.swift",297),n},getFormaWidth:function(e){var t=i.clone(e.totalPlacement.transformPoints(e.bounds.points)),n=t[2].distanceTo(t[0]);return f.LegacyCoreAssert.isTrue(n>=0,"height is negative",void 0,"DesignFeatureUtils.getFormaWidth","DesignFeatureUtils.swift",305),n},sumAreaOfForma:function(e,t){var n,r=0;if(n=t.finalFrame){f.LegacyCoreAssert.isTrue(n.area>0,"root area is negative",void 0,"DesignFeatureUtils.sumAreaOfForma","DesignFeatureUtils.swift",312);for(var o=i.iter(e);!o.done;o.next()){var a;(a=o.value.finalFrame.intersectionWith(n))&&(r+=a.area/n.area)}}return Math.max(r,1)},getLockupsInDesign:function(e){return e.filterByControllerKind(v.TypeLockupController.KIND)},getRoleString:function(e){return(new y.RoleSuggester).getRole(e).role},isFloating:function(e){var t;return(!(t=i.opt(e.controller,(function(e){return e.userGroupChild})))&&null==t||!t)&&(!(null==e.controller||!e.controller.userGroup||!e.controller.floating)||e.isTypeLockup()||e.kind==T.ShapeForma.KIND&&e.hasIntent(l.Forma.INTENT_ICON)||e.kind==c.FrameForma.KIND&&e.controller.floating&&!e.isLogo())},getTypeLockupParentFormaIDofShape:function(e){var t;return e.style.kind==m.LockupStyle.KIND?e.formaID:(t=e.parent)?r.getTypeLockupParentFormaIDofShape(t):null},getLockupsWithin:function(e,t,n){for(var r=[],o=i.iter(t);!o.done;o.next()){var a=o.value,s=a.finalFrame.center.distanceTo(e.finalFrame.center);e.formaID!=a.formaID&&s<n&&r.push(a)}return r},getSetDiff:function(e,t){for(var n=[],r=i.iter(e);!r.done;r.next()){for(var o=r.value,a=!1,s=i.iter(t);!s.done;s.next())s.value.forma.formaID==o.formaID&&(a=!0);a||n.push(o)}return n},getSetSimm:function(e,t){for(var n=[],r=i.iter(e);!r.done;r.next())for(var o=r.value,a=i.iter(t);!a.done;a.next()){var s=a.value;if(s.forma.formaID==o.formaID){n.push(s);break}}return n},getAlignmentConcensus:function(e){for(var t={},n=i.iter(e);!n.done;n.next()){var r=n.value,o=a.describeAlignmentType(r.line.type);i.keys(t).includes(o)?t[o]=t[o]+1:t[o]=1}for(var s=0,l=a.describeAlignmentType(a.AlignmentType.None),u=i.iter(i.keys(t));!u.done;u.next())t[o=u.value]>s&&(s=t[o],l=o);var c=0;return e.length>0&&(c=i.toDouble(s)/i.toDouble(e.length)),i.dict([l,c])}}}),r)},ZhwN:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("iCxV");o.GUIDUtils=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"GUIDUtils",ctor:r,superName:"CoreObject",statics:{makeGUID:function(){var e;return(e=i.opt(s.Host.resourceUtils,(function(e){return e.makeGUID()})))||null!=e?e:""}}}),r)},a9ow:function(e,t,n){var r,o,i,a,s,l,u,c,d,h=t,p=n("oAGj"),f=n("qsM9"),m=n("SpAV"),g=n("dJuF"),y=n("QgZx"),_=n("iCxV"),T=n("fNpk"),v=n("Zifs");h.TextAttribute=(r=function(e){this.value_=e},p.defineClass({name:"TextAttribute",ctor:r,superName:"CoreObject",statics:{PROPERTY_VALUE:"value",PROPERTY_START:"start",PROPERTY_LENGTH:"length"},props:{isEqual:function(e){return m.CoreAssert.fail("unimplemented override of isEqual",void 0,"TextAttribute.isEqual","TextAttribute.swift",23),!1},hash:{get:function(){return m.CoreAssert.fail("unimplemented override of hash",void 0,"TextAttribute","TextAttribute.swift",28),0}},description:{get:function(){return T.LegacyCoreAssert.fail("missing override of description",void 0,"TextAttribute","TextAttribute.swift",33),"TextAttribute"}},clone:function(){return new r(this.value_)}}}),r),h.UTF16Attribute=(o=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"UTF16Attribute",ctor:o,superName:"TextAttribute",statics:{NAME:{get:function(){return"text"}},codec:{get:function(){var e,t="UTF16Attribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var i,a=g.DBProperty.deleted(e);return(i=p.as(n,o))&&(a=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.stringProperty(e.append(h.TextAttribute.PROPERTY_VALUE),i.value)},t)),a}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.stringValue})))?new o(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,o))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new o(this.value)}}}),o),h.FontDescriptorAttribute=(i=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontDescriptorAttribute",ctor:i,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-name"}},codec:{get:function(){var e,t="FontDescriptorAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,a=g.DBProperty.deleted(e);return(o=p.as(n,i))&&(a=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:f.Codecs.fontDescriptorCodec.encode(e.append(h.TextAttribute.PROPERTY_VALUE),o.value_,r)},t)),a}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&(r=p.as(f.Codecs.fontDescriptorCodec.decode(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),n),y.FontDescriptor))?new i(r):null}),t))}}},props:{postscriptName:{get:function(){return this.value.postScriptName}},value:{get:function(){var e;return(e=p.as(this.value_,y.FontDescriptor))||null!=e?e:_.Host.textModelUtils.defaultFont()}},isEqual:function(e){var t;return!!(t=p.as(e,i))&&(t.value===this.value||p.eq(y._equality_FontDescriptor_FontDescriptor,t.value,this.value))},hash:{get:function(){return this.value.hash}},description:{get:function(){return this.value.postScriptName}},clone:function(){return new i(this.value)}}}),i),h.FontSizeAttribute=(a=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontSizeAttribute",ctor:a,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-size"}},codec:{get:function(){var e,t="FontSizeAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,i=g.DBProperty.deleted(e);return(o=p.as(n,a))&&(i=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.doubleProperty(e.append(h.TextAttribute.PROPERTY_VALUE),o.value)},t)),i}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.doubleValue})))?new a(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,a))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new a(this.value)}}}),a),h.FontColorAttribute=(s=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontColorAttribute",ctor:s,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-color"}},codec:{get:function(){var e,t="FontColorAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,i=g.DBProperty.deleted(e);return(o=p.as(n,s))&&(i=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:f.Codecs.solidColorCodec.encode(e.append(h.TextAttribute.PROPERTY_VALUE),o.value_,r)},t)),i}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&(r=p.as(f.Codecs.solidColorCodec.decode(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),n),v.SolidColor))?new s(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,s))&&p.eq(v._equality_SolidColor_SolidColor,t.value,this.value)},hash:{get:function(){return this.value.hash}},description:{get:function(){return this.value.asString}},clone:function(){return new s(this.value)}}}),s),h.FontStrokeColorAttribute=(l=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontStrokeColorAttribute",ctor:l,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-strokecolor"}},codec:{get:function(){var e,t="FontStrokeColorAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,i=g.DBProperty.deleted(e);return(o=p.as(n,l))&&(i=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:f.Codecs.solidColorCodec.encode(e.append(h.TextAttribute.PROPERTY_VALUE),o.value_,r)},t)),i}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&(r=p.as(f.Codecs.solidColorCodec.decode(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),n),v.SolidColor))?new l(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,l))&&p.eq(v._equality_SolidColor_SolidColor,t.value,this.value)},hash:{get:function(){return this.value.hash}},description:{get:function(){return this.value.asString}},clone:function(){return new l(this.value)}}}),l),h.FontStrokeWidthAttribute=(u=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"FontStrokeWidthAttribute",ctor:u,superName:"TextAttribute",statics:{NAME:{get:function(){return"font-strokewidth"}},codec:{get:function(){var e,t="FontStrokeWidthAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,i=g.DBProperty.deleted(e);return(o=p.as(n,u))&&(i=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.doubleProperty(e.append(h.TextAttribute.PROPERTY_VALUE),o.value)},t)),i}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.doubleValue})))?new u(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,u))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new u(this.value)}}}),u),h.TextLookAttribute=(c=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"TextLookAttribute",ctor:c,superName:"TextAttribute",statics:{NAME:{get:function(){return"text-look"}},codec:{get:function(){var e,t="TextLookAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,i=g.DBProperty.deleted(e);return(o=p.as(n,c))&&(i=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_VALUE),o.value)},t)),i}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.intValue})))?new c(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,c))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new c(this.value)}}}),c),h.TrackingAttribute=(d=function(e){h.TextAttribute.call(this,e)},p.defineClass({name:"TrackingAttribute",ctor:d,superName:"TextAttribute",statics:{NAME:{get:function(){return"tracking"}},codec:{get:function(){var e,t="TrackingAttribute";return g.DBPropertyCodec.typeCodec(t)||g.DBPropertyCodec.registerCodec(t,g.DBPropertyCodec.codec((function(e,n,r){var o,i=g.DBProperty.deleted(e);return(o=p.as(n,d))&&(i=g.DBProperty.dictEncoded(e,{start:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_START),0),length:g.DBProperty.intProperty(e.append(h.TextAttribute.PROPERTY_LENGTH),0),value:g.DBProperty.doubleProperty(e.append(h.TextAttribute.PROPERTY_VALUE),o.value)},t)),i}),(function(t,n){var r;return((e=p.opt(t,(function(e){return e.isDictionary})))||null!=e)&&e&&null!=(r=p.opt(t.getDictionaryProperty(h.TextAttribute.PROPERTY_VALUE),(function(e){return e.doubleValue})))?new d(r):null}),t))}}},props:{value:{get:function(){return this.value_}},isEqual:function(e){var t;return!!(t=p.as(e,d))&&t.value==this.value},hash:{get:function(){return p.hashValue(this.value)}},description:{get:function(){return this.value}},clone:function(){return new d(this.value)}}}),d)},aN2p:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("kVgh"),l=n("Vvcj"),u=n("fNpk"),c=n("Zifs");i.SimpleSwatch=(r=function(){},o={},a.defineClass({name:"SimpleSwatch",ctor:r,superName:"ColorSwatch",statics:{SCHEMA_CLASS_NAME:"SimpleSwatch",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),l.ColorThemeDocument);return u.LegacyCoreAssert.isTrue(null!=i,"SimpleSwatch needs a parent ColorThemeDocument",void 0,"SimpleSwatch","SimpleSwatch.swift",15),r.init_7e49(e,n,i)}),o.factory},set:function(e){o.factory=e}},KIND:"simple",PROPERTY_COLOR:"color",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{className:{get:function(){return r.SCHEMA_CLASS_NAME}},color:{get:function(){return a.as(this.get(r.PROPERTY_COLOR),c.SolidColor)},set:function(e){this.set(r.PROPERTY_COLOR,e)}},match:function(e){var t=a.as(e,r);null!=t&&(this.color=t.color),s.ColorSwatch.prototype.match.call(this,e)},solidRepresentation:{get:function(){return this.color}},kind:{get:function(){return r.KIND}},init_7e49:function(e,t,n){a.super_init(this,s.ColorSwatch,s.ColorSwatch.prototype.init_7e49,e,t,n)},init_d0e4:function(e){a.super_init(this,s.ColorSwatch,s.ColorSwatch.prototype.init_d0e4,e)}}}),r)},aS4X:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("hEh8");o.DCXDocumentDecoder=(r=function(e){a.DCXNodeDecoder.call(this,e,e.root)},i.defineClass({name:"DCXDocumentDecoder",ctor:r,superName:"DCXNodeDecoder",statics:{_implements:function(e){return"IImportDataObject"==e}},props:{getPropertyOnNode:function(e){var t=a.DCXNodeDecoder.prototype.getPropertyOnNode.call(this,e);return null==t&&(t=i.as(this.branch_.getValue(e),"AnyObject")),t}}}),r)},az6C:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("gXiO");i.GaussianKernel=(r=function(){this.glKernel=[],this.windowWidth=0},a.defineClass({name:"GaussianKernel",ctor:r,superName:"CoreObject",props:{set:function(e,t){this.glKernel=a.clone(e),this.windowWidth=t}}}),r),i.Sharpen=(o=function(){s.CoreObject.call(this)},a.defineClass({name:"Sharpen",ctor:o,superName:"CoreObject",statics:{computeGaussianKernels:function(e,t,n){var r=new i.GaussianKernel,s=4*e/100*a.toDouble(t+n)/400,l=a.toInt(Math.floor(1.5*s)+1),u=0;l>4&&(u=a.toInt(Math.floor((a.toDouble(l)/a.toDouble(4)-1)/2)+1),l=a.toInt(Math.floor(a.toDouble(l)/a.toDouble(2*u+1))+1));for(var c=2*u+1,d=2*l+1,h=[],p=0,f=a.iter(a.range(0,d,!1));!f.done;f.next()){var m=f.value;p+=a.toDouble(c)*(o.MoaMathNormalCDF(a.toDouble(m)+.5-a.toDouble(l),s/a.toDouble(c))-o.MoaMathNormalCDF(a.toDouble(m)-.5-a.toDouble(l),s/a.toDouble(c)))}for(var g=0,y=a.iter(a.range(0,d,!1));!y.done;y.next())m=y.value,h.push(1/p*a.toDouble(4096)*(o.MoaMathNormalCDF(a.toDouble(m)+.5-a.toDouble(l),s/a.toDouble(c))-o.MoaMathNormalCDF(a.toDouble(m)-.5-a.toDouble(l),s/a.toDouble(c)))),g+=h[m];for(var _=4-a.toInt((d-1)/2),T=4+a.toInt((d-1)/2),v=[],C=a.iter(a.range(0,8,!0));!C.done;C.next())(m=C.value)<_||m>T?v.push(0):v.push(a.toDouble(h[m-_])/g);return r.set(v,c),r},get357FactorsOfClosestFactorableNumber:function(e){for(var t=!1,n=0,r=e,o=[0,0,0];!t;)if(r=e+n,(n*=-1)<=0&&(n-=1),!(r<3)){t=!0;var i=r,a=[3,5,7];o[0]=0,o[1]=0,o[2]=0;for(var s=0;i>1;)if(i%a[s]==0?(o[s]=o[s]+1,i/=a[s]):s+=1,s>=3){t=!1;break}}return o},MoaMathNormalCDF:function(e,t){return(1+o.MoaMathErf(e/1.4142135623730951/t))/2},MoaMathErf:function(e){return e>=0?1-o.MoaMathErfccheb(e):o.MoaMathErfccheb(-e)-1},MoaMathErfccheb:function(e){var t,n=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,1.5626441722e-8,-8.5238095915e-8,6.529054439e-9,5.059343495e-9,-9.91364156e-10,-2.27365122e-10,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];if(e<0)return 0;for(var r=0,o=0,i=2/(2+e),s=4*i-2,l=a.iter(a.range(1,27,!0).reversed());!l.done;l.next())t=r,r=s*r-o+n[l.value],o=t;return i*Math.exp(-e*e+.5*(n[0]+s*r)-o)}}}),o)},"c+uM":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("qsM9"),l=n("SpAV"),u=n("ascj"),c=n("fVJ2"),d=n("dJuF"),h=n("13MC"),p=n("QbzR"),f=n("ZhwN"),m=n("iCxV"),g=n("fNpk"),y=n("3DEm"),_=n("Zifs"),T=n("35Q0"),v=n("VJ9E"),C=n("BgH2"),P=n("oKI3");i.LockupLayout=a.defineEnum("LockupLayout",{SKIP:-2,UNSET:-1,FitJustified:0,LegacyLeft:1,LegacyRight:2,LegacyCenter:3,Standard:4,LetterGrid:5,Path:6,Auto:7}),i.LockupAlignment=a.defineEnum("LockupAlignment",{SKIP:-2,UNSET:-1,Left:0,Right:1,Center:2,Triplet:120,TripletRotatedMiddleMulti:121,TripletRotatedMiddle:122,TripletRotatedEnds:123,RotateTopStart:140,RotateBottomStart:142,RotateFitStart:143,RotateFullStart:146,RotateBottomEnd:145,RotateTopEnd:141,RotateFitEnd:144,RotateFullEnd:147,DropCapTop:180,DropCapBottom:182,DropCapFit:183,DropCap:184,FitRotateFit:202,RotateAndFit:203}),i.VerticalLockupAlignment=a.defineEnum("VerticalLockupAlignment",{UNSET:-1,Top:0,Bottom:1,VerticalCenter:2}),i.LockupBacking=a.defineEnum("LockupBacking",{UNSET:-1,None:0,Frame:1,Rows:2,Box:3,LegacyShadow:4,Banner:5,LeftRight:6,SVGBackground:7,BannerVertical:8,BannerHorizontal:9,TopBottom:10,Knockout:11}),i.LockupTextLook=a.defineEnum("LockupTextLook",{SKIP:-2,UNSET:-1,Fill:0,KnockoutOnly:1,KnockoutAndOutline:2,OutlineOnly:3,FillAndOutline:4,FillAndOutline2:5,KnockoutAndFill:6,Shadow:7,ShadowAndOutline:8,KnockoutAndShadow:9,ShadowOutlineTransparentText:10,KnockoutShadowOutline:11}),i.LockupStyle=(r=function(){this.cachedCharacterStyles_=null},o={},a.defineClass({name:"LockupStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"LockupStyle"}},KIND:{get:function(){return"LockupStyle"}},DEFAULT_PADDING:.65,DEFAULT_SPACING:.35,DEFAULT_SHADOWOFFSET:.5,DEFAULT_STROKEWEIGHT:.1,DEFAULT_WHEELUSED:!1,DEFAULT_TRACKING:0,DEFAULT_RELATIVE_FONT_SCALE:-1,DEFAULT_TEXTOPACITY:1,DEFAULT_BACKINGOPACITY:1,DEFAULT_SHADOWANGLE:135,UNSET_FONT:null,UNSET_SPACING:-1,UNSET_RELATIVE_FONT_SCALE:{get:function(){return void 0===o.UNSET_RELATIVE_FONT_SCALE&&(o.UNSET_RELATIVE_FONT_SCALE=r.DEFAULT_RELATIVE_FONT_SCALE),o.UNSET_RELATIVE_FONT_SCALE}},UNSET_TRACKING:-99,UNSET_PADDING:0,UNSET_BACKING:{get:function(){return void 0===o.UNSET_BACKING&&(o.UNSET_BACKING=i.LockupBacking.None),o.UNSET_BACKING}},UNSET_LAYOUT:{get:function(){return void 0===o.UNSET_LAYOUT&&(o.UNSET_LAYOUT=i.LockupLayout.UNSET),o.UNSET_LAYOUT}},UNSET_BACKING_ARTWORK_ID:null,UNSET_SHADOW_ANGLE:-1,UNSET_TEXT_LOOK:{get:function(){return void 0===o.UNSET_TEXT_LOOK&&(o.UNSET_TEXT_LOOK=i.LockupTextLook.UNSET),o.UNSET_TEXT_LOOK}},UNSET_SHADOW_OFFSET:-1,UNSET_STROKE_WEIGHT:-1,PROPERTY_FONTS:"fonts",PROPERTY_SPACING:"spacing",PROPERTY_TRACKING:"tracking",PROPERTY_RELATIVE_FONT_SCALE:"relativeFontScale",PROPERTY_PADDING:"padding",PROPERTY_BACKING:"backing",PROPERTY_LAYOUT:"layout",PROPERTY_ALIGNMENT:"alignment",PROPERTY_VERTICAL_ALIGNMENT:"verticalAlignment",PROPERTY_BACKING_ARTWORK_ID:"backingArtworkID",PROPERTY_SHADOW_ANGLE:"shadowAngle",PROPERTY_TEXT_OPACITY:"text-opacity",PROPERTY_BACKING_OPACITY:"backing-opacity",PROPERTY_KNOCKOUT:"knockout",PROPERTY_CHARSTYLES:"character-styles",PROPERTY_SHADOW_OFFSET:"shadowOffset",PROPERTY_STROKE_WEIGHT:"strokeWeight",PROPERTY_LINEBREAK:"linebreak",PROPERTY_PATH_ID:"pathID",PROPERTY_CUSTOM_PATH:"customPath",PROPERTY_WHEELUSED:"wheel-used",unsetCharacterStyleProperties:{get:function(){return void 0===o.unsetCharacterStyleProperties&&(o.unsetCharacterStyleProperties=a.dict([r.PROPERTY_SPACING,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_SPACING),r.UNSET_SPACING,!0),r.PROPERTY_TRACKING,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_TRACKING),r.UNSET_TRACKING,!0),r.PROPERTY_PADDING,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_PADDING),r.UNSET_PADDING,!0),r.PROPERTY_BACKING,d.DBProperty.intProperty(d.DBNamePath.init_b14a(r.PROPERTY_BACKING),r.UNSET_BACKING,!0),r.PROPERTY_SHADOW_ANGLE,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_SHADOW_ANGLE),r.UNSET_SHADOW_ANGLE,!0),r.PROPERTY_LAYOUT,d.DBProperty.intProperty(d.DBNamePath.init_b14a(r.PROPERTY_LAYOUT),r.UNSET_LAYOUT,!0),r.PROPERTY_TEXT_OPACITY,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_TEXT_OPACITY),p.FormaStyle.OPACITY_UNSET,!0),r.PROPERTY_BACKING_OPACITY,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_BACKING_OPACITY),p.FormaStyle.OPACITY_UNSET,!0),r.PROPERTY_KNOCKOUT,d.DBProperty.intProperty(d.DBNamePath.init_b14a(r.PROPERTY_KNOCKOUT),r.UNSET_TEXT_LOOK,!0),r.PROPERTY_SHADOW_OFFSET,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_SHADOW_OFFSET),r.UNSET_SHADOW_OFFSET,!0),r.PROPERTY_STROKE_WEIGHT,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_STROKE_WEIGHT),r.UNSET_STROKE_WEIGHT,!0),r.PROPERTY_RELATIVE_FONT_SCALE,d.DBProperty.doubleProperty(d.DBNamePath.init_b14a(r.PROPERTY_RELATIVE_FONT_SCALE),r.UNSET_RELATIVE_FONT_SCALE,!0)])),o.unsetCharacterStyleProperties}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},characterStyleSchemaClassName:"CharacterStyle",characterStyleCodec:{get:function(){return void 0===o.characterStyleCodec&&(o.characterStyleCodec=d.DBPropertyCodec.registerCodec(r.characterStyleSchemaClassName,d.DBPropertyCodec.init_a58a((function(e,t,n){var o,i=d.DBProperty.deleted(e);return(o=a.as(t,r))?(i=d.DBProperty.dictEncoded(e,o.state.allProperties,o.className),null==n||o.isChildObject||n.addChildObject(o,e)):g.LegacyCoreAssert.fail("Expected LockupStyle",{actual:t},"LockupStyle","LockupStyle.swift",219),i}),(function(e,t){var n,o=null;if(null!=(n=a.opt(e,(function(e){return e.className})))){var i,s,l,m=f.GUIDUtils.makeGUID();if(i=a.opt(e,(function(e){return e.namePath})))o=(l=a.as(t,c.DBObject))?a.as(l.createChildObject(r.SCHEMA_CLASS_NAME,i),r):r.init_866e(h.DBChildObjectState.init_94ed(t,i),m);else if(s=a.opt(e,(function(e){return e.dictionaryValue}))){var y=a.clone(r.unsetCharacterStyleProperties);g.LegacyCoreAssert.isTrue(n==r.characterStyleSchemaClassName||n==r.SCHEMA_CLASS_NAME,"Unexpected schema description for character style",void 0,"LockupStyle","LockupStyle.swift",237),y[p.FormaStyle.PROPERTY_COLORS]=u.ColorTable.codec.encode(d.DBNamePath.init_b14a(p.FormaStyle.PROPERTY_COLORS),u.ColorTable.init_25f6([{key:u.ColorRole.FieldPrimary,value:"themeColor0"},{key:u.ColorRole.FieldSecondary,value:"themeColor1"},{key:u.ColorRole.Border,value:"themeColor1"},{key:u.ColorRole.Shadow,value:"themeColor1"}]),null),a.each(s,(function(e,t){y[e]=t})),o=r.init_dd5d(y,{})}}return o}),r.characterStyleSchemaClassName))),o.characterStyleCodec}},createDefault:function(){var e=v.TheoFont.init_9e5c(m.Host.textModelUtils.defaultFont()),t=u.ColorTable.init_25f6([{key:u.ColorRole.FieldPrimary,value:"themeColor0"},{key:u.ColorRole.FieldSecondary,value:"themeColor1"},{key:u.ColorRole.Border,value:"themeColor1"},{key:u.ColorRole.Shadow,value:"themeColor1"}]);return r.init_f3fd(r.DEFAULT_TEXTOPACITY,r.DEFAULT_BACKINGOPACITY,t,e,r.DEFAULT_SPACING,r.DEFAULT_TRACKING,r.DEFAULT_PADDING,i.LockupBacking.None,null,r.DEFAULT_SHADOWANGLE,i.LockupLayout.FitJustified,i.LockupAlignment.UNSET,i.LockupTextLook.Fill,r.DEFAULT_SHADOWOFFSET,r.DEFAULT_STROKEWEIGHT,void 0,void 0,r.DEFAULT_WHEELUSED,r.UNSET_RELATIVE_FONT_SCALE,i.VerticalLockupAlignment.UNSET)},createDefaultCharacterStyle:function(e){var t=r.createDefault();return t.colorLibrary=e.colorLibrary,t.setEmptyStyle(),r.isKnockoutLook(e.textLook)?t.textLook=i.LockupTextLook.Fill:e.backing==i.LockupBacking.Rows&&e.padding<.4&&e.spacing>0&&(t.backing=i.LockupBacking.Rows,t.colors.setColorId(u.ColorRole.FieldPrimary,e.colors.colorID(u.ColorRole.FieldSecondary)),t.colors.setColorId(u.ColorRole.FieldSecondary,e.colors.colorID(u.ColorRole.FieldPrimary)),t.colors.setColorId(u.ColorRole.Border,e.colors.colorID(u.ColorRole.Border)),t.colors.setColorId(u.ColorRole.Shadow,e.colors.colorID(u.ColorRole.Shadow))),r.isLetterGrid(e.layout)&&(t.backing=i.LockupBacking.UNSET),t},isKnockoutLook:function(e){return e==i.LockupTextLook.KnockoutOnly||e==i.LockupTextLook.KnockoutAndOutline||e==i.LockupTextLook.KnockoutAndFill||e==i.LockupTextLook.KnockoutAndShadow||e==i.LockupTextLook.KnockoutShadowOutline},isOutlineLook:function(e){return e==i.LockupTextLook.KnockoutAndOutline||e==i.LockupTextLook.OutlineOnly||e==i.LockupTextLook.FillAndOutline||e==i.LockupTextLook.FillAndOutline2||e==i.LockupTextLook.ShadowAndOutline||e==i.LockupTextLook.KnockoutShadowOutline||e==i.LockupTextLook.ShadowOutlineTransparentText},isShadowLook:function(e){return e==i.LockupTextLook.Shadow||e==i.LockupTextLook.ShadowAndOutline||e==i.LockupTextLook.KnockoutAndShadow||e==i.LockupTextLook.KnockoutShadowOutline||e==i.LockupTextLook.ShadowOutlineTransparentText},isOutlineWithTransparentTextLook:function(e){return e==i.LockupTextLook.OutlineOnly||e==i.LockupTextLook.ShadowOutlineTransparentText},isDuplicateFormaLook:function(e){return e==i.LockupTextLook.Shadow||e==i.LockupTextLook.ShadowAndOutline||e==i.LockupTextLook.FillAndOutline2||e==i.LockupTextLook.KnockoutAndShadow},doesLookColorMatchShapeColor:function(e){return e==i.LockupTextLook.Shadow||e==i.LockupTextLook.ShadowAndOutline||e==i.LockupTextLook.FillAndOutline||e==i.LockupTextLook.FillAndOutline2||e==i.LockupTextLook.OutlineOnly},isAutoLayout:function(e){return e==i.LockupLayout.Auto},isLetterGrid:function(e){return e==i.LockupLayout.LetterGrid},isPath:function(e){return e==i.LockupLayout.Path},doesPerLetterLayout:function(e){return r.isLetterGrid(e)||r.isPath(e)},layoutSupportsAlignments:function(e){return e==i.LockupLayout.LetterGrid||e==i.LockupLayout.Standard},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{description:{get:function(){var e="LockupStyle: ",t=a.clone(a.as(this.get(r.PROPERTY_FONTS),["Array",v.TheoFont])||[]);return e+=r.PROPERTY_FONTS+": "+(1==t.length?t[0].fontData.postScriptName:"<unset>")+" | "}},init_866e:function(e,t){a.super_init(this,p.FormaStyle,p.FormaStyle.prototype.init_866e,e,t),this.fixLegacyProperties()},init_dd5d:function(e,t){a.super_init(this,p.FormaStyle,p.FormaStyle.prototype.init_dd5d,e,t),this.fixLegacyProperties()},init_f3fd:function(e,t,n,o,s,u,c,d,h,f,y,_,T,v,C,S,D,A,E,R){void 0===S&&(S=P.TextPathID.UNSET),void 0===D&&(D=null),void 0===A&&(A=r.DEFAULT_WHEELUSED),void 0===E&&(E=r.DEFAULT_RELATIVE_FONT_SCALE),void 0===R&&(R=i.VerticalLockupAlignment.UNSET),(u<-1||u>1)&&a.opt(m.Host.logging,(function(e){return e.warning("Tracking must be between -1 and 1.")}));var F=Math.max(-1,Math.min(1,u));(c<-.5||c>1)&&a.opt(m.Host.logging,(function(e){return e.warning("Padding must be between 0 and 1.")}));var b=Math.max(-.5,Math.min(1,c));null==h&&d!=i.LockupBacking.SVGBackground||null!=h&&d==i.LockupBacking.SVGBackground||(l.CoreAssertDebugOnly.isFalse(null==h&&d==i.LockupBacking.SVGBackground,"nil backingArtworkID but backing is SVGBackground",void 0,"LockupStyle.init","LockupStyle.swift",293),a.opt(m.Host.logging,(function(e){return e.warning("error backingArtwordID / SVGBackground")}))),g.LegacyCoreAssert.isFalse(y==i.LockupLayout.SKIP||y==i.LockupLayout.LegacyLeft||y==i.LockupLayout.LegacyCenter||y==i.LockupLayout.LegacyRight,"Unexpected LockupLayout value: "+y,void 0,"LockupStyle.init","LockupStyle.swift",297),g.LegacyCoreAssert.isFalse(_==i.LockupAlignment.SKIP,"Unexpected LockupAlignment",{alignment:_},"LockupStyle.init","LockupStyle.swift",299),r.isPath(y)?(S==P.TextPathID.Custom&&null==D||S!=P.TextPathID.Custom&&null!=D)&&a.opt(m.Host.logging,(function(e){return e.warning("pathID/customPath mismatch")})):S==P.TextPathID.UNSET&&null==D||a.opt(m.Host.logging,(function(e){return e.warning("Why are we providing a path or path id with a non-path layout?")}));var I={fonts:[o],spacing:s,tracking:F,padding:b,backing:d,shadowAngle:f,shadowOffset:v,strokeWeight:C,layout:y,alignment:_,verticalAlignment:R,"text-opacity":e,"backing-opacity":t,knockout:T,pathID:S,"wheel-used":A,relativeFontScale:E};null!=h&&(I[r.PROPERTY_BACKING_ARTWORK_ID]=h),null!=D&&(I[r.PROPERTY_CUSTOM_PATH]=D),a.super_init(this,p.FormaStyle,p.FormaStyle.prototype.init_5afe,r.KIND,1,n,null,null,I)},isEqualTo:function(e){var t;if(t=e){if(a.count(this.characterStyles)!=a.count(t.characterStyles))return!1;for(var n=a.iter(this.characterStyles);!n.done;n.next()){var r=n.key,o=n.value;if(null==t.characterStyles[r])return!1;if(!o.isEqualTo(t.characterStyles[r]))return!1}return this.textOpacity==t.textOpacity&&this.backingOpacity==t.backingOpacity&&a.eq(v._equality_TheoFont_TheoFont,this.font,t.font)&&this.spacing==t.spacing&&this.tracking==t.tracking&&this.padding==t.padding&&this.backing==t.backing&&this.shadowAngle==t.shadowAngle&&this.layout==t.layout&&this.alignment==t.alignment&&this.textLook==t.textLook&&this.shadowOffset==t.shadowOffset&&this.strokeWeight==t.strokeWeight&&this.wheelUsed==t.wheelUsed&&this.pathID==t.pathID&&this.customPath==t.customPath&&this.backingArtworkID==t.backingArtworkID&&this.relativeFontScale==t.relativeFontScale&&this.verticalAlignment==t.verticalAlignment&&this.lineBreakAtCharacterStyleSizeChange==t.lineBreakAtCharacterStyleSizeChange}return!1},className:{get:function(){return r.SCHEMA_CLASS_NAME}},willChangeState:function(e){var t;if(p.FormaStyle.prototype.willChangeState.call(this,e),a.keys(e).includes(r.PROPERTY_CHARSTYLES)&&(t=this.cachedCharacterStyles_)){for(var n=a.iter(t);!n.done;n.next())n.value.colorLibrary=null;this.cachedCharacterStyles_=null}},didChangeState:function(e){p.FormaStyle.prototype.didChangeState.call(this,e),a.keys(e).includes(r.PROPERTY_CHARSTYLES)&&a.clone(this.characterStyles)},fixLegacyProperties:function(){var e,t,n,o=a.opt(this.getProperty(p.FormaStyle.PROPERTY_OPACITY),(function(e){return e.doubleValue})),l=null==o?1:o,u=a.opt(this.getProperty(r.PROPERTY_TEXT_OPACITY),(function(e){return e.doubleValue})),c=a.opt(this.getProperty(r.PROPERTY_BACKING_OPACITY),(function(e){return e.doubleValue}));if(null!=u?g.LegacyCoreAssert.isTrue(1==l,"for legacy ",void 0,"LockupStyle.fixLegacyProperties","LockupStyle.swift",472):null!=o&&(this.textOpacity=l),this.set(p.FormaStyle.PROPERTY_OPACITY,1),this.backing==i.LockupBacking.None&&1!=this.backingOpacity&&1==this.textOpacity&&(this.textOpacity=this.backingOpacity),null==u&&this.textOpacity!=p.FormaStyle.OPACITY_UNSET&&o==c&&(this.backingOpacity=l),this.backing==i.LockupBacking.LegacyShadow&&(this.backing=i.LockupBacking.None,this.textLook=i.LockupTextLook.Shadow,this.shadowOffset=this.padding+.48,this.shadowOffset>1&&(this.shadowOffset=1)),(e=a.opt(this.getProperty(p.FormaStyle.PROPERTY_COLORS_DEPRECATED),(function(e){return e.arrayValue})))&&(e.length>=1&&(this.colors.fieldPrimary=a.as(s.Codecs.solidColorCodec.decode(e[0],this),_.SolidColor)),e.length>=2&&(this.colors.fieldSecondary=a.as(s.Codecs.solidColorCodec.decode(e[1],this),_.SolidColor))),null!=(t=a.opt(this.getProperty(r.PROPERTY_LAYOUT),(function(e){return e.intValue})))&&null!=(n=i.LockupLayout.toCaseValue(t)))switch(n){case 3:this.set(r.PROPERTY_LAYOUT,i.LockupLayout.Standard),this.set(r.PROPERTY_ALIGNMENT,i.LockupAlignment.Center);break;case 1:this.set(r.PROPERTY_LAYOUT,i.LockupLayout.Standard),this.set(r.PROPERTY_ALIGNMENT,i.LockupAlignment.Left);break;case 2:this.set(r.PROPERTY_LAYOUT,i.LockupLayout.Standard),this.set(r.PROPERTY_ALIGNMENT,i.LockupAlignment.Right)}},setEmptyStyle:function(){this.font=null,this.spacing=-1,this.tracking=r.UNSET_TRACKING,this.relativeFontScale=r.UNSET_RELATIVE_FONT_SCALE,this.padding=0,this.backing=i.LockupBacking.None,this.backingArtworkID=null,this.shadowAngle=-1,this.layout=i.LockupLayout.UNSET,this.textOpacity=p.FormaStyle.OPACITY_UNSET,this.backingOpacity=p.FormaStyle.OPACITY_UNSET,this.textLook=i.LockupTextLook.UNSET,this.shadowOffset=-1,this.strokeWeight=-1;for(var e=[r.PROPERTY_SPACING,r.PROPERTY_TRACKING,r.PROPERTY_SHADOW_ANGLE,r.PROPERTY_SHADOW_OFFSET,r.PROPERTY_LAYOUT,r.PROPERTY_TEXT_OPACITY,r.PROPERTY_BACKING_OPACITY,r.PROPERTY_KNOCKOUT,r.PROPERTY_STROKE_WEIGHT,r.PROPERTY_RELATIVE_FONT_SCALE],t=a.iter(e);!t.done;t.next()){var n=t.value;a.opt(this.state.getProperty(n),(function(e){return e.shouldWrite=!1}))}},needsLayout:function(e){return e.backing!=this.backing||!a.eq(v._equality_TheoFont_TheoFont,e.font,this.font)||e.layout!=this.layout||e.alignment!=this.alignment||e.verticalAlignment!=this.verticalAlignment||e.pathID!=this.pathID||e.customPath!=this.customPath||e.padding!=this.padding||e.spacing!=this.spacing||e.tracking!=this.tracking||e.textLook!=this.textLook||e.strokeWeight!=this.strokeWeight||e.shadowOffset!=this.shadowOffset||e.lineBreakAtCharacterStyleSizeChange!=this.lineBreakAtCharacterStyleSizeChange||e.relativeFontScale!=this.relativeFontScale},sameColors:function(e){if(!(a.eq(_._equality_SolidColor_SolidColor,e.colors.fieldPrimary,this.colors.fieldPrimary)&&a.eq(_._equality_SolidColor_SolidColor,e.colors.fieldSecondary,this.colors.fieldSecondary)&&a.eq(_._equality_SolidColor_SolidColor,e.colors.border,this.colors.border)&&a.eq(_._equality_SolidColor_SolidColor,e.colors.shadow,this.colors.shadow)))return!1;for(var t=a.iter(this.characterStyles);!t.done;t.next()){var n,r=t.key,o=t.value;if(!(n=e.characterStyles[r]))return!1;if(!(a.eq(_._equality_SolidColor_SolidColor,n.colors.fieldPrimary,o.colors.fieldPrimary)&&a.eq(_._equality_SolidColor_SolidColor,n.colors.fieldSecondary,o.colors.fieldSecondary)&&a.eq(_._equality_SolidColor_SolidColor,n.colors.border,o.colors.border)&&a.eq(_._equality_SolidColor_SolidColor,n.colors.shadow,o.colors.shadow)))return!1}return!0},colorLibrary:{get:function(){return p.FormaStyle._getters.colorLibrary.call(this)},set:function(e){p.FormaStyle._setters.colorLibrary.call(this,e);for(var t=a.iter(this.characterStyles);!t.done;t.next())t.value.colorLibrary=e}},ensureCachedCharacterStyles:function(){var e;if(null==this.cachedCharacterStyles_&&(this.cachedCharacterStyles_={},e=a.opt(this.getProperty(r.PROPERTY_CHARSTYLES),(function(e){return e.dictionaryValue}))))for(var t=a.iter(e);!t.done;t.next()){var n,o=t.key,i=t.value;(n=a.as(r.characterStyleCodec.decode(i,this),r))&&(n.colorLibrary=this.colorLibrary,this.cachedCharacterStyles_[o]=n)}},characterStyles:{get:function(){return this.ensureCachedCharacterStyles(),this.cachedCharacterStyles_}},setCharacterStyles:function(e){var t;if(t=this.cachedCharacterStyles_)for(var n=a.iter(t);!n.done;n.next())(s=n.value).colorLibrary=null;this.cachedCharacterStyles_=a.clone(e);for(var o={},i=a.iter(e);!i.done;i.next()){var s,l=i.key;(s=i.value).colorLibrary=this.colorLibrary,o[l]=r.characterStyleCodec.encode(d.DBNamePath.init_b14a(r.PROPERTY_CHARSTYLES).append(l),s,this)}this.setProperty(r.PROPERTY_CHARSTYLES,d.DBProperty.dictProperty(d.DBNamePath.init_b14a(r.PROPERTY_CHARSTYLES),o))},setCharacterStyle:function(e,t){this.ensureCachedCharacterStyles(),this.cachedCharacterStyles_[e]=t,t.colorLibrary=this.colorLibrary;for(var n={},o=a.iter(this.cachedCharacterStyles_);!o.done;o.next()){var i=o.key;t=o.value,n[i]=r.characterStyleCodec.encode(d.DBNamePath.init_b14a(r.PROPERTY_CHARSTYLES).append(i),t,this)}this.setProperty(r.PROPERTY_CHARSTYLES,d.DBProperty.dictProperty(d.DBNamePath.init_b14a(r.PROPERTY_CHARSTYLES),n))},spacing:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_SPACING),"Double"))||null!=e?e:r.DEFAULT_SPACING},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_SPACING,e),this.notifyAfter()}},tracking:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_TRACKING),"Double"))||null!=e?e:r.UNSET_TRACKING},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_TRACKING,e),this.notifyAfter()}},relativeFontScale:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_RELATIVE_FONT_SCALE),"Double"))||null!=e?e:r.UNSET_RELATIVE_FONT_SCALE},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_RELATIVE_FONT_SCALE,e),this.notifyAfter()}},textLook:{get:function(){var e,t;return(e=i.LockupTextLook.toCaseValue((t=a.as(this.get(r.PROPERTY_KNOCKOUT),"Int"))||null!=t?t:i.LockupTextLook.Fill))||null!=e?e:i.LockupTextLook.Fill},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_KNOCKOUT,e),this.notifyAfter()}},padding:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_PADDING),"Double"))||null!=e?e:r.DEFAULT_PADDING},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_PADDING,e),this.notifyAfter()}},backing:{get:function(){var e,t;return(e=i.LockupBacking.toCaseValue((t=a.as(this.get(r.PROPERTY_BACKING),"Int"))||null!=t?t:i.LockupBacking.None))||null!=e?e:i.LockupBacking.Box},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_BACKING,e),this.notifyAfter()}},opacity:{get:function(){return 1},set:function(e){g.LegacyCoreAssert.fail("opacity being set. use controller's applyOpacity instead",void 0,"LockupStyle","LockupStyle.swift",738)}},textOpacity:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_TEXT_OPACITY),"Double"))||null!=e?e:p.FormaStyle.OPACITY_UNSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_TEXT_OPACITY,e),this.notifyAfter()}},backingOpacity:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_BACKING_OPACITY),"Double"))||null!=e?e:p.FormaStyle.OPACITY_UNSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_BACKING_OPACITY,e),this.notifyAfter()}},layout:{get:function(){var e,t;return(e=i.LockupLayout.toCaseValue((t=a.as(this.get(r.PROPERTY_LAYOUT),"Int"))||null!=t?t:i.LockupLayout.UNSET))||null!=e?e:i.LockupLayout.FitJustified},set:function(e){g.LegacyCoreAssert.isFalse(e==i.LockupLayout.SKIP||e==i.LockupLayout.LegacyLeft||e==i.LockupLayout.LegacyCenter||e==i.LockupLayout.LegacyRight,"Unexpected LockupLayout value: "+e,void 0,"LockupStyle","LockupStyle.swift",763),this.notifyBefore(),this.set(r.PROPERTY_LAYOUT,e),this.notifyAfter()}},alignment:{get:function(){var e,t;return(e=i.LockupAlignment.toCaseValue((t=a.as(this.get(r.PROPERTY_ALIGNMENT),"Int"))||null!=t?t:i.LockupAlignment.UNSET))||null!=e?e:i.LockupAlignment.UNSET},set:function(e){g.LegacyCoreAssert.isFalse(e==i.LockupAlignment.SKIP,"LockupAlignment.SKIP is not a settable value",void 0,"LockupStyle","LockupStyle.swift",777),this.notifyBefore(),this.set(r.PROPERTY_ALIGNMENT,e),this.notifyAfter()}},verticalAlignment:{get:function(){var e,t;return(e=i.VerticalLockupAlignment.toCaseValue((t=a.as(this.get(r.PROPERTY_VERTICAL_ALIGNMENT),"Int"))||null!=t?t:i.VerticalLockupAlignment.UNSET))||null!=e?e:i.VerticalLockupAlignment.UNSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_VERTICAL_ALIGNMENT,e),this.notifyAfter()}},pathID:{get:function(){var e,t;return(e=P.TextPathID.toCaseValue((t=a.as(this.get(r.PROPERTY_PATH_ID),"Int"))||null!=t?t:P.TextPathID.UNSET))||null!=e?e:P.TextPathID.UNSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_PATH_ID,e),this.notifyAfter()}},customPath:{get:function(){return a.as(this.get(r.PROPERTY_CUSTOM_PATH),C.TextPath)},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_CUSTOM_PATH,e),this.notifyAfter()}},backingArtworkID:{get:function(){return a.as(this.get(r.PROPERTY_BACKING_ARTWORK_ID),"String")},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_BACKING_ARTWORK_ID,e),this.notifyAfter()}},shadowAngle:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_SHADOW_ANGLE),"Double"))||null!=e?e:r.UNSET_SHADOW_ANGLE},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_SHADOW_ANGLE,e),this.notifyAfter()}},shadowOffset:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_SHADOW_OFFSET),"Double"))||null!=e?e:r.DEFAULT_SHADOWOFFSET},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_SHADOW_OFFSET,e),this.notifyAfter()}},defaultStrokeWeight:{get:function(){return this.textLook==i.LockupTextLook.KnockoutAndOutline?0:r.DEFAULT_STROKEWEIGHT}},strokeWeight:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_STROKE_WEIGHT),"Double"))||null!=e?e:this.defaultStrokeWeight},set:function(e){this.notifyBefore(),this.set(r.PROPERTY_STROKE_WEIGHT,e),this.notifyAfter()}},wheelUsed:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_WHEELUSED),"Bool"))||null!=e?e:r.DEFAULT_WHEELUSED},set:function(e){this.set(r.PROPERTY_WHEELUSED,e)}},font:{get:function(){var e,t=null;return(e=a.as(this.get(r.PROPERTY_FONTS),["Array",v.TheoFont]))&&(g.LegacyCoreAssert.isTrue(e.length<=1,"should only have 1 or 0 fonts",void 0,"LockupStyle","LockupStyle.swift",858),e.forEach((function(e){t=e}))),t},set:function(e){this.notifyBefore(),null!=e?this.set(r.PROPERTY_FONTS,[e]):this.set(r.PROPERTY_FONTS,null),this.notifyAfter()}},lineBreakAtCharacterStyleSizeChange:{get:function(){var e;return!(e=a.as(this.get(r.PROPERTY_LINEBREAK),"Bool"))&&null==e||e},set:function(e){this.set(r.PROPERTY_LINEBREAK,e)}},setBacking:function(e,t){this.notifyBefore(),this.set(r.PROPERTY_BACKING,e),this.set(r.PROPERTY_BACKING_ARTWORK_ID,t),this.notifyAfter()},colorTableSupportsRole:function(e){return e==u.ColorRole.FieldPrimary||e==u.ColorRole.FieldSecondary||e==u.ColorRole.Border||e==u.ColorRole.Shadow},layoutType:{get:function(){if(this.layout==i.LockupLayout.FitJustified)return"justified";if(this.layout==i.LockupLayout.Standard)switch(this.alignment){case 0:return"left";case 2:return"center";case 1:return"right";default:return"error"}return this.layout==i.LockupLayout.Path?"path":this.layout==i.LockupLayout.LetterGrid?"letter-grid":"error"}},backingShapeID:{get:function(){return this.backing==i.LockupBacking.None?"none":this.backing==i.LockupBacking.Rows?"rows":this.backing==i.LockupBacking.BannerHorizontal||this.backing==i.LockupBacking.BannerVertical||this.backing==i.LockupBacking.Banner?"banner":this.backing==i.LockupBacking.SVGBackground?null!=this.backingArtworkID?this.backingArtworkID:"error":this.backing==i.LockupBacking.Knockout?"knockout":"error"}},textLookAsString:{get:function(){var e;switch(this.textLook){case 1:e="knockoutOnly";break;case 2:e="knockoutAndOutline";break;case 3:e="outlineOnly";break;case 4:e="fillAndOutline";break;case 5:e="fillAndOutline2";break;case 7:e="shadow";break;case 8:e="shadowAndOutline";break;case 9:e="knockoutAndShadow";break;case 11:e="knockoutShadowOutline";break;case 10:e="shadowOutlineTransparentText";break;case 0:e="fill";break;case-1:e="unset";break;case-2:e="skip";break;default:e="unknown value"}return e}},currentTextOpacity:{get:function(){return this.textOpacity!=p.FormaStyle.OPACITY_UNSET?this.textOpacity:p.FormaStyle.OPACITY_DEFAULT}},currentBackingOpacity:{get:function(){return this.backingOpacity!=p.FormaStyle.OPACITY_UNSET?this.backingOpacity:p.FormaStyle.OPACITY_DEFAULT}},textBacked:{get:function(){if(this.backing==i.LockupBacking.Box||this.backing==i.LockupBacking.Rows||this.backing==i.LockupBacking.BannerVertical||this.backing==i.LockupBacking.BannerHorizontal||this.textLook==i.LockupTextLook.ShadowAndOutline&&this.strokeWeight>.15)return!0;if(this.backing==i.LockupBacking.SVGBackground){if(null!=this.backingArtworkID&&T.ShapeLibrary.FilledBackingShapes.includes(this.backingArtworkID))return!0;l.CoreAssertDebugOnly.isTrue(null!=this.backingArtworkID,"textBacked has nil backingArtworkID but backing is SVGBackground",void 0,"LockupStyle","LockupStyle.swift",985)}return!1}},shapeSupportsKnockout:{get:function(){if(this.backing==i.LockupBacking.Box||this.backing==i.LockupBacking.Rows||this.backing==i.LockupBacking.BannerVertical||this.backing==i.LockupBacking.BannerHorizontal||this.backing==i.LockupBacking.Knockout)return!0;if(this.backing==i.LockupBacking.SVGBackground){if(null!=this.backingArtworkID&&T.ShapeLibrary.FilledBackingShapes.includes(this.backingArtworkID))return!0;l.CoreAssertDebugOnly.isTrue(null!=this.backingArtworkID,"shapeSupportsKnockout has nil backingArtworkID but backing is SVGBackground",void 0,"LockupStyle","LockupStyle.swift",1003)}return!1}},secondaryColorVisible:{get:function(){return this.backing!=i.LockupBacking.None||r.isOutlineLook(this.textLook)||this.textLook==i.LockupTextLook.Shadow}},asString:{get:function(){var e="";return null!=this.font&&(e+="Font: "+this.font.fontData.postScriptName+"\n"),(e+=this.colors.asString)+" Spacing "+this.spacing+" \n Backing  "+this.backing+" \n Layout  "+this.layout+" "}},isEqual:function(e){return!1},getCompressedStringOfFeatures:function(){var e=a.clone(this.state.allProperties);return this.compressDictToString(e,"{")},compressDictToString:function(e,t){for(var n=t,o=[p.FormaStyle.PROPERTY_ADJUSTMENTS,p.FormaStyle.PROPERTY_KIND],i=[r.PROPERTY_FONTS,p.FormaStyle.PROPERTY_COLORS],s=a.iter(a.keys(e));!s.done;s.next()){var l=s.value;if(!o.includes(l)){var u,c=this.getSmallKey(l);if(i.includes(l))n=this.handleSpecialCases(e,l,c,n);else if(u=a.opt(e[l],(function(e){return e.dictionaryValue})))n+=c+"{|",n=this.compressDictToString(u,n);else{if(a.opt(e[l],(function(e){return e.arrayValue})))continue;var d;if(null!=(d=a.opt(e[l],(function(e){return e.doubleValue})))){var h=y.MathUtils.roundDoubleToString(d,4);n+=c+":"+a.toString(h)+"|"}else null!=(h=a.opt(e[l],(function(e){return e.stringValue})))&&(n+=c+":"+h+"|")}}}return n+="}"},handleSpecialCases:function(e,t,n,o){var i,s,l=o;return t==r.PROPERTY_FONTS&&(i=a.as(this.get(r.PROPERTY_FONTS),["Array",v.TheoFont]))&&(l=this.compressFonts(i,n,l)),t==p.FormaStyle.PROPERTY_COLORS&&(s=a.as(this.get(p.FormaStyle.PROPERTY_COLORS),u.ColorTable))&&(l=this.compressColorTable(s,n,l)),l},getSmallKey:function(e){var t=e.length;return t>4?e.substr(0,2)+e.substr(t-2,2):e},compressFonts:function(e,t,n){for(var r=n+t+":",o=a.iter(a.range(0,e.length,!1));!o.done;o.next()){var i=o.value,s=e[i].fontData.postScriptName;i<e.length-1?r+=s+",":r+=s+"|"}return r},compressColorTable:function(e,t,n){var r=this,o=n+t+":",i=!1;return e.forEachColor((function(e,t,n){var s;if(s=n||a.opt(r.colorLibrary.color(t),(function(e){return e.rgbColor}))){var l="";e==u.ColorRole.FieldPrimary?l="prim":e==u.ColorRole.FieldSecondary?l="seco":e==u.ColorRole.Border?l="bord":e==u.ColorRole.Shadow&&(l="shad"),i&&(o+=","),o+=l+"#"+s.rgbHex,i=!0}})),i&&(o+="|"),o}}}),r)},c2hD:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("URxh"),s=n("tGKA"),l=n("K17h"),u=n("oKlP"),c=n("RkYL"),d=n("xm77");o.MotionSourceFadeInH=(r=function(){},i.defineClass({name:"MotionSourceFadeInH",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=c.TheoTime.Zero,r=c.TheoTime.fromSeconds(1),o=s.Matrix2D.translation(new u.TheoPoint(400,0)),i=s.Matrix2D.Identity,h=l.MotionUtils.createOpacityStyle(e,0),p=e.style.clone();return t.push(new a.KeyFrame(n,d.TimingFunctionType.EaseInOut,o,null,h)),t.push(new a.KeyFrame(r,d.TimingFunctionType.EaseInOut,i,null,p)),t}}}),r)},c3Vl:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("Z25M"),l=n("6ZWm"),u=n("wc1n"),c=n("9Lk3"),d=n("fdtz"),h=n("c+uM"),p=n("K0Rh"),f=n("djAF"),m=n("8t9B");o.DesignStyleFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=i.clone(t),this.featureEvals_=[],u.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"DesignStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["TextSymmetryX",[this.evaluateTextXSymmetry,u.FeatureType.Numerical]],["TextSymmetryY",[this.evaluateTextYSymmetry,u.FeatureType.Numerical]],["Whitespace",[this.evaluateWhiteSpace,u.FeatureType.Numerical]],["DesignAngle",[this.evaluateDesignAngle,u.FeatureType.Numerical]],["TextDesignCoverage",[this.evaluateTextDesignCoverage,u.FeatureType.Numerical]],["ImageDesignCoverage",[this.evaluateImageDesignCoverage,u.FeatureType.Numerical]],["ShapeDesignCoverage",[this.evaluateShapeDesignCoverage,u.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,u.FeatureType.Numerical]],["ImageCount",[this.evaluateImageCount,u.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,u.FeatureType.Numerical]],["LogoCount",[this.evaluateLogoCount,u.FeatureType.Numerical]],["SalientCoverage",[this.evaluateSalientCoverage,u.FeatureType.Numerical]],["MarginSpace",[this.evaluateMarginSpace,u.FeatureType.Numerical]],["TextFonts",[this.evaluateFonts,u.FeatureType.Complex]],["TextShapes",[this.evaluateTextShapes,u.FeatureType.Complex]],["DesignColors",[this.evaluateColors,u.FeatureType.Complex]],["BackgroundTypes",[this.evaluateBackgroundTypes,u.FeatureType.Complex]],["GridCount",[this.evaluateGridCount,u.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,u.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,u.FeatureType.Numerical]],["BackgroundImageCount",[this.evaluateBackgroundImageCount,u.FeatureType.Numerical]],["ForegroundImageCount",[this.evaluateForegroundImageCount,u.FeatureType.Numerical]],["VisualGroupInfo",[this.evaluateVisualGroupInfo,u.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateTextXSymmetry:function(e){var t=i.clone(e.root_.filterByControllerKind(m.TypeLockupController.KIND));return s.DesignFeatureUtils.getSymmAsymmForForma(t,!0)},evaluateTextYSymmetry:function(e){var t=i.clone(e.root_.filterByControllerKind(m.TypeLockupController.KIND));return s.DesignFeatureUtils.getSymmAsymmForForma(t,!1)},evaluateWhiteSpace:function(e){return s.DesignFeatureUtils.evaluateRootEmptySpace(e.root_)},evaluateDesignAngle:function(e){return e.root_.page.pageSize.angle},evaluateTextDesignCoverage:function(e){return s.DesignFeatureUtils.sumAreaOfForma(e.root_.filterByControllerKind(m.TypeLockupController.KIND),e.root_)},evaluateImageDesignCoverage:function(e){return s.DesignFeatureUtils.sumAreaOfForma(e.root_.filterByControllerKind(l.FrameController.KIND),e.root_)},evaluateShapeDesignCoverage:function(e){var t=i.clone(e.root_.filterWithCallback((function(e){return e instanceof f.ShapeForma&&null!=e.controller&&e.controller.floating})));return s.DesignFeatureUtils.sumAreaOfForma(t,e.root_)},evaluateTextCount:function(e){return s.DesignFeatureUtils.getTextCount(e.root_)},evaluateImageCount:function(e){return s.DesignFeatureUtils.getImageCount(e.root_)},evaluateShapeCount:function(e){return s.DesignFeatureUtils.getShapeCount(e.root_)},evaluateLogoCount:function(e){var t=i.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isLogo()})));return i.toDouble(t.length)},evaluateSalientCoverage:function(e){for(var t=i.clone(e.root_.filterByControllerKind(l.FrameController.KIND)),n=0,r=i.iter(t);!r.done;r.next()){var o,a,s,u=r.value;(o=e.root_.finalFrame)&&(a=i.opt(i.as(u,d.ImageForma),(function(e){return e.getFocusRegion()})))&&(s=a.intersectionWith(o))&&(n+=s.area/o.area)}return Math.max(n,1)},evaluateMarginSpace:function(e){var t,n=0,r=i.clone(e.root_.filterByControllerKind(c.GridController.KIND));return r.length>0&&(t=i.as(r[0].controller,c.GridController))&&(n=t.margin),n},evaluateVisualGroupInfo:function(e){return i.toDouble(0)},evaluateFonts:function(e){for(var t=[],n=i.iter(s.DesignFeatureUtils.getLockupsInDesign(e.root_));!n.done;n.next()){var r,o,a=n.value;(r=i.as(a.style,h.LockupStyle))&&(o=r.font)&&t.push(o.fontData.postScriptName)}return t},evaluateTextShapes:function(e){for(var t=[],n=i.iter(s.DesignFeatureUtils.getLockupsInDesign(e.root_));!n.done;n.next()){var r,o=n.value;(r=i.as(o.style,h.LockupStyle))&&t.push(r.backingShapeID)}return t},evaluateColors:function(e){for(var t=[],n=i.clone(e.root_.filterWithCallback((function(e){return e instanceof d.ImageForma}))),r=i.iter(n);!r.done;r.next()){var o,a,l=r.value;(o=i.as(l,d.ImageForma))&&(a=i.opt(o.contentNode,(function(e){return e.image})))&&i.append(t,a.getImageColors(5))}for(var u=i.iter(s.DesignFeatureUtils.getLockupsInDesign(e.root_));!u.done;u.next()){var c,p,f,m,g=u.value;(c=i.as(g.style,h.LockupStyle))&&((f=e.primaryColorForStyle(c))&&t.push(f),(m=e.secondaryColorForStyle(c))&&t.push(m),(p=c.characterStyles.Highlight)&&((f=e.primaryColorForStyle(p))&&t.push(f),(m=e.secondaryColorForStyle(p))&&t.push(m)))}return t.map((function(e){return e.hex}),this)},primaryColorForStyle:function(e){return e.colors.color(a.ColorRole.FieldPrimary)},secondaryColorForStyle:function(e){return e.backing!=h.LockupBacking.None&&e.backing!=h.LockupBacking.UNSET?e.colors.color(a.ColorRole.FieldSecondary):null},evaluateBackgroundTypes:function(e){for(var t=[],n=i.clone(e.root_.filterWithCallback((function(e){return(e.isBackgroundImage()||e.kind==f.ShapeForma.KIND||e.kind==p.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable}))),r=i.iter(n);!r.done;r.next()){var o=r.value;o.isBackgroundImage()?t.push("image"):o.kind==f.ShapeForma.KIND?t.push("shape"):t.push("root")}return t},evaluatePageWidth:function(e){return s.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return s.DesignFeatureUtils.getPageHeight(e.root_)},evaluateGridCount:function(e){return i.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==c.GridController.KIND&&e.isGridCell()})).length)},evaluateBackgroundImageCount:function(e){return i.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==l.FrameController.KIND&&e.isGridCell()})).length)},evaluateForegroundImageCount:function(e){return i.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==l.FrameController.KIND&&!e.isGridCell()})).length)}}}),r)},cYKp:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.AnimationFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"AnimationFacade",ctor:r,superName:"CoreObject",statics:{applyAnimationStyle:function(e,t){t.animationLibrary.modifyModelForAnimation(e,t.root)},shuffleAnimationStyle:function(e,t){return t.animationLibrary.getNextAnimationStyleOfSameType(e)}}}),r)},cZuM:function(e,t,n){var r,o,i,a,s,l,u=t,c=n("oAGj"),d=n("gXiO"),h=n("FNB+"),p=n("fdtz"),f=n("lmwz"),m=n("fNpk"),g=n("c+uM"),y=n("tGKA"),_=n("Zifs"),T=n("T6jX"),v=n("MnRR"),C=n("8t9B"),P=n("oKlP");u.AlignmentEdges=c.defineEnum("AlignmentEdges",{None:0,Left:1,Right:2,LeftAndRight:3,Top:4,Bottom:8,CenterX:16,CenterY:32,TopAndBottom:12,LeftAndTopAndBottom:13,Outer:15,All:63}),u.describeAlignmentType=function(e){switch(e){case 0:return"Left";case 1:return"CenterX";case 2:return"Right";case 3:return"Top";case 4:return"CenterY";case 5:return"Bottom";case 6:return"Rotation";case 7:return"None"}},u.AlignmentType=c.defineEnum("AlignmentType",{Left:0,CenterX:1,Right:2,Top:3,CenterY:4,Bottom:5,Rotation:6,None:7}),u.AlignmentLocation=c.defineEnum("AlignmentLocation",{Forma:0,Root:1}),u.LineStyle=c.defineEnum("LineStyle",{Dashed:0,Solid:1}),u.AlignmentLine=(r=function(e,t,n,r,o,i,a){void 0===a&&(a=u.LineStyle.Dashed),this.type=e,this.location=t,this.color=n,this.line=r,this.text=o,this.lineStyle=a,this.coordinateSpace=i},c.defineClass({name:"AlignmentLine",ctor:r,superName:"CoreObject",statics:{DASH_WIDTH:4,DASH_GAP_WIDTH:4,LINE_EXTENSION:24,ROTATION_LINE_EXTENSION:40,LINE_WEIGHT:1}}),r),u.FormaAlignment=(o=function(e,t,n){this.forma=e,this.offset=t,this.line=n},c.defineClass({name:"FormaAlignment",ctor:o,props:{clone:function(){return new o(this.forma,this.offset,this.line)}}}),o),u.FormaAlignmentLines=(i=function(){},c.defineClass({name:"FormaAlignmentLines",ctor:i,props:{init_a036:function(e,t){this.forma=e,this.lines=c.clone(t)},init_implicit:function(e,t){this.forma=e,this.lines=c.clone(t)},clone:function(){return i.init_implicit(this.forma,this.lines)}}}),i),u.FormaAlignmentSlope=(a=function(){},c.defineClass({name:"FormaAlignmentSlope",ctor:a,props:{init_c8bd:function(e,t,n){this.forma=e,this.rise=t,this.run=n},init_implicit:function(e,t,n){this.forma=e,this.rise=t,this.run=n},clone:function(){return a.init_implicit(this.forma,this.rise,this.run)}}}),a),u.AlignmentDetector=(s=function(){this.horizontalAlignments=[u.AlignmentType.CenterY,u.AlignmentType.Top,u.AlignmentType.Bottom],this.verticalAlignments=[u.AlignmentType.CenterX,u.AlignmentType.Left,u.AlignmentType.Right],this.boundaryAlignments=[u.AlignmentType.Left,u.AlignmentType.Right,u.AlignmentType.Top,u.AlignmentType.Bottom],this.otherFormae_=null},l={},c.defineClass({name:"AlignmentDetector",ctor:s,superName:"CoreObject",statics:{DISTANCE_THRESHOLD:20,SNAP_ANGLE_THRESHOLD:{get:function(){return void 0===l.SNAP_ANGLE_THRESHOLD&&(l.SNAP_ANGLE_THRESHOLD=Math.PI/64),l.SNAP_ANGLE_THRESHOLD}},ANGULAR_THRESHOLD:{get:function(){return void 0===l.ANGULAR_THRESHOLD&&(l.ANGULAR_THRESHOLD=2*Math.PI/180),l.ANGULAR_THRESHOLD}},ALIGNMENT_FORMA:{get:function(){return void 0===l.ALIGNMENT_FORMA&&(l.ALIGNMENT_FORMA=new _.SolidColor(0,1,1,1)),l.ALIGNMENT_FORMA}},ALIGNMENT_ROOT:{get:function(){return void 0===l.ALIGNMENT_ROOT&&(l.ALIGNMENT_ROOT=new _.SolidColor(1,0,1,1)),l.ALIGNMENT_ROOT}},ALIGNMENT_ROTATION:{get:function(){return void 0===l.ALIGNMENT_ROTATION&&(l.ALIGNMENT_ROTATION=new _.SolidColor(1,78/255,79/255,1)),l.ALIGNMENT_ROTATION}}},props:{init_a00d:function(e,t){void 0===t&&(t=null),this.forma_=e,this.possibleAlignmentLines_=[],this.possibleAngularAlignments_=[],this.otherFormae_=c.clone(t),d.CoreObject.call(this),this.update(!0)},init_f94b:function(e){this.init_a00d(c.first(e))},possibleAlignmentLines:{get:function(){return this.possibleAlignmentLines_}},isVerticalAlignment:function(e){return this.verticalAlignments.includes(e)},isHorizontalAlignment:function(e){return this.horizontalAlignments.includes(e)},isBoundaryAlignment:function(e){return this.boundaryAlignments.includes(e)},alignmentLineCompatible:function(e,t,n,r,o){if(void 0===o&&(o=!0),e.hasIntent(h.Forma.INTENT_GRID_CELL)&&e.finalFrame.contains(t.finalFrame))return!1;if(!o)for(var i=[e.controller,t.controller],a=c.iter(i);!a.done;a.next()){var l,d=a.value;if((l=c.as(d,C.TypeLockupController))&&(f=l.lockupStyle)&&l.numLines()>1){var p=d==e.controller?n.type:r.type;if(p==u.AlignmentType.Left&&g.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=g.LockupAlignment.Left)return!1;if(p==u.AlignmentType.Right&&g.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=g.LockupAlignment.Right)return!1;if(p==u.AlignmentType.CenterX&&g.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=g.LockupAlignment.Center)return!1}}if(n.type==r.type)return!0;var f,m,y=this.isVerticalAlignment(n.type),T=this.isVerticalAlignment(r.type);if(o&&!c.eq(_._equality_SolidColor_SolidColor,n.color,s.ALIGNMENT_ROOT)&&!c.eq(_._equality_SolidColor_SolidColor,r.color,s.ALIGNMENT_ROOT)&&y==T&&this.isBoundaryAlignment(n.type)&&this.isBoundaryAlignment(r.type))return!0;if((f=c.as(t.style,g.LockupStyle))&&(m=c.as(e.style,g.LockupStyle))&&f.backing!=g.LockupBacking.None&&!g.LockupStyle.isShadowLook(f.textLook)&&m.backing!=g.LockupBacking.None&&!g.LockupStyle.isShadowLook(m.textLook)&&this.boundaryAlignments.includes(n.type)&&this.boundaryAlignments.includes(r.type))return!0;var v=this.horizontalAlignments.includes(n.type),P=this.horizontalAlignments.includes(r.type);return!!(v&&!P||!v&&P)},mergeLines:function(e,t){var n,r;m.LegacyCoreAssert.isTrue(c.eq(h._equality_Forma_Forma,e.coordinateSpace,t.coordinateSpace),"coordinate spaces of alignment lines to merge don't match",{first:(n=c.opt(e.coordinateSpace,(function(e){return e.formaID})))||null!=n?n:"nil",second:(r=c.opt(t.coordinateSpace,(function(e){return e.formaID})))||null!=r?r:"nil"},"AlignmentDetector.mergeLines","AlignmentDetector.swift",244);var o=c.eq(_._equality_SolidColor_SolidColor,e.color,s.ALIGNMENT_ROOT)||c.eq(_._equality_SolidColor_SolidColor,t.color,s.ALIGNMENT_ROOT)?s.ALIGNMENT_ROOT:s.ALIGNMENT_FORMA,i=e.location==u.AlignmentLocation.Root||t.location==u.AlignmentLocation.Root?u.AlignmentLocation.Root:u.AlignmentLocation.Forma;return new u.AlignmentLine(e.type,i,o,t.line.unionWith(e.line),e.text&&t.text,e.coordinateSpace)},update:function(e){void 0===e&&(e=!1);var t,n,r,o=this;if(null!=this.forma_&&!c.opt(this.forma_,(function(e){return null==e.root}))){this.possibleAlignmentLines_=[],this.possibleAngularAlignments_=[u.FormaAlignmentSlope.init_c8bd(null,0,1),u.FormaAlignmentSlope.init_c8bd(null,1,1),u.FormaAlignmentSlope.init_c8bd(null,1,0),u.FormaAlignmentSlope.init_c8bd(null,-1,1)];for(var i,a=c.opt(c.opt(c.opt(this.forma_,(function(e){return e.root})),(function(e){return e.finalFrame})),(function(e){return e.area})),s=c.clone(this.otherFormae_||this.forma_.root.visitAsArray(h.FormaTraversal.PreOrder)),l={},d=c.iter(s);!d.done;d.next()){var f=d.value;if(!(null==f.controller||f.kind==p.ImageForma.KIND||(i=f,null!=i.visit(h.FormaTraversal.NearestAncestor,(function(e,t,n){return c.eq(h._equality_Forma_Forma,e,o.forma_)})))||((t=c.opt(f.finalFrame,(function(e){return e.area})))||null!=t?t:0)/((n=a)||null!=n?n:.001)<.001)){this.possibleAlignmentLines_.push(u.FormaAlignmentLines.init_a036(f,f.controller.getAlignments(e))),l[f.formaID]=(r=c.opt(this.forma_.finalFrame,(function(e){return e.L1Distance(f.finalFrame)})))||null!=r?r:0;var m=f.totalPlacement.transformValues,g=c.clone(u.FormaAlignmentSlope.init_c8bd(f,m.rotSine,m.rotCosine));g.run<0&&(g.rise=-g.rise,g.run=-g.run),0!=g.rise&&0!=g.run&&this.possibleAngularAlignments_.push(g)}}var y=T.TheoDocumentUtils.HIGH_DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD;this.possibleAlignmentLines_.length>y&&(c.sortInPlace(this.possibleAlignmentLines_,(function(e,t){return l[e.forma.formaID]<l[t.forma.formaID]})),this.possibleAlignmentLines_=this.possibleAlignmentLines_.splice(0,y))}},detectFormaAlignments:function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===r&&(r=!1),r||this.update(t);for(var o=[],i=c.iter(this.forma_.controller.getAlignments());!i.done;i.next())for(var a=i.value,l=c.iter(this.possibleAlignmentLines_);!l.done;l.next())for(var d=l.value,h=c.iter(d.lines);!h.done;h.next()){var p=h.value;if(this.alignmentLineCompatible(this.forma_,d.forma,a,p,n)){var f=p.line.projectionOffset(a.line.p2),m=p.line.projectionOffset(a.line.p1),g=f.add(m).multiply(.5),y=a.line.angleWith(p.line)%Math.PI;if(g.length()<e&&Math.abs(y)<s.ANGULAR_THRESHOLD){var _=this.mergeLines(a,p);o.push(new u.FormaAlignment(d.forma,g,_))}}}return o},formaAlignmentDistances:function(e){for(var t=c.clone(this.detectFormaAlignments(1/0)),n=[],r=c.iter(t);!r.done;r.next()){var o=r.value;o.line.type==e&&n.push(o)}return n},rotationIndicatorForForma:function(e,t,n,r){var o=[];if(null!=e){var i=e.root,a=e.bounds,l=a.eval(t),c=a.eval(P._plus_TheoPoint_TheoPoint(t,new P.TheoPoint(.5,0))),d=new v.TheoLine(l,c).transform(n),h=new v.TheoLine(d.p1,P._plus_TheoPoint_TheoPoint(d.p1,new P.TheoPoint(d.length,0)));o.push(new u.AlignmentLine(u.AlignmentType.Rotation,u.AlignmentLocation.Forma,s.ALIGNMENT_ROTATION,d,!1,i,r)),o.push(new u.AlignmentLine(u.AlignmentType.Rotation,u.AlignmentLocation.Forma,s.ALIGNMENT_ROTATION,h,!1,i,r))}return o},snapped_Placement:function(e,t,n,r){void 0===r&&(r=!1);var o=null,i=c.clone(this.detectFormaAlignments(t,void 0,void 0,r)),a=[];if(f.ImageFacade.inCropMode(this.forma_))return[o,a];if(null!=e){for(var l=this.forma_.totalPlacement.transformValues,d={rise:l.rotSine,run:l.rotCosine},p=Math.atan2(d.rise,d.run),m=Math.atan2(-d.rise,-d.run),g=c.clone(u.FormaAlignmentSlope.init_c8bd(null,0,0)),_=1/0,T=[],v=c.iter(this.possibleAngularAlignments_);!v.done;v.next()){var S=v.value,D=Math.atan2(S.rise,S.run),A=function(e){var t=Math.abs(D-e);(t<_||t<s.SNAP_ANGLE_THRESHOLD)&&(t<_&&(g=c.clone(S),_=t),T.push({forma:S.forma,difference:t}))};A(p),A(m)}if(_<s.SNAP_ANGLE_THRESHOLD){l.rotCosine*g.run+l.rotSine*g.rise<0&&(g.run=-g.run,g.rise=-g.rise);var E=g.run,R=g.rise,F=($=this.forma_.totalPlacement).transformPoint(this.forma_.bounds.eval(e)),b=$.inverse,I=($=($=($=$.translateXY(-F.x,-F.y)).rotateTo(E,R)).translateXY(F.x,F.y)).concat(b);o=this.forma_.placement.inverse.concat(I).concat(this.forma_.placement);for(var O=u.LineStyle.Dashed,k=c.clone(this.rotationIndicatorForForma(this.forma_,e,$,O)),N=c.iter(k);!N.done;N.next()){var M=N.value;a.push(M)}for(var L=c.iter(T);!L.done;L.next()){var x=L.value,B=x.difference,w=x.forma;if(Math.abs(B-_)<.001)for(var G=c.clone(this.rotationIndicatorForForma(w,new P.TheoPoint(.5,.5),c.opt(w,(function(e){return e.totalPlacement})),O)),Y=c.iter(G);!Y.done;Y.next())M=Y.value,a.push(M)}}}else{for(var U=c.iter([this.verticalAlignments,this.horizontalAlignments]);!U.done;U.next()){for(var j=U.value,V=(_=1/0,null),H=[],K=!1,W=c.iter(i);!W.done;W.next()){var X=(J=W.value).line,z=this.isVerticalAlignment(X.type);if(j.includes(J.line.type))if(null==V)V=J.offset,H.push(X),K=X.location==u.AlignmentLocation.Root,_=z?J.offset.x:J.offset.y;else{var q=z?Math.abs(Math.round(V.x)-Math.round(J.offset.x)):Math.abs(Math.round(V.y)-Math.round(J.offset.y));q<.001?(H.push(X),X.location==u.AlignmentLocation.Root&&(K=!0)):q<_&&(H.splice(0),H.push(X),V=J.offset,K=X.location==u.AlignmentLocation.Root,_=q)}}if(K&&(H=H.filter((function(e){return e.location==u.AlignmentLocation.Root}),this)),null!=V){for(var Z=c.iter(H);!Z.done;Z.next()){var J=Z.value;a.push(J)}var Q=y.Matrix2D.translationXY(V.x,V.y);if(null!=o){o=c.opt(o,(function(e){return e.concat(Q)}));break}o=Q}}var $;if(null!=o)b=($=this.forma_.totalPlacement).inverse,I=($=$.concat(o)).concat(b),o=this.forma_.placement.inverse.concat(I).concat(this.forma_.placement)}return n&&(a=[],this.forma_.root.visitAll(h.FormaTraversal.PreOrder,(function(e){var t;if(t=c.as(e.controller,C.TypeLockupController))for(var n=c.iter(t.getAlignments());!n.done;n.next()){var r=n.value;a.push(r)}}))),[o,a]}}}),s)},cbNz:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("FNB+"),s=n("6ZWm"),l=n("wc1n"),u=n("cmoc"),c=n("tQF8"),d=n("4mVB"),h=n("fNpk"),p=n("Dq5S"),f=n("8t9B"),m=n("oKlP"),g=n("sIWg"),y=n("1NAc");o.GridStyleFeatureExtractor=(r=function(e,t,n,r,o,a,s){var u,c,f;if(this.imageCells_=[],this.floatingCells_=[],this.adjacentImageCount_=0,this.cellXSymm_=0,this.cellYSymm_=0,void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=[]),h.LegacyCoreAssert.isTrue(null!=r||null!=t||null!=i.as(i.opt(e,(function(e){return e.style})),d.GridStyle),"gridStyle or mapping must be provided or forma style must be  a grid style",void 0,"GridStyleFeatureExtractor.init","GridStyleFeatureExtractor.swift",50),(u=t)?this.mapping_=i.clone(u):(this.gridStyle_=r||e.style,this.mapping_=i.clone(this.gridStyle_.formaMapping)),this.gridFrame_=o||e.frame,(c=n)?this.gridCells_=i.clone(c):this.gridCells_=i.clone(this.gridStyle_.gridCellArray),null!=a)this.layoutItems_=i.clone(a);else if(this.layoutItems_=[],f=e)for(var m=i.clone(f.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating||e.isBackgroundImage()}))),g=i.iter(m);!g.done;g.next()){var y=g.value;this.layoutItems_.push(p.LayoutItem.init_b14a(y))}this.currentGrid_=e,this.forFeatures_=i.clone(s),this.featureEvals_=[],l.FeatureExtractor.call(this),this.imageCells_=i.clone(this.getTypeOfCell(p.ItemContentType.Image)),this.floatingCells_=i.clone(this.getTypeOfCell(p.ItemContentType.Floating)),this.adjacentImageCount_=0;for(var _=i.iter(this.imageCells_);!_.done;_.next())for(var T=_.value,v=i.iter(this.imageCells_);!v.done;v.next()){var C=v.value;this.isAdjacent(T,C)&&T!==C&&(this.adjacentImageCount_+=1)}this.cellXSymm_=this.getCellSymmAsymm(!0),this.cellYSymm_=this.getCellSymmAsymm(!1),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"GridStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["CellAspectRatio",[this.evaluateCellAspectRatio,l.FeatureType.Numerical]],["AreaPercentImages",[this.evaluateAreaPercentImages,l.FeatureType.Numerical]],["ImageCellContentFit",[this.evaluateImageCellContentFit,l.FeatureType.Numerical]],["AverageCellSize",[this.evaluateAverageCellSize,l.FeatureType.Numerical]],["AverageImageCellSize",[this.evaluateAverageImageCellSize,l.FeatureType.Numerical]],["AverageTextCellSize",[this.evaluateAverageTextCellSize,l.FeatureType.Numerical]],["ImageCellVariance",[this.evaluateImageCellVariance,l.FeatureType.Numerical]],["TextCellVariance",[this.evaluateTextCellVariance,l.FeatureType.Numerical]],["OverallCellVariance",[this.evaluateOverallCellVariance,l.FeatureType.Numerical]],["TypeSymmetryAcrosstheXAxis",[this.evaluateXAxisTypeSymmetry,l.FeatureType.Numerical]],["TypeSymmetryAcrosstheYAxis",[this.evaluateYAxisTypeSymmetry,l.FeatureType.Numerical]],["TypeAsymmetryAcrosstheXAxis",[this.evaluateXAxisTypeAsymmetry,l.FeatureType.Numerical]],["TypeAsymmetryAcrosstheYAxis",[this.evaluateYAxisTypeAsymmetry,l.FeatureType.Numerical]],["CellSymmetryAcrosstheXAxis",[this.evaluateXAxisCellSymmetry,l.FeatureType.Numerical]],["CellSymmetryAcrosstheYAxis",[this.evaluateYAxisCellAsymmetry,l.FeatureType.Numerical]],["CellAsymmetryAcrosstheXAxis",[this.evaluateXAxisCellSymmetry,l.FeatureType.Numerical]],["CellAsymmetryAcrosstheYAxis",[this.evaluateYAxisCellAsymmetry,l.FeatureType.Numerical]],["AverageImageXVal",[this.evaluateAverageImageXVal,l.FeatureType.Numerical]],["AverageImageYVal",[this.evaluateAverageImageYVal,l.FeatureType.Numerical]],["AverageTextXVal",[this.evaluateAverageTextXVal,l.FeatureType.Numerical]],["AverageTextYVal",[this.evaluateAverageTextYVal,l.FeatureType.Numerical]],["ImageSpreadinXDimension",[this.evaluateImageXSpread,l.FeatureType.Numerical]],["ImageSpreadinYDimension",[this.evaluateImageYSpread,l.FeatureType.Numerical]],["TextSpreadinXDimension",[this.evaluateTextXSpread,l.FeatureType.Numerical]],["TextSpreadinYDimension",[this.evaluateTextYSpread,l.FeatureType.Numerical]],["MaxImageXOffsetFromCenter",[this.evaluateMaxImageXOffsetFromCenter,l.FeatureType.Numerical]],["MaxImageYOffsetFromCenter",[this.evaluateMaxImageYOffsetFromCenter,l.FeatureType.Numerical]],["MaxTextXOffsetFromCenter",[this.evaluateMaxTextXOffsetFromCenter,l.FeatureType.Numerical]],["MaxTextYOffsetFromCenter",[this.evaluateMaxTextYOffsetFromCenter,l.FeatureType.Numerical]],["TextFocused",[this.evaluateTextFocused,l.FeatureType.Numerical]],["TextDispersement",[this.evaluateTextDispersement,l.FeatureType.Numerical]],["AdjacentMatches",[this.evaluateAdjacentMatch,l.FeatureType.Numerical]],["AdjacentMismatches",[this.evaluateAdjacentMismatch,l.FeatureType.Numerical]],["PreviousOrder",[this.evaluatePreviousOrder,l.FeatureType.Numerical]],["PreviousPosition",[this.evaluatePreviousPosition,l.FeatureType.Numerical]],["PreviousPositionFlip",[this.evaluatePreviousPositionFlip,l.FeatureType.Numerical]],["PreviousImageSize",[this.evaluatePreviousImageSize,l.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateCellAspectRatio:function(e){for(var t=0,n=i.iter(e.gridCells_);!n.done;n.next()){var r=n.value,o=e.gridFrame_.evalRect(r.bounds),a=Math.max(o.aspectRatio,1/o.aspectRatio);h.LegacyCoreAssert.isTrue(a>0,"cell aspect ratio must be positive",void 0,"GridStyleFeatureExtractor.evaluateCellAspectRatio","GridStyleFeatureExtractor.swift",176),t+=a}return t/i.toDouble(e.gridCells_.length)},evaluateImageCellContentFit:function(e){for(var t=0,n=0,r=i.iter(e.layoutItems_);!r.done;r.next()){var o,a,s,l=r.value;if(l.type==p.ItemContentType.Image&&(o=i.opt(e.mapping_[l.id],(function(e){return e.bounds})))&&null!=(a=l.width)&&null!=(s=l.height)){var u=e.gridFrame_.evalRect(o),c=g.TheoRect.fromSize(new y.TheoSize(i.toDouble(a),i.toDouble(s)));t+=u.similarity(c),n+=1}}return t/(i.toDouble(n)+1e-5)},evaluateAreaPercentImages:function(e){return e.getCellAreaSum(e.getImageCells())/e.gridFrame_.area},evaluateAverageCellSize:function(e){return 1/i.toDouble(e.gridCells_.length)},evaluateAverageImageCellSize:function(e){var t=i.clone(e.getImageCells());return 0!=t.length?e.getCellAreaSum(t)/i.toDouble(t.length)/e.gridFrame_.area:0},evaluateAverageTextCellSize:function(e){var t=i.clone(e.getFloatingCells());return 0!=t.length?e.getCellAreaSum(t)/i.toDouble(t.length)/e.gridFrame_.area:0},evaluateImageCellVariance:function(e){return e.getVariance(e.getImageCells())},evaluateTextCellVariance:function(e){return e.getVariance(e.getFloatingCells())},evaluateOverallCellVariance:function(e){var t=i.clone(e.getFloatingCells()),n=i.clone(e.getImageCells()),r=e.getMaxandMinCellArea(n),o=r[0],a=r[1],s=e.getMaxandMinCellArea(t),l=s[0],u=s[1],c=Math.max(o,l),d=Math.min(a,u);return Math.abs((c-d)/e.gridFrame_.area)},evaluateXAxisTypeSymmetry:function(e){return e.getSymmAsymm(e.getImageCells(),e.getImageCells(),!0,1)},evaluateYAxisTypeSymmetry:function(e){return e.getSymmAsymm(e.getImageCells(),e.getImageCells(),!1,1)},evaluateXAxisTypeAsymmetry:function(e){return 2*e.getSymmAsymm(e.getImageCells(),e.getFloatingCells(),!0,0)},evaluateYAxisTypeAsymmetry:function(e){return 2*e.getSymmAsymm(e.getImageCells(),e.getFloatingCells(),!1,0)},evaluateXAxisCellSymmetry:function(e){return e.cellXSymm_},evaluateYAxisCellSymmetry:function(e){return e.cellYSymm_},evaluateXAxisCellAsymmetry:function(e){return 1-e.cellXSymm_},evaluateYAxisCellAsymmetry:function(e){return 1-e.cellYSymm_},evaluateAverageImageXVal:function(e){return e.getAverageVal(e.getImageCells(),!0)},evaluateAverageImageYVal:function(e){return e.getAverageVal(e.getImageCells(),!1)},evaluateAverageTextXVal:function(e){return e.getAverageVal(e.getFloatingCells(),!0)},evaluateAverageTextYVal:function(e){return e.getAverageVal(e.getFloatingCells(),!1)},evaluateImageXSpread:function(e){return e.getSpread(e.getImageCells(),!0)},evaluateImageYSpread:function(e){return e.getSpread(e.getImageCells(),!1)},evaluateTextXSpread:function(e){return e.getSpread(e.getFloatingCells(),!0)},evaluateTextYSpread:function(e){return e.getSpread(e.getFloatingCells(),!1)},evaluateMaxImageXOffsetFromCenter:function(e){return e.getOffsetFromCenter(e.getImageCells(),!0)},evaluateMaxImageYOffsetFromCenter:function(e){return e.getOffsetFromCenter(e.getImageCells(),!1)},evaluateMaxTextXOffsetFromCenter:function(e){return e.getOffsetFromCenter(e.getFloatingCells(),!0)},evaluateMaxTextYOffsetFromCenter:function(e){return e.getOffsetFromCenter(e.getFloatingCells(),!1)},evaluateTextFocused:function(e){var t=i.clone(e.getFloatingCells());return 1==t.length&&e.gridFrame_.area>0?t[0].bounds.area/e.gridFrame_.area:0},evaluateTextDispersement:function(e){for(var t=i.clone(e.getFloatingCells()),n=0,r=i.iter(e.layoutItems_);!r.done;r.next()){var o=r.value;null!=e.mapping_[o.id]&&o.type==p.ItemContentType.Floating&&(n+=1)}return i.toDouble(t.length)/(n+.001)},evaluateAdjacentMatch:function(e){for(var t=0,n=0,r=i.clone(e.getFloatingCells()),o=i.clone(e.getImageCells()),a=i.iter(r);!a.done;a.next())for(var s=a.value,l=i.iter(r);!l.done;l.next()){for(var u=l.value,c=i.iter(o);!c.done;c.next()){var d=c.value;e.isAdjacent(s,d)&&(n+=1)}e.isAdjacent(s,u)&&s!==u&&(t+=1,n+=1)}return n+=e.adjacentImageCount_,t+=e.adjacentImageCount_,n>0?i.toDouble(t)/i.toDouble(n):0},evaluateAdjacentMismatch:function(e){for(var t=0,n=0,r=i.clone(e.getFloatingCells()),o=i.clone(e.getImageCells()),a=i.iter(r);!a.done;a.next())for(var s=a.value,l=i.iter(r);!l.done;l.next()){for(var u=l.value,c=i.iter(o);!c.done;c.next()){var d=c.value;e.isAdjacent(s,d)&&(n+=1,t+=1)}e.isAdjacent(s,u)&&s!==u&&(n+=1)}return(n+=e.adjacentImageCount_)>0?i.toDouble(t)/i.toDouble(n):0},evaluatePreviousPosition:function(e){return e.getPreviousPos(!1)},evaluatePreviousPositionFlip:function(e){return e.getPreviousPos(!0)},evaluatePreviousImageSize:function(e){var t;if(t=e.currentGrid_){for(var n=t.root,r=0,o={},a=i.iter(i.keys(e.mapping_));!a.done;a.next()){var s=a.value;o[s]=e.mapping_[s]}for(var l=i.iter(o);!l.done;l.next()){var u,c=l.key,d=l.value,h=t.page.formaByID(c);if(null!=h&&(u=h.finalFrame)){var p=n.finalFrame.size,f=i.opt(t.finalFrame,(function(e){return e.evalRect(d.bounds)}));h.isImage()&&null!=f&&(r+=Math.abs(u.area-f.area)/(p.width*p.height))}}return r}return 0},evaluatePreviousOrder:function(e){var t;if(t=e.currentGrid_){t.root;for(var n=[],r=[],o=i.clone(e.getImageCells()),l=i.clone(e.getFloatingCells()),d=[],h=i.iter(i.range(0,e.gridCells_.length,!1));!h.done;h.next())d.push(null);for(var p={},g=i.iter(i.keys(e.mapping_));!g.done;g.next()){var y=g.value;p[y]=e.mapping_[y]}for(var _=i.iter(p);!_.done;_.next()){var T=_.key,v=_.value,C=t.page.formaByID(T);i.opt(i.opt(C,(function(e){return e.controller})),(function(e){return e.kind==s.FrameController.KIND}))&&(i.containsEq(o,v,c._equality_GridCell_GridCell)||o.push(v),n.push({cell:v,forma:C})),i.opt(i.opt(C,(function(e){return e.controller})),(function(e){return e.kind==f.TypeLockupController.KIND}))&&(i.containsEq(l,v,c._equality_GridCell_GridCell)||l.push(v),r.push({cell:v,forma:C}))}var P=i.clone(t.root.filterByKind(u.FrameForma.KIND));i.sortInPlace(P,(function(e,t){return e.frame.center.distanceTo(m.TheoPoint.ZERO)<t.frame.center.distanceTo(m.TheoPoint.ZERO)})),i.sortInPlace(n,(function(e,t){return e.cell.bounds.origin.distanceTo(m.TheoPoint.ZERO)<t.cell.bounds.origin.distanceTo(m.TheoPoint.ZERO)}));var S=i.clone(t.root.filterByControllerKind(f.TypeLockupController.KIND));i.sortInPlace(S,(function(e,t){return e.frame.center.distanceTo(m.TheoPoint.ZERO)<t.frame.center.distanceTo(m.TheoPoint.ZERO)})),i.sortInPlace(l,(function(e,t){return e.bounds.center.distanceTo(m.TheoPoint.ZERO)<t.bounds.center.distanceTo(m.TheoPoint.ZERO)}));for(var D=0,A=i.iter(i.range(0,n.length,!1));!A.done;A.next()){var E=n[M=A.value].forma;null!=(L=i.indexOfEq(P,E,a._equality_Forma_Forma))&&L!=M&&(D+=1)}for(var R=[],F=i.iter(l);!F.done;F.next()){for(var b=F.value,I=[],O=i.iter(r);!O.done;O.next()){var k=O.value;i.eq(c._equality_GridCell_GridCell,k.cell,b)&&I.push(k.forma)}i.sortInPlace(I,(function(e,t){return e.finalFrame.origin.distanceTo(m.TheoPoint.ZERO)<t.finalFrame.origin.distanceTo(m.TheoPoint.ZERO)})),i.append(R,I)}for(var N=i.iter(i.range(0,R.length,!1));!N.done;N.next()){var M,L,x=R[M=N.value];null!=(L=i.indexOfEq(S,x,a._equality_Forma_Forma))&&L!=M&&(D+=1)}return D}return 0},getPreviousPos:function(e){var t;if(t=this.currentGrid_){for(var n=t.root,r=0,o={},a=i.iter(i.keys(this.mapping_));!a.done;a.next()){var s=a.value;o[s]=this.mapping_[s]}for(var l=i.iter(o);!l.done;l.next()){var u,c=l.key,d=l.value,p=t.page.formaByID(c);if(null!=p&&(u=p.finalFrame)){var f=n.finalFrame.size;h.LegacyCoreAssert.isTrue(f.width>0&&f.height>0,"root width and height must be positive",void 0,"GridStyleFeatureExtractor.getPreviousPos","GridStyleFeatureExtractor.swift",597),r+=(e?new m.TheoPoint(u.center.y/f.height,u.center.x/f.width):new m.TheoPoint(u.center.x/f.width,u.center.y/f.height)).distanceTo(d.bounds.center)}}return r}return 0},getSymmAsymm:function(e,t,n,r){var o;void 0===r&&(r=0);var a=0;if(0==t.length||0==e.length)return r;for(var s=i.iter(i.range(0,e.length,!1));!s.done;s.next())for(var l=e[s.value].bounds,u=n?new g.TheoRect(l.minX,1-l.maxY,l.maxX,1-l.minY):new g.TheoRect(1-l.maxX,l.minY,1-l.minX,l.maxY),c=i.iter(i.range(0,t.length,!1));!c.done;c.next()){var d=c.value,h=this.cellIntersection(t[d].bounds,u);a+=(o=i.opt(h,(function(e){return e.area})))||null!=o?o:0}return e.length>0?a:r},getCellSymmAsymm:function(e){for(var t=0,n=i.iter(i.range(0,this.gridCells_.length,!1));!n.done;n.next())for(var r=n.value,o=this.gridCells_[r].bounds,a=o.area,s=e?new g.TheoRect(o.minX,1-o.maxY,o.maxX,1-o.minY):new g.TheoRect(1-o.maxX,o.minY,1-o.minX,o.maxY),l=i.iter(i.range(0,this.gridCells_.length,!1));!l.done;l.next()){var u,c=l.value,d=this.gridCells_[c].bounds;(u=this.cellIntersection(d,s))&&(t+=u.area/Math.max(a,d.area))}return this.gridCells_.length>0?t/i.toDouble(this.gridCells_.length):0},cellIntersection:function(e,t){var n=null;return Math.max(e.minX,t.minX)<Math.min(e.maxX,t.maxX)&&Math.max(e.minY,t.minY)<Math.min(e.maxY,t.maxY)&&(n=new g.TheoRect(Math.max(e.minX,t.minX),Math.max(e.minY,t.minY),Math.min(e.maxX,t.maxX),Math.min(e.maxY,t.maxY))),n},isAdjacent:function(e,t){var n=e.bounds,r=t.bounds;return n.maxX-r.minX>0&&r.maxX-n.minX>0&&n.maxY-r.minY>=0&&r.maxY-n.minY>=0||n.maxX-r.minX>=0&&r.maxX-n.minX>=0&&n.maxY-r.minY>0&&r.maxY-n.minY>0},getOffsetFromCenter:function(e,t){for(var n=0,r=i.iter(e);!r.done;r.next()){var o=r.value,a=Math.abs((t?o.bounds.center.x:o.bounds.center.y)-.5);a>n&&(n=a)}return n},getAverageVal:function(e,t){for(var n=0,r=i.iter(e);!r.done;r.next()){var o=r.value;n+=t?o.bounds.center.x:o.bounds.center.y}return e.length>0?n/i.toDouble(e.length):0},getSpread:function(e,t){for(var n=1,r=0,o=i.iter(e);!o.done;o.next()){var a=o.value;t?(a.bounds.minX<n&&(n=a.bounds.minX),a.bounds.maxX>r&&(r=a.bounds.maxX)):(a.bounds.minY<n&&(n=a.bounds.minY),a.bounds.maxY>r&&(r=a.bounds.maxY))}return Math.max(r-n,0)},getVariance:function(e){var t=this.getMaxandMinCellArea(e),n=t[0],r=t[1];return Math.abs((n-r)/this.gridFrame_.area)},getMaxandMinCellArea:function(e){for(var t=0,n=this.gridFrame_.area,r=i.iter(e);!r.done;r.next()){var o=r.value,a=this.gridFrame_.evalRect(o.bounds).area;a>t&&(t=a),a<n&&(n=a)}return[t,n]},getCellAreaSum:function(e){for(var t=0,n=i.iter(e);!n.done;n.next()){var r=n.value;t+=this.gridFrame_.evalRect(r.bounds).area}return t},getImageCells:function(){return this.imageCells_},getFloatingCells:function(){return this.floatingCells_},getTypeOfCell:function(e){for(var t=[],n=i.iter(this.layoutItems_);!n.done;n.next()){var r,o=n.value;(r=this.mapping_[o.id])&&o.type==e&&(i.containsEq(t,r,c._equality_GridCell_GridCell)||t.push(r))}return t}}}),r)},cmoc:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("CWW7"),s=n("Bpjk"),l=n("FNB+"),u=n("6ZWm"),c=n("fWxZ"),d=n("JEzR"),h=n("P83h"),p=n("pnSN"),f=n("4mVB"),m=n("fdtz"),g=n("lmwz"),y=n("fNpk"),_=n("djAF");o.FrameForma=(r=function(){},i.defineClass({name:"FrameForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"Frame"}},PROPERTY_CLIPMODE:"clipmode",PROPERTY_CROP_RATIO_ID:"cropRatioId",SCHEMA_CLASS_NAME:{get:function(){return"FrameForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),p.GroupForma),s=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),c.FormaPage);return y.LegacyCoreAssert.isTrue(null!=a||null!=s,"FrameForma needs a parent group or page",void 0,"FrameForma","FrameForma.swift",23),null!=a?r.init_3144(e,t,n,a):r.init_7dbd(e,t,n,s)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,p.GroupForma,p.GroupForma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){i.super_init(this,p.GroupForma,p.GroupForma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return d.FrameStyle.createDefault()},clipmode:function(){return!0},cropRatioId:function(){return s.CropRatioPresetLibrary.FREEFORM_ID}},o=i.clone(t),a=i.iter(n);!a.done;a.next()){var l=a.key,u=a.value;null==t[l]&&(o[l]=u())}i.super_init(this,p.GroupForma,p.GroupForma.prototype.init_812f,e,o)},init_d1c9:function(e,t){i.super_init(this,p.GroupForma,p.GroupForma.prototype.init_d1c9,e,t)},init_7186:function(e){var t={kind:r.KIND,clipmode:!0,cropRatioId:s.CropRatioPresetLibrary.FREEFORM_ID};this.init_812f(e,t)},decodeController:function(){var e;(e=i.opt(this.page.document,(function(e){return e.controller})))&&(this.controller=e.controllerFactory.createController(u.FrameController.KIND,this)),p.GroupForma.prototype.decodeController.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){switch(e){case"style":var t;return(t=g.ImageFacade.getImageFormaForForma(this))?new h.FormaCutoutChangedEvent(t):null;default:return p.GroupForma.prototype.updateEventForProperty.call(this,e)}},bounds:{get:function(){return p.GroupForma._getters.bounds.call(this)},set:function(e){var t,n,r,o=this.bounds;p.GroupForma._setters.bounds.call(this,e),(t=i.as(this.controller,u.FrameController))&&(n=o)&&(r=e)&&t.setChildrenCropping(t.getCurrentCropType(n,r),n)}},cropRatioId:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_CROP_RATIO_ID),"String"))||null!=e?e:s.CropRatioPresetLibrary.FREEFORM_ID},set:function(e){this.set(r.PROPERTY_CROP_RATIO_ID,e)}},clipMode:{get:function(){return this.get(r.PROPERTY_CLIPMODE)},set:function(e){this.set(r.PROPERTY_CLIPMODE,e)}},hasAlpha:function(){var e,t=!(!(e=i.opt(i.as(this.controller,u.FrameController),(function(e){return e.hasCutout})))&&null==e)&&e&&null==this.style.colors.fieldPrimary;return this.visitAll(l.FormaTraversal.JustChildren,(function(e){var n=i.as(e,m.ImageForma);null!=n&&n.hasAlpha()&&(t=!0)})),t},image:{get:function(){return g.ImageFacade.getImageFormaForForma(this)}},matchColors:function(e){i.opt(i.as(this.controller,u.FrameController),(function(t){return 1==t.hasCutout&&i.opt(i.as(e.controller,u.FrameController),(function(e){return 1==e.hasCutout}))}))&&p.GroupForma.prototype.matchColors.call(this,e)},match:function(e){var t,n=this;if(p.GroupForma.prototype.match.call(this,e),t=i.as(e,r)){var o,s,l,c,d,h,y;if(this.isGridCell()&&!e.isGridCell()&&(o=i.as(i.opt(this.parent,(function(e){return e.style})),f.GridStyle))&&o.formaMapping[this.formaID]&&o.removeMappingToForma(this),this.intent=e.intent,(s=g.ImageFacade.getMaskForForma(t))?g.ImageFacade.applyMaskToForma(this,s,null,!0):(l=g.ImageFacade.getMaskFormaForForma(this))&&(l instanceof _.ShapeForma||l instanceof m.ImageForma)&&g.ImageFacade.removeMaskForForma(this),(c=g.ImageFacade.getCutoutMaskFormaForForma(t))&&(d=c.contentNode)&&(h=this.page.document)){var T,v=new a.AddFormaParams(void 0,void 0,void 0,void 0,a.AddFormaParentingHint.doNotAddFormaForContentToTree);(T=e.page==this.page?d:d.copyTo(h))&&a.CreationFacade.addImageForContentNode(this.page,T,v).then((function(t){var r;return(r=i.as(t,m.ImageForma))&&(g.ImageFacade.setCutoutForForma(n,r),g.ImageFacade.setCutoutModeForForma(n,g.ImageFacade.getCutoutModeForForma(e)),r.match(c)),null}))}else(y=i.as(this.controller,u.FrameController))&&g.ImageFacade.getCutoutMaskFormaForForma(this)&&y.hasCutout&&g.ImageFacade.removeCutoutForForma(this);this.cropRatioId=t.cropRatioId}}}}),r)},dE3O:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("ThKb");i.ImageProcessingUtils=(r=function(){},o={},a.defineClass({name:"ImageProcessingUtils",ctor:r,statics:{sobelX:{get:function(){return void 0===o.sobelX&&(o.sobelX=new s.TheoMatrix([[1,0,-1],[2,0,-2],[1,0,-1]])),o.sobelX}},sobelY:{get:function(){return void 0===o.sobelY&&(o.sobelY=new s.TheoMatrix([[1,2,1],[0,0,0],[-1,-2,-1]])),o.sobelY}},gaussianBlur3x3:{get:function(){return void 0===o.gaussianBlur3x3&&(o.gaussianBlur3x3=new s.TheoMatrix([[1,2,1],[2,4,2],[1,2,1]]).multiplyConstant(1/16)),o.gaussianBlur3x3}},applyConvolution:function(e,t){for(var n=a.toInt(Math.floor(a.toDouble(t.width)/2)),r=a.toInt(Math.floor(a.toDouble(t.height)/2)),o=[],i=a.iter(a.range(0,e.height,!1));!i.done;i.next()){for(var l=i.value,u=[],c=a.iter(a.range(0,e.width,!1));!c.done;c.next()){for(var d=c.value,h=0,p=a.iter(a.range(0,t.height,!1));!p.done;p.next())for(var f=p.value,m=a.iter(a.range(0,t.width,!1));!m.done;m.next()){var g=m.value,y=d+g-n,_=l+f-r;y>=0&&_>=0&&y<e.width&&_<e.height&&(h+=e.value(_,y)*t.value(f,g))}u.push(h)}o.push(u)}return new s.TheoMatrix(o)},getEdgeMagnitudeImage:function(e){if(e.isEmpty())return s.TheoMatrix.empty();var t=r.applyConvolution(e,r.sobelX).squared(),n=r.applyConvolution(e,r.sobelY).squared();return r.removeBorders(t),r.removeBorders(n),t.add(n).squareRoot()},removeBorders:function(e){e.isEmpty()||(e.setColValue(0,0),e.setColValue(e.cols-1,0),e.setRowValue(0,0),e.setRowValue(e.rows-1,0))}}}),r)},dJuF:function(e,t,n){var r,o,i,a,s,l=t,u=n("oAGj"),c=n("O60Y"),d=n("fVJ2"),h=n("SmK9"),p=n("13MC"),f=n("fNpk");l.DBNamePath=(r=function(){},u.defineClass({name:"DBNamePath",ctor:r,props:{init_1346:function(e,t){this.name=e,this.parent=t},init_b14a:function(e){this.name=e,this.parent=null},prepend:function(e){return r.init_b14a(e).appendPath(this)},append:function(e){return r.init_1346(e,this)},appendPath:function(e){var t=this;return e.forEach((function(e){t=t.append(e.name)})),t},forEach:function(e){u.opt(this.parent,(function(t){return t.forEach(e)})),e(this)},path:{get:function(){var e=[];return this.forEach((function(t){return e.push(t.name)})),e}}}}),r),l.DBProperty=(o=function e(t,n,r,o){this.shouldWrite=!0,this.schemaType=t,this.className=o,this.name_=n.name,this.value_=r,this.namePath_=n,t==h.DBSchemaType.ArrayType?this.arrayValue_=u.clone(u.as(r,["Array",e])):this.arrayValue_=null,t==h.DBSchemaType.ObjectType?this.dictionaryValue_=u.clone(u.as(r,["Dictionary","String",e])):this.dictionaryValue_=null,this.reroot(n)},u.defineClass({name:"DBProperty",ctor:o,statics:{deleted:function(e){return new l.DBDeletedProperty(e)},boolEncoded:function(e,t,n){return new o(h.DBSchemaType.BooleanType,e,t,n)},doubleEncoded:function(e,t,n){return new o(h.DBSchemaType.NumberType,e,t,n)},intEncoded:function(e,t,n){return new o(h.DBSchemaType.IntegerType,e,t,n)},stringEncoded:function(e,t,n){return new o(h.DBSchemaType.StringType,e,t,n)},arrayEncoded:function(e,t,n){return new o(h.DBSchemaType.ArrayType,e,t,n)},dictEncoded:function(e,t,n){return new o(h.DBSchemaType.ObjectType,e,t,n)},objProperty:function(e,t,n,r){return new o(h.DBSchemaType.ObjectType,e,c.DBLink.init_14fa(t,r),n)},linkProperty:function(e,t,n,r,i){return new o(h.DBSchemaType.ObjectType,e,c.DBLink.init_8408(t,n,i),r)},boolProperty:function(e,t,n){void 0===n&&(n=!1);var r=new o(h.DBSchemaType.BooleanType,e,t,null);return r.shouldWrite=!n,r},doubleProperty:function(e,t,n){void 0===n&&(n=!1);var r=new o(h.DBSchemaType.NumberType,e,t,null);return r.shouldWrite=!n,r},intProperty:function(e,t,n){void 0===n&&(n=!1);var r=new o(h.DBSchemaType.IntegerType,e,t,null);return r.shouldWrite=!n,r},stringProperty:function(e,t,n){void 0===n&&(n=!1);var r=new o(h.DBSchemaType.StringType,e,t,null);return r.shouldWrite=!n,r},arrayProperty:function(e,t){return new o(h.DBSchemaType.ArrayType,e,t,null)},dictProperty:function(e,t){return new o(h.DBSchemaType.ObjectType,e,t,null)},arraysEqual:function(e,t){var n=e.arrayPropertyCount;if(t.arrayPropertyCount!=n)return!1;for(var r=u.iter(u.range(0,n,!1));!r.done;r.next()){var o=r.value;if(!e.arrayValue_[o].isEqual(t.arrayValue_[o]))return!1}return!0},dictsEqual:function(e,t){if(u.keys(e.dictionaryValue_).length==u.keys(t.dictionaryValue_).length){for(var n=u.iter(u.keys(e.dictionaryValue_));!n.done;n.next()){var r=n.value,o=e.dictionaryValue_[r],i=t.dictionaryValue_[r];if(null==i||!o.isEqual(i))return!1}return!0}return!1}},props:{name:{get:function(){return this.name_}},namePath:{get:function(){return this.namePath_}},index:{get:function(){return u.toInt(this.name_)}},copy:function(){var e,t;if(e=this.arrayValue)return new o(this.schemaType,this.namePath_,e.map((function(e){return e.copy()}),this),this.className);if(t=this.dictionaryValue){for(var n={},r=u.iter(t);!r.done;r.next()){var i=r.key,a=r.value;n[i]=a.copy()}return new o(this.schemaType,this.namePath_,n,this.className)}return new o(this.schemaType,this.namePath_,this.value_,this.className)},reroot:function(e){if(this.namePath_=e,this.isArray)for(var t=u.iter(u.toSequence(this.arrayValue_));!t.done;t.next()){var n=t.value,r=n.offset,o=n.element,i=e.append(u.toString(r));o.reroot(i)}else if(this.isDictionary&&null==this.className)for(var a=u.iter(this.dictionaryValue_);!a.done;a.next()){var s=a.key;o=a.value,i=e.append(s),o.reroot(i)}},prependNameToPath:function(e){this.namePath_=this.namePath_.prepend(e),null==this.className&&this.prependNameToChildPaths(e)},prependNameToChildPaths:function(e){if(null!=this.arrayValue_)for(var t=u.iter(this.arrayValue_);!t.done;t.next())t.value.prependNameToPath(e);else if(null!=this.dictionaryValue_)for(var n=u.iter(this.dictionaryValue_);!n.done;n.next())n.value.prependNameToPath(e)},value:{get:function(){return this.value_}},boolValue:{get:function(){return u.as(this.value_,"Bool")}},doubleValue:{get:function(){return u.as(this.value_,"Double")}},intValue:{get:function(){return u.as(this.value_,"Int")}},stringValue:{get:function(){return u.as(this.value_,"String")}},linkID:{get:function(){var e;return(e=u.as(this.value_,c.IDBLink))?e.referenceID:null}},objValue:{get:function(){var e;return(e=u.as(this.value_,c.IDBLink))?e.dereference():null}},isArray:{get:function(){return this.schemaType==h.DBSchemaType.ArrayType}},getArrayProperty:function(e){return this.arrayValue_[e]},arrayPropertyCount:{get:function(){var e;return(e=u.opt(this.arrayValue_,(function(e){return e.length})))||null!=e?e:0}},forEachArrayProperty:function(e){if(this.isArray)for(var t=u.iter(u.toSequence(this.arrayValue_));!t.done;t.next()){var n=t.value;e(n.offset,n.element)}},arrayValue:{get:function(){return this.isArray?this.arrayValue_:null}},isDictionary:{get:function(){return this.schemaType==h.DBSchemaType.ObjectType&&null!=this.dictionaryValue_}},getDictionaryProperty:function(e){return this.isDictionary?this.dictionaryValue_[e]:null},setDictionaryProperty:function(e,t){this.isDictionary&&(null!=t?this.dictionaryValue_[e]=t:u.removeKey(this.dictionaryValue_,e),this.value_=u.clone(this.dictionaryValue_))},forEachDictionaryProperty:function(e){if(this.isDictionary)for(var t=u.iter(this.dictionaryValue_);!t.done;t.next())e(t.key,t.value)},dictionaryValue:{get:function(){return this.isDictionary?this.dictionaryValue_:null}},isEqual:function(e){var t;if(t=u.as(e,o)){if(t===this)return!0;if(this.schemaType!=t.schemaType)return!1;switch(this.schemaType){case"string":return null!=this.stringValue&&null!=t.stringValue&&this.stringValue==t.stringValue;case"boolean":return null!=this.boolValue&&null!=t.boolValue&&this.boolValue==t.boolValue;case"integer":return null!=this.intValue&&null!=t.intValue&&this.intValue==t.intValue;case"number":return null!=this.doubleValue&&null!=t.doubleValue&&this.doubleValue==t.doubleValue;case"object":if(null!=this.objValue)return this.objValue===t.objValue;if(this.isDictionary&&t.isDictionary)return o.dictsEqual(this,t);break;case"array":return this.isArray&&t.isArray&&o.arraysEqual(this,t);case"unknown":return!1}}return!1}}}),o),l.DBDeletedProperty=(i=function(e){l.DBProperty.call(this,h.DBSchemaType.UnknownType,e,0,null)},u.defineClass({name:"DBDeletedProperty",ctor:i,superName:"DBProperty",props:{shouldWrite:{get:function(){return!1},set:function(e){}},copy:function(){return new i(this.namePath_)},boolValue:{get:function(){return null}},doubleValue:{get:function(){return null}},intValue:{get:function(){return null}},stringValue:{get:function(){return null}},objValue:{get:function(){return null}},arrayValue:{get:function(){return null}},dictionaryValue:{get:function(){return null}},isEqual:function(e){return e instanceof i}}}),i),l.DBPropertyCodec=(a=function(){},s={},u.defineClass({name:"DBPropertyCodec",ctor:a,statics:{registeredCodecs_:{},primitiveUpdater_:{get:function(){return void 0===s.primitiveUpdater_&&(s.primitiveUpdater_=function(e,t){return e.value_=t,e}),s.primitiveUpdater_}},codec:function(e,t,n){return a.init_a58a(e,t,n)},updatingCodec:function(e,t,n,r){return a.init_e208(e,t,n,r)},boolCodec:function(){var e;return a.init_e208((function(e,t,n){return l.DBProperty.boolProperty(e,t)}),(function(t,n){return!(!(e=u.opt(t,(function(e){return e.boolValue})))&&null==e)&&e}),a.primitiveUpdater_,"Bool")},intCodec:function(){var e;return a.init_e208((function(e,t,n){return l.DBProperty.intProperty(e,t)}),(function(t,n){return(e=u.opt(t,(function(e){return e.intValue})))||null!=e?e:0}),a.primitiveUpdater_,"Int")},doubleCodec:function(){var e;return a.init_e208((function(e,t,n){return l.DBProperty.doubleProperty(e,t)}),(function(t,n){return(e=u.opt(t,(function(e){return e.doubleValue})))||null!=e?e:NaN}),a.primitiveUpdater_,"Double")},stringCodec:function(){return a.init_e208((function(e,t,n){return l.DBProperty.stringProperty(e,t)}),(function(e,t){return u.opt(e,(function(e){return e.stringValue}))}),a.primitiveUpdater_,"String")},objectCodec:function(e){return void 0===e&&(e=null),a.init_a58a((function(t,n,r){return l.DBProperty.objProperty(t,n,e,u.opt(r,(function(e){return e.id})))}),(function(e,t){return u.opt(e,(function(e){return e.objValue}))}),"Link")},directObjectCodec:function(e){return a.init_a58a((function(e,t,n){var r,o=l.DBProperty.deleted(e);if(r=u.as(t,d.DBObject)){var i,a,s=u.clone(r.state.allProperties);if((i=h.DBSchema.currentSchema.rulesByName[r.state.className])&&(a=i.getRequiredProperties()))for(var c=u.iter(a);!c.done;c.next()){var m=c.value;f.LegacyCoreAssert.isTrue(u.keys(s).includes(m),"missing property encountered when encoding",{property:m,className:r.state.className},"DBPropertyCodec.directObjectCodec","DBProperty.swift",454)}o=l.DBProperty.dictEncoded(e,s,r.className),null!=n&&(r.isChildObject?f.LegacyCoreAssert.isFalse(r.state instanceof p.DBChildObjectState&&r.state.parentObject!==n,"Cannot reparent child objects. Clone the object before assigning to a new parent",void 0,"DBPropertyCodec.directObjectCodec","DBProperty.swift",466):n.addChildObject(r,e))}else f.LegacyCoreAssert.fail("Expected DBObject",{actual:t},"DBPropertyCodec.directObjectCodec","DBProperty.swift",472);return o}),(function(e,t){var n,r,o,i=null;return null!=(n=u.opt(e,(function(e){return e.className})))&&(r=u.as(t,d.DBObject))&&(o=u.opt(e,(function(e){return e.namePath})))&&(i=r.createChildObject(n,o)),i}),"Direct object")},arrayCodec:function(e){var t=this;return a.init_a58a((function(n,r,o){var i,a=l.DBProperty.deleted(n);if(i=u.as(r,["Array","Any"])){var s=u.toSequence(i).map((function(t){return e.encode(n.append(u.toString(t.offset)),t.element,o)}),t);a=l.DBProperty.arrayProperty(n,s)}else f.LegacyCoreAssert.fail("Expected an array",{actual:r},"DBPropertyCodec.arrayCodec","DBProperty.swift",497);return a}),(function(n,r){var o,i=null;return(o=u.opt(n,(function(e){return e.arrayValue})))&&(i=o.map((function(t){return e.decode(t,r)}),t).filter((function(e){return null!=e}),t).map((function(e){return e}),t)),i}),"Array")},tupleCodec:function(e){return a.init_a58a((function(t,n,r){var o,i=l.DBProperty.deleted(t);if(o=u.as(n,["Array","Any"])){for(var a=[],s=u.iter(u.range(0,o.length,!1));!s.done;s.next()){var c=s.value;c<e.length?a.push(e[c].encode(t.append(u.toString(c)),o[c],r)):a.push(u.last(e).encode(t.append(u.toString(c)),o[c],r))}i=l.DBProperty.arrayProperty(t,a)}else f.LegacyCoreAssert.fail("Expected an array",{actual:n},"DBPropertyCodec.tupleCodec","DBProperty.swift",529);return i}),(function(t,n){var r=null;return null!=t&&t.isArray&&(r=[],t.forEachArrayProperty((function(o,i){var a;o<e.length?null!=(a=e[o].decode(i,n))?r.push(a):f.LegacyCoreAssert.fail("Failed to decode array property",{property:t,index:o},"DBPropertyCodec.tupleCodec","DBProperty.swift",543):null!=(a=u.last(e).decode(i,n))?r.push(a):f.LegacyCoreAssert.fail("Failed to decode array property",{property:t,index:o},"DBPropertyCodec.tupleCodec","DBProperty.swift",549)}))),r}),"Tuple")},dictionaryCodec:function(e){var t=function(e,t,n){var r,o,i,a,s=l.DBProperty.deleted(e);return null!=(r=u.as(t,"Bool"))?s=l.DBProperty.boolProperty(e,r):null!=(o=u.as(t,"Int"))?s=l.DBProperty.intProperty(e,o):null!=(i=u.as(t,"Double"))?s=l.DBProperty.doubleProperty(e,i):null!=(a=u.as(t,"String"))&&(s=l.DBProperty.stringProperty(e,a)),s};return a.init_a58a((function(n,r,o){var i,a=l.DBProperty.deleted(n);if(i=u.as(r,["Dictionary","String","Any"])){for(var s={},c=u.iter(i);!c.done;c.next()){var d,h=c.key,p=c.value;(d=e[h])?s[h]=d.encode(n.append(h),p,o):s[h]=t(n.append(h),p)}a=l.DBProperty.dictProperty(n,s)}else f.LegacyCoreAssert.fail("Expected a dictionary",{actual:r},"DBPropertyCodec.dictionaryCodec","DBProperty.swift",588);return a}),(function(t,n){var r=null;return null!=t&&t.isDictionary&&(r={},t.forEachDictionaryProperty((function(t,o){var i;(i=e[t])?r[t]=i.decode(o,n):r[t]=function(e,t){var n;if(null!=(n=u.opt(e,(function(e){return e.schemaType}))))switch(n){case"boolean":return e.boolValue;case"integer":return e.intValue;case"number":return e.doubleValue;case"string":return e.stringValue;default:return null}return null}(o)}))),r}),"Dictionary")},registerCodec:function(e,t){return f.LegacyCoreAssert.isTrue(null==a.registeredCodecs_[e],"Duplicate codec registered",{typeName:e},"DBPropertyCodec.registerCodec","DBProperty.swift",629),a.registeredCodecs_[e]=t,a.registeredCodecs_[e]},typeCodec:function(e){return a.registeredCodecs_[e]}},props:{init_a58a:function(e,t,n){this.encode=e,this.decode=t,this.update=null,this.tag=n},init_e208:function(e,t,n,r){this.encode=e,this.decode=t,this.update=n,this.tag=r}}}),a)},dNOY:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("90dd");i.InsertedContentChildrenMessage=(r=function e(t,n,r){this.index=n,this.children=a.clone(r),s.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"InsertedContentChildrenMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"InsertedContentChildrenMessage"}}}}),r),i.RemovedContentChildrenMessage=(o=function e(t,n,r){this.index=n,this.removed=a.clone(r),s.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"RemovedContentChildrenMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"RemovedContentChildrenMessage"}}}}),o)},"dX/e":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("VQVe"),l=n("6ZWm"),u=n("7Pku"),c=n("w/+j"),d=n("Qlvz"),h=n("NkBu"),p=n("U010"),f=n("fdtz"),m=n("SDdr"),g=n("lmwz"),y=n("uWOl"),_=n("fNpk"),T=n("Ird5"),v=n("WjWV"),C=n("Iv44"),P=n("GDe9"),S=n("jfma"),D=n("ZTPx"),A=n("+ASD"),E=n("dmHI"),R=n("jfiy"),F=n("bauG"),b=n("jSYS"),I=n("vTQu"),O=n("yjxF"),k=n("dz2e"),N=n("Aj79"),M=n("sJQG"),L=n("44Iz"),x=n("JQ9Y"),B=n("g6aL"),w=n("zW52"),G=n("Zifs");i.ImageFormaToPGMMapper=(r=function e(){u.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},a.defineClass({name:"ImageFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=f.ImageForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{canDoSimpleTransformUpdate:function(e){var t,n;return!((t=g.ImageFacade.getFrameFormaForForma(e.forma))&&(n=a.as(t.controller,l.FrameController))&&n.hasCutout)&&u.FormaToPGMMapper.prototype.canDoSimpleTransformUpdate.call(this,e)},getCutoutImageRef:function(e){var t,n,r,o,i;if((t=g.ImageFacade.getFrameFormaForForma(e))&&(n=a.as(t.controller,l.FrameController))&&(r=n.cutout)&&(o=r.bounds)&&null!=(i=r.contentID)){_.LegacyCoreAssert.isTrue(n.cutoutMode==p.CutoutMode.BackgroundRemoval,"Only BackgroundRemoval type is supported",void 0,"ImageFormaToPGMMapper.getCutoutImageRef","ImageFormaToPGMMapper.swift",55);var s=new F.PGMImage(r.formaID,new O.PGMNodeMetadata(r.formaID,"image"),T.PGMAnimationList.EMPTY,o,i);return new N.PGMReference(s,new S.PGMCompositingParams(r.placement,1))}return null},makePGMRef:function(e,t,n,r){var o,i,s;if((i=a.as(e,f.ImageForma))&&null!=(s=i.contentID)){var l;if(l=i.bounds){var u,d,h=new F.PGMImage(i.formaID,new O.PGMNodeMetadata(i.formaID,"image"),T.PGMAnimationList.EMPTY,l,s),p=new S.PGMCompositingParams(i.placement,i.style.opacity);if(d=this.getCutoutImageRef(i)){var m=new N.PGMReference(h,p);u=this.applyMask(m,d),p=S.PGMCompositingParams.DEFAULT}else u=h;var g=null,y=0;t==L.PGMExportSettings.DYNAMIC&&null!=i.animation&&(g=a.opt(i.animation,(function(e){return e.animationStyle.name})),y=(o=a.opt(i.animation,(function(e){return e.animationStyle.variant})))||null!=o?o:0);var v=this.applyFilters(g,y,i.style,u,h,i.controller),C=new N.PGMReference(v,p),P=c.FormaToPGMUtils.applyAnimations(t,e,C);return this.applyStillAnimations(e,P)}return _.LegacyCoreAssert.fail("ImageFormaToPGMMapper: image is missing bounds or content ID",void 0,"ImageFormaToPGMMapper.makePGMRef","ImageFormaToPGMMapper.swift",159),null}return _.LegacyCoreAssert.fail("ImageFormaToPGMMapper called for something that's not an ImageForma",void 0,"ImageFormaToPGMMapper.makePGMRef","ImageFormaToPGMMapper.swift",164),null},applyFilters:function(e,t,n,r,o,i){var l,u,c,p=r,m=!0;if((l=a.as(i,h.ImageController))&&(u=a.as(l.forma,f.ImageForma))&&(m=!(l.floating||u.hasAlpha())),c=a.as(n,y.ImageStyle)){var g,_=!1;if(g=c.adjustments){var T=d.ImageAdjustments.createDefault();_=g.blur!=T.blur,g.sharpness!=T.sharpness&&(p=this.applySharpen(g,p,o,m)),p=this.applyColorAdjustments(g,p)}var C=p;if(p=this.applyStyleEffects(c,p,o,m),e==s.AnimationStyle.NAME_GRAYSCALE){var P=c.colors,S=a.opt(a.opt(P.library,(function(e){return e.color("themeDerivedDark")})),(function(e){return e.rgbColor}))||G.SolidColor.BLACK,D=a.opt(a.opt(P.library,(function(e){return e.color("themeDerivedLight")})),(function(e){return e.rgbColor}))||G.SolidColor.WHITE,E=this.wrapInFilter([C],"Greyscale",new A.PGMDuotoneFilterSpec(S,D,1));p=this.wrapInFilter([p,E],"AnimationBlend",new v.PGMBlendFilterSpec([0,1]))}else if(e==s.AnimationStyle.NAME_FILL){var F=G.SolidColor.BLACK;(I=a.as(i,h.ImageController))&&(O=a.as(I.forma,f.ImageForma))&&(N=a.clone(O.page.colorLibraryController.getThemeColorKeys())).length>t&&(F=O.page.colorLibraryController.getSolidColorForKey(a.as(N[t],"String"))||G.SolidColor.BLACK);var b=this.wrapInFilter([C],s.AnimationStyle.NAME_FILL,new R.PGMFillFilterSpec(F));p=this.wrapInFilter([p,b],"AnimationBlend",new v.PGMBlendFilterSpec([0,1]))}else if(e==s.AnimationStyle.NAME_COLOR){var I,O,N,M=G.SolidColor.BLACK;(I=a.as(i,h.ImageController))&&(O=a.as(I.forma,f.ImageForma))&&(N=a.clone(O.page.colorLibraryController.getThemeColorKeys())).length>t&&(M=O.page.colorLibraryController.getSolidColorForKey(a.as(N[t],"String"))||G.SolidColor.BLACK);var L=this.wrapInFilter([C],s.AnimationStyle.NAME_COLOR,new k.PGMOverlayFilterSpec(M));p=this.wrapInFilter([p,L],"AnimationBlend",new v.PGMBlendFilterSpec([1,0]))}_&&(p=this.applyBlur(c.adjustments.scaledBlur,p,o,m)),e==s.AnimationStyle.NAME_BLUR&&(p=this.applyBlur(0,p,o,m))}return p},getRootAnimation:function(e){for(var t=e;null!=t.parent;)t=t.parent;return t.animation},applyStillAnimations:function(e,t){var n;if(n=e.animation){var r,o,i=n.animationStyle;if((i.name==s.AnimationStyle.NAME_ZOOM||i.name==s.AnimationStyle.NAME_PAN)&&(r=this.getRootAnimation(e))&&n.endTime.earlierThan(r.endTime)&&(o=a.as(t.animations.animations.find((function(e){return e instanceof w.PGMTransformAnimation&&e.timeFn.domain.contains(i.endTime.seconds)}),this),w.PGMTransformAnimation))){var l=new M.PGMRange(i.endTime.seconds,r.endTime.seconds),u=new b.PGMLinearFunction(l,new M.PGMRange(1,1)),c=new w.PGMTransformAnimation(u,o.endXBounds,o.endXBounds),d=t.animations.append(c);return t.withAnimations(d)}}return t},applyMask:function(e,t){return this.wrapRefsInFilter([e,t],"CutoutMask",new I.PGMMaskFilterSpec)},applySharpen:function(e,t,n,r){var o=t,i=e.scaledSharpness/4,a=o;return o=this.wrapInFilter([a],"Blur",new C.PGMBlurFilterSpec(r,i,n.entity)),o=this.wrapInFilter([a,o],"Sharpen_mixback",new v.PGMBlendFilterSpec([1.5,-.5]))},applyBlur:function(e,t,n,r){var o=t;return o=this.wrapInFilter([o],"Blur",new C.PGMBlurFilterSpec(r,e,n.entity))},applyColorAdjustments:function(e,t){var n=t,r=d.ImageAdjustments.createDefault(),o=e.copyWithNewValues(r.blur,r.sharpness);return o.equals(r)||(n=this.wrapInFilter([n],"ColorAdjustment",new P.PGMColorAdjustmentFilterSpec(o.shadows,o.highlights,o.saturation,o.brightness,o.exposure,o.contrast,o.warmth,o.tint,o.fade,o.vibrance))),n},applyStyleEffects:function(e,t,n,r){var o,i=t;if(o=a.as(e.filter,m.CompositeFilter)){var s,l;if(1!=o.contrast?i=this.wrapInFilter([i],o.name+"_contrast",D.PGMColorTransformFilterSpec.createContrastTransform(o.contrast)):o.grayscale&&(i=this.wrapInFilter([i],o.name,new A.PGMDuotoneFilterSpec(G.SolidColor.BLACK,G.SolidColor.WHITE,1))),(s=o.colors)&&(l=s.fieldPrimary))switch(o.blend){case"normal":var u;i=(u=s.fieldSecondary)?this.wrapInFilter([i],o.name,new A.PGMDuotoneFilterSpec(l,u,1)):this.wrapInFilter([i],o.name,new R.PGMFillFilterSpec(l));break;case"overlay":i=this.wrapInFilter([i],o.name+"_overlay",new k.PGMOverlayFilterSpec(l));break;case"screen":i=this.wrapInFilter([i],o.name,new x.PGMScreenFilterSpec(l));break;case"multiply":i=this.wrapInFilter([i],o.name,D.PGMColorTransformFilterSpec.createColorizeTransform(l))}if(o.blurRadius>.05&&(i=this.wrapInFilter([i],o.name,new C.PGMBlurFilterSpec(r,o.blurRadius,n.entity))),1!=o.mix){var c=new B.PGMSimpleGroup(i.entity+"-mix-filtered",new O.PGMNodeMetadata(i.meta.id,"filter-"+o.name+"-mix-opacity"),T.PGMAnimationList.EMPTY,[new N.PGMReference(i)]),d=new N.PGMReference(c,S.PGMCompositingParams.DEFAULT.withOpacity(o.mix),T.PGMAnimationList.EMPTY);i=new B.PGMSimpleGroup(i.entity+"-mix",new O.PGMNodeMetadata(i.meta.id,"filter-"+o.name+"-mix"),T.PGMAnimationList.EMPTY,[new N.PGMReference(t),d])}}return i},wrapInFilter:function(e,t,n){var r=e.map((function(e){return new N.PGMReference(e)}),this);return this.wrapRefsInFilter(r,t,n)},wrapRefsInFilter:function(e,t,n){var r=e[0].child.entity+"-"+t,o=new O.PGMNodeMetadata(e[0].child.meta.id,"filter-"+t),i=T.PGMAnimationList.EMPTY;return new E.PGMFilter(r,o,i,e,n)}}}),r)},djAF:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("FNB+"),l=n("fWxZ"),u=n("P83h"),c=n("pnSN"),d=n("iCxV"),h=n("fNpk"),p=n("tGKA"),f=n("35Q0"),m=n("u2iI"),g=n("byfQ"),y=n("8t9B"),_=n("hgLm"),T=n("sIWg"),v=n("1NAc"),C=n("LGJg");o.ShapeForma=(r=function(){this.cachedMaskImage_=null},i.defineClass({name:"ShapeForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Shape"}},PROPERTY_ARTWORK:"artwork",PROPERTY_CONTENTID:"content-id",PROPERTY_SHAPELIBRARYID:"shape-id",PROPERTY_SIZE:"size",PROPERTY_SLICE_BOX:"slice-box",PROPERTY_PRESCALE:"prescale",PROPERTY_SHAPE_STYLE_DEPRECATED:"style",PROPERTY_CONTENT_REGION:"content-region",PROPERTY_TEXT_BOX:"text-box",SCHEMA_CLASS_NAME:{get:function(){return"ShapeForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),c.GroupForma),s=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),l.FormaPage);return h.LegacyCoreAssert.isTrue(null!=a||null!=s,"ShapeForma needs a parent group or page",void 0,"ShapeForma","ShapeForma.swift",31),null!=a?r.init_3144(e,t,n,a):r.init_7dbd(e,t,n,s)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,o){var a;i.super_init(this,s.Forma,s.Forma.prototype.init_3144,e,t,n,o),null!=this.shapeLibraryID&&(f.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(a=this.getProperty(r.PROPERTY_ARTWORK))&&(a.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,a)))},init_7dbd:function(e,t,n,o){var a;i.super_init(this,s.Forma,s.Forma.prototype.init_7dbd,e,t,n,o),null!=this.shapeLibraryID&&(f.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(a=this.getProperty(r.PROPERTY_ARTWORK))&&(a.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,a)))},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return m.ShapeStyle.createDefault()},size:function(){return new v.TheoSize(1,1)}},o=i.clone(t),a=i.iter(n);!a.done;a.next()){var l=a.key,u=a.value;null==t[l]&&(o[l]=u())}i.super_init(this,s.Forma,s.Forma.prototype.init_812f,e,o)},init_d1c9:function(e,t){var n;i.super_init(this,s.Forma,s.Forma.prototype.init_d1c9,e,t),null!=this.shapeLibraryID&&(f.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(n=this.getProperty(r.PROPERTY_ARTWORK))&&(n.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,n)))},init_7186:function(e){var t={kind:r.KIND,style:m.ShapeStyle.createDefault(),size:new v.TheoSize(1,1)};this.init_812f(e,t)},postDecode:function(){s.Forma.prototype.postDecode.call(this),this.isGridCell()&&null==this.getProperty(s.Forma.PROPERTY_INTENT)&&this.set(s.Forma.PROPERTY_INTENT,s.Forma.INTENT_GRID_CELL)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==r.PROPERTY_ARTWORK?new u.FormaContentChangedEvent(this):e==r.PROPERTY_PRESCALE?new u.FormaGeometryChangedEvent(this):e==r.PROPERTY_SLICE_BOX||e==r.PROPERTY_CONTENT_REGION?new u.FormaContentChangedEvent(this):e==r.PROPERTY_SIZE?new u.FormaGeometryChangedEvent(this):e==r.PROPERTY_CONTENTID||e==r.PROPERTY_SHAPELIBRARYID?new u.FormaContentChangedEvent(this):s.Forma.prototype.updateEventForProperty.call(this,e)},didChangeState:function(e){null==e[r.PROPERTY_ARTWORK]&&null==e[r.PROPERTY_PRESCALE]&&null==e[r.PROPERTY_SLICE_BOX]&&null==e[r.PROPERTY_SIZE]||(this.artworkSized_=null),s.Forma.prototype.didChangeState.call(this,e)},match:function(e){var t,n,o;if(s.Forma.prototype.match.call(this,e),t=i.as(e,r)){var l=new u.FormaGeometryChangedEvent(this);this.beginUpdate(l),this.artwork_=t.canonicalArtwork.clone(),this.sliceBox=t.sliceBox,this.contentRegion=t.contentRegion,this.size=t.size,this.endUpdate(l)}(n=i.as(e.controller,y.TypeLockupController))&&null!=(o=i.opt(n.lockupStyle,(function(e){return e.textBacked})))&&o&&this.style.colors.setColorId(a.ColorRole.FieldPrimary,e.style.colors.colorID(a.ColorRole.FieldSecondary))},artwork_:{get:function(){var e,t=new _.TheoRectanglePath(T.TheoRect.fromSize(this.size||new v.TheoSize(1,1)));return(e=i.as(this.get(r.PROPERTY_ARTWORK),g.TheoArtworkNode))||null!=e?e:g.TheoArtworkShape.init_9312(null,[t])},set:function(e){this.set(r.PROPERTY_ARTWORK,e)}},canonicalArtwork:{get:function(){return this.artwork_},set:function(e){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.artwork_=e,this.artworkSized_=null,this.endUpdate(t)}},preScale:{get:function(){return i.as(this.get(r.PROPERTY_PRESCALE),"Double")},set:function(e){if(e!=this.preScale){var t=new u.FormaGeometryChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_PRESCALE,e),this.artworkSized_=null,this.endUpdate(t)}}},sizedArtwork:{get:function(){var e,t;return null==this.artworkSized_&&((e=this.artwork_.bounds)?(t=null!=this.preScale&&isFinite(this.preScale)?this.preScale:Math.min(this.size.width/e.width,this.size.height/e.height),this.artworkSized_=this.artwork_.applySlicing(e,T.TheoRect.fromSize(this.size),this.sliceBox,t,!0)):(i.opt(d.Host.logging,(function(e){return e.warning("No bounds obtained from artwork")})),this.artworkSized_=this.artwork_.clone())),this.artworkSized_}},sliceBox:{get:function(){return i.as(this.get(r.PROPERTY_SLICE_BOX),T.TheoRect)},set:function(e){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_SLICE_BOX,e),this.artworkSized_=null,this.endUpdate(t)}},contentRegion:{get:function(){return i.as(this.get(r.PROPERTY_CONTENT_REGION),T.TheoRect)},set:function(e){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_CONTENT_REGION,e),this.endUpdate(t)}},size:{get:function(){return i.as(this.get(r.PROPERTY_SIZE),v.TheoSize)},set:function(e){if(this.size!=e){var t=new u.FormaGeometryChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_SIZE,e),this.artworkSized_=null,this.endUpdate(t)}}},bounds:{get:function(){return this.boundsInCoordSpace(p.Matrix2D.Identity)},set:function(e){var t;if(t=e){if(this.size.equal(t.size))return;this.size=t.size}else h.LegacyCoreAssert.fail("shouldnt be setting nil bounds for a shape",void 0,"ShapeForma","ShapeForma.swift",285)}},boundsInCoordSpace:function(e){return i.opt(this.calcBounds(),(function(t){return t.transform(e)}))},calcBounds:function(){var e;return(e=this.size)?T.TheoRect.fromSize(e):null},contentID:{get:function(){return i.as(this.get(r.PROPERTY_CONTENTID),"String")},set:function(e){if(e!=this.contentID){var t=new u.FormaContentChangedEvent(this);this.beginUpdate(t),this.set(r.PROPERTY_CONTENTID,e),this.endUpdate(t)}}},contentNode:{get:function(){var e=this;return null==this.contentID?null:i.opt(this.page.document,(function(t){return t.content.nodeByID(e.contentID)}))},set:function(e){this.contentID=null==e?null:e.id}},shapeLibraryID:{get:function(){return i.as(this.get(r.PROPERTY_SHAPELIBRARYID),"String")},set:function(e){if(e!=this.shapeLibraryID){var t,n=new u.FormaContentChangedEvent(this);this.beginUpdate(n),this.set(r.PROPERTY_SHAPELIBRARYID,e),(t=this.getProperty(r.PROPERTY_ARTWORK))&&(t.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,t)),this.endUpdate(n)}}},isGraphic:function(){return!0},isShape:function(){return!0},maskImage:{get:function(){if(null==this.cachedMaskImage_){var e=this.persisted?this.database.beginTransaction("cache_mask",null):null;d.Host.imageAnalysis.setShapeFormaTransparencyMask(this,25),i.opt(e,(function(e){return e.rollback()}))}return this.cachedMaskImage_},set:function(e){this.cachedMaskImage_=e}},getAverageAlpha:function(e){if(this.isGridCell())return 1;var t,n,r=e.transform(this.totalPlacement.inverse);if(this.contentNode instanceof C.VectorContentNode&&(t=this.maskImage)&&(n=this.bounds)){var o,a=i.toDouble(t.cols)/i.toDouble(n.width),s=i.toDouble(t.rows)/i.toDouble(n.height),l=r.multiplyXY(a,s).rounded();if(o=l.intersectionWith(new T.TheoRect(0,0,t.size.width,t.size.height)))return t.sumRegion(o)/l.area}return 1}}}),r)},enh0:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("SpAV"),s=n("ascj"),l=n("FNB+"),u=n("QgZx"),c=n("fWxZ"),d=n("P83h"),h=n("pnSN"),p=n("53P9"),f=n("iCxV"),m=n("fNpk"),g=n("cEEQ"),y=n("c+uM"),_=n("Zifs"),T=n("a9ow"),v=n("9YN4"),C=n("8t9B"),P=n("3UhB"),S=n("x4Gy"),D=n("oKlP"),A=n("uUew"),E=n("sIWg"),R=n("LCGV");o.TextForma=(r=function(){this.renderRuns=new S.RenderRuns,this.graphemeCount_=-1,this.cachedText_=null,this.cachedFont_=null,this.cachedSize_=null,this.cachedColor_=null,this.cachedStrokeColor_=null,this.cachedStrokeWidth_=null,this.cachedTextLook_=null,this.cachedTracking_=null},i.defineClass({name:"TextForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Text"}},PROPERTY_SIZE:"size",PROPERTY_TEXT:"text",PROPERTY_TEXT_STYLE:"text-style",PROPERTY_FILLCOLOR_DEPRECATED:"fill-color",PROPERTY_RANGEINLOCKUP:"range-in-lockup",PROPERTY_ROWINDEX:"row-index",SCHEMA_CLASS_NAME:{get:function(){return"TextForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),h.GroupForma),s=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),c.FormaPage);return m.LegacyCoreAssert.isTrue(null!=a||null!=s,"TextForma needs a parent group or page",void 0,"TextForma","TextForma.swift",26),null!=a?r.init_3144(e,t,n,a):r.init_7dbd(e,t,n,s)}return r.init_d1c9(e,n)}}},STROKEWIDTH_ZERO:0,TRACKING_ZERO:0,_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,l.Forma,l.Forma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){i.super_init(this,l.Forma,l.Forma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return R.TextStyle.createDefault()},text:function(){return S.TextModel.init_d41d()}},o=i.clone(t),a=i.iter(n);!a.done;a.next()){var s=a.key,u=a.value;null==t[s]&&(o[s]=u())}i.super_init(this,l.Forma,l.Forma.prototype.init_812f,e,o)},init_7186:function(e){var t={kind:r.KIND,style:R.TextStyle.createDefault(),text:S.TextModel.init_d41d()};this.init_812f(e,t)},init_d1c9:function(e,t){i.super_init(this,l.Forma,l.Forma.prototype.init_d1c9,e,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},didChangeState:function(e){i.count(e)>0&&(this.cachedBounds_=null,this.cachedSize_=null),i.keys(e).includes(r.PROPERTY_TEXT)&&(this.cachedText_=null,this.graphemeCount_=-1,this.cachedFont_=null,this.cachedSize_=null,this.cachedColor_=null,this.cachedStrokeColor_=null,this.cachedStrokeWidth_=null,this.cachedTextLook_=null,this.cachedTracking_=null),l.Forma.prototype.didChangeState.call(this,e)},clearCache:function(){l.Forma.prototype.clearCache.call(this),this.renderRuns.clear()},updateEventForProperty:function(e){return e==r.PROPERTY_TEXT?new d.FormaGeometryChangedEvent(this):l.Forma.prototype.updateEventForProperty.call(this,e)},postDecode:function(){var e,t,n,r,o;if(l.Forma.prototype.postDecode.call(this),(t=i.opt(this.model_.getProperty(S.TextModel.PROPERTY_FONT_NAME),(function(e){return e.arrayValue})))&&(n=i.opt(i.first(t),(function(e){return e.dictionaryValue})))&&(r=i.opt(n[T.TextAttribute.PROPERTY_VALUE],(function(e){return e.dictionaryValue})))&&null!=(o=i.opt(r[u.FontDescriptor.PROPERTY_POSTSCRIPT_NAME],(function(e){return e.stringValue})))){var a=this.fontDescriptor;a.postScriptName==o&&a.availability==u.FontAvailability.LOADED||i.opt(this.page.document,(function(e){return e.recordMissingFont(o)}))}var c,d,h=(e=i.opt(this.page.document,(function(e){return e.versionDecoded.vers})))||null!=e?e:0;if(h<v.TheoDocumentVersion.Grouping){var p=this.fontColor;i.eq(_._equality_SolidColor_SolidColor,p,this.style.colors.fieldPrimary)||this.style.colors.setColor(s.ColorRole.FieldPrimary,p)}h<=v.TheoDocumentVersion.FourColorsAndOpacities&&(c=this.lockupStyle)&&(d=c.colors.fieldPrimary)&&!i.eq(_._equality_SolidColor_SolidColor,this.style.colors.fieldPrimary,d)&&(p=this.fontColor,this.textLook==y.LockupTextLook.FillAndOutline2?this.style.colors.setColor(s.ColorRole.FieldSecondary,p):y.LockupStyle.isShadowLook(this.textLook)&&this.style.colors.setColor(s.ColorRole.Shadow,p))},model_:{get:function(){return this.get(r.PROPERTY_TEXT)},set:function(e){this.set(r.PROPERTY_TEXT,e)}},textStyle:{get:function(){return i.as(this.get(r.PROPERTY_TEXT_STYLE),R.TextStyle)},set:function(e){this.set(r.PROPERTY_TEXT_STYLE,e)}},rangeInLockup_:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_RANGEINLOCKUP),A.TextRange))||null!=e?e:new A.TextRange(0,0)},set:function(e){this.set(r.PROPERTY_RANGEINLOCKUP,e)}},rowIndex_:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_ROWINDEX),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_ROWINDEX,e)}},graphemeCount:{get:function(){return-1==this.graphemeCount_&&(this.graphemeCount_=p.GraphemeUtils.countGraphemes(this.model_.text)),this.graphemeCount_}},isText:function(){return!0},boundsInCoordSpace:function(e){if(0==this.text.length)return E.TheoRect.Zero;if(null==this.cachedBounds_){var t=this.fontStrokeWidth;this.cachedBounds_=f.Host.textModelUtils.measureBoundsForLayout(this.text,this.fontDescriptor,this.fontSize,this.tracking),t!=r.STROKEWIDTH_ZERO&&(this.cachedBounds_=this.cachedBounds_.insetXY(-t/2,-t/2))}return this.cachedBounds_.transform(e)},baselineBoundsInCoordSpace:function(e){return 0==this.text.length?E.TheoRect.Zero:f.Host.textModelUtils.measureBaselineBounds(this.text,this.fontDescriptor,this.fontSize,this.tracking).transform(e)},setTextProperties:function(e,t,n,r,o,l,u,c,h,p,f){var m=new d.FormaGeometryChangedEvent(this);this.beginUpdate(m);var g=this.model_;null!=this.cachedText_&&e==this.cachedText_||(g.text=e,this.cachedText_=e,this.graphemeCount_=-1),g.setAttr(t,S.TextModel.PROPERTY_FONT_NAME),g.setAttr(n,S.TextModel.PROPERTY_FONT_SIZE),g.setAttr(r,S.TextModel.PROPERTY_FONT_COLOR),g.setAttr(o,S.TextModel.PROPERTY_FONT_STROKE_COLOR),g.setAttr(l,S.TextModel.PROPERTY_FONT_STROKE_WIDTH),g.setAttr(u,S.TextModel.PROPERTY_TEXT_LOOK),g.setAttr(c,S.TextModel.PROPERTY_TRACKING),this.cachedFont_=null,this.cachedSize_=null,this.cachedColor_=null,this.cachedStrokeColor_=null,this.cachedStrokeWidth_=null,this.cachedTextLook_=null,this.cachedTracking_=null,this.cachedBounds_=null,this.rangeInLockup_=h,this.rowIndex_=p;var T=this.fontColor;a.CoreAssertDebugOnly.isTrue(f==s.ColorRole.FieldPrimary||f==s.ColorRole.FieldSecondary||f==s.ColorRole.Shadow,"we currently only use primary, secondary or shadow as roles for textForma items",void 0,"TextForma.setTextProperties","TextForma.swift",263),a.CoreAssertDebugOnly.isTrue(f==s.ColorRole.FieldSecondary&&u==y.LockupTextLook.FillAndOutline2||f!=s.ColorRole.FieldSecondary,"currently colorRole secondary is only used for puffy text",void 0,"TextForma.setTextProperties","TextForma.swift",264),f!=s.ColorRole.FieldSecondary&&null!=this.style.colors.fieldSecondary&&this.style.colors.setColor(s.ColorRole.FieldSecondary,null),f!=s.ColorRole.Shadow&&null!=this.style.colors.shadow&&this.style.colors.setColor(s.ColorRole.Shadow,null),f!=s.ColorRole.FieldPrimary&&this.style.colors.setColor(f,T),i.eq(_._equality_SolidColor_SolidColor,this.style.colors.fieldPrimary,T)||this.style.colors.setColor(s.ColorRole.FieldPrimary,T),this.endUpdate(m)},clearTextFormaText:function(){var e=new d.FormaGeometryChangedEvent(this);this.beginUpdate(e);var t=this.model_;null!=this.cachedText_&&this.text==this.cachedText_||(t.text="",this.cachedText_="",this.graphemeCount_=-1),this.endUpdate(e)},text:{get:function(){var e;return null!=(e=this.cachedText_)?e:(this.cachedText_=this.model_.text,this.cachedText_)}},fontDescriptor:{get:function(){var e;return(e=this.cachedFont_)?e:(this.cachedFont_=i.opt(this.model_.fontName,(function(e){return e.value}))||i.opt(i.opt(this.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData})),m.LegacyCoreAssert.isTrue(null!=this.cachedFont_,"Why isn't there a font set?",void 0,"TextForma","TextForma.swift",313),this.cachedFont_||S.TextModel.defaultFontName.value)}},fontSize:{get:function(){var e,t;return null!=(t=this.cachedSize_)?t:(this.cachedSize_=i.opt(this.model_.fontSize,(function(e){return e.value})),m.LegacyCoreAssert.isTrue(null!=this.cachedSize_,"Why isn't there a size set in the model?",void 0,"TextForma","TextForma.swift",323),(e=this.cachedSize_)||null!=e?e:S.TextModel.defaultFontSize.value)}},fontColor:{get:function(){var e;return(e=this.cachedColor_)?e:(this.cachedColor_=i.opt(this.model_.fontColor,(function(e){return e.value}))||i.opt(this.lockupStyle,(function(e){return e.colors.fieldPrimary})),m.LegacyCoreAssert.isTrue(null!=this.cachedColor_,"Why isn't there a color set?",void 0,"TextForma","TextForma.swift",333),this.cachedColor_||S.TextModel.defaultFontColor.value)}},fontStrokeColor:{get:function(){var e;return(e=this.cachedStrokeColor_)?e:(this.cachedStrokeColor_=i.opt(this.model_.fontStrokeColor,(function(e){return e.value}))||i.opt(this.lockupStyle,(function(e){return e.colors.fieldSecondary})),m.LegacyCoreAssert.isTrue(null!=this.cachedStrokeColor_,"Why isn't there a color set?",void 0,"TextForma","TextForma.swift",343),this.cachedStrokeColor_||S.TextModel.defaultFontStrokeColor.value)}},textLook:{get:function(){var e,t,n;return null!=(t=this.cachedTextLook_)?t:(null!=(n=i.opt(this.model_.textLook,(function(e){return e.value})))&&(this.cachedTextLook_=y.LockupTextLook.toCaseValue(n)),this.cachedTextLook_=(e=this.cachedTextLook_)||null!=e?e:y.LockupTextLook.Fill,this.cachedTextLook_)}},fontStrokeWidth:{get:function(){var e,t;return null!=(t=this.cachedStrokeWidth_)?t:(this.cachedStrokeWidth_=(e=i.opt(this.model_.fontStrokeWidth,(function(e){return e.value})))||null!=e?e:r.STROKEWIDTH_ZERO,this.cachedStrokeWidth_)}},tracking:{get:function(){var e,t;return null!=(t=this.cachedTracking_)?t:(this.cachedTracking_=(e=i.opt(this.model_.tracking,(function(e){return e.value})))||null!=e?e:r.TRACKING_ZERO,this.cachedTracking_)}},rangeInLockup:{get:function(){return this.rangeInLockup_}},lockupForma:{get:function(){var e=function(e){return e.visit(l.FormaTraversal.NearestAncestor,(function(e,t,n){var r;return!!(r=e.controller)&&r instanceof C.TypeLockupController}))};return m.LegacyCoreAssert.isTrue(e(this)==i.opt(i.opt(this.parent,(function(e){return e.parent})),(function(e){return e.parent})),"Unexpected number of nodes between text forma and lockup forma",void 0,"TextForma","TextForma.swift",391),i.as(e(this),h.GroupForma)}},lockupStyle:{get:function(){return i.as(i.opt(this.lockupForma,(function(e){return e.style})),y.LockupStyle)}},isRangeStart:function(){var e,t=this.text.includes("");if(e=i.as(i.opt(this.lockupForma,(function(e){return e.controller})),C.TypeLockupController))for(var n=i.iter(e.getCharacterStyleRanges());!n.done;n.next()){var r=n.value;if(t){if(r.end==this.rangeInLockup.end)return!0}else if(r.start==this.rangeInLockup.start)return!0}return!1},isRangeEnd:function(){var e,t=this.text.includes("");if(e=i.as(i.opt(this.lockupForma,(function(e){return e.controller})),C.TypeLockupController))for(var n=i.iter(e.getCharacterStyleRanges());!n.done;n.next()){var r=n.value;if(t){if(r.start==this.rangeInLockup.start)return!0}else if(r.end==this.rangeInLockup.end)return!0}return!1},rowIndex:{get:function(){return this.rowIndex_}},getBoundsCenter:function(){var e;if(e=i.opt(this.bounds,(function(e){return e.center}))){if(!f.Host.textModelUtils.usePGMRenderer())return e;var t,n;if(null!=(t=i.opt(i.as(i.opt(this.lockupForma,(function(e){return e.controller})),C.TypeLockupController),(function(e){return e.text})))&&(n=i.opt(i.opt(this.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData})))){var r=g.getTypographicBoundingRatiosOfString(t,n,!1),o=r.heightRatio*this.fontSize/2+n.capRatio*this.fontSize-r.textVerticalOffsetRatio*this.fontSize;return new D.TheoPoint(e.x,o)}return e}return D.TheoPoint.ZERO},isDecorationTextForma:function(){return this.style.colors.count>1},isWhiteSpace:function(){return P.TypeLockupUtils.isWhiteSpace(this.model_.text)}}}),r)},f9IM:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("URxh"),s=n("c2hD"),l=n("YxjU"),u=n("RkYL");o.MotionSourceStacked=(r=function(){},i.defineClass({name:"MotionSourceStacked",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=l.MotionSourceFadeInV.getSrcKeyframes(e),r=s.MotionSourceFadeInH.getSrcKeyframes(e);return t.push(n[0]),t.push(new a.KeyFrame(u.TheoTime.fromSeconds(.25),n[1].timingFunction,n[1].placement,n[1].bounds,n[1].style)),t.push(new a.KeyFrame(u.TheoTime.fromSeconds(.25),r[0].timingFunction,r[0].placement,r[0].bounds,r[0].style)),t.push(new a.KeyFrame(u.TheoTime.fromSeconds(.5),r[1].timingFunction,r[1].placement,r[1].bounds,r[1].style)),t.push(new a.KeyFrame(u.TheoTime.fromSeconds(.5),r[0].timingFunction,r[0].placement.inverse,r[0].bounds,r[0].style)),t.push(new a.KeyFrame(u.TheoTime.fromSeconds(.75),r[1].timingFunction,r[1].placement,r[1].bounds,r[1].style)),t.push(new a.KeyFrame(u.TheoTime.fromSeconds(.75),n[0].timingFunction,n[0].placement.inverse,n[0].bounds,n[0].style)),t.push(new a.KeyFrame(u.TheoTime.fromSeconds(1),n[1].timingFunction,n[1].placement,n[1].bounds,n[1].style)),t}}}),r)},fAXt:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("0wFF"),s=n("gXiO"),l=n("6ZWm"),u=n("cmoc"),c=n("P83h"),d=n("X0GW"),h=n("iCxV"),p=n("lmwz"),f=n("fNpk"),m=n("tGKA"),g=n("oKlP");o.TransformFacade=(r=function(){s.CoreObject.call(this)},i.defineClass({name:"TransformFacade",ctor:r,superName:"CoreObject",statics:{translateForma:function(e,t){e.move(m.Matrix2D.translation(t))},nudgeFormaeInPageSpace:function(e,t){if(f.LegacyCoreAssert.isTrue(e.length>0,"can't nudge 0 formae",void 0,"TransformFacade.nudgeFormaeInPageSpace","TransformFacade.swift",25),0!=e.length){var n,o=1,s=i.first(e);(n=i.opt(i.opt(s,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))&&(o=Math.sqrt(Math.abs(n.determinant)));var l=t.divide(o);l=l.multiply(2),r.translateFormaeInPageSpace(e,l),e.length>1?i.opt(h.Host.logging,(function(t){return t.logToAnalytics(a.AnalyticsConstants.kAnalyticsDataMultipleNudged,{contextualData1:"formae count: "+e.length})})):s.isImage()?i.opt(h.Host.logging,(function(e){return e.logToAnalytics(a.AnalyticsConstants.kAnalyticsDataImageNudged,{})})):s.isShape()?i.opt(h.Host.logging,(function(e){return e.logToAnalytics(a.AnalyticsConstants.kAnalyticsDataShapeNudged,{})})):s.isText()&&i.opt(h.Host.logging,(function(e){return e.logToAnalytics(a.AnalyticsConstants.kAnalyticsDataTextNudged,{})}))}},translateFormaeInPageSpace:function(e,t){r.transformFormaeInPageSpaceAboutPoint(e,m.Matrix2D.translation(t),g.TheoPoint.ZERO)},transformFormaeInPageSpaceAboutPoint:function(e,t,n,r){var o;void 0===r&&(r=null);for(var a=m._asterisk_Matrix2D_Matrix2D(m._asterisk_Matrix2D_Matrix2D(m.Matrix2D.translation(g._negate_TheoPoint(n)),t),m.Matrix2D.translation(n)),s=i.iter(e);!s.done;s.next()){var h,f,y=s.value,_=y;if(null==y.controller||y.controller.floating&&!p.ImageFacade.inCropMode(y)||(h=i.as(y,u.FrameForma))&&(_=h.childAt(0)),f=_.parent){var T=new c.FormaAnimationTransactionEvent(_);T.duration=0,_.beginUpdate(T);var v,C=_.placement,P=m._asterisk_Matrix2D_Matrix2D(m._asterisk_Matrix2D_Matrix2D(f.totalPlacement,a),f.totalPlacement.inverse);if(_.move(P),v=i.as(f.controller,l.FrameController)){var S;(S=i.opt(r,(function(e){return e.transformValues})))&&(_.placement=_.placement.scaleTo(S.xscale,S.yscale));var D,A=C.transformValues.xscale;v.updateAfterChildTransform(),Math.abs(A-_.placement.transformValues.xscale)<.001&&1!=Math.abs(t.transformValues.xscale)&&(_.placement=C,v.updateCropModeImage(),(D=p.ImageFacade.getCutoutMaskFormaForForma(_))&&p.ImageFacade.updateCutoutMaskPlacement(_,D))}((o=i.opt(i.opt(_.parent,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=o)&&o&&d.GroupFacade.updateUserGroupHierarchy(_.parent),_.endUpdate(T)}}},justTransformFormaInPageSpaceAboutPoint:function(e,t,n){var r;if(r=e.parent){var o=m._asterisk_Matrix2D_Matrix2D(m._asterisk_Matrix2D_Matrix2D(m.Matrix2D.translation(g._negate_TheoPoint(n)),t),m.Matrix2D.translation(n)),i=m._asterisk_Matrix2D_Matrix2D(m._asterisk_Matrix2D_Matrix2D(r.totalPlacement,o),r.totalPlacement.inverse);e.move(i)}},transformInPageSpaceAboutFormaUV:function(e,t,n){r.transformFormaeInPageSpaceAboutPoint([e],t,m._asterisk_TheoPoint_Matrix2D(e.bounds.evalXY(n.x,n.y),e.totalPlacement))},transformAboutFormaCenter:function(e,t){var n;if(n=e.parent){var o=new g.TheoPoint(.5,.5);if(n.controller instanceof l.FrameController){var i=n.bounds.transform(e.parent.totalPlacement).center,a=e.totalPlacement.inverse.transformPoint(i);o=e.bounds.locatePoint(a)}r.transformInPageSpaceAboutFormaUV(e,t,o)}else f.LegacyCoreAssert.fail("trying to rotate a forma which doesnt have a parent",void 0,"TransformFacade.transformAboutFormaCenter","TransformFacade.swift",168)},scaleForma:function(e,t){var n=m.Matrix2D.scalingXY(t,t);r.transformAboutFormaCenter(e,n)},flipForma:function(e,t){var n=t?m.Matrix2D.scalingXY(1,-1):m.Matrix2D.scalingXY(-1,1);r.transformAboutFormaCenter(e,n)},isFormaFlipped:function(e,t){return t?e.placement.a>0&&e.placement.d<0:e.placement.a<0&&e.placement.d>0},rotateForma:function(e,t){var n=m.Matrix2D.rotation(Math.cos(t),Math.sin(t));r.transformAboutFormaCenter(e,n)},currentRotation:function(e){var t,n,r;return(t=i.as(e,u.FrameForma))&&(n=i.opt(i.opt(t.page.document,(function(e){return e.controller})),(function(e){return e.selection})))&&n.inCropMode&&(r=p.ImageFacade.getImageFormaForForma(t))?r.rotation():e.rotation()}}}),r)},fNpk:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("SpAV"),s=n("gXiO"),l=n("iCxV"),u=n("8vXU");o.LegacyCoreAssert=(r=function(){s.CoreObject.call(this)},i.defineClass({name:"LegacyCoreAssert",ctor:r,superName:"CoreObject",statics:{newLog:function(e){return i.opt(l.Host.logging,(function(t){return t.newLog(e)}))||new u.CoreLog(e,u.CoreLogToCoreAssert.INSTANCE)},kSwiftFileSuffix:".swift",fail:function(e,t,n,r,o){void 0===t&&(t={}),void 0===n&&(n="LegacyCoreAssert.fail"),void 0===r&&(r="LegacyCoreAssert.swift"),void 0===o&&(o=34),a.CoreAssertDebugOnly.fail(e,t,n,r,o)},isTrue:function(e,t,n,r,o,i){void 0===n&&(n={}),void 0===r&&(r="LegacyCoreAssert.isTrue"),void 0===o&&(o="LegacyCoreAssert.swift"),void 0===i&&(i=43),a.CoreAssertDebugOnly.isTrue(e,t,n,r,o,i)},isFalse:function(e,t,n,r,o,i){void 0===n&&(n={}),void 0===r&&(r="LegacyCoreAssert.isFalse"),void 0===o&&(o="LegacyCoreAssert.swift"),void 0===i&&(i=52),a.CoreAssertDebugOnly.isFalse(e,t,n,r,o,i)}}}),r)},fVJ2:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("gXiO"),u=n("N5RB"),c=n("O60Y"),d=n("dJuF"),h=n("SmK9"),p=n("13MC"),f=n("ZhwN"),m=n("iCxV"),g=n("fNpk");a.IDBObject=s.defineProtocol("IDBObject",{database:"IDatabase",state:"IDBObjectState",persisted:"Boolean",className:"String",getProperty:"(String) -> DBProperty",setProperty:"(String, DBProperty) -> Void",removeProperty:"(String) -> Void",abandonChanges:"() -> Void"}),a.DBDeletedObject=(r=function(e){this.db_=e,l.CoreObject.call(this),this.state_=new p.DBObjectDeletedState(this)},s.defineClass({name:"DBDeletedObject",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IDBObject"==e}},props:{database:{get:function(){return this.db_}},state:{get:function(){return this.state_},set:function(e){g.LegacyCoreAssert.fail("Cannot set the state of a deleted object",void 0,"DBDeletedObject","DBObject.swift",58)}},persisted:{get:function(){return!1}},getProperty:function(e){return null},setProperty:function(e,t){g.LegacyCoreAssert.fail("Cannot set a proeprty on a deleted object",void 0,"DBDeletedObject.setProperty","DBObject.swift",63)},removeProperty:function(e){g.LegacyCoreAssert.fail("Cannot remove a property from a deleted object",void 0,"DBDeletedObject.removeProperty","DBObject.swift",64)},className:{get:function(){return""}},abandonChanges:function(){}}}),r),a.DBObject=(o=function(){this.initialState_=null,this.childObjects_=[],this.childObjectProperties_={},this.noOpSetter=function(e){},this.cachedValues_={},this.decodedObjects_={},this.validateOnSet=!1},s.defineClass({name:"DBObject",ctor:o,superName:"CoreObject",statics:{instantiateItemDescendants:function(e,t){var n,r,i;if(n=s.as(e,o))n.instantiateDescendants();else if(r=s.as(e,["Array","Any"])){var a;if(a=t.arrayValue)for(var l=s.iter(s.toSequence(a));!l.done;l.next()){var u=l.value,c=u.offset,d=u.element;o.instantiateItemDescendants(r[c],d)}}else(i=s.as(e,["Dictionary","String","Any"]))&&t.isDictionary&&t.forEachDictionaryProperty((function(e,t){var n;null!=(n=i[e])&&o.instantiateItemDescendants(n,t)}))},_implements:function(e){return"IDBObject"==e}},props:{database:{get:function(){return g.LegacyCoreAssert.isTrue(null!=this.db_,"Constant objects are not bound to a database",void 0,"DBObject","DBObject.swift",100),this.db_}},state:{get:function(){return this.state_||this.initialState},set:function(e){var t;if(g.LegacyCoreAssert.isTrue(null!=this.db_,"Cannot change the state of a constant object",void 0,"DBObject","DBObject.swift",107),g.LegacyCoreAssert.isTrue(!(this.initialState_ instanceof p.DBChildObjectState)||e===this.initialState_,"Child objects should have their states changed via a parent object.",void 0,"DBObject","DBObject.swift",108),t=s.as(e,p.DBChildObjectState))this.state_=t,this.initialState_=t;else if(null==this.state_&&null==this.initialState_&&(this.initialState_=e,this.state_=e),e!==this.state_){var n=s.clone(s.opt(this.state_,(function(t){return t.diff(e)})));null!=n&&s.count(n)>0&&this.willChangeState(n),this.state_=e,this.db_.objectStateChanged(e),null!=n&&s.count(n)>0&&(s.removeAll(this.cachedValues_),this.didChangeState(n))}}},removeChildObject:function(e){var t;null!=(t=s.indexOf(this.childObjects_,e))&&(e.removeAllChildren(),this.childObjects_.splice(t,1))},removeAllChildren:function(){for(var e=s.iter(this.childObjects_);!e.done;e.next()){var t=e.value;t.removeAllChildren(),t.persisted&&s.opt(s.as(this.db_.mutableState,p.DBMutableState),(function(e){return e.removeObject(t.id)}))}this.childObjects_.splice(0),s.removeAll(this.childObjectProperties_)},persistToDatabase:function(e,t){this.db_=e,this.guid_=t;for(var n=s.iter(this.childObjects_);!n.done;n.next()){var r=n.value;g.LegacyCoreAssert.isFalse(r.persisted,"Child object already persisted when its parent wasn't",void 0,"DBObject.persistToDatabase","DBObject.swift",160),e.addObject(f.GUIDUtils.makeGUID(),r)}},addChildObject:function(e,t){var n;e.convertToChildObject(this,t),this.persisted&&!e.persisted&&this.database.addObject(f.GUIDUtils.makeGUID(),e),null==t.parent&&((n=this.childObjectProperties_[t.name])&&this.removeChildObject(n),this.childObjectProperties_[t.name]=e),this.childObjects_.push(e)},createChildObject:function(e,t){var n,r=null;if(null!=(n=a.DBHostObject.factory(e))){var i,l=p.DBChildObjectState.init_94ed(this,t),u=f.GUIDUtils.makeGUID();if(null!=(r=s.as(n(u,this.db_,l,null),o)))l.object=r,s.opt(this.db_,(function(e){return e.addObject(u,r)})),null==t.parent&&((i=this.childObjectProperties_[t.name])&&this.removeChildObject(i),this.childObjectProperties_[t.name]=r),this.childObjects_.push(r)}return r},childObjects:{get:function(){return this.childObjects_.concat()}},descendantObjectsMA:{get:function(){for(var e=this.childObjects_.slice(0,this.childObjects_.length),t=s.iter(this.childObjects_);!t.done;t.next()){var n=t.value;s.append(e,n.descendantObjectsMA)}return e}},descendantObjects:{get:function(){return this.descendantObjectsMA.concat()}},convertToChildObject:function(e,t){if(!this.isChildObject){var n=s.clone(this.state.allProperties),r=p.DBChildObjectState.init_7008(this,e,t);this.initialState_=r,this.state_=r,r.setProperties(n),r.savePendingProperties()}return this.state},isChildObject:{get:function(){return this.initialState_ instanceof p.DBChildObjectState}},persisted:{get:function(){return null!=this.db_}},initialized:{get:function(){return null!=this.initialState_}},willChangeState:function(e){},didChangeState:function(e){},className:{get:function(){return g.LegacyCoreAssert.fail("Object class name not provided",void 0,"DBObject","DBObject.swift",239),""}},init_3f7c:function(e){var t,n=e instanceof p.DBChildObjectState;this.guid_=n?f.GUIDUtils.makeGUID():"",l.CoreObject.call(this),!n&&s.is(e,p.IDBObjectMutableState)?(this.initialState_=p.DBObjectState.init_2a9a(this,e.allProperties),this.state_=p.DBObjectMutableState.init_226b(this.initialState_)):(this.initialState_=e,this.state_=e,(t=s.as(e,p.DBChildObjectState))&&(t.object=this))},init_dd5d:function(e,t){this.guid_="",l.CoreObject.call(this),this.initialState_=p.DBObjectMutableState.init_2a9a(this,e),this.state_=this.initialState_;for(var n=s.clone(e),r=s.iter(t);!r.done;r.next()){var o,i=r.key,a=r.value;(o=h.DBSchema.currentSchema.getPropertyCodec(i,this.className))&&(n[i]=o.encode(d.DBNamePath.init_b14a(i),a,this))}this.initialState_=p.DBObjectState.init_2a9a(this,n),this.state_=p.DBObjectMutableState.init_226b(this.initialState_)},init_866e:function(e,t){var n,r=e instanceof p.DBChildObjectState;this.guid_=t,l.CoreObject.call(this),!r&&s.is(e,p.IDBObjectMutableState)?(this.initialState_=p.DBObjectState.init_2a9a(this,e.allProperties),this.state_=p.DBObjectMutableState.init_226b(this.initialState_)):(this.initialState_=e,this.state_=e,(n=s.as(e,p.DBChildObjectState))&&(n.object=this))},init_11e0:function(e){this.db_=e,this.guid_=f.GUIDUtils.makeGUID(),l.CoreObject.call(this),this.db_.addObject(this.guid_,this)},init_5079:function(e,t,n,r){this.db_=e,this.guid_=s.isEmpty(r)?f.GUIDUtils.makeGUID():r,l.CoreObject.call(this),this.initialState_=p.DBObjectMutableState.init_2a9a(this,t),this.state_=this.initialState_;for(var o=s.clone(t),i=s.iter(n);!i.done;i.next()){var a,u=i.key,c=i.value;(a=h.DBSchema.currentSchema.getPropertyCodec(u,this.className))&&(o[u]=a.encode(d.DBNamePath.init_b14a(u),c,this))}this.initialState_=p.DBObjectState.init_2a9a(this,o),this.state_=null,this.db_.addObject(this.guid_,this)},init_3181:function(e,t,n){var r;this.db_=e,this.guid_=n,l.CoreObject.call(this),(r=s.as(t,p.IDBObjectMutableState))?this.initialState_=r.assign(this):this.initialState_=t,this.state_=s.as(this.initialState_,p.DBChildObjectState),this.db_.addObject(this.guid_,this)},init_67b3:function(e){this.db_=e.database,this.guid_=f.GUIDUtils.makeGUID(),l.CoreObject.call(this),this.db_.addObject(this.guid_,this)},id:{get:function(){return this.guid_}},fork:function(e){return this.forkWithLink(e,null)},forkWithLink:function(e,t){return this.forkToDatabase(e,!0,s.opt(t,(function(e){return e.database}))||this.db_,t)},forkPropertyToDatabase:function(e,t,n,r,i){var a,l=this,u=null;if(null!=n.linkID){if(t){var h=s.as(n.objValue,o);if(null!=h){var p,m=f.GUIDUtils.makeGUID(),g=null!=i?c.DBLink.init_8408(m,i,r):null;(p=s.opt(h,(function(e){return e.forkToDatabase(m,!0,i,g)})))&&(u=d.DBProperty.objProperty(d.DBNamePath.init_b14a(e),p,this.className,r))}}}else if(a=n.arrayValue){for(var y=[],_=s.iter(s.toSequence(a));!_.done;_.next()){var T,v=_.value,C=v.offset,P=v.element;(T=this.forkPropertyToDatabase(s.toString(C),t,P,r,i))&&y.push(T)}u=null!=n.className?d.DBProperty.arrayEncoded(d.DBNamePath.init_b14a(e),y,n.className):d.DBProperty.arrayProperty(d.DBNamePath.init_b14a(e),y)}else if(n.isDictionary){var S={};n.forEachDictionaryProperty((function(e,n){var o;(o=l.forkPropertyToDatabase(e,t,n,r,i))&&(S[e]=o)})),u=null!=n.className?d.DBProperty.dictEncoded(d.DBNamePath.init_b14a(e),S,n.className):d.DBProperty.dictProperty(d.DBNamePath.init_b14a(e),S)}else u=n.copy();return u},forkToDatabase:function(e,t,n,r){var i,l=null;if(null!=(i=a.DBHostObject.factory(this.className))){for(var u=s.clone(this.state.allProperties),c={},d=s.iter(u);!d.done;d.next()){var h,f=d.key,m=d.value;(h=this.forkPropertyToDatabase(f,t,m,e,n))&&(c[f]=h)}var g=p.DBObjectMutableState.init_6271(this.className,c);l=s.as(i(e,n,g,r),o)}return l},getCodec:function(e){return h.DBSchema.currentSchema.getPropertyCodec(e,this.className)},clearCache:function(){s.removeAll(this.cachedValues_)},abandonChanges:function(){this.clearCache()},host:{get:function(){var e,t;return(e=s.as(this.state_,p.DBChildObjectState))&&(t=s.as(e.parentObject,o))?t.host:s.as(s.opt(this.db_,(function(e){return e.host})),a.DBHostObject)}},get:function(e){var t,n,r,i,a,l,u,c,p,f=this,y=this.getProperty(e);if(null==y||y instanceof d.DBDeletedProperty)return null;if(null!=(a=this.cachedValues_[e]))return a;if(l=this.childObjectProperties_[e]){if(s.opt(y,(function(e){return e.className==l.className})))return l;g.LegacyCoreAssert.isTrue(s.opt(y,(function(e){return"AlphaBlendFilter"==e.className||s.opt(y,(function(e){return"CompositeFilter"==e.className}))})),"Unexpected className",{className:(t=s.opt(y,(function(e){return e.className})))||null!=t?t:"nil",childObjectClassName:l.className},"DBObject.get","DBObject.swift",475),s.opt(m.Host.logging,(function(e){return e.info("ClassName is "+((n=s.opt(y,(function(e){return e.className})))||null!=n?n:"nil")+" childObject ClassName is "+l.className)}))}if(null!=(u=this.decodedObjects_[e])&&(c=this.database.getObject(u))){if(s.opt(y,(function(e){return e.className==c.className})))return c;g.LegacyCoreAssert.isTrue(s.opt(y,(function(e){return"AlphaBlendFilter"==e.className||s.opt(y,(function(e){return"CompositeFilter"==e.className}))})),"Unexpected className",{className:(r=s.opt(y,(function(e){return e.className})))||null!=r?r:"nil",dbObjectClassName:c.className},"DBObject.get","DBObject.swift",489),s.opt(m.Host.logging,(function(e){return e.info("ClassName is "+((i=s.opt(y,(function(e){return e.className})))||null!=i?i:"nil")+" database obj ClassName is "+c.className)}))}if(p=y){var _=s.opt(this.host,(function(e){return e.decodingSchema})),T=h.DBSchema.currentSchema.getPropertyCodec(e,this.className)||s.opt(_,(function(t){return t.getPropertyCodec(e,f.className)}));if(null!=T){var v,C=T.decode(p,this);return(v=s.as(C,o))?v.persisted&&(this.decodedObjects_[e]=v.id):null!=C&&(this.cachedValues_[e]=C),C}}return this.cachedValues_[e]},set:function(e,t){var n;s.removeKey(this.decodedObjects_,e),null==t?(s.removeKey(this.cachedValues_,e),this.removeProperty(e)):(n=h.DBSchema.currentSchema.getPropertyCodec(e,this.className))&&(this.cachedValues_[e]=t,this.updateProperty(e,t)||this.setProperty(e,n.encode(d.DBNamePath.init_b14a(e),t,this)))},mutable:{get:function(){return null!=this.db_&&(s.is(this.state_,p.IDBObjectMutableState)||null!=this.db_.mutableState)}},schemaRule:{get:function(){return h.DBSchema.currentSchema.rulesByName[this.className]}},getProperty:function(e){return this.state.getProperty(e)},setProperty:function(e,t){var n=this;if(!t.isEqual(this.getProperty(e))){g.LegacyCoreAssert.isTrue(!this.persisted||null!=this.db_.mutableState,"Cannot change the state of a persisted "+this.className+" object when the database is immutable",void 0,"DBObject.setProperty","DBObject.swift",538);var r,o=s.is(this.state_,p.IDBObjectMutableState)?s.as(this.state_,p.IDBObjectMutableState):s.opt(s.opt(this.db_,(function(e){return e.mutableState})),(function(e){return e.newObjectState(n)}));if(r=o){var i;if(this.isChildObject&&s.opt(s.opt(this.db_,(function(e){return e.mutableState})),(function(e){return e.setObjectState(n,r)})),this.validateOnSet&&(i=s.opt(this.schemaRule,(function(t){return t.getPropertyRule(e)})))){var a,l=i.validateProperty(t);if(a=s.as(l,h.DBValidationError))return void g.LegacyCoreAssert.fail("Failed to write property",{property:e,error:a.error},"DBObject.setProperty","DBObject.swift",553)}r.setProperty(e,t)}}},updateProperty:function(e,t){var n,r;return!(!(n=s.as(this.state_,p.IDBObjectMutableState))||!(r=h.DBSchema.currentSchema.getPropertyCodec(e,this.className)))&&n.updateProperty(e,t,r)},removeProperty:function(e){var t=this,n=this.getProperty(e);if(null!=n&&!(n instanceof d.DBDeletedProperty)){g.LegacyCoreAssert.isTrue(!this.persisted||null!=this.db_.mutableState,"Cannot remove a property from a persisted "+this.className+" object when the database is immutable",void 0,"DBObject.removeProperty","DBObject.swift",573);var r,o,i=s.is(this.state_,p.IDBObjectMutableState)?this.state_:this.db_.mutableState.newObjectState(this);if(this.validateOnSet&&(r=s.opt(this.schemaRule,(function(e){return e.getRequiredProperties()})))&&r.includes(e))return void g.LegacyCoreAssert.fail("Cannot remove required property",{property:e},"DBObject.removeProperty","DBObject.swift",582);this.isChildObject&&s.opt(s.opt(this.db_,(function(e){return e.mutableState})),(function(e){return e.setObjectState(t,i)})),i.removeProperty(e),(o=this.childObjectProperties_[e])&&(this.removeChildObject(o),s.removeKey(this.childObjectProperties_,e),this.persisted&&s.opt(s.as(this.db_.mutableState,p.DBMutableState),(function(e){return e.removeObject(o.id)})))}},matchProperties:function(e){g.LegacyCoreAssert.isTrue(!this.persisted||null!=this.db_.mutableState,"Cannot change the state of a persisted object when the database is immutable",void 0,"DBObject.matchProperties","DBObject.swift",605);var t=s.is(this.state_,p.IDBObjectMutableState)?this.state_:this.db_.mutableState.newObjectState(this);t.clear();for(var n=s.iter(e);!n.done;n.next()){var r=n.key,o=n.value;t.setProperty(r,o)}for(var i=s.iter(this.childObjects);!i.done;i.next()){var a=i.value;a.clearCache(),s.opt(s.as(a.state,p.DBChildObjectState),(function(e){return e.abandonPendingProperties()}))}this.clearCache()},makeMutable:function(){s.opt(this.db_,(function(e){return null!=e.mutableState}))&&this.db_.mutableState.makeObjectMutable(this)},emptyState:{get:function(){return null==this.emptyState_&&(this.emptyState_=p.DBObjectState.init_be8f(this)),this.emptyState_}},initialState:{get:function(){return this.initialState_||this.emptyState}},mutableState:{get:function(){return s.is(this.state_,p.IDBObjectMutableState)?this.state_:this.db_.mutableState.newObjectState(this)}},instantiateDescendants:function(){for(var e=s.iter(this.state.allProperties);!e.done;e.next()){var t,n,r=e.key,i=e.value;i.schemaType!=h.DBSchemaType.ArrayType&&i.schemaType!=h.DBSchemaType.ObjectType||null!=(t=this.get(r))&&(n=this.getProperty(r))&&o.instantiateItemDescendants(t,n)}},willCommitState:function(){},didCommitState:function(){}}}),o),a.DBHostObject=(i=function(){this.hostDB_=new u.PostDB},s.defineClass({name:"DBHostObject",ctor:i,superName:"DBObject",statics:{factories_:{},registerFactory:function(e,t){return null==i.factories_[e]&&(i.factories_[e]=t),i.factories_[e]},factory:function(e){return i.factories_[e]},_implements:function(e){return"IDBObject"==e}},props:{init_1be9:function(e,t,n){this.schema_=h.DBSchema.init_2af7(e);var r=this.hostDB_.beginTransaction("decode",null);this.initialStateID_=this.schema_.validateAndRead(t,this.hostDB_,(function(e){for(var t="Errors: ",r=s.iter(e);!r.done;r.next())t=t+"\n"+r.value.error;n(t)})),s.super_init(this,a.DBObject,a.DBObject.prototype.init_5079,this.hostDB_,{},{},this.initialStateID_),r.end(),this.hostDB_.host=this},init_7341:function(e,t){var n;void 0===t&&(t=null),this.schema_=h.DBSchema.init_2af7(e);var r=this.hostDB_.beginTransaction("decode",null);this.initialStateID_="",s.super_init(this,a.DBObject,a.DBObject.prototype.init_5079,this.hostDB_,{},{},(n=t)||null!=n?n:f.GUIDUtils.makeGUID()),r.end(),this.hostDB_.host=this},init_b80b:function(e){var t;void 0===e&&(e=null),this.schema_=null;var n=this.hostDB_.beginTransaction("decode",null);this.initialStateID_="",s.super_init(this,a.DBObject,a.DBObject.prototype.init_5079,this.hostDB_,{},{},(t=e)||null!=t?t:f.GUIDUtils.makeGUID()),n.end(),this.hostDB_.host=this},decodingSchema:{get:function(){return this.schema_||h.DBSchema.currentSchema}},willApplyDatabaseState:function(e){},didApplyDatabaseState:function(e){}}}),i)},fWxZ:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("6NRR"),l=n("KSe6"),u=n("CWW7"),c=n("9WSY"),d=n("yhkb"),h=n("quOg"),p=n("lqhW"),f=n("FNB+"),m=n("NxMp"),g=n("cmoc"),y=n("ylxa"),_=n("ML5t"),T=n("OdB2"),v=n("P83h"),C=n("9Lk3"),P=n("pnSN"),S=n("iCxV"),D=n("U010"),A=n("fdtz"),E=n("b/QB"),R=n("fNpk"),F=n("Quhx"),b=n("NbJN"),I=n("K0Rh"),O=n("9YN4"),k=n("enh0"),N=n("8t9B"),M=n("sIWg"),L=n("1NAc");i.FormaPage=(r=function(){this.formaFactory_=new m.DefaultFormaFactory,this.formaCache_={},this.pgmSource_=null,this.colorLibrary_=null},o={},a.defineClass({name:"FormaPage",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"FormaPage",factory:{get:function(){return void 0===o.factory&&(o.factory=function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),O.TheoDocument);return R.LegacyCoreAssert.isTrue(null!=i,"FormaPage needs a parent document",void 0,"FormaPage","FormaPage.swift",15),r.init_3144(e,t,n,i)}),o.factory},set:function(e){o.factory=e}},PROPERTY_KIND:"kind",PROPERTY_PAGE_SIZE:"size",PROPERTY_TEMPLATE_ID:"template-id",PROPERTY_COLOR_LIBRARY:"color-library",PROPERTY_SIZE_ID:"size-id",PROPERTY_ORIGINAL_SIZE_ID:"original-size-id",PROPERTY_CUSTOM_SIZE_FORMAT:"custom-size-format",PROPERTY_CUSTOM_SIZE_PPI:"custom-size-ppi",PROPERTY_EXPORT_DATA:"export-data",PROPERTY_CHILDREN:"children",DEFAULT_SIZE_ID:"Instagram",DEFAULT_ORIGINAL_SIZE_ID:"Unknown",DEFAULT_CUSTOM_SIZE_FORMAT:{get:function(){return void 0===o.DEFAULT_CUSTOM_SIZE_FORMAT&&(o.DEFAULT_CUSTOM_SIZE_FORMAT=y.PageExportFormat.PIXELS),o.DEFAULT_CUSTOM_SIZE_FORMAT}},DEFAULT_CUSTOM_SIZE_PPI:300,DEFAULT_PAGE_SIZE:{get:function(){return void 0===o.DEFAULT_PAGE_SIZE&&(o.DEFAULT_PAGE_SIZE=new L.TheoSize(1200,1200)),o.DEFAULT_PAGE_SIZE}},DCXTYPE:{get:function(){return"application/vnd.adobe.theo.forma+dcx"}},PATH:{get:function(){return"forma-document"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){this.document_=r,this.imageFilterLibrary_=new E.ImageFilterLibrary,this.imageCutoutLibrary_=new D.ImageCutoutLibrary,this.animationLibrary_=new l.AnimationLibrary,this.refineCutoutController_=new b.RefineCutoutController,a.super_init(this,F.PostDCXObject,F.PostDCXObject.prototype.init_3181,t,n,e),this.colorLibraryController_=new d.ColorLibraryController(this.colorLibrary,r),this.animationController_=new s.AnimationController(r)},init_d0e4:function(e){this.document_=e,this.imageFilterLibrary_=new E.ImageFilterLibrary,this.imageCutoutLibrary_=new D.ImageCutoutLibrary,this.animationLibrary_=new l.AnimationLibrary,this.refineCutoutController_=new b.RefineCutoutController,a.super_init(this,F.PostDCXObject,F.PostDCXObject.prototype.init_11e0,e.database),this.set(F.PostDCXObject.PROPERTY_PATH,r.PATH),this.set(F.PostDCXObject.PROPERTY_TYPE,r.DCXTYPE),this.set(r.PROPERTY_PAGE_SIZE,r.DEFAULT_PAGE_SIZE),this.set(r.PROPERTY_SIZE_ID,r.DEFAULT_SIZE_ID),this.set(r.PROPERTY_COLOR_LIBRARY,c.ColorLibrary.init_d41d()),this.colorLibraryController_=new d.ColorLibraryController(this.colorLibrary,e),this.animationController_=new s.AnimationController(e),this.root_=a.as(this.createForma(I.RootForma.KIND),P.GroupForma)},cleanupEmptyTextLockups:function(){var e=[];this.root_.visitAll(f.FormaTraversal.PreOrder,(function(t){var n;(n=a.as(t.controller,N.TypeLockupController))&&a.isEmpty(n.text)&&e.push(t)})),u.CreationFacade.deleteFormae(e,(function(){}))},postDecode:function(){var e=this;null==this.colorLibrary.color(a.as(this.colorLibraryController.getThemeColorKeys()[0],"String"))&&a.opt(this.colorLibraryController_,(function(t){return t.applyLegacyColorThemeFromDocument(e.document_)})),a.opt(this.colorLibraryController_,(function(e){return e.ensureDerivedColorsAreSet()})),this.cleanupEmptyTextLockups(),this.root_.visitAll(f.FormaTraversal.PostOrderWithAuxiliaries,(function(e){return e.postDecode()}))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},document:{get:function(){return this.document_}},view:{get:function(){return this.view_},set:function(e){this.view_=e}},pgm:{get:function(){return this.pgmSource_=this.pgmSource_||new _.FormaPagePGMSource(this),this.pgmSource_}},setPageSizeFromDesignSize:function(e){var t=Math.max(this.pageSize_.width,this.pageSize_.height),n=e.aspectRatio>1?Math.round(t/e.aspectRatio):t,r=Math.round(e.aspectRatio*n);this.sizeID=e.id,this.customSizeFormat=e.exportData.format,this.customSizePPI=e.exportData.PPI,this.templateID=null,this.setPageSize(new L.TheoSize(r,n),e.exportData)},setPageSize:function(e,t){if(void 0===t&&(t=null),null!=t&&Math.abs((t.dimensions.aspectRatio-e.aspectRatio)/Math.max(t.dimensions.aspectRatio,e.aspectRatio))>.02)R.LegacyCoreAssert.fail("Incompatible dimensions",void 0,"FormaPage.setPageSize","FormaPage.swift",169);else{var n=!1;if(e.equal(this.pageSize_)||(n=!0,this.pageSize_=e,this.root.bounds=M.TheoRect.fromSize(e),this.publish(new T.PageSizeUpdateMessage(this,e))),n||e.equal(r.DEFAULT_PAGE_SIZE)){var o=a.opt(a.opt(this.document,(function(e){return e.controller})),(function(e){return e.designController.view}));a.opt(o,(function(e){return e.pageSizeChanged()}))}this.exportData_=t}},getExportDataWithLimitTo:function(e){return this.getExportData(e,null)},getPageExportData:function(){return this.getExportData(null,null)},getExportData:function(e,t){var n=null;if(null!=this.exportData_)n=this.exportData_;else{var r=p.DesignSizeLibrary.getById(this.sizeID);null!=r&&(n=r.exportData)}var o=this.pageSize_.aspectRatio,i=null!=t?t:p.DesignSizeLibrary.MAX_EDGE;null==n&&(n=o<1?new y.FormaPageExportData(new L.TheoSize(Math.round(i*o),i),y.PageExportFormat.PIXELS):new y.FormaPageExportData(new L.TheoSize(i,Math.round(i/o)),y.PageExportFormat.PIXELS));var a=Math.max(n.pixelDimensions.width,n.pixelDimensions.height);return null!=e&&a>e&&(i=e,n=o<1?new y.FormaPageExportData(new L.TheoSize(Math.round(i*o),i),y.PageExportFormat.PIXELS):new y.FormaPageExportData(new L.TheoSize(i,Math.round(i/o)),y.PageExportFormat.PIXELS)),n},pageSize_:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_PAGE_SIZE),L.TheoSize))||null!=e?e:r.DEFAULT_PAGE_SIZE},set:function(e){this.set(r.PROPERTY_PAGE_SIZE,e)}},pageSize:{get:function(){return this.pageSize_}},templateID:{get:function(){return a.as(this.get(r.PROPERTY_TEMPLATE_ID),"String")},set:function(e){this.set(r.PROPERTY_TEMPLATE_ID,e)}},sizeID:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_SIZE_ID),"String"))||null!=e?e:r.DEFAULT_SIZE_ID},set:function(e){this.set(r.PROPERTY_SIZE_ID,e)}},originalSizeID:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_ORIGINAL_SIZE_ID),"String"))||null!=e?e:r.DEFAULT_ORIGINAL_SIZE_ID},set:function(e){this.set(r.PROPERTY_ORIGINAL_SIZE_ID,e)}},customSizeFormat:{get:function(){var e,t,n=(e=a.as(this.get(r.PROPERTY_CUSTOM_SIZE_FORMAT),"Int"))||null!=e?e:r.DEFAULT_CUSTOM_SIZE_FORMAT;return(t=y.PageExportFormat.toCaseValue(n))||null!=t?t:r.DEFAULT_CUSTOM_SIZE_FORMAT},set:function(e){this.set(r.PROPERTY_CUSTOM_SIZE_FORMAT,e)}},customSizePPI:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_CUSTOM_SIZE_PPI),"Double"))||null!=e?e:r.DEFAULT_CUSTOM_SIZE_PPI},set:function(e){this.set(r.PROPERTY_CUSTOM_SIZE_PPI,e)}},colorLibrary:{get:function(){return null==this.colorLibrary_&&(this.colorLibrary_=a.as(this.get(r.PROPERTY_COLOR_LIBRARY),c.ColorLibrary)),this.colorLibrary_}},setColorLibrary:function(e){this.colorLibrary_=e,this.set(r.PROPERTY_COLOR_LIBRARY,e)},colorLibraryController:{get:function(){return this.colorLibraryController_}},exportData_:{get:function(){return a.as(this.get(r.PROPERTY_EXPORT_DATA),y.FormaPageExportData)},set:function(e){this.set(r.PROPERTY_EXPORT_DATA,e)}},exportData:{get:function(){return this.exportData_}},children_:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_CHILDREN),["Array",f.Forma]))||null!=e?e:[]}},root_:{get:function(){return this.children_.length>0?a.as(this.children_[0],P.GroupForma):null},set:function(e){if(null!=e&&0==this.children_.length){var t=a.clone(a.as(this.get(r.PROPERTY_CHILDREN),["Array",f.Forma]));null!=t&&t.length>0?(t[0]=e,this.set(r.PROPERTY_CHILDREN,t)):this.set(r.PROPERTY_CHILDREN,[a.as(e,f.Forma)])}}},root:{get:function(){return this.root_}},hasRoot:function(){return null!=this.root_},imageFilterLibrary:{get:function(){return this.imageFilterLibrary_}},imageCutoutLibrary:{get:function(){return this.imageCutoutLibrary_}},animationLibrary:{get:function(){return this.animationLibrary_}},layoutLibrary:{get:function(){return this.document.gridLibrary}},animationController:{get:function(){return this.animationController_}},refineCutoutController:{get:function(){return this.refineCutoutController_}},imageColors:{get:function(){var e,t,n=[],r=a.clone(this.root_.filterWithCallback((function(e){return e instanceof A.ImageForma})));return r.length>0&&(e=a.as(r[0],A.ImageForma))&&(t=a.opt(e.contentNode,(function(e){return e.image})))&&a.append(n,t.getImageColors(10)),n}},formaByID:function(e){var t;return(t=this.formaCache_[e])?t:(t=this.root.formaByID(e))?(this.formaCache_[e]=t,t):null},getAllSelectableTopLevel:function(){var e;return null!=this.root_&&this.root_.childCount>0&&(e=a.as(this.root_.childAt(0),P.GroupForma))&&a.as(e.controller,C.GridController)?e.visitAsArray(f.FormaTraversal.JustChildren):[]},selectableFormaeIntersectingRect:function(e){var t=[];return this.root_.visit(f.FormaTraversal.PreOrder,(function(n,r,o){var i,s;return null!=n.controller&&n.controller.canMultiSelect&&!n.controller.userGroupChild&&(n.isFullCanvas||M.TheoRect.PointInCommon(e,n.totalPlacement.inverse,n.bounds)&&((i=a.as(n.parent,g.FrameForma))?M.TheoRect.PointInCommon(e,i.totalPlacement.inverse,i.bounds)&&t.push(n):(s=a.as(n,k.TextForma))?t.push(s.lockupForma):t.push(n))),!1})),t},formaAtPoint:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=null),void 0===r&&(r=null);var o,i=this,s=null;return this.root_.visit(f.FormaTraversal.PreOrder,(function(l,u,c){var d;if(d=a.opt(l.totalPlacement.inverse,(function(t){return t.transformPoint(e)}))){var p=Math.sqrt(Math.abs(l.totalPlacement.determinant));R.LegacyCoreAssert.isTrue(0!=p,"framescale is zero",void 0,"FormaPage.formaAtPoint","FormaPage.swift",448);var f=t/p;if(l.containsPoint(d,f)&&!l.isFullCanvas){if(i.document.controller.interactionMode==h.InteractionMode.AutomaticGrid&&null!=l.controller&&l.controller.floating&&!S.Host.platform.isWeb)return!0;if(null!=r&&0==r(l))return!1;if(((o=a.opt(l.controller,(function(e){return e.userGroup})))||null!=o)&&o)return!1;if(null!=n){for(var m=!1,y=a.iter(n);!y.done;y.next()){var _=y.value;if(l.kind==_&&(!l.isShape()||null!=l.controller)){m=!0;break}}if(0==m)return!1}var T,v;if(T=a.as(l.parent,g.FrameForma)){if(v=a.opt(T.totalPlacement.inverse,(function(t){return t.transformPoint(e)}))){var C=Math.sqrt(Math.abs(T.totalPlacement.determinant));R.LegacyCoreAssert.isTrue(0!=C,"framescale is zero",void 0,"FormaPage.formaAtPoint","FormaPage.swift",487);var P=t/C;T.containsPoint(v,P)&&(s=l)}}else s=l}}return!1})),s},formaAtPointInSelection:function(e,t){var n=null;return t.forEachSelected((function(t){return t.visit(f.FormaTraversal.PreOrder,(function(t,r,o){var i;if((i=a.opt(t.totalPlacement.inverse,(function(t){return t.transformPoint(e)})))&&t.containsPoint(i)&&!t.isFullCanvas){if(t instanceof k.TextForma)return n=t,!0;var s,l;(s=a.as(t.parent,g.FrameForma))?(l=a.opt(s.totalPlacement.inverse,(function(t){return t.transformPoint(e)})))&&s.containsPoint(l)&&(n=t):n=t}return!1}))})),n},createForma:function(e){var t=this.formaFactory_.createForma(this,e);if(null==t)return null;var n=new v.FormaCreatedEvent(t);return this.beginUpdate(n),t.initializeToDefaults(),this.endUpdate(n),t},createFormaWithController:function(e,t){var n=this.formaFactory_.createForma(this,e);if(null==n)return null;var r=new v.FormaCreatedEvent(n);return this.beginUpdate(r),n.initializeToDefaults(),n.controller=a.opt(a.opt(this.document_,(function(e){return e.controller})),(function(e){return e.controllerFactory.createController(t,n)})),this.endUpdate(r),n},createModelForma:function(e){var t=this.formaFactory_.createForma(this,e);return null==t?null:(t.isModel=!0,t)},beginUpdate:function(e){null!=this.view_&&(e.token=this.view_.beginViewUpdate(e)),this.publish(new T.FormaBeginUpdateMessage(this,e))},endUpdate:function(e){this.publish(new T.FormaEndUpdateMessage(this,e)),a.opt(this.view_,(function(t){return t.endViewUpdate(e.token)}))},formaCache:{get:function(){return this.formaCache_}},clearFormaCache:function(){this.formaCache_={}},removeFormaFromCache:function(e){a.removeKey(this.formaCache_,e)}}}),r)},fdtz:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("ascj"),u=n("FNB+"),c=n("6ZWm"),d=n("cmoc"),h=n("fWxZ"),p=n("P83h"),f=n("pnSN"),m=n("NkBu"),g=n("q5zr"),y=n("lmwz"),_=n("uWOl"),T=n("fNpk"),v=n("tGKA"),C=n("VkKB"),P=n("Zifs"),S=n("sIWg");a.LRUColorCacheEntry=(r=function(e,t){this.key=e,this.value=t},s.defineClass({name:"LRUColorCacheEntry",ctor:r}),r),a.LRUColorCache=(o=function(e){this.cachedItemsByKey_={},this.cachedItemsLRU_=[],void 0===e&&(e=50),this.maxEntries_=e},s.defineClass({name:"LRUColorCache",ctor:o,props:{get:function(e){var t;return(t=this.cachedItemsByKey_[e])?(s.remove(this.cachedItemsLRU_,t),this.cachedItemsLRU_.splice(0,0,t),t.value):null},remove:function(e){var t;(t=this.cachedItemsByKey_[e])&&(s.removeKey(this.cachedItemsByKey_,e),s.remove(this.cachedItemsLRU_,t))},add:function(e,t){(n=this.cachedItemsByKey_[e])&&(s.removeKey(this.cachedItemsByKey_,e),s.remove(this.cachedItemsLRU_,n));var n=new a.LRUColorCacheEntry(e,t);this.cachedItemsByKey_[e]=n,this.cachedItemsLRU_.splice(0,0,n);var r=this.cachedItemsLRU_.length;r>this.maxEntries_&&this.cachedItemsLRU_.splice(this.maxEntries_,r-this.maxEntries_)}}}),o),a.ImageForma=(i=function(){this.cachedBounds_=null,this.cachedContent_=null,this.avgColorCache_=new a.LRUColorCache,this.changeSubscriptions_=[]},s.defineClass({name:"ImageForma",ctor:i,superName:"Forma",statics:{KIND:{get:function(){return"Image"}},PROPERTY_CONTENTID:"content-id",PROPERTY_IMAGE_STYLE_DEPRECATED:"image-style",SCHEMA_CLASS_NAME:{get:function(){return"ImageForma"}},factory:{get:function(){return function(e,t,n,r){if(null!=t){var o=s.as(s.opt(s.opt(r,(function(e){return e.backLink})),(function(e){return e.dereference()})),f.GroupForma),a=s.as(s.opt(s.opt(r,(function(e){return e.backLink})),(function(e){return e.dereference()})),h.FormaPage);return T.LegacyCoreAssert.isTrue(null!=o||null!=a,"ImageForma needs a parent group or page",void 0,"ImageForma","ImageForma.swift",73),null!=o?i.init_3144(e,t,n,o):i.init_7dbd(e,t,n,a)}return i.init_d1c9(e,n)}}},propagateMaskContentChange:function(e){var t,n;if((t=s.opt(e,(function(e){return e.parent})))&&(n=y.ImageFacade.getImageFormaForForma(t))){var r=new p.FormaContentChangedEvent(n);n.beginUpdate(r),n.endUpdate(r)}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{deprecatedStyle_:{get:function(){return s.as(this.get(i.PROPERTY_IMAGE_STYLE_DEPRECATED),_.ImageStyle)}},init_3144:function(e,t,n,r){s.super_init(this,u.Forma,u.Forma.prototype.init_3144,e,t,n,r),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},init_7dbd:function(e,t,n,r){s.super_init(this,u.Forma,u.Forma.prototype.init_7dbd,e,t,n,r),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},init_812f:function(e,t){for(var n={kind:function(){return i.KIND},style:function(){return _.ImageStyle.createDefault()}},r=s.clone(t),o=s.iter(n);!o.done;o.next()){var a=o.key,l=o.value;null==t[a]&&(r[a]=l())}s.super_init(this,u.Forma,u.Forma.prototype.init_812f,e,r)},init_7186:function(e){var t={kind:i.KIND,style:_.ImageStyle.createDefault()};this.init_812f(e,t)},init_d1c9:function(e,t){s.super_init(this,u.Forma,u.Forma.prototype.init_d1c9,e,t),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},initializeDefaultState:function(){null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_),u.Forma.prototype.initializeDefaultState.call(this)},decodeController:function(){var e;null==this.controller&&(e=s.opt(this.page.document,(function(e){return e.controller})))&&(this.controller=e.controllerFactory.createController(m.ImageController.KIND,this)),u.Forma.prototype.decodeController.call(this)},className:{get:function(){return i.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==i.PROPERTY_CONTENTID?new p.FormaContentChangedEvent(this):u.Forma.prototype.updateEventForProperty.call(this,e)},postDecode:function(){var e,t,n,r,o;(e=this.contentNode)&&(this.ensureContentNodeListeners(),(t=e.mediaMetadata)&&null!=(n=t.designIntent)&&(n==C.MediaMetadata.DESIGNINTENT_LOGO&&(this.intent=u.Forma.INTENT_LOGO),n==C.MediaMetadata.DESIGNINTENT_PATTERN&&(this.intent=u.Forma.INTENT_PATTERN),n==C.MediaMetadata.DESIGNINTENT_FLOATING_IMAGE&&(this.intent=u.Forma.INTENT_FLOATING_IMAGE))),this.isGridCell()&&null==this.getProperty(u.Forma.PROPERTY_INTENT)&&this.set(u.Forma.PROPERTY_INTENT,u.Forma.INTENT_GRID_CELL),(r=s.opt(this.parent,(function(e){return e.controller})))&&r.kind!=c.FrameController.KIND&&(o=s.as(this.page.createFormaWithController(d.FrameForma.KIND,c.FrameController.KIND),d.FrameForma))&&(s.opt(this.parent,(function(e){return e.appendChild(o)})),o.bounds=this.bounds,o.placement=this.placement,this.placement=v.Matrix2D.Identity,o.appendChild(this,!1),o.allowUserMove=!0),u.Forma.prototype.postDecode.call(this)},contentNode:{get:function(){var e,t;null!=(e=this.contentID)&&((!(t=this.cachedContent_)||t.id!=e)&&(this.cachedContent_=s.as(s.opt(this.page.document,(function(t){return t.content.nodeByID(e)})),g.ImageContentNode)));return this.cachedContent_},set:function(e){this.cachedContent_=e,this.contentID=s.opt(e,(function(e){return e.id}))}},contentUrl:{get:function(){return s.opt(this.contentNode,(function(e){return e.url}))}},mimeType:{get:function(){return s.opt(this.contentNode,(function(e){return e.mimeType}))}},contentID:{get:function(){return s.as(this.get(i.PROPERTY_CONTENTID),"String")},set:function(e){var t=new p.FormaContentChangedEvent(this);this.beginUpdate(t),this.removeListenersFromContentNode(),this.set(i.PROPERTY_CONTENTID,e),this.addListenersToContentNode(),this.cachedBounds_=null,s.opt(this.cachedContent_,(function(t){return t.id!=e}))&&(this.cachedContent_=null),this.avgColorCache_=new a.LRUColorCache,this.endUpdate(t),this.intent==u.Forma.INTENT_CUTOUT_MASK&&i.propagateMaskContentChange(this)}},didChangeState:function(e){u.Forma.prototype.didChangeState.call(this,e),this.intent==u.Forma.INTENT_CUTOUT_MASK&&s.keys(e).includes(i.PROPERTY_CONTENTID)&&i.propagateMaskContentChange(this)},addListenersToContentNode:function(){var e,t=this;this.intent==u.Forma.INTENT_CUTOUT_MASK&&(e=this.contentNode)&&this.changeSubscriptions_.push(e.subscribeWithCallback((function(e){return i.propagateMaskContentChange(t)}),g.ImageContentChangedMessage.TYPE))},removeListenersFromContentNode:function(){for(;0==!this.changeSubscriptions_.length;)s.opt(this.changeSubscriptions_.pop(),(function(e){return e.unsubscribe()}))},ensureContentNodeListeners:function(){this.removeListenersFromContentNode(),this.addListenersToContentNode()},match:function(e){var t,n=this.placement;if(u.Forma.prototype.match.call(this,e),t=s.as(e,i)){if(0==t.style.colors.hasReferencedColorsFromColorLibrary()){var r,o,a=t.page.colorLibraryController.applyLegacyFilterColorsAndReturnKeys(t.style);null!=(r=a.primaryKey)&&t.style.colors.setColorId(l.ColorRole.FieldPrimary,r),null!=(o=a.secondaryKey)&&t.style.colors.setColorId(l.ColorRole.FieldSecondary,o)}this.applyStyle(t.style),e.contentID!=this.contentID&&(this.placement=n)}},boundsInCoordSpace:function(e){var t;return null==this.cachedBounds_&&(t=this.contentNode)&&(this.cachedBounds_=S.TheoRect.fromXYWH(0,0,s.toDouble(t.pixelWidth),s.toDouble(t.pixelHeight))),s.opt(this.cachedBounds_,(function(t){return t.transform(e)}))},invalidateCachedBounds:function(){var e=new p.FormaBoundsInvalidatedEvent(this);this.beginUpdate(e),this.cachedBounds_=null,this.endUpdate(e)},getFocusRegion:function(){var e;return(e=s.opt(this.contentNode,(function(e){return e.focusRegion})))?e.transform(this.placement):null},getAverageEdge:function(e){var t,n=e.transform(this.placement.inverse);return(t=this.contentNode)?t.getAverageEdge(n):0},getFaceIntersections:function(e){var t,n,r=e.transform(this.placement.inverse);if((t=this.contentNode)&&(n=t.image)){var o=s.toDouble(n.getWidth())/s.toDouble(t.pixelWidth),i=s.toDouble(n.getHeight())/s.toDouble(t.pixelHeight);return n.getFaceIntersections(r.multiplyXY(o,i))}return 0},getAverageColor:function(e){var t;if((t=this.avgColorCache_.get(e.asString))&&!s.eq(P._equality_SolidColor_SolidColor,t,P.SolidColor.BLACK))return t;var n,r,o=e.transform(this.placement.inverse);if((n=this.contentNode)&&(r=n.image)){var i,a=s.toDouble(r.getWidth())/s.toDouble(n.pixelWidth),l=s.toDouble(r.getHeight())/s.toDouble(n.pixelHeight);if(i=r.getAverageColor(o.multiplyXY(a,l),s.as(this.style,_.ImageStyle)))return this.avgColorCache_.add(e.asString,i),i}return null},hasAlpha:function(){return null!=this.contentNode&&this.contentNode.hasAlpha},isImage:function(){return!0}}}),i)},"gBh/":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.ColorThemeFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"ColorThemeFacade",ctor:r,superName:"CoreObject",statics:{applyColorTheme:function(e,t,n){n.colorLibraryController.applyColorTheme(e,t,!0)},shuffleColorTheme:function(e){e.colorLibraryController.shuffleColorAssignments()},modifyColorTheme:function(e,t,n){n.colorLibraryController.setTheoColorToLibrary(e,t)}}}),r)},gpZI:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("gXiO"),l=n("ascj"),u=n("6ZWm"),c=n("cmoc"),d=n("lmwz"),h=n("fNpk"),p=n("c+uM"),f=n("T6jX"),m=n("8t9B");i.SavedColorState=(r=function(e,t,n,r){this.formae=a.clone(e),this.colorLibraryState=t,this.primaryColorIDs=a.clone(n),this.secondaryColorIDs=a.clone(r)},a.defineClass({name:"SavedColorState",ctor:r,superName:"CoreObject"}),r),i.ColorFacade=(o=function(){s.CoreObject.call(this)},a.defineClass({name:"ColorFacade",ctor:o,superName:"CoreObject",statics:{applyColorsToForma:function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=0);var i,s,h=r%2==0?l.ColorRole.FieldPrimary:l.ColorRole.FieldSecondary;if(e.isTypeLockup())return(i=a.opt(a.as(e.controller,m.TypeLockupController),(function(e){return e.styleController})))&&(n&&a.opt(a.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),o.getDominantColorRoleOfLockup(e)==l.ColorRole.FieldSecondary&&(h=h==l.ColorRole.FieldPrimary?l.ColorRole.FieldSecondary:l.ColorRole.FieldPrimary),i.applyColors(t,h)),e;if(e instanceof c.FrameForma){if(s=f.TheoDocumentUtils.getCellBackgroundShape(e))a.opt(s.controller,(function(e){return e.applyColors(t,h)}));else if(null!=a.as(e.controller,u.FrameController))return d.ImageFacade.replaceImageWithColors(e,t)}else a.opt(e.controller,(function(e){return e.applyColors(t,h)}));return e},applyColorsWithRoleToForma:function(e,t,n){var r,i;if(void 0===n&&(n=!1),e.isTypeLockup()&&(r=a.opt(a.as(e.controller,m.TypeLockupController),(function(e){return e.styleController})))&&(n&&a.opt(a.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),i=a.opt(e.controller,(function(e){return e.getCurrentColorsWithRole(r.targetedLockupStyle)})))){var s=a.clone(o.updateColorsWithRole(t,i));r.applyColorsWithRole(s)}return e},updateColorsWithRole:function(e,t){for(var n=t.concat(),r=a.iter(e);!r.done;r.next())for(var o=r.value,i=a.iter(n);!i.done;i.next()){var s=i.value;o.role==s.role&&(s.color=o.color.rgbColor)}return n},applyColorsToFormae:function(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=0),e.map((function(e){return o.applyColorsToForma(e,t,n,r)}),this)},applyNoneColorToFormae:function(e,t){return void 0===t&&(t=l.ColorRole.FieldPrimary),e.map((function(e){return h.LegacyCoreAssert.isTrue(e.kind==c.FrameForma.KIND,"Only frame forma can have primary color as nil",void 0,"ColorFacade.applyNoneColorToFormae","ColorFacade.swift",122),e.style.colors.setColor(t,null),e}),this)},applyColorsWithRoleToFormae:function(e,t,n){return void 0===n&&(n=!1),e.map((function(e){return o.applyColorsWithRoleToForma(e,t,n)}),this)},getDominantColorRoleOfLockup:function(e){var t;if(e.isTypeLockup()&&(t=a.opt(a.as(e.controller,m.TypeLockupController),(function(e){return e.styleController})))){var n=t.targetedLockupStyle;return n.textLook==p.LockupTextLook.KnockoutOnly||n.textLook==p.LockupTextLook.OutlineOnly?l.ColorRole.FieldSecondary:l.ColorRole.FieldPrimary}return l.ColorRole.FieldPrimary},getSavedColorState:function(e){var t,n;h.LegacyCoreAssert.isTrue(e.length>0,"empty Forma array",void 0,"ColorFacade.getSavedColorState","ColorFacade.swift",151);var r=e[0].page.colorLibraryController.recordUndoState(),o=e.map((function(e){return(t=e.style.colors.colorID(l.ColorRole.FieldPrimary))||null!=t?t:""}),this),a=e.map((function(e){return(n=e.style.colors.colorID(l.ColorRole.FieldSecondary))||null!=n?n:""}),this);return new i.SavedColorState(e,r,o,a)}}}),o)},hEh8:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("RO7T"),s=n("lWlM"),l=n("iCxV"),u=n("8vXU"),c=n("rxGp");o.DCXNodeDecoder=(r=function(e,t){this.node_=t,a.BaseNodeDecoder.call(this,e),l.Host.logging.logForCategory(c.LogCategories.kDecode,"init "+i.toString(this.id)+" "+i.toString(this.name)+" "+i.toString(this.type)+" "+i.toString(this.path),u.LogLevelEnum.INFO_LEVEL)},i.defineClass({name:"DCXNodeDecoder",ctor:r,superName:"BaseNodeDecoder",statics:{_implements:function(e){return"IImportDataObject"==e}},props:{getPropertyOnNode:function(e){var t=i.as(this.node_.getValue(e),"AnyObject");return l.Host.logging.logForCategory(c.LogCategories.kDecode,i.toString(this.node_.nodeId)+" getPropertyOnNode "+e+" "+i.toString(t),u.LogLevelEnum.INFO_LEVEL),t},forEachChild:function(e){for(var t=0,n=i.iter(this.branch_.getChildrenOfNode(this.node_));!n.done;n.next()){var o=n.value;e(new r(this.branch_,o),t),t+=1}},forEachComponent:function(e){for(var t=0,n=i.iter(this.branch_.getComponentsOfNode(this.node_));!n.done;n.next()){var r=n.value;e(new s.DCXComponentDecoder(this.branch_,r),t),t+=1}}}}),r)},hndY:function(e,t,n){var r,o,i,a=t,s=n("oAGj"),l=n("OdB2"),u=n("Bcdx"),c=n("w/+j"),d=n("P83h"),h=n("iCxV"),p=n("IUM5"),f=n("fNpk"),m=n("K17h"),g=n("sq5L"),y=n("bauG"),_=n("euLT"),T=n("PlOi"),v=n("b94u"),C=n("ZA1K"),P=n("bAjp"),S=n("mj5y"),D=n("s3Tu"),A=n("t+nd"),E=n("fnrT"),R=n("uYSz"),F=n("KDc2"),b=n("T6jX"),I=n("sIWg"),O=n("qSCS");a.FormaDamage=(r=function(){this.descendants=!1,this.transform=!1},s.defineClass({name:"FormaDamage",ctor:r,props:{onlyTransform:function(){return!this.descendants&&this.transform},onlyDescendants:function(){return this.descendants&&!this.transform}}}),r),a.FormaPGMCacheEntry=(o=function(e,t){this.damage=null,this.forma=e,this.ref=t},s.defineClass({name:"FormaPGMCacheEntry",ctor:o,props:{addDamage:function(){return null==this.damage&&(this.damage=new a.FormaDamage),this.damage},damageDescendants:function(){this.addDamage().descendants=!0},damageTransform:function(){this.addDamage().transform=!0}}}),o),a.FormaPGMCache=(i=function(e,t,n){this.graph_=null,this.formaCache_={},this.mappers=u.FormaToPGMMapperFactory.instance,this.cachedGraphRef_=null,this.cachedGraph_=g.PGMGraph.EMPTY,this.validationCount_=0,this.fastValidationCount_=0,this.pageSubscription_=null,this.page=e,this.settings=t,this.adhoc=n,this.log=f.LegacyCoreAssert.newLog("FormaPGMCache-"+t.asString),this.pageSubscription_=e.subscribe(this,l.FormaEndUpdateMessage.TYPE)},s.defineClass({name:"FormaPGMCache",ctor:i,statics:{reportedFailures:{},failOnce:function(e){var t;((t=i.reportedFailures[e])||null!=t)&&t||(i.reportedFailures[e]=!0,f.LegacyCoreAssert.fail(e,void 0,"FormaPGMCache.failOnce","FormaPGMCache.swift",385))},_implements:function(e){return"TheoMessageSubscriber"==e||"FormaToPGMFactory"==e}},props:{destroy:function(){var e;(e=this.pageSubscription_)&&(s.opt(this.page,(function(t){return t.unsubscribe(e)})),this.pageSubscription_=null),s.removeAll(this.formaCache_)},onMessage:function(e){var t;if(t=s.as(e,l.FormaEndUpdateMessage)){var n,r,o=t.event.forma,i=!0;if((n=o)&&(r=this.formaCache_[n.formaID])&&(t.event instanceof d.FormaTransformChangedEvent?r.damageTransform():t.event instanceof d.FormaNullChangedEvent||t.event instanceof d.FormaAlignmentChangedEvent?i=!1:t.event instanceof d.FormaAnimationChangedEvent?this.settings.asDynamic?(this.log.info("animation changed invalidation on "+n.kind),s.removeKey(this.formaCache_,n.formaID)):i=!1:s.removeKey(this.formaCache_,n.formaID),o=n.parent),i){for(;null!=o;)s.opt(this.formaCache_[o.formaID],(function(e){return e.damageDescendants()})),o=o.parent;this.graph_=null}}},getPGMReferenceForForma:function(e){var t,n=this.formaCache_[e.formaID];if(t=this.mappers.getMapper(e)){var r,o;if(r=n){var s;if(!(s=r.damage))return r.ref;if(s.onlyTransform()&&t.canDoSimpleTransformUpdate(r))return r.ref=r.ref.withPlacement(e.placement),r.damage=null,r.ref}return this.validationCount_+=1,(o=t.makePGMRef(e,this.settings,this,n))?o.child instanceof _.PGMNullNode?null:(this.formaCache_[e.formaID]=new a.FormaPGMCacheEntry(e,o),o):(i.failOnce("Mapper at path "+b.TheoDocumentUtils.debugFormaPath(e)+" did not produce a reference."),null)}return i.failOnce("No pgm mapper available at path "+b.TheoDocumentUtils.debugFormaPath(e)+" "),null},childReferences:function(e){for(var t=[],n=s.iter(e.childrenAsArray);!n.done;n.next()){var r,o=n.value;(r=this.getPGMReferenceForForma(o))&&t.push(r)}return t},referenceForForma:function(e){return this.getPGMReferenceForForma(e)},getGraph:function(){return this.validate(),this.graph_},resourcesForGraph:function(e){var t=this,n={},r={};return e.visit((function(e){var o,a,l,u,d,f,m=null;if(o=s.as(e,y.PGMImage))m=o.contentID;else if(a=s.as(e,D.PGMVideo))m=a.contentID;else if(l=s.as(e,C.PGMSVG))m=l.contentID;else if(u=s.as(e,P.PGMText)){var g,_=u.style.font.postScriptName;if(null==r[_]&&(r[_]=u.style.font,(S=s.opt(t.page,(function(e){return e.document})))&&(g=s.opt(h.Host.fontProvider,(function(e){return e.descriptorForPostScriptName(_,S)}))))){var v;switch(g.source){case 2:v=new E.StorageSpecApplicationResource(p.CATEGORY_ID_FONT,p.FONT_RESOURCE_ID_EMBEDDED_PREFIX+_);break;case 1:case 3:v=new E.StorageSpecApplicationResource(p.CATEGORY_ID_FONT,p.FONT_RESOURCE_ID_SPARK_PREFIX+_);break;case 4:var S,b;(S=s.opt(t.page,(function(e){return e.document})))&&(b=s.opt(h.Host.brandkitManager,(function(e){return e.brandkitForDocument(S)})))?v=new R.StorageSpecExternalCC(R.StorageSpecExternalCC.BRANDKIT_SYNC_GROUP,b.id,null,_,null,null,null):(i.failOnce("can't obtain a brandkit for a custom font "+_),v=new F.StorageSpecInvalid);break;case 5:case 6:v=new A.StorageSpecAdobeFont(_);break;default:i.failOnce("unexpected font source for "+_),v=new F.StorageSpecInvalid}n["font:"+_]=new T.PGMResourceProvider("font/otf",v)}}null!=(d=m)&&(S=s.opt(t.page,(function(e){return e.document})))&&null==n[d]&&((f=s.as(S.content.nodeByID(d),O.URLBasedContentNode))?n[d]=c.FormaToPGMUtils.createResourceProviderForContentNode(f):i.failOnce("couldn't look up content by ID; no resource available"))})),new v.PGMResourceProviderList(n)},getGraphForForma:function(e){var t;return(t=this.getPGMReferenceForForma(e))?(t===this.cachedGraphRef_||(this.cachedGraph_=new g.PGMGraph(t.child,e.bounds,this.settings.asDynamic?S.PGMUtils.calculateDuration(t):0,this.resourcesForGraph(t.child)),this.cachedGraphRef_=t),this.cachedGraph_):(i.failOnce("getGraphForForma: couldn't get a reference from which to build a graph."),null)},validate:function(){var e,t;if(null==this.graph_&&(e=this.page))if(this.validationCount_=0,this.fastValidationCount_=0,t=this.getPGMReferenceForForma(e.root)){var n=0;if(this.settings.asDynamic){var r,o=!1;(r=e.animationController.animationStyle)&&(o=!r.isNoStyle()),n=o?m.MotionUtils.determineTotalDuration(e).seconds:S.PGMUtils.calculateDuration(t)}this.log.info("validate: "+this.validationCount_+" slow, "+this.fastValidationCount_+" fast");var a=e.pageSize;this.graph_=new g.PGMGraph(t.child,I.TheoRect.fromSize(a),n,this.resourcesForGraph(t.child))}else i.failOnce("failed to generate a reference for root")}}}),i)},i1Gv:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("URxh"),l=n("iCxV");i.FormaAnimationFactory=(r=function(){this.lookup_={},this.lookup_[s.FormaAnimation.KIND]=function(){return s.FormaAnimation.createDefault()}},o={},a.defineClass({name:"FormaAnimationFactory",ctor:r,superName:"CoreObject",statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}}},props:{create:function(e){var t;return null!=(t=this.lookup_[e])?t():(a.opt(l.Host.logging,(function(t){return t.warning("no constructor for forma style kind = "+e)})),null)}}}),r)},iFIB:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("TP4q"),l=n("3v9D");o.GridLearning=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"GridLearning",ctor:r,superName:"CoreObject",statics:{learnGridMappingWeights:function(e){if(0==e.length)return{weights:[],bestStyle:null};for(var t={},n=i.iter(e);!n.done;n.next()){var o=n.value,a=new s.GridScore(o.gridStyle,o.gridFrame,o.layoutItems);t[o.docID]={score:a,features:a.getFeatures()}}for(var l=new s.GridScore(e[0].gridStyle,e[0].gridFrame,e[0].layoutItems),u=i.clone(l.getWeights()),c=null,d=i.iter(i.range(0,500,!1));!d.done;d.next()){for(var h=d.value,p=i.repeat(0,u.length),f=0,m=0,g=null,y=0,_=i.iter(e);!_.done;_.next()){var T,v=t[(o=_.value).docID];if(v.score.setWeights(u),T=r.getBestGridLayout(o,u)){g=T.gridStyle,f+=v.score.score,m+=T.score;for(var C=i.clone(T.getFeatures()),P=i.iter(i.range(0,u.length,!1));!P.done;P.next())p[D=P.value]+=C[D]-v.features[D];y+=1}}if(f/=i.toDouble(e.length),m/=i.toDouble(e.length),i.info(i.toString("\nNIO iteration "+h+" G: %5.02f fInit: %5.02f fOpt: %5.02f avg mismatch %5.02f",m-f,f,m)),m-f<.001){c=g;break}for(var S=i.iter(i.range(0,u.length,!1));!S.done;S.next()){var D,A=p[D=S.value]/i.toDouble(y);u[D]+=-1*A*.01}}return{weights:u,bestStyle:c}},getBestGridLayout:function(e,t){var n=i.clone(l.LayoutSuggester.init_cb42(e,t).createSuggestions());return 0==!n.length?n[0].weightedScore:null}}}),r)},jC54:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.ModelWeightLibrary=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"ModelWeightLibrary",ctor:r,superName:"CoreObject",statics:{weights:{DefaultDesignScore:{Maxzoomlevel:{mean:.00018027334267821125,std:.8132335406308514,weight:-.08010375273536166},textareanotcontrasting:{mean:-.0033339994317995274,std:.25020875502904477,weight:-.14415975362288352},shapesareanotcontrasting:{mean:-.0005424908444142923,std:.16815414319793917,weight:-.030270956800708296},lockupareaoutofbounds:{mean:.0003963054774770136,std:.03879175427738692,weight:-.1289655276464355},minfontsize:{mean:.4162329663731091,std:27.695820940950014,weight:.04372203001144579},maxfontsize:{mean:.4612274707747426,std:57.444985900183354,weight:.10830759811249395},mintextarea:{mean:488.9105104765153,std:89533.71385858732,weight:-.013866098359443309},maxtextarea:{mean:1325.1752065666267,std:186711.01621053327,weight:-.2361503759042213},minshapesize:{mean:-55.646916071109146,std:44574.83972690322,weight:.029270742827542353},maxshapesize:{mean:-201.25488977770246,std:46340.96127095905,weight:-.08223116203941933},lockupareaoverlapping:{mean:.00020290565299043752,std:.03925994410311496,weight:-.1636881423600194},Maxemptyspace:{mean:-.004717028998489912,std:.1976916685529546,weight:-.11662298994579136},textincorrectalign:{mean:-.004764058495477163,std:.2987539130553497,weight:-.03690998410689036},emptygridsquares:{mean:-.0007268850555160692,std:.14877245350943186,weight:-.23283917900645912},overlappingmultiplegridcells:{mean:-.008452699670100044,std:.4087079047503421,weight:-.0569178307172981},maxaspectratio:{mean:.021926589002448465,std:3.1432119741395548,weight:.21439804312559388},breakingflowX:{mean:-.006980250264133872,std:.45684350428459336,weight:.011093192112083617},breakingflowY:{mean:-.008525554047037538,std:.4077234799494897,weight:-.06308947475173525},BreakingHorisontalSymmetryinsidevisualparent:{mean:412041.9613712293,std:45212121.039130844,weight:-.034310695376294276},marginsaretoosmall:{mean:-32649.714698565716,std:4443401.694947285,weight:-.028229129254167384},balanceofvisualparentX:{mean:-.007559473558332495,std:.3227787688513554,weight:-.13312017596904124},balanceofvisualparentY:{mean:-.010450324811186476,std:.4524201239517186,weight:-.09532942482280946},totalalignmentlines:{mean:-.0009045680687471732,std:.5654767847212782,weight:.007683119790124987},CellAspectRatio:{mean:-.000866027015147402,std:1.4808460165726252,weight:-.2282126421778498},AreaPercentImages:{mean:.0011783622381679377,std:.3209991901820274,weight:.40897766247230655},ImageCellContentFit:{mean:-.0010022863121065778,std:.06839864851764367,weight:-.035663159273769146},AverageCellSize:{mean:-.003853477920843118,std:.3674675336869799,weight:-.0861206668785603},AverageImageCellSize:{mean:.0014705706334928255,std:.30689611738107436,weight:-.310870215199779},AverageTextCellSize:{mean:.0030857846907960075,std:.3190234573570835,weight:.03296304542028719},ImageCellVariance:{mean:.0008047901252859525,std:.06410991367658431,weight:-.024296079984680582},TextCellVariance:{mean:.0036032703466117107,std:.14545169804975572,weight:.08747903039684307},OverallCellVariance:{mean:.010513688422152926,std:.3036485447684895,weight:.006791166993508748},TypeSymmetryAcrosstheXAxis:{mean:.0025981146277427093,std:.43849102556669445,weight:-.2902662035011975},TypeSymmetryAcrosstheYAxis:{mean:-.0007791864813152262,std:.45283696286437347,weight:-.23419662370595393},TypeAsymmetryAcrosstheXAxis:{mean:.008912652724408086,std:.7331157676033474,weight:-.09727780755199468},TypeAsymmetryAcrosstheYAxis:{mean:.010873023708513306,std:.6982196294438795,weight:.03350849616250007},CellSymmetryAcrosstheXAxis:{mean:-.001132162147191269,std:.33392704164452364,weight:.06266679976903884},CellSymmetryAcrosstheYAxis:{mean:-.0005155668142621847,std:.33292297327240367,weight:-.058041551211506504},CellAsymmetryAcrosstheXAxis:{mean:.001132162147191268,std:.33392704164452364,weight:-.06266679976903927},CellAsymmetryAcrosstheYAxis:{mean:.0005155668139908147,std:.3329229732722636,weight:.058041551397742044},AverageImageXVal:{mean:-.0015815559988986917,std:.15008002059800904,weight:-.06098982378772082},AverageImageYVal:{mean:7891179554016043e-20,std:.1438772538377358,weight:-.10273553740768389},AverageTextXVal:{mean:.0049443186134623075,std:.25262901903129675,weight:-.025304213039208205},AverageTextYVal:{mean:.004664303074648295,std:.26747263439055524,weight:.012656120935728677},ImageSpreadinXDimension:{mean:-.00310888031836687,std:.28336827022361394,weight:.24726198560445092},ImageSpreadinYDimension:{mean:.0031367634820247538,std:.27346012927936375,weight:.1989040843352687},TextSpreadinXDimension:{mean:.00650620828022051,std:.4043232862187427,weight:-.1293283969219272},TextSpreadinYDimension:{mean:.007645995665318362,std:.40379994376989187,weight:-.011516607422389176},MaxImageXOffsetFromCenter:{mean:.0016157427991856622,std:.14246903105574066,weight:-.020089296400970874},MaxImageYOffsetFromCenter:{mean:-.0008679463633771875,std:.12934639704481982,weight:-.15444476815025124},MaxTextXOffsetFromCenter:{mean:.0007758562872193546,std:.10612718654583783,weight:-.08563320326004221},MaxTextYOffsetFromCenter:{mean:.0025601067703762033,std:.14804047677121857,weight:.0002795079579061673},TextFocused:{mean:1.1008033251432315e-9,std:3.747646504742835e-7,weight:.011466692333776875},TextDispersement:{mean:.006047062110539865,std:.38381427709455296,weight:.025895655099346427},AdjacentMatches:{mean:.001957343375687507,std:.24482209931437043,weight:-.021211802454498736},AdjacentMismatches:{mean:.005279201174289879,std:.4373270531182902,weight:.0011997430973767964},PreviousOrder:{mean:-.004296698326549073,std:.7698699665723179,weight:-.004121330693776555},PreviousPosition:{mean:.0040594447624014525,std:.4015754424391129,weight:.02671704069247397},PreviousPositionFlip:{mean:.009238177093947593,std:1.072273993426883,weight:.14746380228860045}},DefaultGridScore:{CellAspectRatio:{mean:0,std:1,weight:-.571428571428571},AreaPercentImages:{mean:0,std:1,weight:.3},ImageCellContentFit:{mean:0,std:1,weight:-10},AverageCellSize:{mean:0,std:1,weight:.4},AverageImageCellSize:{mean:0,std:1,weight:.3},AverageTextCellSize:{mean:0,std:1,weight:.2},ImageCellVariance:{mean:0,std:1,weight:-.7},TextCellVariance:{mean:0,std:1,weight:-.7},OverallCellVariance:{mean:0,std:1,weight:0},TypeSymmetryAcrosstheXAxis:{mean:0,std:1,weight:1.42857142857143},TypeSymmetryAcrosstheYAxis:{mean:0,std:1,weight:1.42857142857143},TypeAsymmetryAcrosstheXAxis:{mean:0,std:1,weight:-1.42857142857143},TypeAsymmetryAcrosstheYAxis:{mean:0,std:1,weight:-1.42857142857143},CellSymmetryAcrosstheXAxis:{mean:0,std:1,weight:.285714285714286},CellSymmetryAcrosstheYAxis:{mean:0,std:1,weight:.285714285714286},CellAsymmetryAcrosstheXAxis:{mean:0,std:1,weight:-.285714285714286},CellAsymmetryAcrosstheYAxis:{mean:0,std:1,weight:-.285714285714286},AverageImageXVal:{mean:0,std:1,weight:0},AverageImageYVal:{mean:0,std:1,weight:0},AverageTextXVal:{mean:0,std:1,weight:0},AverageTextYVal:{mean:0,std:1,weight:0},ImageSpreadinXDimension:{mean:0,std:1,weight:.571428571428571},ImageSpreadinYDimension:{mean:0,std:1,weight:.571428571428571},TextSpreadinXDimension:{mean:0,std:1,weight:.571428571428571},TextSpreadinYDimension:{mean:0,std:1,weight:.571428571428571},MaxImageXOffsetFromCenter:{mean:0,std:1,weight:0},MaxImageYOffsetFromCenter:{mean:0,std:1,weight:0},MaxTextXOffsetFromCenter:{mean:0,std:1,weight:0},MaxTextYOffsetFromCenter:{mean:0,std:1,weight:0},TextFocused:{mean:0,std:1,weight:.142857142857143},TextDispersement:{mean:0,std:1,weight:1.17142857142857},AdjacentMatches:{mean:0,std:1,weight:-2.85714285714286},AdjacentMismatches:{mean:0,std:1,weight:2.85714285714286},PreviousOrder:{mean:0,std:1,weight:-1},PreviousPosition:{mean:0,std:1,weight:-1},PreviousPositionFlip:{mean:0,std:1,weight:-.5},PreviousImageSize:{mean:0,std:1,weight:-10}}},getData:function(e,t){return i.keys(r.weights).includes(e)&&i.keys(r.weights[e]).includes(t)?r.weights[e][t]:{mean:0,std:1,weight:0}}}}),r)},"jV/A":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("fNpk"),l=n("sIWg"),u=n("1NAc");o.PROPERTY_ID="id",o.PROPERTY_IMAGE="image",o.PROPERTY_NAME="name",o.PROPERTY_SIZE="size",o.PROPERTY_EDITING_RESOLUTION="editing-resolution",o.PROPERTY_PUBLISH_RESOLUTION="publish-resolution",o.PROPERTY_URI="uri",o.PROPERTY_LOCKUP_STRINGS="lockup-strings",o.PROPERTY_FOCUS="focus",o.PROPERTY_NUM_IMAGES="num-images",o.PROPERTY_NUM_SHAPES="num-shapes",o.PROPERTY_NUM_RETARGETABLE_BACKGROUND_IMAGES="num-retargetable-background-images",o.PROPERTY_NUM_RETARGETABLE_FLOATING_IMAGES="num-retargetable-floating-images",o.PROPERTY_EDGE_MAP="edges",o.PROPERTY_LAYOUT_ID="layout-id",o.PROPERTY_NUM_GRID_CELLS="num-grids-cells",o.PROPERTY_VISUAL_GROUP_INFO="visual-group-info",o.PROPERTY_TEXT_ROLES="text-roles",o.PROPERTY_SHAPE_ROLES="shape-roles",o.PROPERTY_SALIENT_COVERAGE="salient-coverage",o.PROPERTY_NUM_MOVEABLE="num-moveable",o.PROPERTY_NUM_GIFS="gifs-count",o.PROPERTY_CP_DOCID="cpId",o.PROPERTY_PREVIEW_URL="previewUrl",o.PROPERTY_MANIFEST_URL="manifestUrl",o.PROPERTY_FILTER_FORMAE="content-formae",o.RetargetDocumentExemplar=(r=function(e,t,n,r,o,s,l,u,c,d,h,p,f,m,g,y,_,T,v,C,P,S,D,A,E,R){this.id=e,this.cpId=n,this.previewUrl=r,this.manifestUrl=o,this.uri=d,this.name=t,this.size=s,this.editingResolution=l,this.publishResolution=u,this.image=c,this.lockupStrings=i.clone(h),this.focus=p,this.numImages=f,this.edgeMap=i.clone(m),this.layoutID=g,this.numGridCells=y,this.numMoveable=_,this.numShapes=T,this.numRetargetableBackgroundImages=v,this.numRetargetableFloatingImages=C,this.visualGroupInfo=i.clone(P),this.textRoles=i.clone(S),this.shapeRoles=i.clone(D),this.salientCoverage=A,this.gifsCount=E,this.filterFormae=i.clone(R),a.CoreObject.call(this)},i.defineClass({name:"RetargetDocumentExemplar",ctor:r,superName:"CoreObject",statics:{decodeJson:function(e){var t,n,a,c,d,h,p,f,m,g,y,_,T,v,C;if(null==e);else if(C=i.as(e,["Dictionary","String","Any"])){var P;if(null!=(P=i.as(C[o.PROPERTY_ID],"String"))){var S,D=C[o.PROPERTY_EDGE_MAP];null!=D&&null!=(b=i.clone(i.as(D,["Array","Double"])))&&(S=i.clone(b));var A=[],E=C[o.PROPERTY_LOCKUP_STRINGS];null!=E&&(b=i.as(E,["Array","String"]))&&i.append(A,b);var R=[],F=C[o.PROPERTY_TEXT_ROLES];null!=F&&(b=i.as(F,["Array","String"]))&&i.append(R,b);var b,I=[],O=C[o.PROPERTY_SHAPE_ROLES];null!=O&&(b=i.as(O,["Array","String"]))&&i.append(I,b);var k=i.clone(C[o.PROPERTY_VISUAL_GROUP_INFO]),N=i.as(C[o.PROPERTY_FOCUS],"AnyObject"),M=null!=N?N.length:0;return new r(P,(t=i.as(C[o.PROPERTY_NAME],"String"))||null!=t?t:"",(n=i.as(C[o.PROPERTY_CP_DOCID],"String"))||null!=n?n:"",(a=i.as(C[o.PROPERTY_PREVIEW_URL],"String"))||null!=a?a:"",(c=i.as(C[o.PROPERTY_MANIFEST_URL],"String"))||null!=c?c:"",u.TheoSize.decodeJson(i.as(C[o.PROPERTY_SIZE],"AnyObject"))||u.TheoSize.Zero,(d=i.as(C[o.PROPERTY_EDITING_RESOLUTION],"Double"))||null!=d?d:1,(h=i.as(C[o.PROPERTY_PUBLISH_RESOLUTION],"Double"))||null!=h?h:1,(p=i.as(C[o.PROPERTY_IMAGE],"String"))||null!=p?p:"",(f=i.as(C[o.PROPERTY_URI],"String"))||null!=f?f:"",A,null!=N&&M>0?l.TheoRect.decodeJson(N):null,(m=i.as(C[o.PROPERTY_NUM_IMAGES],"Double"))||null!=m?m:0,S,(g=i.as(C[o.PROPERTY_LAYOUT_ID],"String"))||null!=g?g:"",(y=i.as(C[o.PROPERTY_NUM_GRID_CELLS],"Double"))||null!=y?y:0,i.toDouble(A.length),(_=i.as(C[o.PROPERTY_NUM_SHAPES],"Double"))||null!=_?_:0,i.as(C[o.PROPERTY_NUM_RETARGETABLE_BACKGROUND_IMAGES],"Double"),i.as(C[o.PROPERTY_NUM_RETARGETABLE_FLOATING_IMAGES],"Double"),null!=k?k:{},R,I,(T=i.as(C[o.PROPERTY_SALIENT_COVERAGE],"Double"))||null!=T?T:0,(v=i.as(C[o.PROPERTY_NUM_GIFS],"Double"))||null!=v?v:0,i.as(C[o.PROPERTY_FILTER_FORMAE],["Array","String"]))}}else s.LegacyCoreAssert.fail("decodeJson: not a dictionary",void 0,"RetargetDocumentExemplar.decodeJson","RetargetDocumentExemplar.swift",264);return null}},props:{editingSize:{get:function(){return this.size.multiply(this.editingResolution)}},publishSize:{get:function(){return this.size.multiply(this.publishResolution)}},encodeJson:function(){var e={};return e[o.PROPERTY_ID]=this.id,e[o.PROPERTY_NAME]=this.name,e[o.PROPERTY_CP_DOCID]=this.cpId,e[o.PROPERTY_PREVIEW_URL]=this.previewUrl,e[o.PROPERTY_MANIFEST_URL]=this.manifestUrl,e[o.PROPERTY_SIZE]=this.size.encodeJson(),e[o.PROPERTY_PUBLISH_RESOLUTION]=this.publishResolution,e[o.PROPERTY_IMAGE]=this.image,e[o.PROPERTY_URI]=this.uri,e[o.PROPERTY_LOCKUP_STRINGS]=i.clone(this.lockupStrings),null!=this.focus&&(e[o.PROPERTY_FOCUS]=this.focus.encodeJson()),null!=this.edgeMap&&(e[o.PROPERTY_EDGE_MAP]=i.clone(this.edgeMap)),e[o.PROPERTY_NUM_IMAGES]=this.numImages,e[o.PROPERTY_LAYOUT_ID]=this.layoutID,e[o.PROPERTY_NUM_GRID_CELLS]=this.numGridCells,e[o.PROPERTY_NUM_MOVEABLE]=this.numMoveable,e[o.PROPERTY_NUM_SHAPES]=this.numShapes,e[o.PROPERTY_NUM_RETARGETABLE_BACKGROUND_IMAGES]=this.numRetargetableBackgroundImages,e[o.PROPERTY_NUM_RETARGETABLE_FLOATING_IMAGES]=this.numRetargetableFloatingImages,e[o.PROPERTY_VISUAL_GROUP_INFO]=i.clone(this.visualGroupInfo),e[o.PROPERTY_TEXT_ROLES]=i.clone(this.textRoles),e[o.PROPERTY_SHAPE_ROLES]=i.clone(this.shapeRoles),e[o.PROPERTY_SALIENT_COVERAGE]=this.salientCoverage,e[o.PROPERTY_NUM_GIFS]=this.gifsCount,null!=this.filterFormae&&(e[o.PROPERTY_FILTER_FORMAE]=i.clone(this.filterFormae)),e}}}),r)},kSRw:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("fWxZ"),s=n("pnSN"),l=n("fNpk");o.SmartGroupForma=(r=function(){},i.defineClass({name:"SmartGroupForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"smart-group"}},PROPERTY_BOUNDS_DEPRECATED:"bounds",PROPERTY_CLIPMODE:"clipmode",SCHEMA_CLASS_NAME:{get:function(){return"SmartGroupForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var u=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.GroupForma),c=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),a.FormaPage);return l.LegacyCoreAssert.isTrue(null!=u||null!=c,"SmartGroupForma needs a parent group or page",void 0,"SmartGroupForma","SmartGroupForma.swift",28),null!=u?s.GroupForma.init_3144(e,t,n,u):s.GroupForma.init_7dbd(e,t,n,c)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,s.GroupForma,s.GroupForma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){i.super_init(this,s.GroupForma,s.GroupForma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND}},o=i.clone(t),a=i.iter(n);!a.done;a.next()){var l=a.key,u=a.value;null==t[l]&&(o[l]=u())}i.super_init(this,s.GroupForma,s.GroupForma.prototype.init_812f,e,o)},init_7fcf:function(e,t){var n={kind:t};this.init_812f(e,n)},init_d1c9:function(e,t){i.super_init(this,s.GroupForma,s.GroupForma.prototype.init_d1c9,e,t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r)},kVgh:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("dJuF"),s=n("ZhwN"),l=n("fNpk"),u=n("Quhx");o.ColorSwatch=(r=function(){},i.defineClass({name:"ColorSwatch",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ColorSwatch",PROPERTY_NUM_TAGS:"numTags",PROPERTY_TAG_KEY_PREFIX:"key-",PROPERTY_TAG_VALUE_PREFIX:"value-",PROPERTY_TAGS:"tags",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_7e49:function(e,t,n){this.parent_=n,i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_3181,n.database,t,e)},init_d0e4:function(e){for(var t=e.database,n={path:function(){return s.GUIDUtils.makeGUID()}},r={},o=i.iter(n);!o.done;o.next()){var a=o.key,l=o.value;r[a]=l()}this.parent_=e,i.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_5079,t,{},r,"")},className:{get:function(){return r.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},numTags:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_NUM_TAGS),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_NUM_TAGS,e)}},rawTags_:{get:function(){for(var e,t,n={},o=i.iter(i.range(0,this.numTags,!1));!o.done;o.next()){var a=o.value,s=(e=i.opt(this.getProperty(r.PROPERTY_TAG_KEY_PREFIX+i.toString(a)),(function(e){return e.stringValue})))||null!=e?e:"",l=(t=i.opt(this.getProperty(r.PROPERTY_TAG_VALUE_PREFIX+i.toString(a)),(function(e){return e.stringValue})))||null!=t?t:"";n[s]=l}return n},set:function(e){for(var t=0,n=this.numTags,o=i.iter(e);!o.done;o.next()){var s=o.key,l=o.value,u=r.PROPERTY_TAG_KEY_PREFIX+i.toString(t),c=r.PROPERTY_TAG_VALUE_PREFIX+i.toString(t);this.setProperty(u,a.DBProperty.stringProperty(a.DBNamePath.init_b14a(u),s)),this.setProperty(c,a.DBProperty.stringProperty(a.DBNamePath.init_b14a(c),l)),t+=1}if(this.numTags=t,t<n)for(var d=i.iter(i.range(t,n,!1));!d.done;d.next()){var h=d.value;this.removeProperty(r.PROPERTY_TAG_KEY_PREFIX+i.toString(h)),this.removeProperty(r.PROPERTY_TAG_VALUE_PREFIX+i.toString(h))}}},tags:{get:function(){return i.keys(this.rawTags_)}},tag:function(e){return this.rawTags_[e]},contains:function(e){return null!=this.rawTags_[e]},clearTags:function(){this.rawTags_={}},match:function(e){this.clearTags();for(var t=i.iter(e.tags);!t.done;t.next()){var n=t.value;this.setTag(n,e.tag(n))}},setTag:function(e,t){var n=i.clone(this.rawTags_);null==t?i.removeKey(n,e):n[e]=t,this.rawTags_=i.clone(n)},publish:function(e){i.opt(this.parent_,(function(t){return t.publishForChild(e)}))},solidRepresentation:{get:function(){return l.LegacyCoreAssert.fail("stub",void 0,"ColorSwatch","ColorSwatch.swift",107),null}},kind:{get:function(){return l.LegacyCoreAssert.fail("stub",void 0,"ColorSwatch","ColorSwatch.swift",112),""}}}}),r)},kYI4:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("0wFF"),s=n("CWW7"),l=n("gXiO"),u=n("yGNn"),c=n("ascj"),d=n("QgZx"),h=n("ZK0l"),p=n("iCxV"),f=n("3lr5"),m=n("8vXU"),g=n("q5zr"),y=n("fdtz"),_=n("rxGp"),T=n("fNpk"),v=n("c+uM"),C=n("VkKB"),P=n("umUn"),S=n("VJ9E"),D=n("8t9B");o.AUTHORING_CONTEXT_TYPE_LOGO="LOGO",o.AUTHORING_CONTEXT_TYPE_FONT="FONT",o.AUTHORING_CONTEXT_TYPE_COLOR="COLOR",o.SPARK_LOGO_ROLE_PRIMARY="primary-logo",o.SPARK_LOGO_ROLE_SECONDARY="secondary-logo",o.SPARK_LOGO_ROLE_POST_STAMP="post-stamp",o.IAuthoringContextManager=i.defineProtocol("IAuthoringContextManager",{authoringContexts:"Array<IAuthoringContext>",authoringContext:"(String) -> IAuthoringContext",getOwnedAuthoringContextIDs:"() -> Array<String>",getDefaultBrandIdFromServer:"() -> String",createAuthoringContext:"(String, Boolean) -> IAuthoringContext"}),o.IAuthoringContext=i.defineProtocol("IAuthoringContext",{id:"String",name:"String",activated:"Boolean",isDefault:"Boolean",contextID:"String",urn:"String",colors:"Array<IAuthoringContextColor>",fonts:"Array<IAuthoringContextFont>",logos:"Array<IAuthoringContextLogo>",isMinimal:"Boolean",isValidVersion:"Boolean",ownedByCurrentUser:"Boolean",isBrandkitComplete:"() -> Boolean"}),o.IAuthoringContextColor=i.defineProtocol("IAuthoringContextColor",{id:"String",acRoles:"Array<String>",red:"Double",green:"Double",blue:"Double",alpha:"Double"}),o.IAuthoringContextFont=i.defineProtocol("IAuthoringContextFont",{id:"String",acRoles:"Array<String>",sourceType:"String",descriptor:"FontDescriptor"}),o.IAuthoringContextLogo=i.defineProtocol("IAuthoringContextLogo",{id:"String",acRoles:"Array<String>",acName:"String",url:"String",pixelWidth:"Integer",pixelHeight:"Integer",mimeType:"String"}),o.BrandingFacade=(r=function(){l.CoreObject.call(this)},i.defineClass({name:"BrandingFacade",ctor:r,superName:"CoreObject",statics:{brandifyDocument:function(e,t,n,o,i){return void 0===n&&(n=!0),void 0===o&&(o=!0),void 0===i&&(i=!0),T.LegacyCoreAssert.isTrue(""!=t.id,"need a valid authoring context to brandify",void 0,"BrandingFacade.brandifyDocument","BrandingFacade.swift",122),r.addBrandLogo(e,t,o).then((function(o){return i&&r.brandifyColors(e,t),n&&r.brandifyFonts(e,t),null}))},addBrandLogo:function(e,t,n){void 0===n&&(n=!0);var a=u.CorePromise.resolve(null);if(n){var l,c=t.logos.filter((function(e){return!i.isEmpty(e.url)&&e.acRoles.includes(o.SPARK_LOGO_ROLE_POST_STAMP)}),this);if((l=i.first(c))&&null==i.first(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==y.ImageForma.KIND})))){var d=r.makeLogoContentNode(l,e);a=a.then((function(t){return s.CreationFacade.addContent(e.firstPage,d,void 0,void 0,new s.AddFormaParams(void 0,void 0,null))}))}}return a},brandifyColors:function(e,t,n){void 0===n&&(n=!1),r.updateBrandedColorPalette(e,t,n)},updateBrandedColorPalette:function(e,t,n){for(var r=0,o=0,a=i.clone(e.firstPage.colorLibraryController.getTheoColorsUsedInDocument()),s=i.iter(a);!s.done;s.next()){var l=s.value;l.isBrandkitSecondaryColor()&&(o+=1),l.isBrandkitShade()&&(r+=1)}for(var u=o>0&&o>=r,d=[],h=i.iter(t.colors);!h.done;h.next()){var f=h.value,g=P.TheoColor.init_bb45(f);(u&&(g.isBrandkitSecondaryColor()||g.isBrandkitPrimaryColor())||!u&&g.isBrandkitShade())&&d.push(g)}if(d.length>0){var y;if(n)if(null!=(S=e.firstPage.root.controller.getGridController())){T.LegacyCoreAssert.isTrue(S.gridStyle.gridCells.length>=1,"expecting to have a grid with at least one cell",void 0,"BrandingFacade.updateBrandedColorPalette","BrandingFacade.swift",218);var v=S.forma.childAt(0).style.colors.colorID(c.ColorRole.FieldPrimary);null!=v&&(y=e.firstPage.colorLibraryController.getTheoColorForKey(v))}else{var C=e.firstPage.root.style.colors.colorID(c.ColorRole.FieldPrimary);null!=C&&(y=e.firstPage.colorLibraryController.getTheoColorForKey(C))}if(e.firstPage.colorLibraryController.applyColorTheme(d,"brandkit"),n){if(null!=y){var S,D=e.firstPage.colorLibraryController.getKeyOfColorInTheme(y);null==D&&(D=e.firstPage.colorLibraryController.addNewThemeKeyWithColor(y)),null!=(S=e.firstPage.root.controller.getGridController())?S.forma.childAt(0).style.colors.setColorId(c.ColorRole.FieldPrimary,D):e.firstPage.root.style.colors.setColorId(c.ColorRole.FieldPrimary,D)}}else e.firstPage.colorLibraryController.shuffleColorAssignments()}else p.Host.logging.logForCategory(_.LogCategories.kMultibrand,"addBranding asked to update color palette, but brandkit doesn't have any colors. Hope that's ok.",m.LogLevelEnum.INFO_LEVEL)},brandifyFonts:function(e,t){var n=r.getHeadlineFontForBrandify(e,t);if(null!=n){for(var o=!1,a=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!a.done;a.next()){var s,l=a.value;(s=i.as(l.style,v.LockupStyle))&&(s.font=n,o=!0)}0==o&&p.Host.logging.logForCategory(_.LogCategories.kMultibrand,"addBranding asked to apply fonts, but document contains no text lockups, so we can't. Hope that's ok.",m.LogLevelEnum.INFO_LEVEL)}},getHeadlineFontForBrandify:function(e,t){var n=r.getTheoFontForRole(S.TheoFont.SPARK_FONT_ROLE_HEADLINE,t);if(null==n)if(t.fonts.length>0){var o,i=t.fonts[0];(o=r.getFontFromIncludedFonts(i.descriptor))?n=S.TheoFont.init_9e5c(o,i.id,i.acRoles):(p.Host.logging.logForCategory(_.LogCategories.kMultibrand,"addBranding asked to apply fonts, but brandkit doesn't have a headline font, so we're just picking some random font. Hope that's ok.",m.LogLevelEnum.INFO_LEVEL),n=S.TheoFont.init_9e5c(p.Host.fontProvider.getIncludedFonts(e).fontAt(0)))}else p.Host.logging.logForCategory(_.LogCategories.kMultibrand,"addBranding asked to apply fonts, but brandkit doesn't have any fonts. Hope that's ok.",m.LogLevelEnum.INFO_LEVEL);return n},whichUserUploadedFontsWillBeUsedInBrandify:function(e,t){var n,o=[];if((n=r.getHeadlineFontForBrandify(e,t))&&n.fontData.source==d.FontSource.USER_UPLOAD)for(var a=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!a.done;a.next()){var s=a.value;if(null!=i.as(s.style,v.LockupStyle)){o.push(n.fontData.touaName);break}}return o},getCustomFontsForBrand:function(e){return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t}),this)},getCustomFontNamesForBrand:function(e){var t;return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t}),this).map((function(e){return(t=i.opt(e.descriptor,(function(e){return e.touaName})))||null!=t?t:""}),this).filter((function(e){return""!=e}),this)},getEmbeddableFontNamesForBrand:function(e){var t;return e.fonts.filter((function(e){var t;return null!=(t=e.sourceType)&&"user-uploaded"==t&&i.opt(e.descriptor,(function(e){return e.fsType==d.FontEmbeddability.INSTALLABLE}))}),this).map((function(e){return(t=i.opt(e.descriptor,(function(e){return e.touaName})))||null!=t?t:""}),this).filter((function(e){return""!=e}),this)},getTheoFontForRole:function(e,t){for(var n,o=i.iter(t.fonts);!o.done;o.next()){var a,s=o.value;if(a=r.getFontFromIncludedFonts(s.descriptor)){var l=S.TheoFont.init_9e5c(a,s.id,s.acRoles);if(l.getSparkFontRole()==e){n=l;break}}}return n},getFontFromIncludedFonts:function(e){if(null==e)return null;var t,n=p.Host.fontProvider.getIncludedFonts(f.ANY_DOCUMENT);return null!=(t=n.indexOf(e))?n.fontAt(t):null},changeBranding:function(e,t){return u.CorePromise.resolve(null).then((function(n){return null==t?""==e.authoringContextID?null:r.removeBranding(e):e.authoringContextID==t.id?null:""==e.authoringContextID?(i.opt(p.Host.brandkitManager,(function(e){return e.activateBrand(t.id)})),null):r.addBranding(e,t)}))},addBranding:function(e,t){return T.LegacyCoreAssert.isTrue(""!=t.id,"need a valid authoring context to add branding",void 0,"BrandingFacade.addBranding","BrandingFacade.swift",467),r.applyLogoForAddBranding(e,t).then((function(n){return i.opt(p.Host.fontProvider,(function(e){return e.registerBrandFonts(t.id)})),r.applyBrandFontsForAddBranding(e,t),r.applyColorsForAddBranding(e,t),i.opt(p.Host.brandkitManager,(function(e){return e.activateBrand(t.id)})),e.setAuthoringContext(t),null}))},applyLogoForAddBranding:function(e,t){for(var n=[],o=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==y.ImageForma.KIND})));!o.done;o.next()){var a=o.value;n.push(a)}for(var l=u.CorePromise.resolve(null),c=i.iter(n);!c.done;c.next()){var d=c.value,h=i.as(e.content.nodeByID(d.contentID),g.ImageContentNode),p=r.getReplacementLogoContentNode(e,t,h.getSparkLogoRole());null!=p&&(l=l.then((function(t){return s.CreationFacade.addContent(e.firstPage,p,void 0,void 0,new s.AddFormaParams(void 0,void 0,d.parent))})))}return l},applyColorsForAddBranding:function(e,t){for(var n=[],r=i.iter(t.colors);!r.done;r.next()){var o=r.value;n.push(P.TheoColor.init_bb45(o))}n.length>0&&e.firstPage.colorLibraryController.updateSparkColorsByRole(n)},applyBrandFontsForAddBranding:function(e,t){for(var n,r=[],o=i.iter(t.fonts);!o.done;o.next()){var a=o.value,s=S.TheoFont.init_a314(a);r.push(s),s.getSparkFontRole()==S.TheoFont.SPARK_FONT_ROLE_BODY&&(n=s)}for(var l=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!l.done;l.next()){var u,c=l.value;if(u=i.as(c.style,v.LockupStyle)){var d;if((d=u.font)&&d.isSparkFont()){for(var h,p=n,f=i.iter(r);!f.done;f.next())if(a=f.value,d.getSparkFontRole()==a.getSparkFontRole()){p=a;break}(h=p)&&(u.font=h)}for(var m=i.iter(u.characterStyles);!m.done;m.next()){var g,y=m.value;if((g=y.font)&&g.isSparkFont()){p=n;for(var _=i.iter(r);!_.done;_.next())if(a=_.value,g.getSparkFontRole()==a.getSparkFontRole()){p=a;break}null!=p&&(y.font=p)}}}}},whichUserUploadedFontsWouldBeUsedInBrandSwitch:function(e,t,n){var r,o,a=[];if((r=t)&&(o=n)){var s,l=[];i.opt(p.Host.fontProvider,(function(e){return e.registerBrandFonts(o.id)}));for(var u=i.iter(o.fonts);!u.done;u.next()){var c=u.value,h=S.TheoFont.init_a314(c);h.fontData.source==d.FontSource.USER_UPLOAD&&(l.push(h),h.getSparkFontRole()==S.TheoFont.SPARK_FONT_ROLE_BODY&&(s=h))}if(i.opt(p.Host.fontProvider,(function(e){return e.refreshBrandkitFonts(r.id)})),0==!l.length)for(var f=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!f.done;f.next()){var m,g=f.value;if(m=i.as(g.style,v.LockupStyle)){var y;if((y=m.font)&&y.isSparkFont()){for(var _=s,T=i.iter(l);!T.done;T.next())if(c=T.value,y.getSparkFontRole()==c.getSparkFontRole()){_=c;break}null!=(D=i.opt(_,(function(e){return e.fontData.touaName})))&&(a.includes(D)||a.push(D))}for(var C=i.iter(m.characterStyles);!C.done;C.next()){var P;if((P=C.value.font)&&P.isSparkFont()){_=s;for(var D,A=i.iter(l);!A.done;A.next())if(c=A.value,P.getSparkFontRole()==c.getSparkFontRole()){_=c;break}null!=(D=i.opt(_,(function(e){return e.fontData.touaName})))&&(a.includes(D)||a.push(D))}}}}}return a},getReplacementLogoContentNode:function(e,t,n){for(var a,s=i.iter(t.logos);!s.done;s.next())for(var l=s.value,u=i.iter(l.acRoles);!u.done;u.next()){var c=u.value;if(c==n)return r.makeLogoContentNode(l,e);c==o.SPARK_LOGO_ROLE_PRIMARY&&(a=l)}return null!=a?r.makeLogoContentNode(a,e):null},removeBranding:function(e){return r.removeAllBrandkitFontsAndLogos(e),e.setAuthoringContext(null),u.CorePromise.resolve(null)},removeAllBrandkitFontsAndLogos:function(e){var t;if(t=e.controller)for(var n=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()||e.isLogo()})));!n.done;n.next()){var o=n.value;if(o.isTypeLockup()){var a,s;if((a=i.as(o.style,v.LockupStyle))&&(s=a.font)&&s.isSparkFont()){var l=r.getNonBKFontForRemapping(s);p.Host.logging.logForCategory(_.LogCategories.kMultibrand,"Replacing brandkit font "+s.fontData.postScriptName+" with non-BK font "+l.postScriptName,m.LogLevelEnum.INFO_LEVEL),a.font=S.TheoFont.init_9e5c(l)}}else{var u;t.selection.deselectForma(o),(u=o.parent)&&i.opt(i.as(u.controller,h.GroupController),(function(e){return e.removeFormaFromGroup(o)}));var c=o.controller.settings;null!=c&&c==t.controllerSettingsState.settings&&(t.controllerSettingsState.settings=null)}}else T.LegacyCoreAssert.fail("Document has no controller",void 0,"BrandingFacade.removeAllBrandkitFontsAndLogos","BrandingFacade.swift",701)},getNonBKFontForRemapping:function(e){return e.fontData.source==d.FontSource.EMBEDDED?e.fontData:e.fontData.serif?e.fontData.blackness>=7?r.getFontWithPostscriptName("Lora-Regular"):e.fontData.italic?r.getFontWithPostscriptName("OldStandardTT-Italic"):r.getFontWithPostscriptName("Lora-Regular"):e.fontData.calligraphic?r.getFontWithPostscriptName("Yellowtail"):e.fontData.blackness>=7?r.getFontWithPostscriptName("SourceSansPro-Black"):e.fontData.italic?r.getFontWithPostscriptName("CallunaSans-Italic"):r.getFontWithPostscriptName("Raleway")},getFontWithPostscriptName:function(e){return p.Host.fontProvider.descriptorForPostScriptName(e,f.ANY_DOCUMENT)},brandDocumentForElement:function(e,t,n){var r=p.Host.brandkitManager.brandkitForElement(t,n);T.LegacyCoreAssert.isTrue(null!=r,"Adding a branded element but can't find the brandkit it belongs to",{elementType:n},"BrandingFacade.brandDocumentForElement","BrandingFacade.swift",748),i.opt(p.Host.logging,(function(e){return e.logToAnalytics(a.AnalyticsConstants.kAnalyticsDataBrandkitElementUsed,{elementType:n})})),null!=r&&(""==e.authoringContextID?(p.Host.logging.logForCategory(_.LogCategories.kMultibrand,"** Branding document, because it now contains a branded element of type "+n,m.LogLevelEnum.INFO_LEVEL),i.opt(p.Host.logging,(function(t){return t.logToAnalytics(a.AnalyticsConstants.kAnalyticsEventAddedBrandingToProject,{projectID:e.uuid})}))):e.authoringContextID!=r.id&&p.Host.logging.logForCategory(_.LogCategories.kMultibrand,"** Re-Branding document, because it was branded (for a different brand) and now contains a branded element of type "+n,m.LogLevelEnum.INFO_LEVEL),e.setAuthoringContext(r))},unBrandDocumentIfNoBrandedElements:function(e){""!=e.authoringContextID&&(r.doesDocumentContainBrandedElements(e,!1)||(e.setAuthoringContext(null),p.Host.logging.logForCategory(_.LogCategories.kMultibrand,"** Unbranding document, because it no longer contains any branded elements",m.LogLevelEnum.INFO_LEVEL)))},isDocumentBranded:function(e,t){return""!=e.authoringContextID&&(!t||r.getDocumentBrandedElementsUsage(e,!0).length>0)},kBrandUsageColor:"color",kBrandUsageFont:"font",kBrandUsageCustomFont:"customFont",kBrandUsageLogo:"logo",getDocumentBrandedElementsUsage:function(e,t,n){void 0===n&&(n=!0);var o=!1,a=!1,s=!1,l=!1,u=[];if(!t&&e.firstPage.colorLibraryController.areAnySparkColorsInUse()&&(u.push(r.kBrandUsageColor),o=!0,1==n))return u;for(var c=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()||e.isTypeLockup()})));!c.done;c.next()){var d=c.value;if(d.isTypeLockup())!a&&r.doesLockupUseBrandedFonts(d)&&(u.push(r.kBrandUsageFont),a=!0),!s&&r.doesLockupUseCustomFonts(d)&&(u.push(r.kBrandUsageCustomFont),s=!0);else if(!l&&d.isLogo()&&null!=d.contentID){var h;(h=i.as(e.content.nodeByID(d.contentID),g.ImageContentNode))&&null!=h.sparkElementID&&""!=h.sparkElementID&&(u.push(r.kBrandUsageLogo),l=!0)}if(n&&(o||a||s||l))return u;if(o&&a&&s&&l)break}return u},doesDocumentContainBrandedElements:function(e,t){return r.getDocumentBrandedElementsUsage(e,t).length>0},areSparkFontsInUse:function(e,t){if(0==t.length)return!1;for(var n=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var r,o=n.value;if(r=i.as(o.style,v.LockupStyle)){var a;if((a=r.font)&&null!=a.sparkElementID&&a.sparkElementID.length>0&&t.includes(a.sparkElementID))return!0;for(var s=i.iter(r.characterStyles);!s.done;s.next()){var l;if((l=s.value.font)&&null!=l.sparkElementID&&l.sparkElementID.length>0&&t.includes(l.sparkElementID))return!0}}}return!1},updateSparkFont:function(e,t){for(var n=!1,r=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!r.done;r.next()){var o,a=r.value;if(o=i.as(a.style,v.LockupStyle)){var s;if(s=o.font){var l=s.sparkElementID;null!=l&&l.length>0&&l==t.id&&(n=!0,o.font=S.TheoFont.init_a314(t))}for(var u=i.iter(o.characterStyles);!u.done;u.next()){var c=u.value;null!=c.font&&null!=c.font.sparkElementID&&c.font.sparkElementID.length>0&&c.font.sparkElementID==t.id&&(n=!0,c.font=S.TheoFont.init_a314(t))}}}T.LegacyCoreAssert.isTrue(n,"asked to update spark font which isn't currently used.",void 0,"BrandingFacade.updateSparkFont","BrandingFacade.swift",971)},relinkSparkFont:function(e,t,n){for(var r=!1,o=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!o.done;o.next()){var a,s=o.value;if(a=i.as(s.style,v.LockupStyle)){var l;if(l=a.font){var u=l.sparkElementID;null!=u&&u.length>0&&u==t&&(r=!0,a.font=S.TheoFont.init_a314(n))}for(var c=i.iter(a.characterStyles);!c.done;c.next()){var d=c.value;null!=d.font&&null!=d.font.sparkElementID&&d.font.sparkElementID.length>0&&d.font.sparkElementID==t&&(r=!0,d.font=S.TheoFont.init_a314(n))}}}T.LegacyCoreAssert.isTrue(r,"asked to relink spark font which isn't currently used.",void 0,"BrandingFacade.relinkSparkFont","BrandingFacade.swift",1010)},doesLockupUseBrandedFonts:function(e){var t;if(t=i.as(e.style,v.LockupStyle)){var n;if((n=t.font)&&null!=n.sparkElementID&&n.sparkElementID.length>0)return!0;for(var r=i.iter(t.characterStyles);!r.done;r.next()){var o=r.value;if(null!=o.font&&null!=o.font.sparkElementID&&o.font.sparkElementID.length>0)return!0}}else T.LegacyCoreAssert.fail("doesLockupUseBrandedFonts called for something which is not a type lockup",void 0,"BrandingFacade.doesLockupUseBrandedFonts","BrandingFacade.swift",1043);return!1},doesLockupUseCustomFonts:function(e){var t;if(t=i.as(e.style,v.LockupStyle)){var n;if((n=t.font)&&n.fontData.source==d.FontSource.USER_UPLOAD)return!0;for(var r=i.iter(t.characterStyles);!r.done;r.next()){var o=r.value;if(null!=o.font&&o.font.fontData.source==d.FontSource.USER_UPLOAD)return!0}}else T.LegacyCoreAssert.fail("doesLockupUseCustomFonts called for something which is not a type lockup",void 0,"BrandingFacade.doesLockupUseCustomFonts","BrandingFacade.swift",1078);return!1},areSparkLogosInUse:function(e,t){if(0==t.length)return!1;for(var n=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==y.ImageForma.KIND})));!n.done;n.next()){var r,o=n.value;if((r=i.as(e.content.nodeByID(o.contentID),g.ImageContentNode))&&null!=r.sparkElementID&&""!=r.sparkElementID&&t.includes(r.sparkElementID))return!0}return!1},updateSparkLogo:function(e,t){for(var n=!1,o=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==y.ImageForma.KIND})));!o.done;o.next()){var a=o.value,l=i.as(e.content.nodeByID(a.contentID),g.ImageContentNode);if(i.opt(l,(function(e){return null!=e.sparkElementID&&i.opt(l,(function(e){return""!=e.sparkElementID}))&&t.id==i.opt(l,(function(e){return e.sparkElementID}))}))){n=!0;var u=r.makeLogoContentNode(t,e);s.CreationFacade.addContent(e.firstPage,u,void 0,void 0,new s.AddFormaParams(void 0,void 0,a.parent))}}T.LegacyCoreAssert.isTrue(n,"asked to update spark logo which isn't currently used.",void 0,"BrandingFacade.updateSparkLogo","BrandingFacade.swift",1130)},relinkSparkLogo:function(e,t,n){for(var o=!1,a=i.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==y.ImageForma.KIND})));!a.done;a.next()){var l=a.value,u=i.as(e.content.nodeByID(l.contentID),g.ImageContentNode);if(i.opt(u,(function(e){return null!=e.sparkElementID&&i.opt(u,(function(e){return""!=e.sparkElementID}))&&t==i.opt(u,(function(e){return e.sparkElementID}))}))){o=!0;var c=r.makeLogoContentNode(n,e);s.CreationFacade.addContent(e.firstPage,c,void 0,void 0,new s.AddFormaParams(void 0,void 0,l.parent))}}T.LegacyCoreAssert.isTrue(o,"asked to relink spark logo which isn't currently used.",void 0,"BrandingFacade.relinkSparkLogo","BrandingFacade.swift",1154)},isImageBrandedLogo:function(e){var t;return!(null==e.contentID||!(t=i.as(e.page.document.content.nodeByID(e.contentID),g.ImageContentNode))||!e.isLogo()||null==t.sparkElementID||""==t.sparkElementID)},makeLogoContentNode:function(e,t){var n=t.content.createNode(g.ImageContentNode.KIND,null);return n.url=e.url,n.pixelWidth=e.pixelWidth,n.pixelHeight=e.pixelHeight,n.mimeType=e.mimeType,n.setRoles(e.acRoles),n.sparkElementID=e.id,n.mediaMetadata=C.MediaMetadata.init_4d41(void 0,void 0,void 0,void 0,void 0,void 0,"brandkit",void 0,void 0,void 0,void 0,C.MediaMetadata.DESIGNINTENT_LOGO),n},areSparkColorsInUse:function(e,t){return 0!=t.length&&e.firstPage.colorLibraryController.areSparkColorsInUse(t)},updateSparkColor:function(e,t){return e.firstPage.colorLibraryController.updateSparkColor(P.TheoColor.init_bb45(t))},getBrandkitColorsForUI:function(e,t){var n,r,o=!1,a=[];if((n=i.as(i.opt(t,(function(e){return e.controller})),D.TypeLockupController))&&n.styleController.isCurrentlyShowingMultipleColors()){o=!0;var s=n.lockupStyle.colors.theoColor(c.ColorRole.FieldPrimary),l=n.lockupStyle.colors.theoColor(c.ColorRole.FieldSecondary);null!=s&&s.isBrandkitColor()&&null!=l&&l.isBrandkitColor()&&(a=[s,l])}for(var u=[],d=i.iter(e.colors);!d.done;d.next()){var h=d.value,p=P.TheoColor.init_bb45(h);if(0==o)u.push([p]),p.isBrandkitPrimaryColor()&&(r=p,p.isBrandkitShade()&&u.push([P.TheoColor.init_bb45(h)]));else{var f=0,m="";if(p.isBrandkitPrimaryColor())r=p,f=5;else if(p.isBrandkitSecondaryColor())f=3;else if(p.isBrandkitShade()){f=1;var g=p.getBrandkitShadeRole();if(g.startsWith(P.SHADE_ROLE_PREFIX)){var y=g.substr(P.SHADE_ROLE_PREFIX.length),_=(i.toInt(y)+3)%7;m=P.SHADE_ROLE_PREFIX+i.toString(_)}}else f=1;for(var T=0,v=i.clone(i.shuffle(e.colors)),C=i.iter(v);!C.done;C.next()){var S=C.value,A=P.TheoColor.init_bb45(S);if((""==m&&Math.abs(p.rgbColor.lightness-A.rgbColor.lightness)>30||m==A.getBrandkitShadeRole())&&(u.push([p,A]),(T+=1)>=f))break}}}if(o&&a.length>0){for(var E=!1,R=i.iter(u);!R.done;R.next()){var F=R.value;if(F[0].sparkElementID==a[0].sparkElementID&&F[1].sparkElementID==a[1].sparkElementID){E=!0;break}}E||u.push(a)}return i.sortInPlace(u,(function(e,t){var n=e[0],o=t[0];if(null!=r){if(n===r)return o!==r;if(o===r)return!1}if(n.isBrandkitSecondaryColor())return!o.isBrandkitSecondaryColor()||n.rgbColor.lightness<o.rgbColor.lightness;if(o.isBrandkitSecondaryColor())return!1;var i=n.getBrandkitShadeRole(),a=o.getBrandkitShadeRole();return null!=i?null==a||i<a:null==a&&n.rgbColor.lightness<o.rgbColor.lightness})),u},getTheoColorForSolidColor:function(e,t){if(null!=e)for(var n=i.iter(e.colors);!n.done;n.next()){var r=n.value,o=P.TheoColor.init_bb45(r);if(o.rgbColor.isEqual(t))return o}return P.TheoColor.init_5344(t,null,null)}}}),r)},kwVJ:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("IUM5"),s=n("tGKA"),l=n("Ird5"),u=n("jfma"),c=n("sq5L"),d=n("bauG"),h=n("yjxF"),p=n("Aj79"),f=n("PlOi"),m=n("g6aL"),g=n("fnrT"),y=n("sIWg");o.PGMWatermarkingUtils=(r=function(){},i.defineClass({name:"PGMWatermarkingUtils",ctor:r,statics:{WATERMARK_ENTITY:"watermark",WATERMARK_GROUP_ENTITY:"add-watermark-group",WATERMARK_CONTENT_TYPE:"image/png",WATERMARK_RESOURCE_ID:"watermark-spark.png",WATERMARK_V2_RESOURCE_ID:"watermark-spark-v2.png",WATERMARK_EXPRESS_RESOURCE_ID:"watermark-express.png",WATERMARK_WIDTH:743,WATERMARK_HEIGHT:80,WATERMARK_SCALE:.5,addWatermark:function(e){var t,n,o=new d.PGMImage(r.WATERMARK_ENTITY,h.PGMNodeMetadata.EMPTY,l.PGMAnimationList.EMPTY,y.TheoRect.fromXYWH(0,0,r.WATERMARK_WIDTH,r.WATERMARK_HEIGHT),r.WATERMARK_EXPRESS_RESOURCE_ID),_=new p.PGMReference(o,new u.PGMCompositingParams(s.Matrix2D.translationXY(e.bounds.width-r.WATERMARK_WIDTH,e.bounds.height-r.WATERMARK_HEIGHT).scaleXYfromPoint(e.bounds.evalXY(1,1),r.WATERMARK_SCALE,r.WATERMARK_SCALE)));return t=(n=i.as(e.root,m.PGMSimpleGroup))?n.withEntityAndChildren(n.entity,n.children.concat([_])):new m.PGMSimpleGroup(r.WATERMARK_GROUP_ENTITY,h.PGMNodeMetadata.EMPTY,l.PGMAnimationList.EMPTY,[new p.PGMReference(e.root),_]),new c.PGMGraph(t,e.bounds,e.duration,e.resources.adding(o.contentID,new f.PGMResourceProvider(r.WATERMARK_CONTENT_TYPE,new g.StorageSpecApplicationResource(a.CATEGORY_ID_IMAGES,r.WATERMARK_EXPRESS_RESOURCE_ID))))}}}),r)},lJxM:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("HRWw"),s=n("A6KL"),l=n("fNpk"),u=n("x4Gy");o.TextContentNode=(r=function(){},i.defineClass({name:"TextContentNode",ctor:r,superName:"ContentNode",statics:{KIND:{get:function(){return"text"}},SCHEMA_CLASS_NAME:{get:function(){return"TextContentNode"}},factory:{get:function(){return function(e,t,n,o){var a=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),s.GroupContentNode);return l.LegacyCoreAssert.isTrue(null!=a,"Content nodes need a parent",void 0,"TextContentNode","TextContentNode.swift",16),r.init_3144(e,t,n,a)}}},PROPERTY_TEXT_MODEL:"text-model",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,a.ContentNode,a.ContentNode.prototype.init_3144,e,t,n,r)},init_5972:function(e,t){i.super_init(this,a.ContentNode,a.ContentNode.prototype.init_8b5c,e,"text",t),this.set(r.PROPERTY_TEXT_MODEL,u.ContentTextModel.init_d41d())},className:{get:function(){return r.SCHEMA_CLASS_NAME}},textModel:{get:function(){return this.get(r.PROPERTY_TEXT_MODEL)},set:function(e){this.set(r.PROPERTY_TEXT_MODEL,e)}},text:{get:function(){return this.textModel.text},set:function(e){this.textModel.text=e}},insertTextUsingSubstring:function(e){this.textModel.insertTextUsingSubstring(e)},replaceText:function(e){this.textModel.replaceText(e)},subscribeWithCallbackToTextModel:function(e,t){return this.textModel.subscribeWithCallback(e,t)},match:function(e,t){var n;void 0===t&&(t=null),(n=i.as(e,r))&&this.textModel.match(n.textModel),a.ContentNode.prototype.match.call(this,e,t)}}}),r)},lWlM:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("iCxV");o.DCXComponentDecoder=(r=function(e,t){this.branch_=e,this.component_=t,a.CoreObject.call(this)},i.defineClass({name:"DCXComponentDecoder",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IImportDataComponent"==e}},props:{id:{get:function(){return this.component_.componentId}},name:{get:function(){return this.component_.name}},path:{get:function(){return this.component_.path}},mimeType:{get:function(){return this.component_.type}},etag:{get:function(){return this.component_.etag}},url:{get:function(){var e;return null!=(e=this.branch_.getPathForComponent(this.component_))?i.opt(s.Host.persistUtils,(function(t){return t.fileUrlForPath(e)})):null}}}}),r)},lmwz:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("0wFF"),l=n("SpAV"),u=n("aO0D"),c=n("SDMx"),d=n("gpZI"),h=n("CWW7"),p=n("gXiO"),f=n("yGNn"),m=n("Bpjk"),g=n("ascj"),y=n("FNB+"),_=n("6ZWm"),T=n("cmoc"),v=n("JEzR"),C=n("P83h"),P=n("9Lk3"),S=n("ZK0l"),D=n("6Rk9"),A=n("4mVB"),E=n("ZhwN"),R=n("iCxV"),F=n("xYeW"),b=n("8vXU"),I=n("kJ8p"),O=n("IUM5"),k=n("Qlvz"),N=n("U010"),M=n("q5zr"),L=n("fdtz"),x=n("uWOl"),B=n("fNpk"),w=n("tGKA"),G=n("VkKB"),Y=n("uxH+"),U=n("K0Rh"),j=n("JO5d"),V=n("djAF"),H=n("35Q0"),K=n("fAXt"),W=n("8t9B"),X=n("oKlP"),z=n("sIWg"),q=n("zjod");i.ImageFacade=(r=function(){p.CoreObject.call(this)},o={},a.defineClass({name:"ImageFacade",ctor:r,superName:"CoreObject",statics:{disableCCStorageForDeepcut:{get:function(){var e;return void 0===o.disableCCStorageForDeepcut&&(o.disableCCStorageForDeepcut=!(e=a.opt(R.Host.featureFlags,(function(e){return e.isRemoveBackgroundCCStorageDisabled()})))&&null==e||e),o.disableCCStorageForDeepcut}},replaceImageWithColors:function(e,t){var n=e;if(e instanceof T.FrameForma||e instanceof L.ImageForma&&e.parent instanceof T.FrameForma){var r,o,i=a.as(e,T.FrameForma)||e.parent;(r=a.as(e.parent,U.RootForma))?(h.CreationFacade.deleteFormae([i],null),null!=t&&d.ColorFacade.applyColorsToForma(r,t),n=r):(n=i,(o=a.opt(a.as(i.controller,_.FrameController),(function(e){return e.replaceWithColoredShape()})))&&(null!=t?d.ColorFacade.applyColorsToForma(o,t):a.opt(o.controller,(function(e){return e.shuffleColorAssignment()})),n=o))}return n},replaceImagesWithColors:function(e,t){return e.map((function(e){return r.replaceImageWithColors(e,t)}),this)},applyImageFilter:function(e,t,n){a.clone(n?r.getBackgroundImagesFromPage(e.document.firstPage):e.selection.asFormaArray()).forEach((function(e){var n;if(n=r.getImageFormaForForma(e)){t.adjustments=k.ImageAdjustments.createDefault();var o=n.style;t.adjustments=o.adjustments,r.applyImageStyle(t,[e])}}))},applyImageStyle:function(e,t){for(var n=a.iter(t);!n.done;n.next()){var o,i=n.value;(o=r.getImageFormaForForma(i))&&(a.opt(a.opt(o.root,(function(e){return e.animation})),(function(e){return e.invalidate()})),o.applyStyle(e))}},getImageStyleForForma:function(e){var t;return(t=r.getImageFormaForForma(e))?a.as(t.style,x.ImageStyle):null},isFrame:function(e){return e instanceof T.FrameForma},getImageContentForForma:function(e){var t;return(t=r.getImageFormaForForma(e))?t.contentNode:null},getImageFormaForForma:function(e){var t,n,r;if(t=a.as(e,L.ImageForma))return t;if(n=a.as(e,q.VideoForma))return n;if((r=a.as(e,T.FrameForma))&&r.childCount>0){for(var o=a.iter(r.childrenAsArray);!o.done;o.next()){var i,s=o.value;if(i=a.as(s,L.ImageForma))return i}return null}return null},getMaskFormaForFormaByIntent:function(e,t){var n;return(n=r.getFrameFormaForForma(e))?n.findAuxiliary((function(e){return e.hasIntent(t)})):a.opt(e,(function(e){return 1==e.hasIntent(t)}))?e:null},getMaskFormaForForma:function(e){return r.getMaskFormaForFormaByIntent(e,y.Forma.INTENT_IMAGE_MASK)},getCutoutMaskFormaForForma:function(e){return a.as(r.getMaskFormaForFormaByIntent(e,y.Forma.INTENT_CUTOUT_MASK),L.ImageForma)},setCutoutModeForForma:function(e,t){var n,o,i;if((n=r.getFrameFormaForForma(e))&&(o=r.getImageFormaForForma(e))&&(i=a.as(n.style,v.FrameStyle))){var s=new C.FormaCutoutChangedEvent(o);o.beginUpdate(s),i.cutoutMode=t,o.endUpdate(s)}},getCutoutModeForForma:function(e){var t,n;return(t=r.getFrameFormaForForma(e))&&(n=a.as(t.style,v.FrameStyle))?n.cutoutMode:N.CutoutMode.Off},getVideoFormaForForma:function(e){var t;return(t=a.as(e,T.FrameForma))&&t.childCount>0?a.as(t.childAt(0),q.VideoForma):a.as(e,q.VideoForma)},getFrameFormaForForma:function(e){var t,n;return(t=a.as(a.opt(e,(function(e){return e.parent})),T.FrameForma))?t:(n=a.as(e,L.ImageForma))?a.as(n.parent,T.FrameForma):a.as(e,T.FrameForma)},getBackgroundImagesFromPage:function(e){for(var t=[],n=a.iter(e.root.filterWithCallback((function(e){return e.kind==T.FrameForma.KIND&&e.isBackgroundImage()&&e.childCount>0})));!n.done;n.next()){var r=n.value;t.push(r.childAt(0))}return t},getCropRatioId:function(e){var t;return(t=r.getFrameFormaForForma(e))?t.cropRatioId:m.CropRatioPresetLibrary.FREEFORM_ID},setImageCropToFreeform:function(e){var t;if((t=r.getFrameFormaForForma(e))&&t.cropRatioId!=m.CropRatioPresetLibrary.FREEFORM_ID){var n=new C.FormaTransformChangedEvent(t);t.beginUpdate(n),t.cropRatioId=m.CropRatioPresetLibrary.FREEFORM_ID,t.endUpdate(n)}},usesFreeformCropPreset:function(e){return r.getCropRatioId(e)==m.CropRatioPresetLibrary.FREEFORM_ID},migrateImageRotationToFrame:function(e,t){var n,r,o=e.placement.transformValues;if((n=t.bounds)&&(r=t.parent)){var i=Math.atan2(o.rotSine,o.rotCosine);if(Math.abs(i)>.001){var a=w.Matrix2D.rotation(o.rotCosine,o.rotSine),s=w._asterisk_TheoPoint_Matrix2D(n.evalXY(.5,.5),t.totalPlacement),l=w._asterisk_Matrix2D_Matrix2D(w._asterisk_Matrix2D_Matrix2D(w.Matrix2D.translation(X._negate_TheoPoint(s)),a),w.Matrix2D.translation(s)),u=w._asterisk_Matrix2D_Matrix2D(w._asterisk_Matrix2D_Matrix2D(r.totalPlacement,l),r.totalPlacement.inverse);t.move(u),K.TransformFacade.rotateForma(e,-i),o=e.placement.transformValues}}return o},resetCrop:function(e,t){var n,o,i,s;if(void 0===t&&(t=!0),(n=r.getFrameFormaForForma(e))&&(o=a.as(n.controller,_.FrameController))&&(i=e.bounds)&&(s=e.page.root.bounds)){var l=s.insetXY(10,10),u=e.finalFrame||l,c=u.center,d=new C.FormaTransformChangedEvent(n);n.beginUpdate(d);for(var h=r.migrateImageRotationToFrame(e,n),p=h.xscale,f=h.yscale,g=!1,y=0;!g&&y<10;){var T=i.transform(w.Matrix2D.scalingXY(p,f)),v=z.TheoRect.fromSize(T.size);o.setBoundsWithCropType(v,_.CropType.FitBorder);var P=(u=e.finalFrame||l).center;if(o.move(w.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(c,P))),t)if(0==e.totalPlacement.transformPoints(i.points).filter((function(e){return l.containsPoint(e)}),this).length){u=e.finalFrame||l;var S=l.intersectionWith(u)||l,D=Math.max(u.width/S.width,u.height/S.height);D=Math.max(D,1.05),0==y&&(c=S.center),p/=D,f/=D,y+=1}else g=!0;else g=!0}10==y&&a.opt(R.Host.logging,(function(e){return e.warning("resetCrop did not converge")})),n.cropRatioId=m.CropRatioPresetLibrary.ORIGINAL_ID,n.endUpdate(d),o.updateCropModeImage()}},cropImageToRatio:function(e,t,n){var o,i,s,l,u;if(void 0===t&&(t=0),void 0===n&&(n=null),r.canCropImage(e)){if(r.removeMaskForForma(e),(i=r.getFrameFormaForForma(e))&&(s=r.getImageFormaForForma(e))&&(l=s.finalFrame)&&(u=s.bounds)){var c,d;t<=0?(d=u.aspectRatio,c=m.CropRatioPresetLibrary.ORIGINAL_ID):(d=t,c=(o=m.CropRatioPresetLibrary.getIdForRatio(t))||null!=o?o:m.CropRatioPresetLibrary.FREEFORM_ID);var h=i.controller,p=l.origin,f=new C.FormaTransformChangedEvent(i);i.beginUpdate(f);var g=n||i.bounds,y=z.TheoRect.fromSize(g.fitAspectRatioWithin(d)),T=h.isImageCropped()?_.CropType.PreserveFocusAndScale:_.CropType.FitBorder;h.setBoundsWithCropType(y,T);var v=a.opt(s.finalFrame,(function(e){return e.origin}))||X.TheoPoint.ZERO;h.move(w.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(p,v))),i.cropRatioId=c,i.endUpdate(f),h.updateCropModeImage()}}else a.opt(R.Host.logging,(function(e){return e.warning("Asked to crop an image that can't be.")}))},snapFrameToVisibleImage:function(e,t){var n,o;if((n=a.opt(e.finalFrame,(function(e){return e.center})))&&(o=a.as(t.controller,_.FrameController))){var i,s,l=new C.FormaTransformChangedEvent(t);t.beginUpdate(l),(i=r.calcSnapFrameToVisibleImageBounds(e,t))&&(o.setBoundsWithCropType(i,_.CropType.PreserveFocusAndScale),(s=a.opt(e.finalFrame,(function(e){return e.center})))&&o.move(w.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(n,s)))),t.endUpdate(l)}},calcSnapFrameToVisibleImageBounds:function(e,t,n){var o,i;if(void 0===n&&(n=.99),(o=e.bounds)&&(i=t.bounds)){var s=e.placement,l=s.transformValues,u=Math.atan2(l.rotSine,l.rotCosine);if(Math.abs(u)<.001)return r.calcSnapFrameToVisibleImageBoundsUnrotated(o,i,s,n);var c=a.clone(D.GeometryFacade.getIntersectionPolygon(i,o,w.Matrix2D.Identity,e.placement));if(D.GeometryFacade.areaOfConvexPolygon(c)<n*i.area){var d=w.Matrix2D.rotation(Math.cos(u),Math.sin(u)),h=D.GeometryFacade.centerOfPolygon(c),p=t.totalPlacement.transformPoint(h);return K.TransformFacade.justTransformFormaInPageSpaceAboutPoint(t,d,p),K.TransformFacade.justTransformFormaInPageSpaceAboutPoint(e,d.inverse,p),s=e.placement,r.calcSnapFrameToVisibleImageBoundsUnrotated(o,i,s,n)}}return null},calcSnapFrameToVisibleImageBoundsUnrotated:function(e,t,n,r){var o;return void 0===r&&(r=.99),(o=n.transformRect(e).intersectionWith(t))&&o.area<r*t.area?o:null},inCropMode:function(e){return r.pageInCropMode(a.opt(e,(function(e){return e.page})))},pageInCropMode:function(e){var t;return null!=(t=a.opt(a.opt(a.opt(e,(function(e){return e.document})),(function(e){return e.controller})),(function(e){return e.selection.inCropMode})))&&t},enterCropMode:function(e){var t,n;return!(!(t=a.as(a.opt(e.parent,(function(e){return e.controller})),_.FrameController))||!(n=a.opt(e.controller,(function(e){return e.owner})))||(n.selection.inCropMode=!0,t.enterCropMode(),0))},exitCropMode:function(e){var t;if((r=a.as(a.opt(e.parent,(function(e){return e.controller})),_.FrameController))&&(t=a.opt(e.controller,(function(e){return e.owner})))&&(t.selection.inCropMode=!1,r.cleanupCropVisualization()),a.as(e.controller,Y.RootController)&&(t=a.opt(e.controller,(function(e){return e.owner})))){t.selection.inCropMode=!1;for(var n=a.iter(e.filterByKind(T.FrameForma.KIND));!n.done;n.next()){var r,o=n.value;(r=a.as(o.controller,_.FrameController))&&r.cleanupCropVisualization()}}},getTempCropImageForForma:function(e){var t;if(t=a.opt(a.opt(e,(function(e){return e.parent})),(function(e){return e.visitAsArray(y.FormaTraversal.JustChildren)})))for(var n=a.iter(t);!n.done;n.next()){var r=n.value;if(r.hasIntent(y.Forma.INTENT_TEMP_IMAGE_CROP)&&r.kind==T.FrameForma.KIND)return r}return null},canSetBackgroundImage:function(e){var t,n;return!(!(t=a.as(e,T.FrameForma))||!(n=t.controller))&&e.isImage()&&!t.isLogo()&&n.floating&&!e.isSticker()&&!n.userGroupMember},canSetFloatingImage:function(e){var t,n;return!(!(t=e)||!(n=t.controller))&&t.isImage()&&!t.isLogo()&&!n.floating&&!t.isVideo()&&!n.userGroupMember},canApplyCutout:function(e){var t;return!!(t=e)&&t.isImage()&&!t.isLogo()&&!t.isVideo()&&!t.isSticker()},canApplyBackgroundColor:function(e){var t,n;return!(!(t=a.as(e,T.FrameForma))||!(n=a.as(t.controller,_.FrameController)))&&t.isImage()&&(n.isBackgroundImageWithAlpha()||n.hasCutout)},isPotentialBackgroundImage:function(e){var t;return!!(t=a.as(e,T.FrameForma))&&(!t.isLogo()&&!t.isSticker()&&!t.controller.userGroupMember||t.isBackgroundImage())},isFloatingImage:function(e){var t,n;return!(!(t=a.as(e,T.FrameForma))||!(n=t.controller))&&n.floating},canCropImage:function(e){var t,n;return!(!(t=r.getFrameFormaForForma(e))||!(n=t.controller))&&!t.isLogo()&&n.floating&&!e.isSticker()},addHiddenImageToGrid:function(e){var t,n,o;(t=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),Y.RootController),(function(e){return e.getGridController()})))&&(n=a.as(e,T.FrameForma))&&(o=r.getImageFormaForForma(n))&&(o.style.opacity=1,o.intent=y.Forma.INTENT_GRID_CELL,n.intent=y.Forma.INTENT_GRID_CELL,n.allowUserMove=!1,t.removeFormaFromGroup(n),t.addFormaToGroup(n))},setBackgroundImage:function(e){e.isBackgroundImage()||(B.LegacyCoreAssert.isTrue(r.canSetBackgroundImage(e),"asked to pin an image that can't be pinned",void 0,"ImageFacade.setBackgroundImage","ImageFacade.swift",669),r.setBackgroundOrFloatingImage(e,!0))},setFloatingImage:function(e){var t;(t=e.controller)&&t.floating||(B.LegacyCoreAssert.isTrue(r.canSetFloatingImage(e),"asked to float an image that can't be floated",void 0,"ImageFacade.setFloatingImage","ImageFacade.swift",679),r.setBackgroundOrFloatingImage(e,!1))},setBackgroundOrFloatingImage:function(e,t){var n,o,i,s;if(!(e.isBackgroundImage()&&t||!e.isBackgroundImage()&&!t)&&(n=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),Y.RootController),(function(e){return e.getGridController()})))&&(o=a.as(e,T.FrameForma))&&(i=r.getImageFormaForForma(o))&&(s=o.finalFrame)){var l,u=a.opt(i.finalFrame,(function(e){return e.intersectionWith(s)})),c=new C.FormaStyleChangedEvent(n.forma);n.forma.beginUpdate(c),t&&(r.formaHasMask(o)&&r.removeMaskForForma(e),a.opt(i.controller,(function(e){return e.rotate(o.rotationInRadians())})),i.style.opacity=1,o.cropRatioId=m.CropRatioPresetLibrary.FREEFORM_ID,null!=(l=n.getBasicShapeLayoutColor())&&a.opt(e.root,(function(e){return e.style.colors.setColorId(g.ColorRole.FieldPrimary,l)})));var d=!1;if(!t&&null!=n.formaMappingSwiftDict[o.formaID]){var h=n.gridStyle.name.includes(A.GridStyle.SINGLE_LAYOUT_NAME)||n.gridStyle.name.includes(A.GridStyle.BALANCED_LAYOUT_NAME)||n.gridStyle.name==A.GridStyle.CUSTOM_LAYOUT_NAME;(n.getBackgroundShapes().length>0||!h)&&(n.removeFormaWithoutGridModification(o),d=!0)}if(d||n.removeFormaFromGroup(o),o.allowUserMove=!t,o.intent=t?y.Forma.INTENT_GRID_CELL:y.Forma.INTENT_FLOATING_IMAGE,i.intent=t?y.Forma.INTENT_GRID_CELL:y.Forma.INTENT_FLOATING_IMAGE,!t){var p=s.center;(null!=u?u.area/s.area:1)<.8?(o.bounds=z.TheoRect.fromSize(u.size),p=u.center):o.bounds=a.opt(o.bounds,(function(e){return e.scale(.95,new X.TheoPoint(0,0))})),o.moveCenterToPoint(p)}if(n.addFormaToGroupWithCurrentImage(o),!t){var f,_=o.parent,v=a.clone(_.filterByControllerKind(W.TypeLockupController.KIND));if(v.length>0){for(var P,S=v[0];null!=S&&null==_.indexOfChild(S);)S=S.parent;(P=S)?_.insertBefore(o,P,!0):B.LegacyCoreAssert.fail("Parenting confusion while moving image to fore; not reordering",void 0,"ImageFacade.setBackgroundOrFloatingImage","ImageFacade.swift",791)}(f=r.getCutoutMaskFormaForForma(o))&&r.setTightCropToCutoutMask(o,f,!1)}n.forma.endUpdate(c)}},getFrameForForma:function(e){var t;return(t=a.as(e,T.FrameForma))?t:e instanceof L.ImageForma||e instanceof q.VideoForma?a.as(e.parent,T.FrameForma):null},logCutoutProgressToAnalytics:function(e,t,n,r){var o;if(void 0===r&&(r=null),o=R.Host.logging){var i,a={mode:t,duration:n,platformID:o.platformID()};null!=(i=r)&&(a.error=i),o.logToNewRelic(e,a)}},generateMaskFromImageBytes:function(e,t,n){var o,i,s,l,u;return(o=a.opt(e.contentNode,(function(e){return e.image})))&&null!=(i=e.mimeType)&&(s=R.Host.network)&&(l=R.Host.dataFactory)&&(u=R.Host.logging)?o.getImageRepresentationData(i,n).then((function(e){var n;if(n=a.as(e,F.HostDataProtocol)){t.data=l.createFromFormData({file:new F.HostNetworkFormDatum(n,"masksource")});var o=u.getCurrentTime();return s.request(t).then((function(e){return r.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_SUCCESS,"upload",a.toInt(1e3*(u.getCurrentTime()-o))),e})).fail((function(e){var t,n=e;return r.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_ERROR,"upload",a.toInt(1e3*(u.getCurrentTime()-o)),a.toString(n)),(t=a.as(n,I.HostNetworkError))&&(n=N.ImageCutoutErrorLibrary.mapServerErrorToMaskError(t)),f.CorePromise.reject(n)}))}return B.LegacyCoreAssert.fail("Failed to get resized image.",void 0,"ImageFacade.generateMaskFromImageBytes","ImageFacade.swift",880),f.CorePromise.reject("Failed to get resized image.")})):(B.LegacyCoreAssert.fail("Invalid image data or Host instance(s).",void 0,"ImageFacade.generateMaskFromImageBytes","ImageFacade.swift",885),f.CorePromise.reject("Invalid image data or Host instance(s)."))},generateMaskFromCCStorageImage:function(e,t){var n,o,i,s,l,u,c;if((n=a.opt(e.contentNode,(function(e){return e.image})))&&(o=e.contentNode)&&null!=(i=n.getStoragePath(o))&&(s=R.Host.network)&&(l=R.Host.dataFactory)&&(u=R.Host.logging)&&(c=l.createFromString("cc-storage://"+i,"text/plain"))){t.data=l.createFromFormData({url:new F.HostNetworkFormDatum(c)});var d=u.getCurrentTime();return s.request(t).then((function(e){return r.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_SUCCESS,"cc-storage",a.toInt(1e3*(u.getCurrentTime()-d))),e})).fail((function(e){var t,n=e,o=a.toString(n);return(t=a.as(n,I.HostNetworkError))&&(t.type==I.HostNetworkErrorType.NotFound&&(o="image not found on CC Storage"),n=N.ImageCutoutErrorLibrary.mapServerErrorToMaskError(t)),r.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_ERROR,"cc-storage",a.toInt(1e3*(u.getCurrentTime()-d)),o),f.CorePromise.reject(n)}))}return B.LegacyCoreAssert.fail("Invalid image data or Host instance(s).",void 0,"ImageFacade.generateMaskFromCCStorageImage","ImageFacade.swift",937),f.CorePromise.reject("Invalid image data or Host instance(s).")},setModelVersionFromResponse:function(e,t){var n,r;(n=e.headers)&&null!=(r=n["x-version"])&&(t.modelVersion=r,t.model==N.ImageCutoutModelLibrary.CURRENT_MODEL&&N.ImageCutoutModelLibrary.instance.setModelVersion(r))},processNetworkResponseAndSaveImage:function(e,t){var n,o;return(n=a.as(e,I.HostNetworkResponse))&&(o=n.data)?(r.setModelVersionFromResponse(n,t),R.Host.network.saveImageComponent(o,n.mimeType)):f.CorePromise.reject("Invalid network response")},generateCutoutMaskForImage:function(e,t,n,o){var i;return void 0===o&&(o=!1),(i=r.getImageFormaForForma(e))?N.ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig(t,N.MASK_ENDPOINT,I.HostNetworkRequestMethod.post,n).then((function(e){var n;return(n=a.as(e,I.HostNetworkRequest))?o||r.disableCCStorageForDeepcut?r.generateMaskFromImageBytes(i,n,t.maskSize):r.generateMaskFromCCStorageImage(i,n).then((function(e){return t.maskSize=N.CutoutMaskSize.ORIGINAL,e})).fail((function(e){var o;return(o=a.as(e,I.HostNetworkError))&&o.type==I.HostNetworkErrorType.NotFound?r.generateMaskFromImageBytes(i,n,t.maskSize):f.CorePromise.reject(e)})):f.CorePromise.reject("Invalid network request object")})):f.CorePromise.reject("Invalid image or frame")},processMask:function(e,t,n,o){var i,s;if(void 0===o&&(o=!0),(i=a.as(n,I.HostNetworkResponse))&&(s=i.data)){var u,c,d,h,p=a.opt(a.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.saveMgr}));return null!=(d=a.opt(R.Host.imageAnalysis,(function(e){return e.createTempMaskURL(s)})))&&(o&&a.opt(p,(function(e){return e.suspend()})),u=r.applyCutoutMaskToImage(e,d,"",null,t)),(o||null==u)&&(c=r.processNetworkResponseAndSaveImage(n,t).then((function(n){var o,i;return(o=a.as(n,I.HostComponentResponse))?(i=u)?r.updateTempCutoutMaskWithComponentizedMask(e,i,o).then((function(e){return a.opt(p,(function(e){return e.resume()})),e})).fail((function(e){return l.CoreAssert.fail("Failed to substitute temporary cutout mask with componentized mask",{error:a.toString(e)},"ImageFacade.processMask","ImageFacade.swift",1060)})):r.applyCutoutMaskToImage(e,o.url,o.type,o.id,t):f.CorePromise.reject("Invalid component response object")}))),(h=u)?h:c}return f.CorePromise.reject("Invalid network response")},retryNewMaskFromCC:function(e,t,n){var o,i;if((o=r.getImageFormaForForma(e))&&(i=R.Host.logging)){var s=i.getCurrentTime();return r.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_RETRY,"cc-storage",a.toInt(1e3*(i.getCurrentTime()-s))),N.ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig(t,N.MASK_ENDPOINT,I.HostNetworkRequestMethod.post,n).then((function(n){var l;return(l=a.as(n,I.HostNetworkRequest))?r.generateMaskFromCCStorageImage(o,l).then((function(n){return t.maskSize=N.CutoutMaskSize.ORIGINAL,r.logCutoutProgressToAnalytics(b.RemoteLoggingEvent.CUTOUT_RETRY_SUCCESS,"cc-storage",a.toInt(1e3*(i.getCurrentTime()-s))),r.processMask(e,t,n)})):f.CorePromise.reject("Invalid network request object")}))}return f.CorePromise.reject("Invalid image data or Host instance(s).")},updateTempCutoutMaskWithComponentizedMask:function(e,t,n){return t.then((function(t){var r,o,i,s,l;return(r=a.as(t,L.ImageForma))&&(o=r.contentNode)&&null!=(i=o.url)&&(s=e.page.document)&&(l=a.opt(s.controller,(function(e){return e.undoRedoMgr})))?new f.CorePromise((function(e,t){a.opt(R.Host.imageAnalysis,(function(e){return e.disposeTempMaskURL(i)})),s.maskSubstitutionController.substitute(i,n.id,n.url,n.type),l.invalidatePatches((function(){return e(r)}))})):f.CorePromise.reject("Invalid forma or content node or db.")}))},getNewMaskForImage:function(e,t,n,o){return void 0===o&&(o=!1),r.generateCutoutMaskForImage(e,t,n,o).then((function(n){var i=R.Host.platform.isWeb&&!o;return r.processMask(e,t,n,!i)}))},runDeepCutDirectly:function(e,t){void 0===t&&(t=N.ImageCutoutModelLibrary.DEFAULT_TIMEOUT);var n=new N.CutoutMaskMetadata(N.ImageCutoutModelLibrary.CURRENT_MODEL,N.ImageCutoutModelLibrary.DEFAULT_MASK_SIZE,null);return r.generateCutoutMaskForImage(e,n,t,!1).then((function(e){var t,o;return(t=a.as(e,I.HostNetworkResponse))&&(o=t.data)?(r.setModelVersionFromResponse(t,n),[o,n]):f.CorePromise.reject("Invalid image data for cutout mask")}))},hasRefinedCutout:function(e){var t,n;return!(!(t=r.getCutoutMaskFormaForForma(e))||!(n=t.contentNode))&&null==n.getTag(M.ImageContentNode.IMAGE_MASK_METADATA_TAG)},isRefineCutoutUnmaskedImageVisible:function(e){return a.opt(e,(function(e){return 1==e.page.refineCutoutController.isUnmaskedImageVisible()}))},getCutoutMaskMetadataForForma:function(e){var t,n,o;return(t=r.getCutoutMaskFormaForForma(e))&&(n=t.contentNode)&&null!=(o=n.getTag(M.ImageContentNode.IMAGE_MASK_METADATA_TAG))?N.CutoutMaskMetadata.decode(o):null},createCutoutMaskForImage:function(e,t,n,o,i){void 0===i&&(i=!1);var s=r.getCutoutMaskFormaForForma(e),l=new N.CutoutMaskMetadata(t,n,null);if(null==s)return r.getNewMaskForImage(e,l,o,i);var u=a.opt(a.opt(s,(function(e){return e.contentNode})),(function(e){return e.getTag(M.ImageContentNode.IMAGE_MASK_METADATA_TAG)})),c=N.CutoutMaskMetadata.decode(u),d=a.opt(c,(function(e){return e.maskSize==N.CutoutMaskSize.ORIGINAL}));return N.ImageCutoutModelLibrary.isMaskUptodateWithCurrentModel(c).then((function(t){var n;return null!=(n=a.as(t,"Bool"))&&n?d||r.disableCCStorageForDeepcut?s:r.retryNewMaskFromCC(e,l,o).fail((function(e){return s})):r.getNewMaskForImage(e,l,o)}))},createAndLoadCutoutMaskForImage:function(e,t,n,o,i,s){return void 0===t&&(t=N.ImageCutoutModelLibrary.CURRENT_MODEL),void 0===n&&(n=N.ImageCutoutModelLibrary.DEFAULT_MASK_SIZE),void 0===o&&(o=N.ImageCutoutModelLibrary.DEFAULT_TIMEOUT),void 0===s&&(s=!1),i==N.CutoutMode.Off?(l.CoreAssertDebugOnly.fail("Asked to create cutout mask with cutout mode OFF",void 0,"ImageFacade.createAndLoadCutoutMaskForImage","ImageFacade.swift",1298),f.CorePromise.resolve(null)):r.createCutoutMaskForImage(e,t,n,o,s).then((function(e){var t,n;return(t=a.as(e,L.ImageForma))&&(n=t.contentNode)?n.whenLoaded().thenReturn(e):e}))},createAndLoadCutoutMaskForReplacementImage:function(e,t){var n;return(n=a.as(e,T.FrameForma))?r.createAndLoadCutoutMaskForImage(n,void 0,void 0,void 0,t,!0).then((function(e){return e})).fail((function(e){return a.opt(R.Host.logging,(function(t){return t.logToNewRelic(b.RemoteLoggingEvent.CUTOUT_ERROR_AFTER_REPLACE,{error:a.toString(e)})})),null})):f.CorePromise.resolve(null)},finalizeCutoutAfterMaskLoad:function(e,t,n,o,i,l,u){void 0===o&&(o=null),void 0===i&&(i=null),void 0===l&&(l=!0),void 0===u&&(u=!0);var c,d,h=new C.FormaAnimationTransactionEvent(e);if(h.duration=0,e.beginUpdate(h),r.setCutoutModeForForma(e,n),(c=o)&&(d=c.frame))if(e.matchColors(c),r.setTightCropToCutoutMask(e,t)){var p=e.rotationInRadians();a.opt(e.controller,(function(e){return e.rotate(-p)})),a.opt(e.controller,(function(e){return e.fitInArea(d)})),a.opt(e.controller,(function(e){return e.rotate(p)})),D.GeometryFacade.fitInPage(e,i,void 0,void 0,void 0,1.25)}else e.isBackgroundImage()||r.matchTrimmedRegion(c,e);else if(l&&r.setTightCropToCutoutMask(e,t),u){var f=N.ImageCutoutLibrary.getCutoutModeString(n);a.opt(R.Host.logging,(function(e){return e.logToAnalytics(s.AnalyticsConstants.kAnalyticsDataEditImageRemoveBackgroundApplied,{contextualData1:"appliedCutout: "+f})}))}e.isBackgroundImage()&&a.opt(a.as(a.opt(e.parent,(function(e){return e.controller})),S.GroupController),(function(e){return e.updateGroup()})),e.endUpdate(h)},removeCutoutMaskFromImage:function(e){return r.setCutoutModeForForma(e,N.CutoutMode.Off),f.CorePromise.resolve(null)},formaHasMask:function(e){return null!=r.getMaskFormaForForma(e)},formaHasShapeMask:function(e){return r.getMaskFormaForForma(e)instanceof V.ShapeForma},setAuxiliaryForForma:function(e,t,n){var o;if(o=r.getFrameFormaForForma(e)){var i,a,s,l=new C.FormaContentChangedEvent(o);if(o.beginUpdate(l),(i=r.getMaskFormaForFormaByIntent(o,n))&&o.removeAuxiliary(i),(a=t)&&(a.intent=n,o.appendAuxiliary(a)),e.endUpdate(l),s=r.getImageFormaForForma(e)){var u=new C.FormaContentChangedEvent(s);s.beginUpdate(u),s.endUpdate(u)}}},setMaskForForma:function(e,t){r.setAuxiliaryForForma(e,t,y.Forma.INTENT_IMAGE_MASK)},removeMaskForForma:function(e){r.setMaskForForma(e,null)},setCutoutForForma:function(e,t){var n;r.setAuxiliaryForForma(e,t,y.Forma.INTENT_CUTOUT_MASK),(n=t)&&r.updateCutoutMaskPlacement(e,n)},removeCutoutForForma:function(e){r.setCutoutForForma(e,null),r.setCutoutModeForForma(e,N.CutoutMode.Off)},getMaskForForma:function(e){var t,n,o,i,s=r.getMaskFormaForForma(e);return(t=a.as(s,V.ShapeForma))&&null!=(n=t.shapeLibraryID)?u.CropAssetLibrary.getCropShapeFromID(n):(o=a.as(s,L.ImageForma))&&null!=(i=o.contentNode.getTag(M.ImageContentNode.ASSET_ID_TAG))?u.CropAssetLibrary.getRasterMaskFromID(i):null},applyMaskToForma:function(e,t,n,o){var i;if(void 0===n&&(n=null),void 0===o&&(o=!1),i=a.as(e,T.FrameForma)){var s,l,c,d=null,h=new C.FormaApplyMaskEvent(i);return i.beginUpdate(h),(s=a.as(t,u.CropShape))?d=r.applyShapeMaskToImage(e,s.id,n,o):(l=a.as(t,u.RasterMask))&&(d=r.applyRasterMaskToImage(e,l,n,o)),(c=d)?c.then((function(e){var t;if(t=a.as(i.controller,_.FrameController)){if(r.formaHasMask(i)){var n=new C.FormaGeometryChangedEvent(i);i.beginUpdate(n),t.fitChildrenToFrame(),i.endUpdate(n)}t.fitting=_.FitType.None,t.updateCropModeImage()}return i.cropRatioId=m.CropRatioPresetLibrary.NONE_ID,i.endUpdate(h),e})):f.CorePromise.reject("Invalid CropAsset type.")}return f.CorePromise.reject("Invalid frame.")},applyShapeMaskToImage:function(e,t,n,o){var i;if(void 0===n&&(n=null),void 0===o&&(o=!1),i=a.as(e,T.FrameForma)){var s,l,u,c,d,h=r.formaHasMask(i),p=a.opt(a.opt(r.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin}));if((s=n)&&a.opt(a.as(i.controller,_.FrameController),(function(e){return e.setBoundsWithCropType(s,_.CropType.PreserveFocusAndScale)})),r.removeMaskForForma(i),null!=t&&(l=a.as(i.page.createFormaWithController(V.ShapeForma.KIND,j.ShapeController.KIND),V.ShapeForma))){H.ShapeLibrary.applyToShapeForma(l,t);var m,g,v=l.canonicalArtwork;if(!o&&(m=v.bounds)&&(g=i.bounds)){var C=g.fitAspectRatioWithin(m.aspectRatio);i.bounds=z.TheoRect.fromXYWH(g.minX,g.minY,C.width,C.height)}l.preScale=null,l.allowUserMove=!1,l.intent=y.Forma.INTENT_IMAGE_MASK,r.setMaskForForma(i,l)}return(g=i.bounds)&&(u=a.opt(r.getImageFormaForForma(i),(function(e){return e.bounds})))&&!r.formaHasMask(i)&&h&&null==n&&(C=g.fitAspectRatioWithin(u.aspectRatio),i.bounds=z.TheoRect.fromXYWH(g.minX,g.minY,C.width,C.height)),(c=p)&&(d=a.opt(a.opt(r.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin})))&&i.move(w.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(c,d))),f.CorePromise.resolve(r.getMaskFormaForForma(e))}return f.CorePromise.reject("frame is nil")},applyRasterMaskToImage:function(e,t,n,o){var i,s,l;if(void 0===n&&(n=null),void 0===o&&(o=!1),(i=r.getFrameFormaForForma(e))&&(s=t)&&null!=(l=R.Host.resourceUtils.urlForResource(O.CATEGORY_ID_RASTER_MASK,s.id))){var u=new h.AddFormaParams(void 0,void 0,void 0,void 0,h.AddFormaParentingHint.doNotAddFormaForContentToTree),c={"image-role":M.ImageContentNode.ROLE_MASK,"asset-id":s.id};return h.CreationFacade.addImage(e.page,l,s.mimeType,s.width,s.height,!1,void 0,u,c).then((function(e){var t;return(t=a.as(e,L.ImageForma))?(r.setMaskForForma(i,t),t):f.CorePromise.reject("imageCN is nil")}))}return f.CorePromise.reject("frame is invalid")},getBoundingBoxAndMask:function(e,t){var n;void 0===t&&(t=5);var r,o,i,s,l,u,d={source:{bytes:e},saliency:{boundingBoxRectangles:!0,mask:!0}},h=new c.CoreContentJSON(a.as(d,["Dictionary","String","Any"]),"application/json;charset=UTF-8");if((r=R.Host.network)&&(o=R.Host.imageAnalysis)&&(i=R.Host.dataFactory)&&(s=R.Host.resourceUtils)&&(l=R.Host.logging)&&(u=i.createFromCoreContent(h))){var p=l.newLog("host");return f.CorePromise.all([r.getAuthToken(),o.getSaliencyAPIEndpoint(),o.getSaliencyAPIKey()]).then((function(e){var o,i,c,d,h=a.clone(a.as(e,["Array","Any"]));if(B.LegacyCoreAssert.isTrue(a.opt(h,(function(e){return 3==e.length})),"Expected three CorePromise results.",void 0,"ImageFacade.getBoundingBoxAndMask","ImageFacade.swift",1662),(o=h)&&null!=(i=a.as(o[0],"String"))&&null!=(c=a.as(o[1],"String"))&&null!=(d=a.as(o[2],"String"))){var m=s.makeGUID(),g=new I.HostNetworkRequest(c+"/imageAnalysis");g.timeout=t,g.method=I.HostNetworkRequestMethod.post,g.headers.Authorization="Bearer "+i,g.headers["X-API-Key"]=d,g.headers["X-Request-Id"]=m,g.data=u;var y=l.getCurrentTime(),_={saliency:{boundingBoxRectangles:[]}};return r.request(g).then((function(e){var t,n;if((t=a.as(e,I.HostNetworkResponse))&&(n=t.data)){var r=1e3*(l.getCurrentTime()-y);return p.info("Successfully got Saliency BoundingBoxAndMask in "+r+"ms."),n.asJSON()}return p.warning("Invalid Saliency BoundingBoxAndMask API response type."),_})).fail((function(e){var r;return(r=a.as(e,I.HostNetworkError))?r.type==I.HostNetworkErrorType.Timeout?p.warning("Saliency BoundingBoxAndMask timed-out after "+1e3*t+"ms. request-id: "+m):p.warning("Error getting Saliency BoundingBoxAndMask: ["+((n=r.status)||null!=n?n:-1)+"] "+r.description+". request-id: "+m):p.warning("Error getting Saliency BoundingBoxAndMask. request-id: "+m),_}))}return f.CorePromise.reject("Invalid auth data")}))}return f.CorePromise.reject("Invalid Host instances")},updateCutoutMaskPlacement:function(e,t){var n,o,i;if((n=r.getImageFormaForForma(e))&&(o=n.bounds)&&(i=t.bounds)){B.LegacyCoreAssert.isTrue(i.width>0&&i.height>0,"Invalid mask bounds.",void 0,"ImageFacade.updateCutoutMaskPlacement","ImageFacade.swift",1726);var a=o.width/i.width,s=o.height/i.height;t.placement=w.Matrix2D.scalingXY(a,s).concat(n.placement)}else B.LegacyCoreAssert.fail("Failed to update cutout mask bounds - invalid image or mask bounds.",void 0,"ImageFacade.updateCutoutMaskPlacement","ImageFacade.swift",1732)},applyCutoutMaskToImage:function(e,t,n,o,i){var s,l;if(void 0===o&&(o=null),void 0===i&&(i=null),l=a.as(e,T.FrameForma)){var u=new h.AddFormaParams(void 0,void 0,void 0,void 0,h.AddFormaParentingHint.doNotAddFormaForContentToTree),c={"image-role":M.ImageContentNode.ROLE_MASK,"image-mask-metadata":(s=a.opt(i,(function(e){return e.encode()})))||null!=s?s:""};return h.CreationFacade.addImage(e.page,t,n,void 0,void 0,void 0,void 0,u,c,o).then((function(e){var t;return(t=a.as(e,L.ImageForma))?a.opt(t.contentNode,(function(e){return null==e.trimmedBounds}))?(t.removeFromParent(),f.CorePromise.reject(new I.HostCutoutMaskError(I.HostCutoutMaskErrorType.NoForegroundObjectImage))):(d.ColorFacade.applyNoneColorToFormae([l]),r.setCutoutForForma(l,t),r.setCutoutModeForForma(l,N.CutoutMode.Off),t):f.CorePromise.reject("mask is not an ImageForma.")}))}return f.CorePromise.reject("frame is nil")},canSetTightCropToCutoutMask:function(e,t){var n,o;return void 0===t&&(t=!0),!(!(n=e)||!(o=n.controller)||r.formaHasShapeMask(n)||n.isBackgroundImage()||o.userGroupChild||t&&null!=n.style.colors.fieldPrimary)},setTightCropToCutoutMask:function(e,t,n){if(void 0===n&&(n=!0),!r.canSetTightCropToCutoutMask(e,n))return!1;var o,i,s,l,u;if((o=r.getImageFormaForForma(e))&&(i=a.as(e.controller,_.FrameController))&&(s=o.bounds)&&(l=t.bounds)&&(u=a.opt(t.contentNode,(function(e){return e.trimmedBounds})))){var c,d,h=u.multiplyXY(s.width/l.width,s.height/l.height);if((c=a.opt(o.placement.inverse,(function(t){return t.transformRect(e.bounds)})))&&(d=h.intersectionWith(c))){var p=new C.FormaGeometryChangedEvent(e);e.beginUpdate(p);var f=o.placement.transformRect(d),m=o.totalPlacement.transformPoint(d.center);e.bounds=z.TheoRect.fromSize(f.size);var g=w.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(e.bounds.center,o.placement.transformPoint(d.center)));o.move(g),i.fitChildrenToFrame(),e.move(w.Matrix2D.translation(X._minus_TheoPoint_TheoPoint(m,e.finalFrame.center))),e.endUpdate(p)}}return!0},getTrimmedRegionForMatching:function(e,t){var n,o,i,s;return(n=t.bounds)&&(o=r.getCutoutMaskFormaForForma(e))&&(i=o.bounds)&&(s=a.opt(o.contentNode,(function(e){return e.trimmedBounds})))?s.multiplyXY(n.width/i.width,n.height/i.height):null},getTrimmedRegionCropBoundsAndArea:function(e,t,n){var r=a.clone(D.GeometryFacade.getIntersectionPolygon(e,t,w.Matrix2D.Identity,n)),o=z.TheoRect.boundsOfPoints(r)||z.TheoRect.Zero,i=D.GeometryFacade.areaOfConvexPolygon(r),s=n.transformRect(t).intersectionWith(e)||z.TheoRect.Zero,l=s.area;return(i<.05*l||i>l)&&(o=s,i=l),{croppedBounds:o,croppedArea:i}},matchTrimmedRegion:function(e,t){var n,o,i,a,s,u;if((n=e.frame)&&(o=t.frame)&&(i=e.bounds)&&(a=t.bounds)&&(s=r.getImageFormaForForma(e))&&(u=r.getImageFormaForForma(t))){l.CoreAssertDebugOnly.isTrue(n.equalWithAccuracy(o,.01),"matchTrimmedRegion expects congruent frames",void 0,"ImageFacade.matchTrimmedRegion","ImageFacade.swift",1901);var c,d,h=u.rotationInRadians();if(l.CoreAssertDebugOnly.isTrue(Math.abs(h)<.01,"matchTrimmedRegion expects the destination image to be unrotated",void 0,"ImageFacade.matchTrimmedRegion","ImageFacade.swift",1903),(c=r.getTrimmedRegionForMatching(e,s))&&(d=r.getTrimmedRegionForMatching(t,u))){var p=r.getTrimmedRegionCropBoundsAndArea(i,c,s.placement);c=p.croppedBounds;var f=e.placement.transformValues,m=p.croppedArea*f.xscale*f.yscale;if(m>0){d=u.placement.transformRect(d);var g=t.placement.transformValues,y=d.area*g.xscale*g.yscale,_=D.GeometryFacade.getClosestPin(i,c),T=w._asterisk_TheoPoint_Matrix2D(c.evalXY(_.x,_.y),e.placement),v=w._asterisk_TheoPoint_Matrix2D(T,t.placement.inverse),C=d.evalXY(_.x,_.y),P=X._minus_TheoPoint_TheoPoint(v,C);K.TransformFacade.translateForma(u,P),d=d.offset(P);var S,A=Math.sqrt(m/y);null!=(S=D.GeometryFacade.getScaleToFit(d,a,v))&&(A=Math.min(A,S)),K.TransformFacade.transformFormaeInPageSpaceAboutPoint([u],w.Matrix2D.scalingXY(A,A),w._asterisk_TheoPoint_Matrix2D(v,t.totalPlacement))}}}},canAddImages:function(e,t){return t+e.filterByControllerKind(_.FrameController.KIND).length<=P.GridController.MAX_IMAGE_COUNT},addPlaceholderImage:function(e){var t,n;return null!=(t=R.Host.resourceUtils.urlForResource(O.CATEGORY_ID_IMAGE,"placeholder"))&&(n=a.opt(R.Host.imageAnalysis,(function(e){return e.createHostImage(t,!1,null)})))?n.getImageRepresentationData("image/png",Math.max(n.getHeight(),n.getWidth())).then((function(t){var r;return(r=a.as(t,F.HostDataProtocol))?R.Host.network.saveImageComponent(r,"image/png").then((function(t){var r,o;return(r=a.as(t,I.HostComponentResponse))?(o=a.as(e.content.createNode(M.ImageContentNode.KIND,E.GUIDUtils.makeGUID()),M.ImageContentNode))?(o.url=r.url,o.mimeType="image/png",o.pixelWidth=n.getWidth(),o.pixelHeight=n.getHeight(),o.mediaMetadata=G.MediaMetadata.init_4d41(),o.componentID=r.id,h.CreationFacade.addContent(e.firstPage,o,null,!1,new h.AddFormaParams(void 0,void 0,void 0,h.FloatingImageStrategy.Always)).then((function(e){var t=a.as(e,y.Forma);return null!=t?f.CorePromise.resolve(t):(B.LegacyCoreAssert.fail("expected a forma result from CreationFacade.addContent",void 0,"ImageFacade.addPlaceholderImage","ImageFacade.swift",2007),f.CorePromise.resolve(null))}))):f.CorePromise.resolve(null):f.CorePromise.reject(t)})):f.CorePromise.resolve(null)})):f.CorePromise.resolve(null)}}}),r)},mGL3:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("QgZx"),l=n("ZhwN"),u=n("iCxV"),c=n("fNpk");o.OrderedFontSet=(r=function(){this.descriptors_=[],this.familyKeys_=[],this.familyFaces_=[],this.clock_=0,this.fontSetID=l.GUIDUtils.makeGUID(),a.CoreObject.call(this)},i.defineClass({name:"OrderedFontSet",ctor:r,superName:"CoreObject",statics:{fromList:function(e){for(var t=new r,n=i.iter(e);!n.done;n.next()){var o=n.value;t.append(o)}return t}},props:{descriptors:{get:function(){return this.descriptors_.concat()}},count:{get:function(){return this.descriptors_.length}},familyCount:{get:function(){return this.familyKeys_.length}},familyAt:function(e){return i.as(this.familyKeys_[e],"String")},facesInFamily:function(e){var t=i.indexOf(this.familyKeys_,e);return null==t?(i.opt(u.Host.logging,(function(t){return t.warning("Invalid family ("+e+") in facesInFamily()")})),null):i.sort(this.familyFaces_[t],(function(e,t){var n=e.source==s.FontSource.TYPEKIT_PREMIUM||e.source==s.FontSource.TYPEKIT_FREE,r=t.source==s.FontSource.TYPEKIT_PREMIUM||t.source==s.FontSource.TYPEKIT_FREE;return!(!n||r)||!(!n&&r)&&(0==e.usWeightClass||0==t.usWeightClass?e.weight==t.weight?(e.italic||0!=e.italicAngle)==(t.italic||0!=t.italicAngle)?e.label.length<t.label.length:!e.italic&&0==e.italicAngle:e.weight<t.weight:e.usWeightClass==t.usWeightClass?e.usWidthClass==t.usWidthClass?e.weight==t.weight?(e.italic||0!=e.italicAngle)==(t.italic||0!=t.italicAngle)?e.label.length<t.label.length:!e.italic&&0==e.italicAngle:e.weight<t.weight:e.usWidthClass<t.usWidthClass:e.usWeightClass<t.usWeightClass)}))},defaultFaceInFamily:function(e){var t=i.clone(this.facesInFamily(e)||[]);function n(e){for(var n=i.iter(t);!n.done;n.next()){var r=n.value;if(r.displayFaceName.includes(e))return r}return null}c.LegacyCoreAssert.isTrue(0==!t.length,"facesInFamily is empty",{family:e},"OrderedFontSet.defaultFaceInFamily","OrderedFontSet.swift",111);for(var r=i.iter(["Regular","Normal","Plain","Book","Display"]);!r.done;r.next())if(o=n(r.value))return o;for(var o,a,s=1e5,l=1e5,u=i.iter(t);!u.done;u.next()){var d=u.value,h=d.usWeightClass;h=0==h?d.weight:h,!d.italic&&Math.abs(h-400)<s?(s=Math.abs(h-400),o=d):d.italic&&Math.abs(h-400)<l&&(l=Math.abs(h-400),a=d)}return null!=o?o:null!=a?a:i.first(t)},fontAt:function(e){return e<0||e>=this.descriptors_.length?(c.LegacyCoreAssert.fail("Invalid index in fontAt()",{index:e},"OrderedFontSet.fontAt","OrderedFontSet.swift",165),null):this.descriptors_[e]},forEach:function(e){this.descriptors_.forEach(e)},indexOf:function(e){return i.indexOfEq(this.descriptors_,e,s._equality_FontDescriptor_FontDescriptor)},getIndexOfPostScriptName:function(e){for(var t=0,n=i.iter(this.descriptors_);!n.done;n.next()){if(n.value.postScriptName==e)return t;t+=1}return null},filter:function(e){return this.descriptors_.filter(e,this)},find:function(e){return this.descriptors_.find(e,this)},append:function(e){if(!this.contains(e)){this.clock_+=1,this.descriptors_.push(e);var t=e.displayFamilyName,n=i.indexOf(this.familyKeys_,t);null==n&&(this.familyKeys_.push(t),this.familyFaces_.push([])),n=i.indexOf(this.familyKeys_,t),this.familyFaces_[n].push(e)}},contains:function(e){return i.containsEq(this.descriptors_,e,s._equality_FontDescriptor_FontDescriptor)},remove:function(e){this.clock_+=1,i.remove(this.descriptors_,e);var t=e.displayFamilyName,n=i.indexOf(this.familyKeys_,t);if(null!=n){var r=this.familyFaces_[n];i.remove(r,e),0==r.length&&(i.remove(this.familyKeys_,t),this.familyFaces_.splice(n,1))}},clone:function(){var e=new r;return this.descriptors_.forEach((function(t){return e.append(t)})),e},sort:function(){var e=i.sort(this.descriptors_,(function(e,t){return e.postScriptName>t.postScriptName}));this.descriptors_=[];for(var t=i.iter(e);!t.done;t.next()){var n=t.value;this.descriptors_.push(n)}},revisionNumber:{get:function(){return this.clock_}}}}),r)},muPB:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("ytEx"),l=n("iCxV"),u=n("C4JV"),c=n("Puiz"),d=n("9YN4");i.JSONDocumentDecoder=(r=function(e){var t,n,r,o={};(t=e.getComponentWithAbsolutePath(u.JSON_CONTENT_PATH_DCX2D))&&null!=(n=e.getPathForComponent(t))?null!=(r=a.opt(l.Host.persistUtils,(function(e){return e.readJsonContentFromFile(n)})))&&(o=r):a.opt(l.Host.logging,(function(e){return e.warning("Could not find dom component!")})),c.JSONNodeDecoder.call(this,e,o)},o={},a.defineClass({name:"JSONDocumentDecoder",ctor:r,superName:"JSONNodeDecoder",statics:{getRequiredSynchronousComponents:function(e){return[u.JSON_CONTENT_PATH_DCX2D]},localizedDefaultName:{get:function(){return void 0===o.localizedDefaultName&&(o.localizedDefaultName=a.opt(l.Host.locale,(function(e){return e.getLocalizedDefaultDocumentName()}))),o.localizedDefaultName}},_implements:function(e){return"IImportDataObject"==e}},props:{isDefaultName:function(e){return null==e||e==d.TheoDocument.DEFAULT_NAME||e==r.localizedDefaultName||""==e},getPropertyOnNode:function(e){if(e==s.PROPERTY_KEY_ID)return a.as(this.branch_.getValue(s.PROPERTY_KEY_ID),"AnyObject");if(e==s.PROPERTY_KEY_NAME){var t=r.localizedDefaultName,n=a.as(this.branch_.getValue(e),"String"),o=a.as(c.JSONNodeDecoder.prototype.getPropertyOnNode.call(this,e),"String");return this.isDefaultName(n)&&!this.isDefaultName(o)?t=o:this.isDefaultName(o)&&!this.isDefaultName(n)||null!=n?t=n:null!=o&&(t=o),a.as(t,"AnyObject")}var i=c.JSONNodeDecoder.prototype.getPropertyOnNode.call(this,e);return null==i&&(i=a.as(this.branch_.getValue(e),"AnyObject")),i}}}),r)},mxdD:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("FNB+"),l=n("cmoc"),u=n("RkYL"),c=n("sW6f"),d=n("zjod"),h=n("QTen");o.VideoFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"VideoFacade",ctor:r,superName:"CoreObject",statics:{getVideoFormaForForma:function(e){var t;return(t=i.as(e,l.FrameForma))&&t.childCount>0?i.as(t.childAt(0),d.VideoForma):i.as(e,d.VideoForma)},getTrueVideoFormaForForma:function(e){var t;return(t=r.getVideoFormaForForma(e))&&!t.isSticker()?t:null},setTransientTimeForVideoForma:function(e,t,n,o){var i,a;(i=r.getVideoStyleForForma(e))&&(a=r.getVideoContentForForma(e))&&(i.setTransientTime(t,n),a.setTransientOffset(o))},resetTransientTimeForVideoForma:function(e){var t,n;(t=r.getVideoStyleForForma(e))&&(n=r.getVideoContentForForma(e))&&(t.resetTransientTime(),n.resetTransientOffset())},changeVideoVolume:function(e,t){for(var n=i.iter(e);!n.done;n.next()){var o,a=n.value;(o=r.getVideoStyleForForma(a))&&(o.volumeLevel=t)}},getVideosOnPage:function(e,t){return void 0===t&&(t=!0),e.root.filterWithCallback((function(e){return e instanceof d.VideoForma&&(t||!e.isSticker())}))},getVideoCountOnPage:function(e,t){void 0===t&&(t=!0);for(var n=0,r=i.iter(e.root.visitAsArray(s.FormaTraversal.PreOrder));!r.done;r.next()){var o=r.value;o instanceof d.VideoForma&&(t||!o.isSticker())&&(n+=1)}return n},getStickerCountOnPage:function(e){for(var t=0,n=i.iter(e.root.visitAsArray(s.FormaTraversal.PreOrder));!n.done;n.next()){var r=n.value;r instanceof d.VideoForma&&r.isSticker()&&(t+=1)}return t},videoContentIsLivePhoto:function(e){var t;return null!=(t=i.opt(e,(function(e){return e.getTag(c.VideoContentNode.LIVE_PHOTO_TAG)})))&&"true"==t},formaIsLivePhoto:function(e){var t;return!!(t=r.getVideoContentForForma(e))&&r.videoContentIsLivePhoto(t)},formaIsGIFVideo:function(e){var t;return!!(t=r.getVideoContentForForma(e))&&t.isGIF},getVideoContentForForma:function(e){var t;return(t=r.getVideoFormaForForma(e))?t.videoContentNode:null},getVideoStyleForForma:function(e){var t;return(t=r.getVideoFormaForForma(e))?i.as(t.style,h.VideoStyle):null},getStartTimeForVideoForma:function(e,t){void 0===t&&(t=!1);var n,o,i,a=u.TheoTime.Zero;return(n=r.getVideoStyleForForma(e))&&(a=n.startTime),t&&(o=r.getVideoContentForForma(e))&&(i=o.offsetInOriginal)&&(a=a.add(i)),a},getDurationInSecondsForVideo:function(e){return r.getDurationForVideo(e).seconds},getVideoTimeForVideoWithTimeInTotalLoop:function(e,t){var n=r.getDurationInSecondsForVideo(e),o=t.seconds%n;return u.TheoTime.fromSeconds(o,t.timescale)},getDurationForVideo:function(e){var t,n,r=u.TheoTime.Zero;if(t=e.videoContentNode)if(n=i.as(e.style,h.VideoStyle))r=n.duration;else{var o=i.clone(t.times);o.length>0&&(r=o[o.length-1])}return r},addVideoContent:function(e,t,n,r,o,a,s,l,u,d,h,p){var f,m,g;return(f=i.as(i.opt(e,(function(e){return e.createNode(c.VideoContentNode.KIND,null)})),c.VideoContentNode))?(f.url=t,f.mimeType=n,f.width=r,f.height=o,f.duration=a,f.mediaMetadata=u,f.localIdentifier=d,f.setTimes(h),p&&f.setTag(c.VideoContentNode.LIVE_PHOTO_TAG,"true"),(m=s)&&(f.offsetInOriginal=m),(g=l)&&(f.originalDuration=g),f):null}}}),r)},nPwb:function(e,t,n){var r,o=t,i=n("oAGj");o.PGMFacade=(r=function(){},i.defineClass({name:"PGMFacade",ctor:r}),r)},"nQ+V":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("95jH");o.MotionEntryStacked=(r=function(){this.srcId="MotionSourceStacked",this.logic=new a.MotionLogicStacked,this.args={lineDur:.3,endPadDur:1}},i.defineClass({name:"MotionEntryStacked",ctor:r,statics:{_implements:function(e){return"MotionEntry"==e}}}),r)},nUE5:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("iCxV"),s=n("wL85"),l=n("qTtJ"),u=n("f9IM");o.MotionSource=(r=function(){},i.defineClass({name:"MotionSource",ctor:r,statics:{getSourceAnimation:function(e,t){return"MotionSourceStacked"==e?u.MotionSourceStacked.getSrcKeyframes(t):"MotionSrcFadeIn"==e?l.MotionSrcFadeIn.getSrcKeyframes(t):"MotionSrcDropIn"==e?s.MotionSrcDropIn.getSrcKeyframes(t):(""!=e&&i.opt(a.Host.logging,(function(t){return t.warning("Unknown source animation: "+e)})),[])}}}),r)},oTAR:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("CWW7"),s=n("gXiO"),l=n("yGNn"),u=n("ascj"),c=n("FNB+"),d=n("ZK0l"),h=n("iCxV"),p=n("/BuD"),f=n("fNpk"),m=n("tGKA"),g=n("VkKB"),y=n("3DEm"),_=n("JO5d"),T=n("djAF"),v=n("B8ge"),C=n("byfQ"),P=n("hgLm"),S=n("oKlP"),D=n("sIWg"),A=n("1NAc"),E=n("LGJg");o.SVGParserUtils=(r=function(){s.CoreObject.call(this)},i.defineClass({name:"SVGParserUtils",ctor:r,superName:"CoreObject",statics:{k_two_pi:6.283185307179586,k_pi:3.141592653589793,kNumericRegEX:"[+-]?(([0-9]*\\.[0-9]+)|([0-9]+\\.?))([eE][+-]?[0-9]+)?",theoArtworkFromSVGData:function(e,t){if(null!=e){var n=r.parseSVGToPathData(e);return r.theoArtworkFromSVGPathData(n,t)}return null},theoArtworkFromSVGPathData:function(e,t){var n,r=C.TheoArtworkShape.init_d1d0(null,e.paths,u.ColorRole.FieldPrimary,u.ColorRole.FieldPrimary),o=r.bounds;if(e.viewBox.contains(o)||0==o.area)if(t){var i=.05*y.MathUtils.maxDouble(o.width,o.height);o.width<i&&(o=D.TheoRect.fromXYWH(o.minX-i/2+o.width/2,o.minY,i,o.height)),o.height<i&&(o=D.TheoRect.fromXYWH(o.minX,o.minY-i/2+o.height/2,o.width,i)),n=r.cloneWithBounds(o)}else n=r.cloneWithBounds(e.viewBox);else{var a;if(t){var s=e.viewBox.intersectionWith(o);a=new P.TheoRectanglePath(s)}else a=new P.TheoRectanglePath(e.viewBox);n=new C.TheoArtworkClipGroup(null,[r],a)}var l=e.sliceBox.width*e.sliceBox.height>0?e.sliceBox:null,c=e.contentBox.width*e.contentBox.height>0?e.contentBox:null;return new p.ArtworkInfo(n,l,c)},createShapeFromSVGURL:function(e,t,n){var o;return(o=h.Host.pathUtils.artworkFromURL(t,!0))?r.createShapeFromTheoArtwork(e,t,o,n):(f.LegacyCoreAssert.fail("artworkFromURL failed",void 0,"SVGParserUtils.createShapeFromSVGURL","SVGParserUtils.swift",107),null)},createShapeFromTheoArtwork:function(e,t,n,r){var o=e.content.createNode(E.VectorContentNode.KIND,null);o.url=t,o.mimeType="image/svg+xml",o.mediaMetadata=g.MediaMetadata.init_a9d7(r,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,g.MediaMetadata.DESIGNINTENT_ICON);var a=n.artwork.bounds;null==a&&(a=n.contentRegion),null==a&&(i.info("failed to get size of the SVG. Making one up"),a=new D.TheoRect(0,0,50,50)),f.LegacyCoreAssert.isTrue(null!=a,"How do we not have an artSize?",void 0,"SVGParserUtils.createShapeFromTheoArtwork","SVGParserUtils.swift",145),o.size=a.size,e.content.root.appendChild(o);var s=e.firstPage.createFormaWithController(T.ShapeForma.KIND,_.ShapeController.KIND);return s.contentNode=o,s.canonicalArtwork=n.artwork,s.sliceBox=n.sliceBox,s.contentRegion=n.contentRegion,s.size=o.size,s.intent=c.Forma.INTENT_ICON,s},addShapeFromTheoArtwork:function(e,t,n,o,i){return r.addShapeToDocument(e,r.createShapeFromTheoArtwork(e,n,o,i),t,null)},addShapeFromSVGURL:function(e,t,n,o){var i;return(i=r.createShapeFromSVGURL(e,n,o))?r.addShapeToDocument(e,i,t):l.CorePromise.reject("unable to create artwork info")},addShapeToDocument:function(e,t,n,r){var o;void 0===r&&(r=null);var s,u,c=l.CorePromise.resolve(null);return(s=n)&&(u=i.as(i.opt(s.parent,(function(e){return e.controller})),d.GroupController))?(u.replaceChildWithForma(s,t,!0),i.opt(i.opt(t.controller,(function(e){return e.owner})),(function(e){return e.selection.deselectForma(s,!1)})),t.style.kind==s.style.kind&&t.style.match(s.style)):c=a.CreationFacade.addForma(e.firstPage,t,new a.AddFormaParams(void 0,void 0,n,void 0,void 0,r)).then((function(e){return t.controller.shuffleColorAssignment(),null})),c.then((function(e){var n,r;return(n=i.as(t.contentNode,E.VectorContentNode))?((r=t.canonicalArtwork.bounds)?n.size=r.size:(f.LegacyCoreAssert.isTrue(!1,"How do we not have canonical artwork bounds?",{url:(o=i.opt(n.mediaMetadata,(function(e){return e.sourceURL})))||null!=o?o:"unknown"},"SVGParserUtils.addShapeToDocument","SVGParserUtils.swift",273),n.size=new A.TheoSize(100,100)),l.CorePromise.resolve(t)):l.CorePromise.reject("expected the icon shape to have a vector content node backing it.")}))},parseSVGToPathData:function(e){var t=new v.SVGParser;return h.Host.pathUtils.parseSVGXMLData(e,t),t.createTheoPathFromParsedDom()},parseSVGTransform:function(e){var t=m.Matrix2D.Identity;if(null!=e)for(var n=i.clone(h.Host.pathUtils.matchesForRegexInString("(matrix|translate|scale|rotate|skewX|skewY)\\s*\\([^)]+\\)",e)),o=i.iter(n);!o.done;o.next()){var a=o.value,s=i.clone(h.Host.pathUtils.matchesForRegexInString("(matrix|translate|scale|rotate|skewX|skewY)",a));f.LegacyCoreAssert.isTrue(1==s.length,"unexpected number of transform type matches in one transform string",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",310);var l=s[0],u=i.clone(h.Host.pathUtils.matchesForRegexInString("\\(([^)]+)\\)",a));f.LegacyCoreAssert.isTrue(1==u.length,"unexpected number of transform args matches in one transform string",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",314);for(var c=u[0],d=[],p=i.clone(h.Host.pathUtils.matchesForRegexInString("[-+]?[0-9]*\\.?[0-9]+([eE][-+]?[0-9]+)?",c)),g=i.iter(p);!g.done;g.next()){var y=g.value;d.push(h.Host.pathUtils.parseStringToDouble(y))}var _=m.Matrix2D.Identity;switch(l){case"matrix":f.LegacyCoreAssert.isTrue(6==d.length,"unexpected # of arguments for matrix",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",328),_=new m.Matrix2D(d[0],d[1],d[2],d[3],d[4],d[5]);break;case"translate":f.LegacyCoreAssert.isTrue(1==d.length||2==d.length,"unexpected # of arguments for translate",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",333),_=m.Matrix2D.translationXY(d[0],d.length>1?d[1]:0);break;case"scale":f.LegacyCoreAssert.isTrue(1==d.length||2==d.length,"unexpected # of arguments for scale",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",338),_=m.Matrix2D.scalingXY(d[0],d.length>1?d[1]:d[0]);break;case"rotate":f.LegacyCoreAssert.isTrue(1==d.length||3==d.length,"unexpected # of arguments for rotate",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",343);var T=d[0]*r.k_pi/180;1==d.length?_=m.Matrix2D.rotation(Math.cos(T),Math.sin(T)):3==d.length&&(_=(_=(_=m.Matrix2D.translationXY(d[1],d[2])).precat(m.Matrix2D.rotation(Math.cos(T),Math.sin(T)))).precat(m.Matrix2D.translationXY(-d[1],-d[2])));break;case"skewX":f.LegacyCoreAssert.isTrue(1==d.length,"unexpected # of arguments for skewX",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",355),_=new m.Matrix2D(1,0,Math.tan(d[0]*r.k_pi/180),1,0,0);break;case"skewY":f.LegacyCoreAssert.isTrue(1==d.length,"unexpected # of arguments for skewY",void 0,"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",360),_=new m.Matrix2D(1,Math.tan(d[0]*r.k_pi/180),0,1,0,0);break;default:f.LegacyCoreAssert.fail("unknown SVG transform type",{type:l},"SVGParserUtils.parseSVGTransform","SVGParserUtils.swift",365)}t=t.precat(_)}return t},parseSVGBox:function(e){if(null==e)return D.TheoRect.Zero;for(var t=[],n=i.clone(h.Host.pathUtils.matchesForRegexInString(r.kNumericRegEX,e)),o=i.iter(n);!o.done;o.next()){var a=o.value;a.length>0&&t.length<4&&t.push(h.Host.pathUtils.parseStringToDouble(a))}return 4==t.length?D.TheoRect.fromXYWH(t[0],t[1],t[2],t[3]):D.TheoRect.Zero},svgArcToPath:function(e,t,n,o,a,s,l,u){var c=m._asterisk_Matrix2D_Matrix2D(m.Matrix2D.rotation(Math.cos(-o),Math.sin(-o)),m.Matrix2D.scalingXY(1/t,1/n)),d=c.transformPoint(e),h=c.transformPoint(l),p=y.MathUtils.CircleCircleIntersection(d,1,h,1),g=a==s?p.rightCenter:p.leftCenter;if(g.isValidPoint)c=m._asterisk_Matrix2D_Matrix2D(c,m.Matrix2D.translation(S._negate_TheoPoint(g)));else{g=S._plus_TheoPoint_TheoPoint(d,h).divide(2),c=m._asterisk_Matrix2D_Matrix2D(c,m.Matrix2D.translation(S._negate_TheoPoint(g)));var _=y.MathUtils.VectorNorm(S._minus_TheoPoint_TheoPoint(d,g));f.LegacyCoreAssert.isTrue(_>=1,"unexpected value for upscale",void 0,"SVGParserUtils.svgArcToPath","SVGParserUtils.swift",418),c=m._asterisk_Matrix2D_Matrix2D(c,m.Matrix2D.scalingXY(1/_,1/_))}d=S._minus_TheoPoint_TheoPoint(d,g),h=S._minus_TheoPoint_TheoPoint(h,g);var T=Math.atan2(d.y,d.x),v=Math.atan2(h.y,h.x);!s&&T<v&&(T+=r.k_two_pi),s&&T>v&&(T-=r.k_two_pi);var C=i.clone(y.MathUtils.ArcToBezier3(T,v,6));f.LegacyCoreAssert.isTrue(19==C.length,"unexpected number of points",void 0,"SVGParserUtils.svgArcToPath","SVGParserUtils.swift",449);for(var D=c.inverse,A=i.iter(i.stride(1,C.length-2,3));!A.done;A.next()){var E=A.value;if(D.isIdentity)u.cubicBezier(C[E].x,C[E].y,C[E+1].x,C[E+1].y,C[E+2].x,C[E+2].y);else{var R=P.TheoPathBuilder.init_d41d();R.cubicBezier(C[E].x,C[E].y,C[E+1].x,C[E+1].y,C[E+2].x,C[E+2].y),u.addPath(R.path,D)}}},scanCoordinateData:function(e){for(var t=[],n=i.clone(h.Host.pathUtils.matchesForRegexInString(r.kNumericRegEX,e)),o=i.iter(n);!o.done;o.next()){var a=o.value;t.push(a)}return t},scanPathData:function(e){for(var t=[],n=i.clone(h.Host.pathUtils.matchesForRegexInString("[,\\x20\\x09\\x0D\\x0A]*[ZzHhVvMmLlTtQqSsCcAa]([,\\x20\\x09\\x0D\\x0A]*[+-]?(([0-9]*\\.[0-9]+)|([0-9]+\\.?))([eE][+-]?[0-9]+)?)*",e)),o=i.iter(n);!o.done;o.next()){var a=o.value,s=h.Host.pathUtils.firstMatchForRegexInString("[ZzHhVvMmLlTtQqSsCcAa]",a);f.LegacyCoreAssert.isTrue(1==s.length,"unexpected length for path token",{token:s},"SVGParserUtils.scanPathData","SVGParserUtils.swift",493);var l=0;switch(s){case"Z":case"z":l=0;break;case"H":case"h":case"V":case"v":l=1;break;case"M":case"m":case"L":case"l":case"T":case"t":l=2;break;case"Q":case"q":case"S":case"s":l=4;break;case"C":case"c":l=6;break;case"A":case"a":l=7;break;default:l=0}t.push(s);for(var u=l,c=i.clone(h.Host.pathUtils.matchesForRegexInString(r.kNumericRegEX,a)),d=i.iter(c);!d.done;d.next()){var p=d.value;0==u&&("M"!=s&&"m"!=s||("M"==s&&(s="L"),"m"==s&&(s="l")),u=l,t.push(s)),u-=1,t.push(p)}0!=u&&f.LegacyCoreAssert.fail("svg path had wrong number of arguments",{type:s,expected:l,found:l-u},"SVGParserUtils.scanPathData","SVGParserUtils.swift",548)}return t},parseStyleStringToAttrDict:function(e){for(var t={},n=e.split(";"),r=i.iter(n);!r.done;r.next()){var o=r.value.trim();if(o.length>0){var a=o.split(":");if(2==a.length){var s=a[0].trim(),l=a[1].trim();t[s]=l}else 0!=a.length&&i.info("unexpected number of string components - just expecting a key string and a value string")}}return t},getAttrDoubleForKey:function(e,t,n){var r=e[t];return null!=r?(r.endsWith("px")&&(r=r.substr(0,r.length-"px".length)),h.Host.pathUtils.parseStringToDouble(r)):n},getSVGEndcapType:function(e){var t,n=P.TheoPath.PATHEND_BUTT;if(null!=(t=e["stroke-linecap"]))switch(t){case"round":n=P.TheoPath.PATHEND_ROUND;break;case"square":n=P.TheoPath.PATHEND_SQUARE}return n},getSVGPathJoin:function(e){var t,n=P.TheoPath.PATHJOIN_MITER;if(null!=(t=e["stroke-linejoin"]))switch(t){case"round":n=P.TheoPath.PATHJOIN_ROUND;break;case"bevel":n=P.TheoPath.PATHJOIN_BEVEL}return n},getSVGStrokeWt:function(e){var t=0,n=e["stroke-width"];if(null!=n&&n.length>0)t=h.Host.pathUtils.parseStringToDouble(n);else{var r=e.stroke;null!=r&&r.length>0&&"none"!=r&&(t=1)}return t},getSVGSMiterLimit:function(e){var t=4,n=e["stroke-miterlimit"];return null!=n&&n.length>0&&(t=h.Host.pathUtils.parseStringToDouble(n)),t}}}),r)},p15M:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("gXiO"),l=n("2bF5"),u=n("/9Bx"),c=n("R19c");i.ImageAdjustmentMaps=(r=function(){this.colorMap=[],this.sMap=[],this.hMap=[],this.threeChannelColorMap=[],this.cm=[]},a.defineClass({name:"ImageAdjustmentMaps",ctor:r,superName:"CoreObject",props:{set:function(e,t,n,r,o){this.colorMap=a.clone(e),this.sMap=a.clone(t),this.hMap=a.clone(n),this.threeChannelColorMap=a.clone(r),this.cm=a.clone(o)}}}),r),i.MoaAdjustments=(o=function(){s.CoreObject.call(this)},a.defineClass({name:"MoaAdjustments",ctor:o,superName:"CoreObject",statics:{computeColorMaps:function(e){return o.computeColorMapsFromValues(e.shadows,e.highlights,e.saturation,e.brightness,e.exposure,e.contrast,e.warmth,e.tint,e.fade,e.vibrance)},computeColorMapsFromValues:function(e,t,n,r,o,s,d,h,p,f){var m=new i.ImageAdjustmentMaps,g=a.clone(u.MoaColorMap.createIdentityColorMap()),y=0!=r||0!=o||0!=s,_=0!=d||0!=h||0!=p;if(0!=r){var T=a.clone(u.MoaColorMap.createBrightnessColorMap(r));g=a.clone(u.MoaColorMap.combineColorMaps(g,T))}if(0!=o){var v=a.clone(u.MoaColorMap.createExposureColorMap(o));g=a.clone(u.MoaColorMap.combineColorMaps(g,v))}if(0!=s){var C=a.clone(u.MoaColorMap.createContrastColorMap(s));g=a.clone(u.MoaColorMap.combineColorMaps(g,C))}var P=a.clone(u.MoaColorMap.createShadowsColorMap(e)),S=a.clone(u.MoaColorMap.createHighlightsColorMap(t)),D=a.clone(u.MoaColorMap.createIdentityColorMap()),A=a.clone(u.MoaColorMap.createIdentityColorMap()),E=a.clone(u.MoaColorMap.createIdentityColorMap());if(0!=p){var R=a.clone(u.MoaColorMap.createFadeColorMap(p));D=a.clone(u.MoaColorMap.combineColorMaps(D,R)),A=a.clone(u.MoaColorMap.combineColorMaps(A,R)),E=a.clone(u.MoaColorMap.combineColorMaps(E,R))}if(0!=d){var F=a.clone(u.MoaColorMap.createWarmthColorMaps(d));D=a.clone(u.MoaColorMap.combineColorMaps(D,F[0])),A=a.clone(u.MoaColorMap.combineColorMaps(A,F[1])),E=a.clone(u.MoaColorMap.combineColorMaps(E,F[2]))}if(0!=h){var b=a.clone(u.MoaColorMap.createTintColorMaps(h));D=a.clone(u.MoaColorMap.combineColorMaps(D,b[0])),A=a.clone(u.MoaColorMap.combineColorMaps(A,b[1])),E=a.clone(u.MoaColorMap.combineColorMaps(E,b[2]))}if(y)for(var I=a.iter(a.range(0,l.MoaConstants.kMoaColorMapSizeRGB,!1));!I.done;I.next())g[k=I.value]=u.MoaColorMap.MoaColorClamp(Math.round(g[k]));if(_)for(var O=a.iter(a.range(0,l.MoaConstants.kMoaColorMapSizeRGB,!1));!O.done;O.next()){var k;D[k=O.value]=u.MoaColorMap.MoaColorClamp(Math.round(D[k])),A[k]=u.MoaColorMap.MoaColorClamp(Math.round(A[k])),E[k]=u.MoaColorMap.MoaColorClamp(Math.round(E[k]))}var N=n,M=f;if(N+M>l.MoaConstants.kSatVibranceSumMax){var L=N+M;N=l.MoaConstants.kSatVibranceSumMax*N/L,M=l.MoaConstants.kSatVibranceSumMax*M/L}var x=[1,0,0,0,0,1,0,0,0,0,1,0];0!=M&&c.MoaColorMatrix.applyVibranceToColorMatrix(x,M),0!=N&&c.MoaColorMatrix.applySaturationToColorMatrix(x,N),u.MoaColorMap.roundColorMap(P),u.MoaColorMap.roundColorMap(S);var B=a.repeat([],3);return B[0]=a.clone(D),B[1]=a.clone(A),B[2]=a.clone(E),m.set(g,P,S,B,x),m}}}),o)},pFDI:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("Z25M"),s=n("FNB+"),l=n("6ZWm"),u=n("wc1n"),c=n("dE3O"),d=n("ERpL");o.ShapeFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e.root,this.forma_=e,this.forFeatures_=i.clone(t),this.featureEvals_=[],u.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"ShapeFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["BoundingBox",[this.evaluateBoundingBox,u.FeatureType.Complex]],["ShapeWidth",[this.evaluateShapeWidth,u.FeatureType.Numerical]],["ShapeHeight",[this.evaluateShapeHeight,u.FeatureType.Numerical]],["Area",[this.evaluateArea,u.FeatureType.Numerical]],["CenterX",[this.evaluateCenterX,u.FeatureType.Numerical]],["CenterY",[this.evaluateCenterY,u.FeatureType.Numerical]],["RotCosine",[this.evaluateRotCosine,u.FeatureType.Numerical]],["RotSine",[this.evaluateRotSine,u.FeatureType.Numerical]],["PercentageDesignArea",[this.evaluatePercentageDesignArea,u.FeatureType.Numerical]],["PercentageOutofBounds",[this.evaluatePercentageOutofBounds,u.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,u.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,u.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,u.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,u.FeatureType.Numerical]],["BackgroundImageCount",[this.evaluateBackgroundImageCount,u.FeatureType.Numerical]],["ForegroundImageCount",[this.evaluateForegroundImageCount,u.FeatureType.Numerical]]],this.evaluateOverlappingFeatures(),this.evaluateShapeMaskFeatures()},evaluateOverlappingFeatures:function(){for(var e=i.clone(this.root_.visitAsArray(s.FormaTraversal.PreOrder)),t=0,n=0,r=0,o=0,a=i.iter(e);!a.done;a.next()){var l=a.value;if(null!=l.controller&&l.controller.floating&&!l.isGridCell()&&"temp-struct-vis"!=l.intent&&l!=this.forma_){if(l.parent==this.forma_.parent){var c=this.forma_.parent.indexOfChild(this.forma_),d=this.forma_.parent.indexOfChild(l);if(null!=c&&null!=d&&c>d)continue}var h,p,f;if((h=l.finalFrame)&&(p=this.forma_.finalFrame)&&(f=h.intersectionWith(p))){var m=this.forma_.getAverageAlpha(h),g=f.area/p.area;m>.01&&g>.05&&(l.isTypeLockup()?(n+=1,r+=m*g):(t+=1,o+=m*g))}}}this.setFeature("OverlappingGraphicCount",t,u.FeatureType.Numerical),this.setFeature("OverlappingTextCount",n,u.FeatureType.Numerical),this.setFeature("PercentageTextOverlap",r,u.FeatureType.Numerical),this.setFeature("PercentageGraphicOverlap",o,u.FeatureType.Numerical)},evaluateShapeMaskFeatures:function(){var e,t=0,n=0;if((e=this.forma_.maskImage)&&!e.isEmpty()){var r=c.ImageProcessingUtils.getEdgeMagnitudeImage(e);t=e.sum()/i.toDouble(e.numElements),n=r.sum()/i.toDouble(e.numElements)}this.setFeature(d.ShapeRoleFeatures.MaskAverage,t,u.FeatureType.Numerical),this.setFeature(d.ShapeRoleFeatures.MaskAverageEdge,n,u.FeatureType.Numerical)},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var n=t.value;if(e||!e&&this.forFeatures_.includes(n[0])){var r=n[1],o=(0,r[0])(this);this.setFeature(n[0],o,r[1])}}},evaluateBoundingBox:function(e){return a.DesignFeatureUtils.getFormaBoundingBox(e.forma_)},evaluateShapeWidth:function(e){return a.DesignFeatureUtils.getFormaWidth(e.forma_)},evaluateShapeHeight:function(e){return a.DesignFeatureUtils.getFormaHeight(e.forma_)},evaluateArea:function(e){return e.numericalFeatures_.ShapeWidth*e.numericalFeatures_.ShapeHeight},evaluateCenterX:function(e){return a.DesignFeatureUtils.getFormaCenterX(e.forma_)},evaluateCenterY:function(e){return a.DesignFeatureUtils.getFormaCenterY(e.forma_)},evaluateRotCosine:function(e){return e.forma_.totalPlacement.transformValues.rotCosine},evaluateRotSine:function(e){return e.forma_.totalPlacement.transformValues.rotSine},evaluatePercentageDesignArea:function(e){var t=e.root_.finalFrame.area;return e.numericalFeatures_.Area/t},evaluatePercentageOutofBounds:function(e){var t,n,r=0;return(t=e.forma_.finalFrame)&&(n=e.root_.finalFrame.intersectionWith(t))&&(r=(t.area-n.area)/t.area),r},evaluateOverlappingGraphicCount:function(e){var t,n,r=0;return(t=e.forma_.finalFrame)&&(n=e.root_.finalFrame.intersectionWith(t))&&(r=(t.area-n.area)/t.area),r},evaluateShapeCount:function(e){return a.DesignFeatureUtils.getShapeCount(e.root_)},evaluateTextCount:function(e){return a.DesignFeatureUtils.getTextCount(e.root_)},evaluatePageWidth:function(e){return a.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return a.DesignFeatureUtils.getPageHeight(e.root_)},evaluateBackgroundImageCount:function(e){return i.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==l.FrameController.KIND&&e.isGridCell()})).length)},evaluateForegroundImageCount:function(e){return i.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==l.FrameController.KIND&&!e.isGridCell()})).length)}}}),r)},"pR+7":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("fNpk"),c=n("Ird5"),d=n("jLWG"),h=n("jfma"),p=n("yjxF"),f=n("Aj79"),m=n("Ucb9"),g=n("K0Rh"),y=n("Zifs"),_=n("hgLm");i.RootFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},a.defineClass({name:"RootFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=g.RootForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{makePGMRef:function(e,t,n,r){var o,i,s;if((o=a.as(e,g.RootForma))&&(i=n.childReferences(o))&&(s=o.bounds)){var T,v=new _.TheoRectanglePath(s),C=o.style.colors.fieldPrimary||y.SolidColor.WHITE,P=C.withAlphaOf(C.alpha*t.backgroundOpacityOverride);if(P.alpha>0){var S=new f.PGMReference(new m.PGMShape(o.formaID+"-background",new p.PGMNodeMetadata(o.formaID,"background"),c.PGMAnimationList.EMPTY,s,[v],P));T=[l.FormaToPGMUtils.applyAnimations(t,e,S)].concat(i)}else T=a.clone(i);return l.FormaToPGMUtils.applyAnimations(t,e,new f.PGMReference(new d.PGMClip(o.formaID,new p.PGMNodeMetadata(o.formaID,"clip"),c.PGMAnimationList.EMPTY,T,[v]),new h.PGMCompositingParams(o.placement,o.style.opacity)))}return u.LegacyCoreAssert.fail("root forma child reference generation failed",void 0,"RootFormaToPGMMapper.makePGMRef","RootFormaToPGMMapper.swift",87),null}}}),r)},pmb0:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("VQVe"),s=n("FNB+"),l=n("KkVW"),u=n("3/rh"),c=n("Pn67"),d=n("nQ+V"),h=n("SAU6"),p=n("nUE5");o.EXPOSE_MOTION_STYLE=!1,o.MotionFacade=(r=function(){},i.defineClass({name:"MotionFacade",ctor:r,statics:{ANIM_STYLE_NAME_STACKED:"Stacked",ANIM_STYLE_NAME_COMPOSITE:"Composite",getCurrentAnimationStyle:function(){return r._animStyle},applyEntryToForma:function(e,t){var n=p.MotionSource.getSourceAnimation(t.srcId,e);t.logic.apply(e,n,t.args)},canApplyStyle:function(e){return e.name==r.ANIM_STYLE_NAME_STACKED||e.name==r.ANIM_STYLE_NAME_COMPOSITE||e.name==a.AnimationStyle.NAME_DYNAMIC&&3==e.variant},createAllAnimationStyles:function(){return o.EXPOSE_MOTION_STYLE?[a.AnimationStyle.init_e14f(r.ANIM_STYLE_NAME_STACKED,0,1,a.AnimationStyleCategory.Text),a.AnimationStyle.init_e14f(r.ANIM_STYLE_NAME_COMPOSITE,0,1,a.AnimationStyleCategory.Text)]:[]},applyStyle:function(e,t){if(r.canApplyStyle(t))if(r._animStyle=t,t.name==a.AnimationStyle.NAME_DYNAMIC)r.applyEntryToForma(e,new h.MotionEntryStackedRoot);else{var n,o=[],p=new c.MotionEntryNone;e.visitAll(s.FormaTraversal.PreOrder,(function(e){r.applyEntryToForma(e,p),e.isTypeLockup()&&o.push(e)})),(n=i.first(o))&&(t.name==r.ANIM_STYLE_NAME_COMPOSITE?(r.applyEntryToForma(n,new l.MotionEntryDropIn),r.applyEntryToForma(n,new u.MotionEntryFadeIn)):t.name==r.ANIM_STYLE_NAME_STACKED&&r.applyEntryToForma(n,new d.MotionEntryStacked))}}}}),r)},pnSN:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("13MC"),s=n("FNB+"),l=n("fWxZ"),u=n("QbzR"),c=n("P83h"),d=n("9Lk3"),h=n("ZK0l"),p=n("fNpk"),f=n("c+uM"),m=n("tGKA"),g=n("Quhx"),y=n("8t9B"),_=n("sIWg");o.GroupForma=(r=function(){this.cachedChildren_=null,this.cachedAuxiliaries_=null},i.defineClass({name:"GroupForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"group"}},PROPERTY_BOUNDS:"bounds",PROPERTY_CHILDREN:"children",OLD_PROPERTY_CHARSTYLES:"character-styles",OLD_PROPERTY_CHARSTYLERANGES:"charstyle-ranges",SCHEMA_CLASS_NAME:{get:function(){return"GroupForma"}},factory:{get:function(){var e;return function(t,n,o,a){if(null!=n){var s=i.as(i.opt(i.opt(a,(function(e){return e.backLink})),(function(e){return e.dereference()})),g.PostDCXObject),u=i.as(s,r),c=(e=i.as(s,l.FormaPage))||null!=e?e:i.opt(u,(function(e){return e.page}));return p.LegacyCoreAssert.isTrue(null!=c,"GroupForma needs a parent page",void 0,"GroupForma","GroupForma.swift",27),null!=u?r.init_3144(t,n,o,u):r.init_7dbd(t,n,o,c)}return r.init_d1c9(t,o)}}},childrenPostOrder:function(e,t,n){for(var r=null,o=0,a=t.childCount,l=t.auxiliaryCount,u=i.iter(i.range(0,t.childCount,!1));!u.done;u.next()){var c=u.value;if(null!=(r=t.childAt(c).visit(e,(function(e,t,r){return n(e,t+1,(o+=1)-1)}))))return r}if(e==s.FormaTraversal.PostOrderWithAuxiliaries)for(var d=i.iter(i.range(0,t.auxiliaryCount,!1));!d.done;d.next())if(c=d.value,null!=(r=t.auxiliaryAt(c).visit(e,(function(e,t,r){return n(e,t+1,(o+=1)-1)}))))return r;return p.LegacyCoreAssert.isTrue(a<=t.childCount,"this function should not delete any children",void 0,"GroupForma.childrenPostOrder","GroupForma.swift",775),p.LegacyCoreAssert.isTrue(l<=t.auxiliaryCount,"this function should not delete any auxiliaries",void 0,"GroupForma.childrenPostOrder","GroupForma.swift",776),n(t,0,o)?t:r},childrenPreOrder:function(e,t,n){var r=null,o=0;if(n(t,0,o))return t;for(var a=t.childCount,l=t.auxiliaryCount,u=i.iter(i.range(0,t.childCount,!1));!u.done;u.next()){var c=u.value;if(null!=(r=t.childAt(c).visit(e,(function(e,t,r){return n(e,t+1,(o+=1)-1)}))))return r}if(e==s.FormaTraversal.PreOrderWithAuxiliaries)for(var d=i.iter(i.range(0,t.auxiliaryCount,!1));!d.done;d.next())if(c=d.value,null!=(r=t.auxiliaryAt(c).visit(e,(function(e,t,r){return n(e,t+1,(o+=1)-1)}))))return r;return p.LegacyCoreAssert.isTrue(a<=t.childCount,"this function should not delete any children",void 0,"GroupForma.childrenPreOrder","GroupForma.swift",821),p.LegacyCoreAssert.isTrue(l<=t.auxiliaryCount,"this function should not delete any auxiliaries",void 0,"GroupForma.childrenPreOrder","GroupForma.swift",822),r},childrenOnly:function(e,t){for(var n=i.iter(i.range(0,e.childCount,!1));!n.done;n.next()){var r=n.value,o=e.childAt(r);if(t(o,1,r))return o}return null},childrenAndAuxiliaries:function(e,t){var n;return(n=r.childrenOnly(e,t))?n:r.auxiliariesOnly(e,t)},auxiliariesOnly:function(e,t){for(var n=i.iter(i.range(0,e.auxiliaryCount,!1));!n.done;n.next()){var r,o=n.value;if((r=e.auxiliaryAt(o))&&t(r,1,o))return r}return null},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,s.Forma,s.Forma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){i.super_init(this,s.Forma,s.Forma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},children:function(){return[]}},o=i.clone(t),a=i.iter(n);!a.done;a.next()){var l=a.key,u=a.value;null==t[l]&&(o[l]=u())}i.super_init(this,s.Forma,s.Forma.prototype.init_812f,e,o)},init_7fcf:function(e,t){var n={kind:t};this.init_812f(e,n)},init_d1c9:function(e,t){i.super_init(this,s.Forma,s.Forma.prototype.init_d1c9,e,t)},destroy:function(){s.Forma.prototype.destroy.call(this);for(var e=i.iter(this.children_);!e.done;e.next())e.value.destroy();for(var t=i.iter(this.auxiliaries_);!t.done;t.next())t.value.destroy()},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==r.PROPERTY_BOUNDS?new c.FormaGeometryChangedEvent(this):e==r.PROPERTY_CHILDREN?new c.FormaHierarchyChangedEvent(this):s.Forma.prototype.updateEventForProperty.call(this,e)},postDecode:function(){var e;s.Forma.prototype.postDecode.call(this),this.populateChildrenAndAux(),this.controller instanceof y.TypeLockupController&&(e=i.as(this.style,f.LockupStyle))&&(e.wheelUsed=!1),this.controller instanceof d.GridController&&(this.validateOnSet=!0)},setProperty:function(e,t){s.Forma.prototype.setProperty.call(this,e,t),p.LegacyCoreAssert.isTrue(null!=this.getProperty(s.Forma.PROPERTY_KIND),"Group forma missing kind; base state inaccessible",{id:this.id},"GroupForma.setProperty","GroupForma.swift",119),p.LegacyCoreAssert.isTrue(null!=this.getProperty(g.PostDCXObject.PROPERTY_PATH),"Group forma missing path; base state inaccessible",{id:this.id},"GroupForma.setProperty","GroupForma.swift",120)},charStylesArray_:{get:function(){var e,t=null;if(e=i.opt(this.getProperty(r.OLD_PROPERTY_CHARSTYLES),(function(e){return e.dictionaryValue}))){t={};for(var n=i.iter(e);!n.done;n.next()){var o,a=n.key,s=n.value;(o=i.as(u.FormaStyle.codec.decode(s,this),f.LockupStyle))&&(t[a]=o)}}return t}},charStylesRangesArray:{get:function(){var e,t=null;if(e=i.opt(this.getProperty(r.OLD_PROPERTY_CHARSTYLERANGES),(function(e){return e.dictionaryValue}))){t={};for(var n=i.iter(e);!n.done;n.next()){var o=n.key,a=n.value,s=i.clone(a.arrayValue);if(null!=s){var l=s.map((function(e){return e.intValue}),this).filter((function(e){return null!=e}),this).map((function(e){return e}),this);t[o]=i.clone(l)}}}return t}},bounds_:{get:function(){return i.as(this.get(r.PROPERTY_BOUNDS),_.TheoRect)},set:function(e){this.set(r.PROPERTY_BOUNDS,e)}},children_:{get:function(){return this.populateChildrenAndAux(),this.cachedChildren_}},populateChildrenAndAux:function(){var e,t=null==this.cachedChildren_,n=null==this.cachedAuxiliaries_;if((t||n)&&(this.cachedChildren_=this.cachedChildren_||[],this.cachedAuxiliaries_=this.cachedAuxiliaries_||[],e=i.as(this.get(r.PROPERTY_CHILDREN),["Array",s.Forma])))for(var o=i.iter(e);!o.done;o.next()){var a=o.value,l=a.hasTag(s.Forma.TAG_IS_AUXILIARY);t&&!l?i.opt(this.cachedChildren_,(function(e){return e.push(a)})):n&&l&&i.opt(this.cachedAuxiliaries_,(function(e){return e.push(a)}))}},auxiliaries_:{get:function(){return this.populateChildrenAndAux(),this.cachedAuxiliaries_}},flushChildren:function(){if(null!=this.cachedChildren_||null!=this.cachedAuxiliaries_){p.LegacyCoreAssert.isTrue(i.is(this.state,a.IDBObjectMutableState),"flushChildren - group state not mutable!",void 0,"GroupForma.flushChildren","GroupForma.swift",200);var e,t,n=[];if((e=this.cachedChildren_)&&(n=e.concat()),t=this.cachedAuxiliaries_)for(var o=i.iter(t);!o.done;o.next()){var s=o.value;n.push(s)}this.set(r.PROPERTY_CHILDREN,n)}},clearCache:function(){this.flushChildren(),s.Forma.prototype.clearCache.call(this),this.cachedChildren_=null,this.cachedAuxiliaries_=null},childrenAsArray:{get:function(){return this.children_.concat()}},willCommitState:function(){this.flushChildren(),s.Forma.prototype.willCommitState.call(this)},willChangeState:function(e){var t=this;s.Forma.prototype.willChangeState.call(this,e),i.keys(e).includes(r.PROPERTY_CHILDREN)&&(i.opt(this.cachedChildren_,(function(e){return e.forEach((function(e){e.parent===t&&e.setParent(null)}))})),this.cachedChildren_=null,i.opt(this.cachedAuxiliaries_,(function(e){return e.forEach((function(e){e.parent===t&&e.setParent(null)}))})),this.cachedAuxiliaries_=null)},didChangeState:function(e){var t,n=this;i.keys(e).includes(r.PROPERTY_CHILDREN)&&(p.LegacyCoreAssert.isTrue(null==this.cachedChildren_,"Re-get of children happened while trying to change states",void 0,"GroupForma.didChangeState","GroupForma.swift",259),p.LegacyCoreAssert.isTrue(null==this.cachedAuxiliaries_,"Re-get of auxiliaries happened while trying to change states",void 0,"GroupForma.didChangeState","GroupForma.swift",260),this.cachedChildren_=null,this.cachedAuxiliaries_=null,(t=i.as(this.get(r.PROPERTY_CHILDREN),["Array",s.Forma]))&&t.forEach((function(e){return e.setParent(n,null==e.parent||e.parent!=n)}))),s.Forma.prototype.didChangeState.call(this,e)},setParent:function(e,t){if(void 0===t&&(t=!1),s.Forma.prototype.setParent.call(this,e,!1),t)for(var n=i.iter(this.childrenAsArray);!n.done;n.next())n.value.setParent(this,!0)},state:{get:function(){return s.Forma._getters.state.call(this)},set:function(e){i.is(s.Forma._getters.state.call(this),a.IDBObjectMutableState)&&this.flushChildren(),s.Forma._setters.state.call(this,e)}},bounds:{get:function(){return null!=this.bounds_?this.bounds_:this.childrenBoundsInCoordSpace(m.Matrix2D.Identity)},set:function(e){var t=this;if(!(null!=e&&null!=this.bounds_&&e.equal(this.bounds_)||null==e&&null==this.bounds_)){var n=new c.FormaGeometryChangedEvent(this);this.beginUpdate(n),i.opt(i.as(this.controller,h.GroupController),(function(e){return e.beginUpdateGroup(t.bounds_)})),this.bounds_=e,i.opt(i.as(this.controller,h.GroupController),(function(e){return e.updateGroup()})),i.opt(i.as(this.controller,h.GroupController),(function(e){return e.endUpdateGroup()})),this.endUpdate(n)}}},setBounds:{get:function(){return this.bounds_}},contentID:{get:function(){if(null!=(r=s.Forma._getters.contentID.call(this)))return r;var e=[];if(this.visit(s.FormaTraversal.JustChildren,(function(t,n,r){var o;return null!=(o=t.contentID)&&e.push(o),!1})),0==e.length)return null;i.sortInPlace(e);for(var t="",n=i.iter(e);!n.done;n.next()){var r;t+=r=n.value}return t}},match:function(e){if(s.Forma.prototype.match.call(this,e),!this.bounds.equal(e.bounds))if(null!=this.controller&&this.controller.maintainAspectRatio){var t=e.bounds.fitAspectRatioWithin(this.bounds.aspectRatio);this.bounds=_.TheoRect.fromXYWH(e.bounds.minX,e.bounds.minY,t.width,t.height)}else this.bounds=e.bounds},visit:function(e,t){switch(e){case 1:case 7:return r.childrenPreOrder(e,this,t);case 2:case 8:return r.childrenPostOrder(e,this,t);case 6:return r.childrenOnly(this,t);case 9:return r.auxiliariesOnly(this,t);case 10:return r.childrenAndAuxiliaries(this,t);default:return s.Forma.prototype.visit.call(this,e,t)}},insertChildrenInternal:function(e,t,n){if(t<0||t>this.children_.length)p.LegacyCoreAssert.fail("insertChildrenInternal: invalid index",{index:t},"GroupForma.insertChildrenInternal","GroupForma.swift",400);else{for(var r=i.iter(e);!r.done;r.next())if((l=r.value).page.uuid!=this.page.uuid)return void p.LegacyCoreAssert.fail("insertChildrenAt: attempting to insert children from a different page",void 0,"GroupForma.insertChildrenInternal","GroupForma.swift",407);var o=new c.FormaInsertedChildrenEvent(this,e,t);this.beginUpdate(o),this.makeMutable();for(var a=t,s=i.iter(e);!s.done;s.next()){var l,u=(l=s.value).totalPlacement,d=a;if(null!=l.parent&&(l.parent!=this?l.parent.removeChild(l):(a>0&&a==this.children_.length&&(d-=1),i.remove(this.children_,l))),l.setParent(this),this.children_.splice(d,0,l),a+=1,n){var h=l.totalPlacement;h.equal(u)||l.move(m.Matrix2D.concat2(h.inverse,u))}}this.endUpdate(o)}},insertChildrenAt:function(e,t,n){void 0===n&&(n=!1),this.insertChildrenInternal(e,t,n)},appendChild:function(e,t){void 0===t&&(t=!1);var n=[];n.push(e),this.insertChildrenInternal(n,this.children_.length,t)},appendChildren:function(e,t){void 0===t&&(t=!1),this.insertChildrenAt(e,this.children_.length,t)},insertBefore:function(e,t,n){void 0===n&&(n=!1),null==t?this.insertChildAt(e,this.children_.length,n):t.parent!==this?(p.LegacyCoreAssert.fail("insertBefore: refForma must be a child of this forma; appending",void 0,"GroupForma.insertBefore","GroupForma.swift",467),this.insertChildAt(e,this.children_.length,n)):this.insertChildAt(e,i.indexOfEq(this.children_,t,s._equality_Forma_Forma),n)},insertChildAt:function(e,t,n){void 0===n&&(n=!1);var r=[];r.push(e),this.insertChildrenAt(r,t,n)},removeChildrenAt:function(e,t){var n=this;if(e<0||t<0||e+t>this.children_.length)p.LegacyCoreAssert.fail("removeChildrenAt: Invalid index or count",{index:e,count:t},"GroupForma.removeChildrenAt","GroupForma.swift",482);else if(0==t);else{var r=this.children_.slice(e,e+t),o=new c.FormaRemovedChildrenEvent(this,r,e);this.beginUpdate(o),this.makeMutable();for(var a=i.iter(r);!a.done;a.next())a.value.setParent(null);this.children_.splice(e,t),this.endUpdate(o),r.forEach((function(e){return n.page.removeFormaFromCache(e.formaID)}))}},removeChild:function(e){var t;null!=(t=i.indexOfEq(this.children_,e,s._equality_Forma_Forma))?this.removeChildAt(t):p.LegacyCoreAssert.fail("Child is not part of this group",void 0,"GroupForma.removeChild","GroupForma.swift",510)},removeChildAt:function(e){this.removeChildrenAt(e,1)},removeAllChildren:function(){this.removeChildrenAt(0,this.children_.length)},indexOfChild:function(e){return i.indexOfEq(this.children_,e,s._equality_Forma_Forma)},indexOfTop:function(e){for(var t=-1,n=i.iter(i.range(0,this.childCount,!1).reversed());!n.done;n.next()){var r=n.value;if(e(this.childAt(r))){t=r;break}}return t},findDescendant:function(e){for(var t=i.iter(this.children_);!t.done;t.next()){var n,o,a=t.value;if(e(a))return a;if((n=i.as(a,r))&&(o=n.findDescendant(e)))return o}return null},findChild:function(e){return this.children_.find(e,this)},childAt:function(e){return p.LegacyCoreAssert.isTrue(e>=0&&e<this.children_.length,"requested for child at out of range index",void 0,"GroupForma.childAt","GroupForma.swift",558),e>=0&&e<this.children_.length?this.children_[e]:null},childCount:{get:function(){return this.children_.length}},boundsInCoordSpace:function(e){return null!=this.bounds_?this.bounds_.transform(e):this.childrenBoundsInCoordSpace(e)},childrenFinalFrame:{get:function(){return this.childrenBoundsInCoordSpace(this.totalPlacement)}},childrenFrame:{get:function(){return this.childrenBoundsInCoordSpace(this.placement)}},childrenBoundsInCoordSpace:function(e){var t=null;return this.children_.forEach((function(n){var o;if(o=i.as(n,r))t=_.TheoRect.unionOf(t,o.childrenBoundsInCoordSpace(n.placement.concat(e)));else if(!n.isFullCanvas){var a=n.boundsInCoordSpace(n.placement.concat(e));t=_.TheoRect.unionOf(t,a)}})),t},auxiliaryCount:{get:function(){return this.auxiliaries_.length}},auxiliaryAt:function(e){return p.LegacyCoreAssert.isTrue(e>=0&&e<this.auxiliaries_.length,"requested for auxiliary at out of range index",void 0,"GroupForma.auxiliaryAt","GroupForma.swift",609),e>=0&&e<this.auxiliaries_.length?this.auxiliaries_[e]:null},indexOfAuxiliary:function(e){return i.indexOfEq(this.auxiliaries_,e,s._equality_Forma_Forma)},findAuxiliary:function(e){return this.auxiliaries_.find(e,this)},appendAuxiliary:function(e){var t=[];t.push(e),this.insertAuxiliaryInternal(t,this.auxiliaries_.length)},removeAuxiliary:function(e){var t;null!=(t=i.indexOfEq(this.auxiliaries_,e,s._equality_Forma_Forma))?this.removeAuxiliaryAt(t):p.LegacyCoreAssert.fail("Auxiliary is not part of this group",void 0,"GroupForma.removeAuxiliary","GroupForma.swift",637)},removeAuxiliaryAt:function(e){this.removeAuxiliariesAt(e,1)},removeAuxiliariesAt:function(e,t){if(e<0||t<0||e+t>this.auxiliaries_.length)p.LegacyCoreAssert.fail("removeAuxiliariesAt: Invalid index or count",{index:e,count:t},"GroupForma.removeAuxiliariesAt","GroupForma.swift",647);else if(t>0){var n=this.auxiliaries_.slice(e,e+t),r=new c.FormaRemovedAuxiliariesEvent(this,n,e);this.beginUpdate(r),this.makeMutable();for(var o=i.iter(n);!o.done;o.next())o.value.setParent(null);this.auxiliaries_.splice(e,t),this.endUpdate(r)}},insertAuxiliaryInternal:function(e,t){if(t<0||t>this.auxiliaries_.length)p.LegacyCoreAssert.fail("insertAuxiliaryInternal: invalid index",{index:t},"GroupForma.insertAuxiliaryInternal","GroupForma.swift",666);else{for(var n=i.iter(e);!n.done;n.next()){if((l=n.value).page.uuid!=this.page.uuid)return void p.LegacyCoreAssert.fail("insertAuxiliaryInternal: attempting to insert formae from a different page",void 0,"GroupForma.insertAuxiliaryInternal","GroupForma.swift",673);l.setTag(s.Forma.TAG_IS_AUXILIARY)}var r=new c.FormaInsertedAuxiliariesEvent(this,e,t);this.beginUpdate(r),this.makeMutable();for(var o=t,a=i.iter(e);!a.done;a.next()){var l,u;(u=(l=a.value).parent)&&(u!=this?u.removeAuxiliary(l):i.remove(this.auxiliaries_,l)),o>this.auxiliaries_.length&&(o=this.auxiliaries_.length),l.setParent(this),this.auxiliaries_.splice(o,0,l),o+=1}this.endUpdate(r)}},isImage:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isImage()}),this)},isGraphic:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isGraphic()}),this)},isText:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isText()}),this)},isShape:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isShape()}),this)},isVideo:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isVideo()}),this)},isLogo:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isLogo()}),this)},isSticker:function(){return this.children_.length>0&&null==this.children_.find((function(e){return!e.isSticker()}),this)}}}),r)},q5zr:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("CWW7"),l=n("yGNn"),u=n("A6KL"),c=n("iCxV"),d=n("2rlr"),h=n("REQJ"),p=n("fNpk"),f=n("90dd"),m=n("sIWg"),g=n("qSCS");i.ImageContentNode=(r=function(){this.computeSaliencyPromise_=null,this.saliencyIntegral_=null,this.edgeIntegral_=null,this.MAX_SALIENCY_DIM=20,this.setFocusPromise_=null,this.image_=null},a.defineClass({name:"ImageContentNode",ctor:r,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"image"}},SCHEMA_CLASS_NAME:{get:function(){return"ImageContentNode"}},factory:{get:function(){return function(e,t,n,o){var i=a.as(a.opt(a.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),u.GroupContentNode);return p.LegacyCoreAssert.isTrue(null!=i,"Content nodes need a parent",void 0,"ImageContentNode","ImageContentNode.swift",16),r.init_3144(e,t,n,i)}}},PROPERTY_PIXEL_WIDTH:"pixel-width",PROPERTY_PIXEL_HEIGHT:"pixel-height",PROPERTY_IMAGE_COLOR_DATA:"image-color-data",PROPERTY_IMAGE_HAS_ALPHA:"image-has_alpha",PROPERTY_SALIENCY_WIDTH:"saliency-width",PROPERTY_SALIENCY_HEIGHT:"saliency-height",PROPERTY_SALIENCY_DATA:"saliency-data",PROPERTY_EDGE_DATA:"edge-data",PROPERTY_FOCUS_REGION:"focus-region",PROPERTY_TRIMMED_BOUNDS:"trimmed-bounds",IMAGE_MASK_ROLE_TAG:{get:function(){return"image-role"}},IMAGE_MASK_METADATA_TAG:{get:function(){return"image-mask-metadata"}},ROLE_MASK:{get:function(){return"mask"}},ASSET_ID_TAG:{get:function(){return"asset-id"}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){a.super_init(this,g.URLBasedContentNode,g.URLBasedContentNode.prototype.init_3144,e,t,n,r)},init_26a9:function(e,t){a.super_init(this,g.URLBasedContentNode,g.URLBasedContentNode.prototype.init_c3fa,e,"image",t)},init_5972:function(e,t){a.super_init(this,g.URLBasedContentNode,g.URLBasedContentNode.prototype.init_8b5c,e,"image",t)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},willCommitState:function(){var e,t,n,o,i,a,s;(e=this.saliencyData_)&&(this.set(r.PROPERTY_SALIENCY_DATA,e),this.saliencyData_=null),(t=this.edgeData_)&&(this.set(r.PROPERTY_EDGE_DATA,t),this.edgeData_=null),null!=(n=this.saliencyWidth_)&&(this.set(r.PROPERTY_SALIENCY_WIDTH,n),this.saliencyWidth_=null),null!=(o=this.saliencyHeight_)&&(this.set(r.PROPERTY_SALIENCY_HEIGHT,o),this.saliencyHeight_=null),(i=this.focusRegion_)&&(this.set(r.PROPERTY_FOCUS_REGION,i),this.focusRegion_=null),(a=this.trimmedBounds_)&&(this.set(r.PROPERTY_TRIMMED_BOUNDS,a),this.trimmedBounds_=null),null!=(s=this.hasAlpha_)&&(this.set(r.PROPERTY_IMAGE_HAS_ALPHA,s),this.hasAlpha_=null),g.URLBasedContentNode.prototype.willCommitState.call(this)},pixelWidth:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_PIXEL_WIDTH),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_PIXEL_WIDTH,e)}},pixelHeight:{get:function(){var e;return(e=a.as(this.get(r.PROPERTY_PIXEL_HEIGHT),"Int"))||null!=e?e:0},set:function(e){this.set(r.PROPERTY_PIXEL_HEIGHT,e)}},imageColorData:{get:function(){return a.as(this.get(r.PROPERTY_IMAGE_COLOR_DATA),["Array",h.ImageColorData])}},saliencyWidth:{get:function(){var e,t;return null==this.get(r.PROPERTY_SALIENCY_WIDTH)&&null==this.saliencyWidth_&&this.computeSaliencyData(),(e=a.as(this.get(r.PROPERTY_SALIENCY_WIDTH),"Int"))||null!=e?e:(t=this.saliencyWidth_)||null!=t?t:0}},saliencyHeight:{get:function(){var e,t;return null==this.get(r.PROPERTY_SALIENCY_HEIGHT)&&null==this.saliencyHeight_&&this.computeSaliencyData(),(e=a.as(this.get(r.PROPERTY_SALIENCY_HEIGHT),"Int"))||null!=e?e:(t=this.saliencyHeight_)||null!=t?t:0}},saliencyData:{get:function(){var e;return null==this.get(r.PROPERTY_SALIENCY_DATA)&&null==this.saliencyData_&&this.computeSaliencyData(),(e=a.as(this.get(r.PROPERTY_SALIENCY_DATA),["Array","Double"]))?e:this.saliencyData_}},edgeData:{get:function(){var e;return null==this.get(r.PROPERTY_EDGE_DATA)&&null==this.edgeData_&&this.computeEdgeData(),(e=a.as(this.get(r.PROPERTY_EDGE_DATA),["Array","Double"]))||null!=e?e:this.edgeData_}},getSaliencyDataDimensions:function(){if(0==this.pixelWidth||0==this.pixelHeight)return null;var e,t,n=this.MAX_SALIENCY_DIM,r=a.toDouble(this.pixelWidth)/a.toDouble(this.pixelHeight);return r>1?(e=a.toInt(n),t=a.toInt(n/r)):(e=a.toInt(n*r),t=a.toInt(n)),0==e||0==t?null:{width:e,height:t}},computeSaliencyData:function(){var e,t,n=this;if((e=this.image)&&null!=(t=this.getSaliencyDataDimensions())){if(null!=this.computeSaliencyPromise_)return;this.computeSaliencyPromise_=e.whenAsyncFeaturesLoaded().then((function(r){var o=0==n.database.transactionDepth?n.database.beginTransaction("compute_saliency",null):null;n.makeMutable();var i=a.clone(e.getSaliencyData(t.width,t.height));return i.length>0&&(n.saliencyWidth_=t.width,n.saliencyHeight_=t.height,n.saliencyData_=a.clone(i),n.computeSaliencyIntegral()),a.opt(o,(function(e){return e.mergeWithPrevious()})),n.computeSaliencyPromise_=null,null}))}},computeSaliencyIntegral:function(){var e;(e=this.saliencyData)&&e.length>0&&(this.saliencyIntegral_=a.clone(this.createIntegralImage(e,this.saliencyWidth,this.saliencyHeight)))},createIntegralImage:function(e,t,n){for(var r=a.repeat(0,t*n),o=a.repeat([],n),i=a.repeat([],n),s=a.iter(a.range(0,n,!1));!s.done;s.next())for(var l=s.value,u=a.iter(a.range(0,t,!1));!u.done;u.next()){var c=u.value,d=c>0&&l>0?r[(l-1)*t+(c-1)]:0,h=l>0?r[(l-1)*t+c]:0,p=c>0?r[l*t+(c-1)]:0,f=e[l*t+c];r[l*t+c]=f+h+p-d,o[l].push(f),i[l].push(f+h+p-d)}return r},computeEdgeData:function(){var e,t;if((e=this.image)&&null!=(t=this.getSaliencyDataDimensions())){var n=0==this.database.transactionDepth?this.database.beginTransaction("compute_edge_data",null):null;this.makeMutable(),this.saliencyWidth_=t.width,this.saliencyHeight_=t.height,this.edgeData_=a.clone(e.getEdgeData(this.saliencyWidth_,this.saliencyHeight_)),this.computeEdgeIntegral(),a.opt(n,(function(e){return e.mergeWithPrevious()}))}},computeEdgeIntegral:function(){var e;(e=this.edgeData)&&e.length>0&&(this.edgeIntegral_=a.clone(this.createIntegralImage(e,this.saliencyWidth,this.saliencyHeight)))},getAverageEdge:function(e){var t;if(c.Host.platform.isWeb||c.Host.platform.isService){if(null!=this.saliencyData&&null==this.saliencyIntegral_&&this.computeSaliencyIntegral(),(t=this.saliencyIntegral_)&&t.length>0)return this.getAverageSaliencyOrEdge(e,t,this.saliencyWidth,this.saliencyHeight)}else if(null!=this.edgeData&&null==this.edgeIntegral_&&this.computeEdgeIntegral(),(t=this.edgeIntegral_)&&t.length>0)return this.getAverageSaliencyOrEdge(e,t,this.saliencyWidth,this.saliencyHeight);return 0},getAverageSaliencyOrEdge:function(e,t,n,r){if(0==this.saliencyWidth||0==this.saliencyHeight)return 0;var o=a.toDouble(n)/a.toDouble(this.pixelWidth),i=a.toDouble(r)/a.toDouble(this.pixelHeight),s=e.multiplyXY(o,i),l=a.toInt(Math.max(a.toInt(s.minY),0)),u=a.toInt(Math.min(a.toInt(s.maxY),r-1)),c=a.toInt(Math.max(a.toInt(s.minX),0)),d=a.toInt(Math.min(a.toInt(s.maxX),n-1));if(l>=u||c>=d)return 0;var h=t[l*n+c],p=t[l*n+d],f=t[u*n+c],m=t[u*n+d]+h-p-f,g=(d-c)*(u-l);return a.toDouble(m)/a.toDouble(g)},computeFocusRegion:function(){var e;(e=this.image)&&e.loaded()&&(this.focusRegion_=e.getFocus())},focusRegion:{get:function(){var e,t;return null==a.as(this.get(r.PROPERTY_FOCUS_REGION),m.TheoRect)&&null==this.focusRegion_&&this.computeFocusRegion(),(t=(e=a.as(this.get(r.PROPERTY_FOCUS_REGION),m.TheoRect))||null!=e?e:this.focusRegion_)?0==t.width||0==t.height?m.TheoRect.fromXXYY(0,a.toDouble(this.pixelWidth),0,a.toDouble(this.pixelHeight)):m.TheoRect.fromXXYY(t.minX*a.toDouble(this.pixelWidth),t.maxX*a.toDouble(this.pixelWidth),t.minY*a.toDouble(this.pixelHeight),t.maxY*a.toDouble(this.pixelHeight)):null},set:function(e){var t;(t=e)&&p.LegacyCoreAssert.isTrue(t.maxX<=1&&t.maxY<=1,"focusRegion must be 0-1",void 0,"ImageContentNode","ImageContentNode.swift",353),this.focusRegion_=null,this.set(r.PROPERTY_FOCUS_REGION,e)}},computeTrimmedBounds:function(){var e;if((e=this.image)&&e.loaded()){var t,n=0==this.database.transactionDepth?this.database.beginTransaction("compute_trimmed_bounds",null):null;this.makeMutable(),this.trimmedBounds_=null,(t=e.getTrimmedBounds())&&isFinite(t.minX)&&isFinite(t.maxX)&&isFinite(t.minY)&&isFinite(t.maxY)&&(this.trimmedBounds_=t),a.opt(n,(function(e){return e.mergeWithPrevious()}))}},trimmedBounds:{get:function(){var e;return null==a.as(this.get(r.PROPERTY_TRIMMED_BOUNDS),m.TheoRect)&&null==this.trimmedBounds_&&this.computeTrimmedBounds(),(e=a.as(this.get(r.PROPERTY_TRIMMED_BOUNDS),m.TheoRect))||null!=e?e:this.trimmedBounds_},set:function(e){this.trimmedBounds_=null,this.set(r.PROPERTY_TRIMMED_BOUNDS,e)}},whenLoaded:function(){var e=this;return new l.CorePromise((function(t,n){var r;(r=e.image)?r.whenLoaded().then((function(e){return t(r)})):n("Content node's image is nil")}))},createImageFeatures:function(){var e=this;a.opt(this.image,(function(t){return t.whenLoaded().then((function(t){return e.persisted&&(e.focusRegion,a.clone(e.saliencyData),a.clone(e.edgeData),a.clone(e.imageColorData)),null}))}))},computeHasAlpha:function(){var e;"image/jpeg"==this.mimeType?this.hasAlpha_=!1:(e=this.image)&&(this.hasAlpha_=e.hasAlpha())},hasAlpha:{get:function(){var e,t;return null==this.get(r.PROPERTY_IMAGE_HAS_ALPHA)&&null==this.hasAlpha_&&this.computeHasAlpha(),(e=a.as(this.get(r.PROPERTY_IMAGE_HAS_ALPHA),"Bool"))||null!=e?e:!(!(t=this.hasAlpha_)&&null==t)&&t},set:function(e){this.hasAlpha_=null,this.set(r.PROPERTY_IMAGE_HAS_ALPHA,e)}},isMask:{get:function(){return this.getTag(r.IMAGE_MASK_ROLE_TAG)==r.ROLE_MASK}},hasAlphaSafe:{get:function(){return a.as(this.get(r.PROPERTY_IMAGE_HAS_ALPHA),"Bool")}},image:{get:function(){var e=this;return null==this.image_&&null!=this.url&&(this.image_=c.Host.imageAnalysis.createHostImage(this.url,this.hasAlphaSafe,this)),null==this.image_||this.isMask||null!=this.get(r.PROPERTY_FOCUS_REGION)||null==this.setFocusPromise_&&(this.setFocusPromise_=a.opt(this.image_,(function(t){return t.whenAsyncFeaturesLoaded().then((function(t){return e.setFocusPromise_=null,a.opt(e.database.appliedState,(function(t){return null!=t.getObjectStateByID(e.id)}))&&(e.focusRegion_=a.opt(e.image_,(function(e){return e.getFocus()}))),null}))}))),this.image_},set:function(e){this.image_=e}},hostImageLoaded:{get:function(){var e;return!!(e=this.image_)&&e.loaded()}},releaseResources:function(){this.image_=null},recreateImageAndFeatures:function(){var e=this;return this.image_=null,this.whenLoaded().then((function(t){var n;return(n=a.as(t,d.HostImage))&&(e.hasAlpha=n.hasAlpha(),e.pixelWidth=n.getWidth(),e.pixelHeight=n.getHeight(),e.isMask||(e.computeEdgeData(),e.computeSaliencyData(),e.computeFocusRegion()),e.computeTrimmedBounds()),t}))},copyTo:function(e){var t;return(t=a.as(e.content.createNode(r.KIND,null),r))?(s.CreationFacade.addContentNodeToDocument(t,e),t.match(this),t):null},componentID:{get:function(){return g.URLBasedContentNode._getters.componentID.call(this)},set:function(e){g.URLBasedContentNode._setters.componentID.call(this,e),this.onSourceUpdated()}},url:{get:function(){return g.URLBasedContentNode._getters.url.call(this)},set:function(e){g.URLBasedContentNode._setters.url.call(this,e),this.onSourceUpdated()}},didChangeState:function(e){g.URLBasedContentNode.prototype.didChangeState.call(this,e);var t=a.keys(e);(t.includes(g.URLBasedContentNode.PROPERTY_DATA_URL)||t.includes(g.URLBasedContentNode.PROPERTY_COMPONENT_URL)||t.includes(g.URLBasedContentNode.PROPERTY_COMPONENT_ID)||t.includes(g.URLBasedContentNode.PROPERTY_COMPONENTS))&&this.onSourceUpdated()},onSourceUpdated:function(){this.publish(new i.ImageContentChangedMessage(this))}}}),r),i.ImageContentChangedMessage=(o=function e(t){this.model=t,f.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"ImageContentChangedMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ImageContentChangedMessage"}}}}),o)},qSCS:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("SpAV"),s=n("HRWw"),l=n("fNpk"),u=n("VkKB");o.URLBasedContentNode=(r=function(){this.remappedUrl_=null},i.defineClass({name:"URLBasedContentNode",ctor:r,superName:"ContentNode",statics:{SCHEMA_CLASS_NAME:{get:function(){return"URLBasedContentNode"}},DATA_URL_PREFIX:"data:",PROPERTY_DATA_URL:"data-url",PROPERTY_MIMETYPE:"mimetype",PROPERTY_MEDIA_METADATA:"media-metadata",PROPERTY_SPARK_ELEMENTID:"element-id",PROPERTY_SPARK_ROLES:"roles",PROPERTY_LOCAL_IDENTIFIER:"local-identifier",PROPERTY_COMPONENTS:"components",PROPERTY_COMPONENT_URL:"url",PROPERTY_COMPONENT_MIMETYPE:"mimeType",PROPERTY_COMPONENT_ID:"id",DO_NOT_LOAD_DATA_URL:"do-not-load",ACP_PREFIX:"acp:",CP_PREFIX:"cp:",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_3144,e,t,n,r)},init_5e75:function(e,t,n,r){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_5e75,e,t,n,r)},init_8b5c:function(e,t,n){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_8b5c,e,t,n)},init_c3fa:function(e,t,n){i.super_init(this,s.ContentNode,s.ContentNode.prototype.init_c3fa,e,t,n)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},setDoNotLoadURL:function(){var e;(e=i.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&1==e.length&&(this.url=r.DO_NOT_LOAD_DATA_URL)},saveComponentDescription:function(e,t,n){var o,a,s,u,c,d=(o=e)||null!=o?o:(a=this.componentID)||null!=a?a:this.id,h=(s=t)||null!=s?s:this.url,p=(u=n)||null!=u?u:this.mimeType,f={};(c=i.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&(l.LegacyCoreAssert.isTrue(1==c.length,"Expecting only one component",void 0,"URLBasedContentNode.saveComponentDescription","URLBasedContentNode.swift",74),c.length>0&&(f=i.clone(c[0]))),f[r.PROPERTY_COMPONENT_ID]=d,null!=h&&(f[r.PROPERTY_COMPONENT_URL]=h),null!=p&&(f[r.PROPERTY_COMPONENT_MIMETYPE]=p),this.set(r.PROPERTY_COMPONENTS,[f])},url:{get:function(){var e,t=i.as(this.get(r.PROPERTY_DATA_URL),"String");return null==t&&(e=i.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&e.length>0&&(t=i.as(e[0][r.PROPERTY_COMPONENT_URL],"String")),t},set:function(e){null==e?(this.set(r.PROPERTY_DATA_URL,null),this.set(r.PROPERTY_COMPONENTS,null)):e.startsWith(r.DATA_URL_PREFIX)?(this.set(r.PROPERTY_DATA_URL,e),this.set(r.PROPERTY_COMPONENTS,null)):(this.saveComponentDescription(null,e,null),this.set(r.PROPERTY_DATA_URL,null))}},componentID:{get:function(){var e,t;return(t=i.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&(l.LegacyCoreAssert.isTrue(1==t.length,"componentID components count not equal 1.",{count:t.length},"URLBasedContentNode","URLBasedContentNode.swift",142),t.length>0&&(e=i.as(t[0][r.PROPERTY_COMPONENT_ID],"String"))),e},set:function(e){this.saveComponentDescription(e,null,null)}},mimeType:{get:function(){return i.as(this.get(r.PROPERTY_MIMETYPE),"String")},set:function(e){this.set(r.PROPERTY_MIMETYPE,e),null!=i.as(this.get(r.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]])&&this.saveComponentDescription(null,null,e)}},remappedUrl:{get:function(){return this.remappedUrl_},set:function(e){var t,n=i.opt(this.url,(function(e){return 1==e.startsWith(r.ACP_PREFIX)}));a.CoreAssertDebugOnly.isTrue(n,"Recording remapped URL for non-ACP url",{url:(t=this.url)||null!=t?t:"nil"},"URLBasedContentNode","URLBasedContentNode.swift",176),this.remappedUrl_=e}},sparkRoles:{get:function(){return i.as(this.get(r.PROPERTY_SPARK_ROLES),["Array","String"])}},setRoles:function(e){this.set(r.PROPERTY_SPARK_ROLES,e)},clearRoles:function(){this.set(r.PROPERTY_SPARK_ROLES,null)},getSparkLogoRole:function(){var e;if(e=this.sparkRoles)for(var t=i.iter(e);!t.done;t.next()){var n=t.value;switch(n){case"primary-logo":case"secondary-logo":return n;default:continue}}return null},sparkElementID:{get:function(){return i.as(this.get(r.PROPERTY_SPARK_ELEMENTID),"String")},set:function(e){this.set(r.PROPERTY_SPARK_ELEMENTID,e)}},mediaMetadata:{get:function(){return i.as(this.get(r.PROPERTY_MEDIA_METADATA),u.MediaMetadata)},set:function(e){this.set(r.PROPERTY_MEDIA_METADATA,e)}},localIdentifier:{get:function(){return i.as(this.get(r.PROPERTY_LOCAL_IDENTIFIER),"String")},set:function(e){this.set(r.PROPERTY_LOCAL_IDENTIFIER,e)}},match:function(e,t){var n;void 0===t&&(t=null);var o=i.clone(t),a=(n=i.opt(i.as(e,r),(function(e){return e.url})))||null!=n?n:"",l=a.startsWith(r.ACP_PREFIX),u=a.startsWith(r.CP_PREFIX);(a==r.DO_NOT_LOAD_DATA_URL||l||u)&&(o=(t||[]).concat([r.PROPERTY_COMPONENTS])),s.ContentNode.prototype.match.call(this,e,o),(l||u)&&(this.url=a)}}}),r)},qTtJ:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("URxh"),s=n("tGKA"),l=n("K17h"),u=n("RkYL"),c=n("xm77");o.MotionSrcFadeIn=(r=function(){},i.defineClass({name:"MotionSrcFadeIn",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=u.TheoTime.Zero,r=u.TheoTime.fromSeconds(1),o=s.Matrix2D.Identity,i=s.Matrix2D.Identity,d=l.MotionUtils.createOpacityStyle(e,0),h=e.style.clone();return t.push(new a.KeyFrame(n,c.TimingFunctionType.Linear,o,null,d)),t.push(new a.KeyFrame(r,c.TimingFunctionType.Linear,i,null,h)),t}}}),r)},qsM9:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("dJuF"),l=n("URxh"),u=n("QgZx"),c=n("ylxa"),d=n("QbzR"),h=n("tQF8"),p=n("iCxV"),f=n("3lr5"),m=n("Qlvz"),g=n("REQJ"),y=n("fNpk"),_=n("tGKA"),T=n("VkKB"),v=n("Zifs"),C=n("byfQ"),P=n("umUn"),S=n("9YN4"),D=n("VJ9E"),A=n("BgH2"),E=n("hgLm"),R=n("oKlP"),F=n("uUew"),b=n("sIWg"),I=n("1NAc"),O=n("RkYL"),k=n("xm77");o.Codecs=(r=function(){},i.defineClass({name:"Codecs",ctor:r,statics:{solidColorCodec:{get:function(){return s.DBPropertyCodec.typeCodec("SolidColor")||s.DBPropertyCodec.registerCodec("SolidColor",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=i.as(t,v.SolidColor)){var a={red:s.DBProperty.doubleProperty(e.append("red"),r.red),green:s.DBProperty.doubleProperty(e.append("green"),r.green),blue:s.DBProperty.doubleProperty(e.append("blue"),r.blue),alpha:s.DBProperty.doubleProperty(e.append("alpha"),r.alpha)};o=s.DBProperty.dictEncoded(e,a,"SolidColor")}else y.LegacyCoreAssert.fail("Expected SolidColor",{actual:t},"Codecs","Codecs.swift",25);return o}),(function(e,t){if(null!=e){var n,r,o,a,s;if((n=i.opt(e,(function(e){return e.dictionaryValue})))&&null!=(r=i.opt(n.red,(function(e){return e.doubleValue})))&&null!=(o=i.opt(n.green,(function(e){return e.doubleValue})))&&null!=(a=i.opt(n.blue,(function(e){return e.doubleValue})))&&null!=(s=i.opt(n.alpha,(function(e){return e.doubleValue}))))return new v.SolidColor(r,o,a,s);y.LegacyCoreAssert.fail("Expected a color dictionary.",void 0,"Codecs","Codecs.swift",39)}return null}),"SolidColor"))}},theoColorCodec:{get:function(){var e=this;return s.DBPropertyCodec.typeCodec("TheoColor")||s.DBPropertyCodec.registerCodec("TheoColor",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=i.as(t,P.TheoColor)){var a={red:s.DBProperty.doubleProperty(e.append("red"),r.rgbColor.red),green:s.DBProperty.doubleProperty(e.append("green"),r.rgbColor.green),blue:s.DBProperty.doubleProperty(e.append("blue"),r.rgbColor.blue),alpha:s.DBProperty.doubleProperty(e.append("alpha"),r.rgbColor.alpha)},l=[];if(null!=r.sparkRoles)for(var u=i.iter(i.toSequence(r.sparkRoles));!u.done;u.next()){var c=u.value,d=c.offset,h=c.element;l.push(s.DBProperty.stringProperty(e.append("sparkRoles").append(i.toString(d)),h))}0==!l.length&&(a.sparkRoles=s.DBProperty.arrayProperty(e.append("sparkRoles"),l)),null!=r.sparkElementID&&(a.sparkElementID=s.DBProperty.stringProperty(e.append("sparkElementID"),r.sparkElementID)),o=s.DBProperty.dictEncoded(e,a,"TheoColor")}else y.LegacyCoreAssert.fail("Expected TheoColor",{actual:t},"Codecs","Codecs.swift",73);return o}),(function(t,n){if(null!=t){var r,o,a,s,l;if((r=i.opt(t,(function(e){return e.dictionaryValue})))&&null!=(o=i.opt(r.red,(function(e){return e.doubleValue})))&&null!=(a=i.opt(r.green,(function(e){return e.doubleValue})))&&null!=(s=i.opt(r.blue,(function(e){return e.doubleValue})))&&null!=(l=i.opt(r.alpha,(function(e){return e.doubleValue})))){var u=i.clone(i.opt(i.opt(r.sparkRoles,(function(e){return e.arrayValue})),(function(t){return t.map((function(e){return e.stringValue}),e)}))),c=i.opt(r.sparkElementID,(function(e){return e.stringValue}));return P.TheoColor.init_5344(new v.SolidColor(o,a,s,l),c,u)}y.LegacyCoreAssert.fail("Expected a color dictionary.",void 0,"Codecs","Codecs.swift",89)}return null}),"TheoColor"))}},paletteIDCodec:{get:function(){return s.DBPropertyCodec.typeCodec("PaletteID")||s.DBPropertyCodec.registerCodec("PaletteID",s.DBPropertyCodec.codec((function(e,t,n){var r,o,a=s.DBProperty.deleted(e);return null!=(r=i.as(t,"String"))?a=s.DBProperty.stringProperty(e,r):null!=(o=i.as(t,"Int"))&&(a=s.DBProperty.stringProperty(e,i.toString(o))),a}),(function(e,t){if(null!=e){var n,r;if(null!=(n=i.opt(e,(function(e){return e.stringValue}))))return n;if(null!=(r=i.opt(e,(function(e){return e.intValue}))))return i.toString(r)}return""}),"PaletteID"))}},theoTimeCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoTime")||s.DBPropertyCodec.registerCodec("TheoTime",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=i.as(t,O.TheoTime))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.intProperty(e.append("0"),r.value),s.DBProperty.intProperty(e.append("1"),r.timescale)])),o}),(function(e,t){if(null!=e){var n;if((n=i.opt(e,(function(e){return e.arrayValue})))&&2==n.length){var r=n[0].intValue,o=n[1].intValue;if(null!=r&&null!=o)return new O.TheoTime(r,o)}y.LegacyCoreAssert.fail("Expected an array of 2 ints.",void 0,"Codecs","Codecs.swift",142)}return null}),"TheoTime"))}},theoSizeCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoSize")||s.DBPropertyCodec.registerCodec("TheoSize",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=i.as(t,I.TheoSize))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.doubleProperty(e.append("0"),r.width),s.DBProperty.doubleProperty(e.append("1"),r.height)])),o}),(function(e,t){if(null!=e){var n;if((n=i.opt(e,(function(e){return e.arrayValue})))&&2==n.length){var r=n[0].doubleValue,o=n[1].doubleValue;if(null!=r&&null!=o)return new I.TheoSize(r,o)}y.LegacyCoreAssert.fail("Expected an array of 2 doubles.",void 0,"Codecs","Codecs.swift",170)}return null}),"TheoSize"))}},theoPointCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoPoint")||s.DBPropertyCodec.registerCodec("TheoPoint",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=i.as(t,R.TheoPoint))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.doubleProperty(e.append("0"),r.x),s.DBProperty.doubleProperty(e.append("1"),r.y)])),o}),(function(e,t){if(null!=e){var n;if((n=i.opt(e,(function(e){return e.arrayValue})))&&2==n.length){var r=n[0].doubleValue,o=n[1].doubleValue;if(null!=r&&null!=o)return new R.TheoPoint(r,o)}y.LegacyCoreAssert.fail("Expected an array of 2 doubles.",void 0,"Codecs","Codecs.swift",198)}return null}),"TheoPoint"))}},theoRectCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoRect")||s.DBPropertyCodec.registerCodec("TheoRect",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=i.as(t,b.TheoRect))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.doubleProperty(e.append("0"),r.minX),s.DBProperty.doubleProperty(e.append("1"),r.minY),s.DBProperty.doubleProperty(e.append("2"),r.maxX),s.DBProperty.doubleProperty(e.append("3"),r.maxY)])),o}),(function(e,t){if(null!=e){var n,r;if(n=i.opt(e,(function(e){return e.arrayValue}))){if(4==n.length){var o=n[0].doubleValue,a=n[1].doubleValue,s=n[2].doubleValue,l=n[3].doubleValue;if(null!=o&&null!=a&&null!=s&&null!=l)return new b.TheoRect(o,a,s,l)}}else if(null!=(r=i.opt(e,(function(e){return e.stringValue})))){var u=r.split(",");if(4==u.length)return b.TheoRect.fromXXYY(i.toDouble(u[0]),i.toDouble(u[1]),i.toDouble(u[2]),i.toDouble(u[3]))}y.LegacyCoreAssert.fail("Expected a string or an array of 4 doubles.",void 0,"Codecs","Codecs.swift",233)}return null}),"TheoRect"))}},matrix2DCodec:{get:function(){return s.DBPropertyCodec.typeCodec("Matrix2D")||s.DBPropertyCodec.registerCodec("Matrix2D",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=i.as(t,_.Matrix2D))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.doubleProperty(e.append("0"),r.a),s.DBProperty.doubleProperty(e.append("1"),r.b),s.DBProperty.doubleProperty(e.append("2"),r.c),s.DBProperty.doubleProperty(e.append("3"),r.d),s.DBProperty.doubleProperty(e.append("4"),r.tx),s.DBProperty.doubleProperty(e.append("5"),r.ty)])),o}),(function(e,t){var n;if(n=i.opt(e,(function(e){return e.arrayValue})))if(6==n.length){var r=n[0].doubleValue,o=n[1].doubleValue,a=n[2].doubleValue,s=n[3].doubleValue,l=n[4].doubleValue,u=n[5].doubleValue;if(null!=r&&null!=o&&null!=a&&null!=s&&null!=l&&null!=u)return new _.Matrix2D(r,o,a,s,l,u)}else y.LegacyCoreAssert.fail("Expected an array of 6 numeric elements.",void 0,"Codecs","Codecs.swift",262);return _.Matrix2D.Identity}),"Matrix2D"))}},colorRoleCodec:{get:function(){return s.DBPropertyCodec.typeCodec("ColorRole")||s.DBPropertyCodec.registerCodec("ColorRole",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(null!=(r=i.as(t,a.ColorRole)))switch(r){case 3:o=s.DBProperty.stringProperty(e,"border");break;case 4:o=s.DBProperty.stringProperty(e,"shadow");break;case 1:o=s.DBProperty.stringProperty(e,"field-primary");break;case 2:o=s.DBProperty.stringProperty(e,"field-secondary");break;default:o=s.DBProperty.deleted(e)}return o}),(function(e,t){var n;if(null!=(n=i.opt(e,(function(e){return e.stringValue}))))switch(n){case"border":return a.ColorRole.Border;case"shadow":return a.ColorRole.Shadow;case"field-primary":return a.ColorRole.FieldPrimary;case"field-secondary":return a.ColorRole.FieldSecondary;default:return a.ColorRole.None}return a.ColorRole.None}),"ColorRole"))}},textRangeCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TextRange")||s.DBPropertyCodec.registerCodec("TextRange",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);return(r=i.as(t,F.TextRange))&&(o=s.DBProperty.arrayProperty(e,[s.DBProperty.intProperty(e.append("0"),r.start),s.DBProperty.intProperty(e.append("1"),r.end)])),o}),(function(e,t){var n;if(null!=e&&(n=i.opt(e,(function(e){return e.arrayValue})))){var r=n[0].intValue,o=n[1].intValue;if(null!=r&&null!=o)return new F.TextRange(r,o);y.LegacyCoreAssert.fail("TextRange decoder: Expected an array of 2 integers",void 0,"Codecs","Codecs.swift",317)}return null}),"TextRange"))}},gridCellCodec:{get:function(){return s.DBPropertyCodec.typeCodec("GridCell")||s.DBPropertyCodec.registerCodec("GridCell",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=i.as(t,h.GridCell)){var a,l=[s.DBPropertyCodec.typeCodec("TheoRect").encode(e.append("0"),r.bounds,null),s.DBProperty.doubleProperty(e.append("1"),r.opacity)];null!=(a=r.colorID)&&l.push(s.DBProperty.stringProperty(e.append("2"),a)),o=s.DBProperty.arrayProperty(e,l)}return o}),(function(e,t){var n;if(n=i.opt(e,(function(e){return e.arrayValue}))){var r=s.DBPropertyCodec.typeCodec("TheoRect").decode(n[0],t),o=n[1].doubleValue,a=n.length>2?n[2].stringValue:null;return new h.GridCell(r,a,o)}return null}),"GridCell"))}},fontDescriptorCodec:{get:function(){var e="FontDescriptor";return s.DBPropertyCodec.typeCodec(e)||s.DBPropertyCodec.registerCodec(e,s.DBPropertyCodec.codec((function(t,n,r){var o,a=s.DBProperty.deleted(t);return(o=i.as(n,u.FontDescriptor))&&(a=s.DBProperty.dictEncoded(t,i.dict(["postscript-name",s.DBProperty.stringProperty(t.append("postscript-name"),o.postScriptName)]),e)),a}),(function(e,t){var n,r;if((n=i.opt(e,(function(e){return e.dictionaryValue})))&&null!=(r=i.opt(n["postscript-name"],(function(e){return e.stringValue})))){var o=t.persisted?i.as(t.database.host,S.TheoDocument):f.ANY_DOCUMENT,a=p.Host.fontProvider.descriptorForPostScriptName(r,o);return p.Host.fontProvider.getIncludedFonts(o).contains(a)?a:p.Host.textModelUtils.defaultFont()}return null}),e))}},fontCodec:{get:function(){var e=this;return s.DBPropertyCodec.typeCodec("TheoFont")||s.DBPropertyCodec.registerCodec("TheoFont",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=i.as(t,D.TheoFont)){var a=[];if(null!=r.sparkRoles)for(var l=i.iter(i.toSequence(r.sparkRoles));!l.done;l.next()){var u=l.value,c=u.offset,d=u.element;a.push(s.DBProperty.stringProperty(e.append("sparkRoles").append(i.toString(c)),d))}var h=r.sparkElementID,p=i.dict(["postscript-name",s.DBProperty.stringProperty(e.append("postscript-name"),r.fontData.postScriptName)]);0==!a.length&&(p.sparkRoles=s.DBProperty.arrayProperty(e.append("sparkRoles"),a)),null!=h&&(p.sparkElementID=s.DBProperty.stringProperty(e.append("sparkElementID"),h)),o=s.DBProperty.dictEncoded(e,p,"TheoFont")}return o}),(function(t,n){var r,o;if((r=i.opt(t,(function(e){return e.dictionaryValue})))&&null!=(o=i.opt(r["postscript-name"],(function(e){return e.stringValue})))){var a,s=n.persisted?i.as(n.database.host,S.TheoDocument):f.ANY_DOCUMENT,l=p.Host.fontProvider.descriptorForPostScriptName(o,s),c=i.clone(i.opt(i.opt(r.sparkRoles,(function(e){return e.arrayValue})),(function(t){return t.map((function(e){return e.stringValue}),e)}))),d=i.opt(r.sparkElementID,(function(e){return e.stringValue}));return!n.persisted||l.postScriptName==o&&l.availability==u.FontAvailability.LOADED||(a=s)&&a.recordMissingFont(o),D.TheoFont.init_9e5c(l,d,c)}return null}),"TheoFont"))}},mediaMetadataCodec:{get:function(){return s.DBPropertyCodec.typeCodec("MediaMetadata")||s.DBPropertyCodec.registerCodec("MediaMetadata",s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=i.as(t,T.MediaMetadata)){var a,l,u,c,d,h,p,f,m,g,y,_,v,C,P,S,D,A={};null!=(a=r.searchSource)&&(A.source=s.DBProperty.stringProperty(e.append("source"),a)),null!=(l=r.searchTerm)&&(A.search=s.DBProperty.stringProperty(e.append("search"),l)),null!=(u=r.title)&&(A.photo_name=s.DBProperty.stringProperty(e.append("photo_name"),u)),null!=(c=r.tags)&&(A.tags=s.DBProperty.stringProperty(e.append("tags"),c)),null!=(d=r.licenseType)&&(A.type=s.DBProperty.stringProperty(e.append("type"),d)),null!=(h=r.sourceName)&&(A.source_name=s.DBProperty.stringProperty(e.append("source_name"),h)),null!=(p=r.sourceURL)&&(A.source_url=s.DBProperty.stringProperty(e.append("source_url"),p)),null!=(f=r.ownerName)&&(A.owner=s.DBProperty.stringProperty(e.append("owner"),f)),null!=(m=r.assetID)&&(A.asset_id=s.DBProperty.stringProperty(e.append("asset_id"),m)),null!=(g=r.creatorUserID)&&(A.creator_user_id=s.DBProperty.stringProperty(e.append("creator_user_id"),g)),null!=(y=r.creatorDisplayName)&&(A.creator_display_name=s.DBProperty.stringProperty(e.append("creator_display_name"),y)),null!=(_=r.designIntent)&&(A.design_intent=s.DBProperty.stringProperty(e.append("design_intent"),_)),null!=(v=r.libraryID)&&(A.library_id=s.DBProperty.stringProperty(e.append("library_id"),v)),null!=(C=r.libraryName)&&(A.library_name=s.DBProperty.stringProperty(e.append("library_name"),C)),null!=(P=r.createdDate)&&(A.created_date=s.DBProperty.doubleProperty(e.append("created_date"),P)),null!=(S=r.modifiedDate)&&(A.modified_date=s.DBProperty.doubleProperty(e.append("modified_date"),S)),null!=(D=r.searchProps)&&(A.search_props=s.DBProperty.stringProperty(e.append("search_props"),D)),o=s.DBProperty.dictEncoded(e,A,"MediaMetadata")}return o}),(function(e,t){var n;return(n=i.opt(e,(function(e){return e.dictionaryValue})))?T.MediaMetadata.init_4d41(i.opt(n.source,(function(e){return e.stringValue})),i.opt(n.search,(function(e){return e.stringValue})),i.opt(n.photo_name,(function(e){return e.stringValue})),i.opt(n.tags,(function(e){return e.stringValue})),i.opt(n.type,(function(e){return e.stringValue})),i.opt(n.source_url,(function(e){return e.stringValue})),i.opt(n.source_name,(function(e){return e.stringValue})),i.opt(n.owner,(function(e){return e.stringValue})),i.opt(n.asset_id,(function(e){return e.stringValue})),i.opt(n.creator_user_id,(function(e){return e.stringValue})),i.opt(n.creator_display_name,(function(e){return e.stringValue})),i.opt(n.design_intent,(function(e){return e.stringValue})),i.opt(n.library_id,(function(e){return e.stringValue})),i.opt(n.library_name,(function(e){return e.stringValue})),i.opt(n.created_date,(function(e){return e.doubleValue})),i.opt(n.modified_date,(function(e){return e.doubleValue})),i.opt(n.search_props,(function(e){return e.stringValue}))):null}),"MediaMetadata"))}},imageColorDataCodec:{get:function(){var e="ImageColorData";return s.DBPropertyCodec.typeCodec(e)||s.DBPropertyCodec.registerCodec(e,s.DBPropertyCodec.codec((function(t,n,r){var o,a=s.DBProperty.deleted(t);if(o=i.as(n,g.ImageColorData)){var l={red:s.DBProperty.doubleProperty(t.append("red"),o.rgbColor.red),green:s.DBProperty.doubleProperty(t.append("green"),o.rgbColor.green),blue:s.DBProperty.doubleProperty(t.append("blue"),o.rgbColor.blue),alpha:s.DBProperty.doubleProperty(t.append("alpha"),o.rgbColor.alpha),coverage:s.DBProperty.doubleProperty(t.append("coverage"),o.coverage)};a=s.DBProperty.dictEncoded(t,l,e)}else y.LegacyCoreAssert.fail("Expected TheoColor",{actual:n},"Codecs","Codecs.swift",546);return a}),(function(e,t){if(null!=e){var n,r,o,a,s,l;if((n=i.opt(e,(function(e){return e.dictionaryValue})))&&null!=(r=i.opt(n.red,(function(e){return e.doubleValue})))&&null!=(o=i.opt(n.green,(function(e){return e.doubleValue})))&&null!=(a=i.opt(n.blue,(function(e){return e.doubleValue})))&&null!=(s=i.opt(n.alpha,(function(e){return e.doubleValue})))&&null!=(l=i.opt(n.coverage,(function(e){return e.doubleValue}))))return new g.ImageColorData(new v.SolidColor(r,o,a,s),l);y.LegacyCoreAssert.fail("Expected a color dictionary.",void 0,"Codecs","Codecs.swift",561)}return null}),e))}},pathDictionary:function(e,t){return{type:s.DBProperty.stringProperty(e.append("type"),t.type),fillRule:s.DBProperty.stringProperty(e.append("fillRule"),t.pathFillType),endType:s.DBProperty.stringProperty(e.append("endType"),t.pathEndcapType),joinType:s.DBProperty.stringProperty(e.append("joinType"),t.pathJoinType),strokeWeight:s.DBProperty.doubleProperty(e.append("strokeWeight"),t.pathStrokeWeight),miterLimit:s.DBProperty.doubleProperty(e.append("miterLimit"),t.pathMiterLimit)}},pathProperties:function(e){return{type:i.opt(e.type,(function(e){return e.stringValue})),fill:i.opt(e.fillRule,(function(e){return e.stringValue})),end:i.opt(e.endType,(function(e){return e.stringValue})),join:i.opt(e.joinType,(function(e){return e.stringValue})),stroke:i.opt(e.strokeWeight,(function(e){return e.doubleValue})),miterLimit:i.opt(e.miterLimit,(function(e){return e.doubleValue}))}},pathCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoPathTypes")||s.DBPropertyCodec.registerCodec("TheoPathTypes",s.DBPropertyCodec.codec((function(e,t,n){var o=s.DBProperty.deleted(e);return t instanceof E.TheoEmptyPath?o=r.emptyPathCodec.encode(e,t,n):t instanceof E.TheoRectanglePath?o=r.rectanglePathCodec.encode(e,t,n):t instanceof E.TheoEllipsePath?o=r.ellipsePathCodec.encode(e,t,n):t instanceof E.TheoArbitraryPath?o=r.arbitraryPathCodec.encode(e,t,n):y.LegacyCoreAssert.fail("Unknown path type",{type:t},"Codecs","Codecs.swift",602),o}),(function(e,t){if(null!=e){var n;if(n=i.opt(e,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(i.opt(n.type,(function(e){return null!=e.stringValue})),"Missing path type",void 0,"Codecs","Codecs.swift",609);var o=n.type.stringValue;switch(o){case"empty":return r.emptyPathCodec.decode(e,t);case"rect":return r.rectanglePathCodec.decode(e,t);case"ellipse":return r.ellipsePathCodec.decode(e,t);case"arbitrary":return r.arbitraryPathCodec.decode(e,t);default:y.LegacyCoreAssert.fail("Unknown path type",{type:o},"Codecs","Codecs.swift",621)}return null}y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",625)}return null}),"TheoPathTypes"))}},emptyPathCodec:{get:function(){return s.DBPropertyCodec.typeCodec("TheoEmptyPath")||s.DBPropertyCodec.registerCodec("TheoEmptyPath",s.DBPropertyCodec.codec((function(e,t,n){var o,a=s.DBProperty.deleted(e);return(o=i.as(t,E.TheoEmptyPath))?a=s.DBProperty.dictEncoded(e,r.pathDictionary(e,o),"TheoEmptyPath"):y.LegacyCoreAssert.fail("Expected TheoEmptyPath",{actual:t},"Codecs","Codecs.swift",640),a}),(function(e,t){if(null!=e){var n;if(n=i.opt(e,(function(e){return e.dictionaryValue})))return y.LegacyCoreAssert.isTrue(i.opt(n.type,(function(e){return"empty"==e.stringValue})),"Expected an empty path",void 0,"Codecs","Codecs.swift",647),new E.TheoEmptyPath;y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",650)}return null}),"TheoEmptyPath"))}},rectanglePathCodec:{get:function(){var e,t,n,o,a,l="TheoRectanglePath";return s.DBPropertyCodec.typeCodec(l)||s.DBPropertyCodec.registerCodec(l,s.DBPropertyCodec.codec((function(e,t,n){var o,a=s.DBProperty.deleted(e);if(o=i.as(t,E.TheoRectanglePath)){var u=i.clone(r.pathDictionary(e,o));u.coords=r.theoRectCodec.encode(e.append("coords"),o.rect,n),a=s.DBProperty.dictEncoded(e,u,l)}else y.LegacyCoreAssert.fail("Expected TheoRectanglePath",{actual:t},"Codecs","Codecs.swift",667);return a}),(function(s,l){if(null!=s){var u;if(u=i.opt(s,(function(e){return e.dictionaryValue}))){var c,d=r.pathProperties(u),h=d.type,p=d.fill,f=d.end,m=d.join,g=d.stroke,_=d.miterLimit;return y.LegacyCoreAssert.isTrue("rect"==h,"Expected a rectangle path",void 0,"Codecs","Codecs.swift",675),(c=i.as(r.theoRectCodec.decode(u.coords,l),b.TheoRect))?new E.TheoRectanglePath(c,(e=p)||null!=e?e:E.TheoPath.PATHFILL_DEFAULT,(t=f)||null!=t?t:E.TheoPath.PATHEND_DEFAULT,(n=m)||null!=n?n:E.TheoPath.PATHJOIN_DEFAULT,(o=g)||null!=o?o:E.TheoPath.PATHSTROKE_DEFAULT,(a=_)||null!=a?a:E.TheoPath.PATHMITERLIMIT_DEFFAULT):(y.LegacyCoreAssert.fail("Expected a rectangle path dictionary.",void 0,"Codecs","Codecs.swift",679),null)}y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",682)}return null}),l))}},ellipsePathCodec:{get:function(){var e,t,n,o,a,l="TheoEllipsePath";return s.DBPropertyCodec.typeCodec(l)||s.DBPropertyCodec.registerCodec(l,s.DBPropertyCodec.codec((function(e,t,n){var o,a=s.DBProperty.deleted(e);if(o=i.as(t,E.TheoEllipsePath)){var u=i.clone(r.pathDictionary(e,o));u.coords=r.theoRectCodec.encode(e.append("coords"),o.rect,n),a=s.DBProperty.dictEncoded(e,u,l)}else y.LegacyCoreAssert.fail("Expected TheoEllipsePath",{actual:t},"Codecs","Codecs.swift",699);return a}),(function(s,l){if(null!=s){var u;if(u=i.opt(s,(function(e){return e.dictionaryValue}))){var c,d=r.pathProperties(u),h=d.type,p=d.fill,f=d.end,m=d.join,g=d.stroke,_=d.miterLimit;return y.LegacyCoreAssert.isTrue("ellipse"==h,"Expected an ellipse path",void 0,"Codecs","Codecs.swift",707),(c=i.as(r.theoRectCodec.decode(u.coords,l),b.TheoRect))?new E.TheoEllipsePath(c,(e=p)||null!=e?e:E.TheoPath.PATHFILL_DEFAULT,(t=f)||null!=t?t:E.TheoPath.PATHEND_DEFAULT,(n=m)||null!=n?n:E.TheoPath.PATHJOIN_DEFAULT,(o=g)||null!=o?o:E.TheoPath.PATHSTROKE_DEFAULT,(a=_)||null!=a?a:E.TheoPath.PATHMITERLIMIT_DEFFAULT):(y.LegacyCoreAssert.fail("Expected an ellipse path dictionary.",void 0,"Codecs","Codecs.swift",711),null)}y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",714)}return null}),l))}},arbitraryPathCodec:{get:function(){var e,t,n,o,a,l="TheoArbitraryPath";return s.DBPropertyCodec.typeCodec(l)||s.DBPropertyCodec.registerCodec(l,s.DBPropertyCodec.codec((function(e,t,n){var o,a=s.DBProperty.deleted(e);if(o=i.as(t,E.TheoArbitraryPath)){var u=i.clone(r.pathDictionary(e,o)),c=i.clone(E.TheoPathBuilder.getEncodedOperations(e.append("ops"),o));u.ops=s.DBProperty.arrayProperty(e.append("ops"),c),a=s.DBProperty.dictEncoded(e,u,l)}else y.LegacyCoreAssert.fail("Expected TheoArbitraryPath",{actual:t},"Codecs","Codecs.swift",732);return a}),(function(s,l){if(null!=s){var u;if(u=i.opt(s,(function(e){return e.dictionaryValue}))){var c=r.pathProperties(u),d=c.type,h=c.fill,p=c.end,f=c.join,m=c.stroke,g=c.miterLimit;y.LegacyCoreAssert.isTrue("arbitrary"==d,"Expected an arbitrary path",void 0,"Codecs","Codecs.swift",740);var _=i.clone(i.opt(u.ops,(function(e){return e.arrayValue})));return null!=_?E.TheoPathBuilder.init_7691(_,(e=h)||null!=e?e:E.TheoPath.PATHFILL_DEFAULT,(t=p)||null!=t?t:E.TheoPath.PATHEND_DEFAULT,(n=f)||null!=n?n:E.TheoPath.PATHJOIN_DEFAULT,(o=m)||null!=o?o:E.TheoPath.PATHSTROKE_DEFAULT,(a=g)||null!=a?a:E.TheoPath.PATHMITERLIMIT_DEFFAULT).path:(y.LegacyCoreAssert.fail("Expected an arbitrary path dictionary.",void 0,"Codecs","Codecs.swift",745),null)}y.LegacyCoreAssert.fail("Expected a path dictionary.",void 0,"Codecs","Codecs.swift",748)}return null}),l))}},artworkNodeCodec:{get:function(){var e="TheoArtworkNodeTypes";return s.DBPropertyCodec.typeCodec(e)||s.DBPropertyCodec.registerCodec(e,s.DBPropertyCodec.codec((function(e,t,n){var o=s.DBProperty.deleted(e);return t instanceof C.TheoArtworkShape?o=r.artworkShapeCodec.encode(e,t,n):t instanceof C.TheoArtworkClipGroup?o=r.artworkClipGroupCodec.encode(e,t,n):t instanceof C.TheoArtworkGroup?o=r.artworkGroupCodec.encode(e,t,n):y.LegacyCoreAssert.fail("Unknown artwork type",{actual:t},"Codecs","Codecs.swift",766),o}),(function(e,t){if(null!=e){var n;if(n=i.opt(e,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(i.opt(n[C.TheoArtworkNode.PROPERTY_TYPE],(function(e){return null!=e.stringValue})),"Missing artwork type",void 0,"Codecs","Codecs.swift",773);var o=n[C.TheoArtworkNode.PROPERTY_TYPE].stringValue;switch(o){case"shape":return r.artworkShapeCodec.decode(e,t);case"group":return r.artworkGroupCodec.decode(e,t);case"clip-group":return r.artworkClipGroupCodec.decode(e,t);default:y.LegacyCoreAssert.fail("Unknown artwork type",{artworkType:o},"Codecs","Codecs.swift",783)}return null}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",787)}return null}),e))}},artworkShapeCodec:{get:function(){var e,t,n,o=this,l="TheoArtworkShape";return s.DBPropertyCodec.typeCodec(l)||s.DBPropertyCodec.registerCodec(l,s.DBPropertyCodec.codec((function(e,t,n){var a,u=s.DBProperty.deleted(e);if(a=i.as(t,C.TheoArtworkShape)){var c=s.DBProperty.stringProperty(e.append(C.TheoArtworkNode.PROPERTY_UID),a.uid),d=s.DBProperty.stringProperty(e.append(C.TheoArtworkNode.PROPERTY_TYPE),a.type),h=r.colorRoleCodec.encode(e.append(C.TheoArtworkNode.PROPERTY_FILLCOLORROLE),a.fillColorRole,n),p=r.colorRoleCodec.encode(e.append(C.TheoArtworkNode.PROPERTY_STROKECOLORROLE),a.strokeColorRole,n),f=null!=a.fillColor?r.solidColorCodec.encode(e.append(C.TheoArtworkNode.PROPERTY_FILLCOLOR),a.fillColor,n):null,m=null!=a.strokeColor?r.solidColorCodec.encode(e.append(C.TheoArtworkNode.PROPERTY_STROKECOLOR),a.strokeColor,n):null,g=s.DBProperty.doubleProperty(e.append(C.TheoArtworkNode.PROPERTY_STROKEWIDTH),a.strokeWidth),_=null!=a.overrideBounds?r.theoRectCodec.encode(e.append(C.TheoArtworkNode.PROPERTY_OVERRIDE_BOUNDS),a.overrideBounds,n):null,T=i.toSequence(a.paths).map((function(t){return r.pathCodec.encode(e.append(C.TheoArtworkNode.PROPERTY_PATHS).append(i.toString(t.offset)),t.element,n)}),o),v={"immutable-id":c,type:d,paths:s.DBProperty.arrayProperty(e.append(C.TheoArtworkNode.PROPERTY_PATHS),T),"fill-color-role":h,"stroke-color-role":p,"stroke-width":g};null!=f&&(v[C.TheoArtworkNode.PROPERTY_FILLCOLOR]=f),null!=m&&(v[C.TheoArtworkNode.PROPERTY_STROKECOLOR]=m),null!=_&&(v[C.TheoArtworkNode.PROPERTY_OVERRIDE_BOUNDS]=_),u=s.DBProperty.dictEncoded(e,v,l)}else y.LegacyCoreAssert.fail("Expected TheoArtworkShape",{actual:t},"Codecs","Codecs.swift",823);return u}),(function(s,l){if(null!=s){var u;if(u=i.opt(s,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(i.opt(u[C.TheoArtworkNode.PROPERTY_TYPE],(function(e){return"shape"==e.stringValue})),"Expected a shape node",void 0,"Codecs","Codecs.swift",830);var c=i.opt(u[C.TheoArtworkNode.PROPERTY_UID],(function(e){return e.stringValue})),d=i.as(r.solidColorCodec.decode(u[C.TheoArtworkNode.PROPERTY_FILLCOLOR],l),v.SolidColor),h=(e=i.as(r.colorRoleCodec.decode(u[C.TheoArtworkNode.PROPERTY_FILLCOLORROLE],l),a.ColorRole))||null!=e?e:a.ColorRole.None,p=i.as(r.solidColorCodec.decode(u[C.TheoArtworkNode.PROPERTY_STROKECOLOR],l),v.SolidColor),f=(t=i.as(r.colorRoleCodec.decode(u[C.TheoArtworkNode.PROPERTY_STROKECOLORROLE],l),a.ColorRole))||null!=t?t:a.ColorRole.None,m=(n=i.opt(u[C.TheoArtworkNode.PROPERTY_STROKEWIDTH],(function(e){return e.doubleValue})))||null!=n?n:0,g=i.as(r.theoRectCodec.decode(u[C.TheoArtworkNode.PROPERTY_OVERRIDE_BOUNDS],l),b.TheoRect),_=i.as(r.pathCodec.decode(u[C.TheoArtworkNode.PROPERTY_PATH],l),E.TheoPath),T=i.clone(null!=_?[_]:u[C.TheoArtworkNode.PROPERTY_PATHS].arrayValue.map((function(e){return r.pathCodec.decode(e,l)}),o));return C.TheoArtworkShape.init_d1d0(c,T,h,f,d,p,m,g)}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",842)}return null}),l))}},artworkGroupCodec:{get:function(){var e=this,t="TheoArtworkGroup";return s.DBPropertyCodec.typeCodec(t)||s.DBPropertyCodec.registerCodec(t,s.DBPropertyCodec.codec((function(n,o,a){var l,u=s.DBProperty.deleted(n);if(l=i.as(o,C.TheoArtworkGroup)){var c=s.DBProperty.stringProperty(n.append(C.TheoArtworkNode.PROPERTY_UID),l.uid),d=s.DBProperty.stringProperty(n.append(C.TheoArtworkNode.PROPERTY_TYPE),l.type),h=i.toSequence(l.children).map((function(e){return r.artworkNodeCodec.encode(n.append(C.TheoArtworkNode.PROPERTY_CHILD_NODES).append(i.toString(e.offset)),e.element,a)}),e),p={"immutable-id":c,type:d,nodes:s.DBProperty.arrayProperty(n.append(C.TheoArtworkNode.PROPERTY_CHILD_NODES),h)};u=s.DBProperty.dictEncoded(n,p,t)}else y.LegacyCoreAssert.fail("Expected TheoArtworkGroup",{actual:o},"Codecs","Codecs.swift",861);return u}),(function(t,n){if(null!=t){var o;if(o=i.opt(t,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(i.opt(o[C.TheoArtworkNode.PROPERTY_TYPE],(function(e){return"group"==e.stringValue})),"Expected a group node",void 0,"Codecs","Codecs.swift",868);var a=i.opt(o[C.TheoArtworkNode.PROPERTY_UID],(function(e){return e.stringValue})),s=i.clone(i.opt(o[C.TheoArtworkNode.PROPERTY_CHILD_NODES],(function(e){return e.arrayValue}))||o[C.TheoArtworkNode.PROPERTY_NODES].arrayValue).map((function(e){return r.artworkNodeCodec.decode(e,n)}),e);return new C.TheoArtworkGroup(a,s)}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",874)}return null}),t))}},artworkClipGroupCodec:{get:function(){var e=this,t="TheoArtworkClipGroup";return s.DBPropertyCodec.typeCodec(t)||s.DBPropertyCodec.registerCodec(t,s.DBPropertyCodec.codec((function(n,o,a){var l,u=s.DBProperty.deleted(n);if(l=i.as(o,C.TheoArtworkClipGroup)){var c=s.DBProperty.stringProperty(n.append(C.TheoArtworkNode.PROPERTY_UID),l.uid),d=s.DBProperty.stringProperty(n.append(C.TheoArtworkNode.PROPERTY_TYPE),l.type),h=r.pathCodec.encode(n.append(C.TheoArtworkNode.PROPERTY_PATH),l.path,a),p=i.toSequence(l.children).map((function(e){return r.artworkNodeCodec.encode(n.append(C.TheoArtworkNode.PROPERTY_CHILD_NODES).append(i.toString(e.offset)),e.element,a)}),e),f={"immutable-id":c,type:d,path:h,nodes:s.DBProperty.arrayProperty(n.append(C.TheoArtworkNode.PROPERTY_CHILD_NODES),p)};u=s.DBProperty.dictEncoded(n,f,t)}else y.LegacyCoreAssert.fail("Expected TheoArtworkClipGroup",{actual:o},"Codecs","Codecs.swift",893);return u}),(function(t,n){if(null!=t){var o;if(o=i.opt(t,(function(e){return e.dictionaryValue}))){y.LegacyCoreAssert.isTrue(i.opt(o[C.TheoArtworkNode.PROPERTY_TYPE],(function(e){return"clip-group"==e.stringValue})),"Expected a clip group node",void 0,"Codecs","Codecs.swift",900);var a=i.opt(o[C.TheoArtworkNode.PROPERTY_UID],(function(e){return e.stringValue})),s=r.pathCodec.decode(o[C.TheoArtworkNode.PROPERTY_PATH],n),l=i.clone(i.opt(o[C.TheoArtworkNode.PROPERTY_CHILD_NODES],(function(e){return e.arrayValue}))||o[C.TheoArtworkNode.PROPERTY_NODES].arrayValue).map((function(e){return r.artworkNodeCodec.decode(e,n)}),e);return new C.TheoArtworkClipGroup(a,l,s)}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",907)}return null}),t))}},pageExportDataCodec:{get:function(){var e,t="FormaPageExportData";return s.DBPropertyCodec.typeCodec(t)||s.DBPropertyCodec.registerCodec(t,s.DBPropertyCodec.codec((function(e,n,o){var a,l=s.DBProperty.deleted(e);if(a=i.as(n,c.FormaPageExportData)){var u={dimensions:r.theoSizeCodec.encode(e.append(c.FormaPageExportData.PROPERTY_DIMENSIONS),a.dimensions,o),format:s.DBProperty.intProperty(e.append(c.FormaPageExportData.PROPERTY_FORMAT),a.format)};null!=a.ppi&&(u[c.FormaPageExportData.PROPERTY_PPI]=s.DBProperty.doubleProperty(e.append(c.FormaPageExportData.PROPERTY_PPI),a.ppi)),l=s.DBProperty.dictEncoded(e,u,t)}else y.LegacyCoreAssert.fail("Expected FormaPageExportData",{actual:n},"Codecs","Codecs.swift",928);return l}),(function(t,n){if(null!=t){var o;if(o=i.opt(t,(function(e){return e.dictionaryValue}))){var a=r.theoSizeCodec.decode(o[c.FormaPageExportData.PROPERTY_DIMENSIONS],n),s=o[c.FormaPageExportData.PROPERTY_FORMAT].intValue,l=i.opt(o[c.FormaPageExportData.PROPERTY_PPI],(function(e){return e.doubleValue}));return new c.FormaPageExportData(a,(e=c.PageExportFormat.toCaseValue(s))||null!=e?e:c.PageExportFormat.PIXELS,l)}y.LegacyCoreAssert.fail("Expected an artwork dictionary.",void 0,"Codecs","Codecs.swift",940)}return null}),t))}},keyFrameCodec:{get:function(){var e,t;return s.DBPropertyCodec.typeCodec("KeyFrame")||s.DBPropertyCodec.registerCodec("KeyFrame",s.DBPropertyCodec.codec((function(e,t,n){var o,a=s.DBProperty.deleted(e);if(o=i.as(t,l.KeyFrame)){var u,c,h=i.dict(["start-time",r.theoTimeCodec.encode(e.append("start-time"),o.time,n),"timing-function",s.DBProperty.stringProperty(e.append("timing-function"),o.timingFunction),"placement",r.matrix2DCodec.encode(e.append("placement"),o.placement,n)]);(u=o.bounds)&&(h.bounds=r.theoRectCodec.encode(e.append("bounds"),u,n)),(c=o.style)&&(h.style=d.FormaStyle.codec.encode(e.append("style"),c,n)),a=s.DBProperty.dictEncoded(e,h,"KeyFrame")}else(h=i.as(t,["Dictionary","String",s.DBProperty]))?a=s.DBProperty.dictEncoded(e,h,"KeyFrame"):y.LegacyCoreAssert.fail("Expected KeyFrame",{actual:t},"Codecs","Codecs.swift",972);return a}),(function(n,o){if(null!=n){var a;if(a=i.opt(n,(function(e){return e.dictionaryValue}))){for(var s=i.iter(a);!s.done;s.next()){var u=s.key;s.value.reroot(n.namePath.append(u))}var c,h=r.theoTimeCodec.decode(a["start-time"],o),p=(e=k.TimingFunctionType.toCaseValue((t=i.opt(a["timing-function"],(function(e){return e.stringValue})))||null!=t?t:""))||null!=e?e:k.TimingFunctionType.EaseInOut,f=r.matrix2DCodec.decode(a.placement,o),m=i.as(d.FormaStyle.codec.decode(a.style,o),d.FormaStyle),g=null;return(c=a.bounds)&&(g=i.as(r.theoRectCodec.decode(c,o),b.TheoRect)),new l.KeyFrame(h,p,f,g,m)}y.LegacyCoreAssert.fail("Expected a KeyFrame dictionary.",void 0,"Codecs","Codecs.swift",993)}return null}),"KeyFrame"))}},imageAdjustmentsCodec:{get:function(){var e,t,n,r,o,a,l,u,c,d,h,p,f="ImageAdjustments";return s.DBPropertyCodec.typeCodec(f)||s.DBPropertyCodec.registerCodec(f,s.DBPropertyCodec.codec((function(e,t,n){var r,o=s.DBProperty.deleted(e);if(r=i.as(t,m.ImageAdjustments)){var a=i.dict(["blur",s.DBProperty.doubleProperty(e.append("blur"),r.blur),"sharpness",s.DBProperty.doubleProperty(e.append("sharpness"),r.sharpness),"shadows",s.DBProperty.doubleProperty(e.append("shadows"),r.shadows),"highlights",s.DBProperty.doubleProperty(e.append("highlights"),r.highlights),"saturation",s.DBProperty.doubleProperty(e.append("saturation"),r.saturation),"brightness",s.DBProperty.doubleProperty(e.append("brightness"),r.brightness),"exposure",s.DBProperty.doubleProperty(e.append("exposure"),r.exposure),"contrast",s.DBProperty.doubleProperty(e.append("contrast"),r.contrast),"warmth",s.DBProperty.doubleProperty(e.append("warmth"),r.warmth),"tint",s.DBProperty.doubleProperty(e.append("tint"),r.tint),"fade",s.DBProperty.doubleProperty(e.append("fade"),r.fade),"vibrance",s.DBProperty.doubleProperty(e.append("vibrance"),r.vibrance)]);o=s.DBProperty.dictEncoded(e,a,f)}else y.LegacyCoreAssert.fail("Expected ImageAdjustments",{actual:t},"Codecs","Codecs.swift",1033);return o}),(function(s,f){if(null!=s){var g;if(g=i.opt(s,(function(e){return e.dictionaryValue})))return new m.ImageAdjustments((e=i.opt(g.blur,(function(e){return e.doubleValue})))||null!=e?e:0,(t=i.opt(g.sharpness,(function(e){return e.doubleValue})))||null!=t?t:0,(n=i.opt(g.shadows,(function(e){return e.doubleValue})))||null!=n?n:0,(r=i.opt(g.highlights,(function(e){return e.doubleValue})))||null!=r?r:0,(o=i.opt(g.saturation,(function(e){return e.doubleValue})))||null!=o?o:0,(a=i.opt(g.brightness,(function(e){return e.doubleValue})))||null!=a?a:0,(l=i.opt(g.exposure,(function(e){return e.doubleValue})))||null!=l?l:0,(u=i.opt(g.contrast,(function(e){return e.doubleValue})))||null!=u?u:0,(c=i.opt(g.warmth,(function(e){return e.doubleValue})))||null!=c?c:0,(d=i.opt(g.tint,(function(e){return e.doubleValue})))||null!=d?d:0,(h=i.opt(g.fade,(function(e){return e.doubleValue})))||null!=h?h:0,(p=i.opt(g.vibrance,(function(e){return e.doubleValue})))||null!=p?p:0);y.LegacyCoreAssert.fail("Expected a ImageAdjustments dictionary.",void 0,"Codecs","Codecs.swift",1053)}return null}),f))}},textPathSegmentCodec:{get:function(){var e="TextPathSegment";return s.DBPropertyCodec.typeCodec(e)||s.DBPropertyCodec.registerCodec(e,s.DBPropertyCodec.codec((function(t,n,o){var a,l=s.DBProperty.deleted(t);if(a=i.as(n,A.TextPathSegment)){var u={p0:r.theoPointCodec.encode(t.append(A.TextPathSegment.PROPERTY_P0),a.p0,o),p1:r.theoPointCodec.encode(t.append(A.TextPathSegment.PROPERTY_P1),a.p1,o),p2:r.theoPointCodec.encode(t.append(A.TextPathSegment.PROPERTY_P2),a.p2,o),p3:r.theoPointCodec.encode(t.append(A.TextPathSegment.PROPERTY_P3),a.p3,o)};l=s.DBProperty.dictEncoded(t,u,e)}else y.LegacyCoreAssert.fail("Expected TextPathSegment",{actual:n},"Codecs","Codecs.swift",1077);return l}),(function(e,t){if(null!=e){var n;if(n=i.opt(e,(function(e){return e.dictionaryValue}))){var o=r.theoPointCodec.decode(n[A.TextPathSegment.PROPERTY_P0],t),a=r.theoPointCodec.decode(n[A.TextPathSegment.PROPERTY_P1],t),s=r.theoPointCodec.decode(n[A.TextPathSegment.PROPERTY_P2],t),l=r.theoPointCodec.decode(n[A.TextPathSegment.PROPERTY_P3],t);return new A.TextPathSegment(o,a,s,l)}y.LegacyCoreAssert.fail("Expected path segment dictionary.",void 0,"Codecs","Codecs.swift",1090)}return null}),e))}},textPathCodec:{get:function(){var e=this;return s.DBPropertyCodec.typeCodec("TextPath")||s.DBPropertyCodec.registerCodec("TextPath",s.DBPropertyCodec.codec((function(t,n,o){var a,l=s.DBProperty.deleted(t);if(a=i.as(n,A.TextPath)){var u=s.DBProperty.doubleProperty(t.append(A.TextPath.PROPERTY_FLEX),a.flex),c=i.toSequence(a.segments).map((function(e){return r.textPathSegmentCodec.encode(t.append(A.TextPath.PROPERTY_SEGMENTS).append(i.toString(e.offset)),e.element,o)}),e),d={flex:u,segment:s.DBProperty.arrayProperty(t.append(A.TextPath.PROPERTY_SEGMENTS),c)};l=s.DBProperty.dictEncoded(t,d,"TextPath")}else y.LegacyCoreAssert.fail("Expected TextPath",{actual:n},"Codecs","Codecs.swift",1109);return l}),(function(t,n){if(null!=t){var o;if(o=i.opt(t,(function(e){return e.dictionaryValue}))){var a=o[A.TextPath.PROPERTY_FLEX].doubleValue,s=i.clone(o[A.TextPath.PROPERTY_SEGMENTS].arrayValue).map((function(e){return r.textPathSegmentCodec.decode(e,n)}),e);return new A.TextPath(s,a)}y.LegacyCoreAssert.fail("Expected text path dictionary.",void 0,"Codecs","Codecs.swift",1122)}return null}),"TextPath"))}}}}),r)},rxGp:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("gXiO");i.LogCategories=(r=function(){s.CoreObject.call(this)},o={},a.defineClass({name:"LogCategories",ctor:r,superName:"CoreObject",statics:{kLaunch:"Launch",kOSInfo:"OSInfo",kUnimplemented:"Unimplemented!",kDocList:"DocList",kDocListMemory:"DocListMemory",kTheoMessage:"TheoMessage",kTransaction:"Transaction",kUndoMgr:"UndoManager",kSaveMgr:"SaveManager",kDrag:"Drag",kTheoDocument:"TheoDocument",kDocPersistenceFactory:"DocPersistenceFactory",kEncode:"Encode",kDecode:"Decode",kMultibrand:"MultiBrand",kFont:"Font",kCollaboration:"Collaboration",kImage:"Image",kDocMetadata:"DocMetadata",kStockImage:"StockImage",kOrganizer:"Organizer",kDesignView:"DesignView",kDesignViewToken:"DesignViewToken",kCoachmark:"Coachmark",kAlert:"Alert",kAnalytics:"Analytics",kIconUsage:"IconUsage",kInApp:"InApp",kNewRelicAttributes:"NewRelicAttributes",kNewRelic:"NewRelic",kCCLibraries:"CCLibraries",categories:{get:function(){return void 0===o.categories&&(o.categories=a.dict([r.kLaunch,{enabled:!0,timed:!0},r.kOSInfo,{enabled:!1,timed:!1},r.kUnimplemented,{enabled:!0,timed:!1},r.kDocList,{enabled:!1,timed:!1},r.kDocListMemory,{enabled:!1,timed:!1},r.kTheoMessage,{enabled:!1,timed:!1},r.kTransaction,{enabled:!1,timed:!1},r.kUndoMgr,{enabled:!1,timed:!1},r.kSaveMgr,{enabled:!1,timed:!1},r.kDrag,{enabled:!1,timed:!1},r.kTheoDocument,{enabled:!1,timed:!1},r.kDocPersistenceFactory,{enabled:!1,timed:!1},r.kEncode,{enabled:!1,timed:!1},r.kDecode,{enabled:!1,timed:!1},r.kMultibrand,{enabled:!1,timed:!1},r.kFont,{enabled:!1,timed:!1},r.kCollaboration,{enabled:!1,timed:!1},r.kImage,{enabled:!1,timed:!1},r.kDocMetadata,{enabled:!1,timed:!1},r.kStockImage,{enabled:!1,timed:!1},r.kOrganizer,{enabled:!1,timed:!0},r.kDesignView,{enabled:!1,timed:!0},r.kDesignViewToken,{enabled:!1,timed:!1},r.kCoachmark,{enabled:!1,timed:!1},r.kAlert,{enabled:!1,timed:!1},r.kAnalytics,{enabled:!1,timed:!1},r.kIconUsage,{enabled:!1,timed:!1},r.kInApp,{enabled:!1,timed:!1},r.kNewRelicAttributes,{enabled:!1,timed:!1},r.kNewRelic,{enabled:!1,timed:!1},r.kCCLibraries,{enabled:!1,timed:!1}])),o.categories},set:function(e){o.categories=e}}}}),r)},"s/Zj":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO");o.MoaTransform=(r=function(){this.transformMatrix_=[],this.identityTransform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},i.defineClass({name:"MoaTransform",ctor:r,superName:"CoreObject",props:{init_d41d:function(){a.CoreObject.call(this),this.copy(this.identityTransform)},init_8c4b:function(e){a.CoreObject.call(this),this.copy(e)},transformMatrix:{get:function(){return this.transformMatrix_}},setIdentity:function(){this.transformMatrix_=i.clone(this.identityTransform)},copy:function(e){this.transformMatrix_=i.clone(e)},preRotateX:function(e){var t=r.init_8c4b([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1]);this.preTransform(t)},preTransform:function(e){var t=r.init_d41d();t.copy(this.transformMatrix),this.matrixMultiply(e,t)},matrixMultiply:function(e,t){var n=i.clone(e.transformMatrix),r=i.clone(t.transformMatrix);this.transformMatrix_[0]=n[0]*r[0]+n[1]*r[4]+n[2]*r[8]+n[3]*r[12],this.transformMatrix_[1]=n[0]*r[1]+n[1]*r[5]+n[2]*r[9]+n[3]*r[13],this.transformMatrix_[2]=n[0]*r[2]+n[1]*r[6]+n[2]*r[10]+n[3]*r[14],this.transformMatrix_[3]=n[0]*r[3]+n[1]*r[7]+n[2]*r[11]+n[3]*r[15],this.transformMatrix_[4]=n[4]*r[0]+n[5]*r[4]+n[6]*r[8]+n[7]*r[12],this.transformMatrix_[5]=n[4]*r[1]+n[5]*r[5]+n[6]*r[9]+n[7]*r[13],this.transformMatrix_[6]=n[4]*r[2]+n[5]*r[6]+n[6]*r[10]+n[7]*r[14],this.transformMatrix_[7]=n[4]*r[3]+n[5]*r[7]+n[6]*r[11]+n[7]*r[15],this.transformMatrix_[8]=n[8]*r[0]+n[9]*r[4]+n[10]*r[8]+n[11]*r[12],this.transformMatrix_[9]=n[8]*r[1]+n[9]*r[5]+n[10]*r[9]+n[11]*r[13],this.transformMatrix_[10]=n[8]*r[2]+n[9]*r[6]+n[10]*r[10]+n[11]*r[14],this.transformMatrix_[11]=n[8]*r[3]+n[9]*r[7]+n[10]*r[11]+n[11]*r[15],this.transformMatrix_[12]=n[12]*r[0]+n[13]*r[4]+n[14]*r[8]+n[15]*r[12],this.transformMatrix_[13]=n[12]*r[1]+n[13]*r[5]+n[14]*r[9]+n[15]*r[13],this.transformMatrix_[14]=n[12]*r[2]+n[13]*r[6]+n[14]*r[10]+n[15]*r[14],this.transformMatrix_[15]=n[12]*r[3]+n[13]*r[7]+n[14]*r[11]+n[15]*r[15]},preRotateY:function(e){var t=r.init_8c4b([Math.cos(e),0,Math.sin(e),0,0,1,0,0,-Math.sin(e),0,Math.cos(e),0,0,0,0,1]);this.preTransform(t)},preScaleXY:function(e,t){var n=r.init_8c4b([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]);this.preTransform(n)}}}),r)},s3ad:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("iCxV"),c=n("fNpk"),d=n("Ird5"),h=n("jfma"),p=n("bauG"),f=n("jSYS"),m=n("KB91"),g=n("wH/i"),y=n("yjxF"),_=n("Aj79"),T=n("sJQG"),v=n("s3Tu"),C=n("zjod"),P=n("mxdD");i.VideoFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},a.defineClass({name:"VideoFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=C.VideoForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{makePGMRef:function(e,t,n,r){var o,i,s,S;if((s=a.as(e,C.VideoForma))&&(S=s.bounds)){var D,A,E="unknown";if((D=s.videoContentNode)&&(E=D.isGIF?"gif":"video"),((o=a.opt(u.Host.videoUtils,(function(e){return e.hostSupportsPGMVideos()})))||null!=o)&&o){var R;if(null!=(R=s.videoContentID)){var F,b=P.VideoFacade.getDurationForVideo(s),I=P.VideoFacade.getStartTimeForVideoForma(s,!(!(i=a.opt(s.videoContentNode,(function(e){return e.isForLocalVideo})))&&null==i)&&i),O=I.seconds,k=I;if(s.mode==C.VideoMode.trim&&(k=s.currentTime),b.seconds>0){var N=new f.PGMLinearFunction(new T.PGMRange(0,b.seconds),T.PGMRange.UNIT),M=new m.PGMLoopingFunction(new T.PGMRange(0,b.seconds),N);F=new d.PGMAnimationList([new g.PGMMediaPlayAnimation(M)])}else F=d.PGMAnimationList.EMPTY;return l.FormaToPGMUtils.applyAnimations(t,e,new _.PGMReference(new v.PGMVideo(s.formaID,new y.PGMNodeMetadata(s.formaID,E),F,S,R,O,k.seconds),new h.PGMCompositingParams(s.placement,s.style.opacity)))}return c.LegacyCoreAssert.fail("videoForma has a nil videoContentID",void 0,"VideoFormaToPGMMapper.makePGMRef","VideoFormaToPGMMapper.swift",86),null}return E="poster",null!=(A=s.contentID)?l.FormaToPGMUtils.applyAnimations(t,e,new _.PGMReference(new p.PGMImage(s.formaID+"-"+E,new y.PGMNodeMetadata(s.formaID,E),d.PGMAnimationList.EMPTY,S,A),new h.PGMCompositingParams(s.placement,s.style.opacity))):(c.LegacyCoreAssert.fail("videoForma has a nil contentID",void 0,"VideoFormaToPGMMapper.makePGMRef","VideoFormaToPGMMapper.swift",110),null)}return c.LegacyCoreAssert.fail("not a video forma, or no bounds",void 0,"VideoFormaToPGMMapper.makePGMRef","VideoFormaToPGMMapper.swift",115),null}}}),r)},sW6f:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("A6KL"),s=n("fNpk"),l=n("RkYL"),u=n("qSCS");o.VideoContentNode=(r=function(){this._isForLocalVideo=!1},i.defineClass({name:"VideoContentNode",ctor:r,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"video"}},SCHEMA_CLASS_NAME:{get:function(){return"VideoContentNode"}},factory:{get:function(){return function(e,t,n,o){var l=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),a.GroupContentNode);return s.LegacyCoreAssert.isTrue(null!=l,"Content nodes need a parent",void 0,"VideoContentNode","VideoContentNode.swift",18),r.init_3144(e,t,n,l)}}},LIVE_PHOTO_TAG:"LivePhoto",PROPERTY_WIDTH:"width",PROPERTY_HEIGHT:"height",PROPERTY_DURATION:"duration",PROPERTY_TIME_SAMPLES:"time-samples",PROPERTY_CHILDREN:"children",PROPERTY_ORIGINAL_DURATION:"original-duration",PROPERTY_OFFSET_IN_ORIGINAL:"offset-in-original",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,u.URLBasedContentNode,u.URLBasedContentNode.prototype.init_3144,e,t,n,r)},init_26a9:function(e,t){i.super_init(this,u.URLBasedContentNode,u.URLBasedContentNode.prototype.init_c3fa,e,"video",t),this.set(r.PROPERTY_WIDTH,0),this.set(r.PROPERTY_HEIGHT,0),this.set(r.PROPERTY_DURATION,l.TheoTime.Zero),this.set(r.PROPERTY_TIME_SAMPLES,[])},init_5972:function(e,t){i.super_init(this,u.URLBasedContentNode,u.URLBasedContentNode.prototype.init_8b5c,e,"video",t),this.set(r.PROPERTY_WIDTH,0),this.set(r.PROPERTY_HEIGHT,0),this.set(r.PROPERTY_DURATION,l.TheoTime.Zero),this.set(r.PROPERTY_TIME_SAMPLES,[])},className:{get:function(){return r.SCHEMA_CLASS_NAME}},width:{get:function(){return this.get(r.PROPERTY_WIDTH)},set:function(e){this.set(r.PROPERTY_WIDTH,e)}},height:{get:function(){return this.get(r.PROPERTY_HEIGHT)},set:function(e){this.set(r.PROPERTY_HEIGHT,e)}},duration:{get:function(){return this.get(r.PROPERTY_DURATION)},set:function(e){this.set(r.PROPERTY_DURATION,e)}},originalDuration:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_ORIGINAL_DURATION),l.TheoTime))||null!=e?e:this.duration},set:function(e){this.set(r.PROPERTY_ORIGINAL_DURATION,e)}},offsetInOriginal:{get:function(){var e;return(e=this._transientOffsetInOriginal)?e:i.as(this.get(r.PROPERTY_OFFSET_IN_ORIGINAL),l.TheoTime)},set:function(e){s.LegacyCoreAssert.isTrue(null==this._transientOffsetInOriginal,"Can't set offsetInOriginal while have transient value",void 0,"VideoContentNode","VideoContentNode.swift",89),this.set(r.PROPERTY_OFFSET_IN_ORIGINAL,e)}},setTransientOffset:function(e){this._transientOffsetInOriginal=e},resetTransientOffset:function(){this._transientOffsetInOriginal=null},wasTrimmed:{get:function(){var e;return!!(e=i.as(this.get(r.PROPERTY_ORIGINAL_DURATION),l.TheoTime))&&!e.secondsEqual(this.duration)}},times:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_TIME_SAMPLES),["Array",l.TheoTime]))||null!=e?e:[]}},isGIF:{get:function(){var e;return null!=(e=this.mimeType)&&e.includes("gif")}},setTimes:function(e){this.set(r.PROPERTY_TIME_SAMPLES,e)},concatTimes:function(e){this.set(r.PROPERTY_TIME_SAMPLES,this.times.concat(e))},addTime:function(e){this.set(r.PROPERTY_TIME_SAMPLES,this.times.concat([e]))},timesAsNSArray:{get:function(){for(var e=[],t=i.iter(this.times);!t.done;t.next()){var n=t.value;e.push(n)}return e.concat()}},isForLocalVideo:{get:function(){return this._isForLocalVideo},set:function(e){this._isForLocalVideo=e}}}}),r)},tQF8:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("fNpk"),l=n("3DEm"),u=n("oKlP"),c=n("sIWg");o.GridCellHandle=i.defineEnum("GridCellHandle",{Left:0,Right:1,Top:2,Bottom:3,TopLeft:4,TopRight:5,BottomLeft:6,BottomRight:7}),o.GridCell=(r=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=1),this.region_=e,this.colorID_=t,this.opacity_=n,a.CoreObject.call(this)},i.defineClass({name:"GridCell",ctor:r,superName:"CoreObject",statics:{BOUNDS_ACCURACY:.001,positionForHandle:function(e){return e==o.GridCellHandle.Top?new u.TheoPoint(.5,0):e==o.GridCellHandle.Bottom?new u.TheoPoint(.5,1):e==o.GridCellHandle.Left?new u.TheoPoint(0,.5):e==o.GridCellHandle.Right?new u.TheoPoint(1,.5):e==o.GridCellHandle.TopLeft?new u.TheoPoint(0,0):e==o.GridCellHandle.TopRight?new u.TheoPoint(1,0):e==o.GridCellHandle.BottomLeft?new u.TheoPoint(0,1):e==o.GridCellHandle.BottomRight?new u.TheoPoint(1,1):(s.LegacyCoreAssert.fail("Incorrect handle type",void 0,"GridCell.positionForHandle","GridCell.swift",170),new u.TheoPoint(.5,.5))},handlePositions:function(){return[r.positionForHandle(o.GridCellHandle.Top),r.positionForHandle(o.GridCellHandle.Bottom),r.positionForHandle(o.GridCellHandle.Left),r.positionForHandle(o.GridCellHandle.Right)]},handles:function(){return[o.GridCellHandle.Top,o.GridCellHandle.Bottom,o.GridCellHandle.Left,o.GridCellHandle.Right]},cornerHandles:function(){return[o.GridCellHandle.TopLeft,o.GridCellHandle.TopRight,o.GridCellHandle.BottomLeft,o.GridCellHandle.BottomRight]},handleForPosition:function(e){for(var t=i.iter(r.handles());!t.done;t.next()){var n=t.value;if(e.distanceTo(r.positionForHandle(n))<.001)return n}return s.LegacyCoreAssert.fail("Incorrect handle position",void 0,"GridCell.handleForPosition","GridCell.swift",202),null},fromArray:function(e){if(0==e.length||e.length>3)return s.LegacyCoreAssert.fail("GridCell.fromArray: Array has incorrect # of elements",void 0,"GridCell.fromArray","GridCell.swift",214),null;var t;if(t=c.TheoRect.decodeJson(i.as(e[0],"AnyObject"))){var n=e[1],o=null;return e.length>2&&(o=i.toString(e[2])),new r(t,o,n)}return null},decodeJson:function(e){return null==e?null:i.is(e,["Array","Any"])?r.fromArray(e):(s.LegacyCoreAssert.fail("GridCell: Not an array",void 0,"GridCell.decodeJson","GridCell.swift",246),null)}},props:{bounds:{get:function(){return this.region_},set:function(e){this.region_=e}},colorID:{get:function(){return this.colorID_},set:function(e){this.colorID_=e}},opacity:{get:function(){return this.opacity_},set:function(e){this.opacity_=e}},clone:function(){return new r(this.region_,this.colorID_,this.opacity_)},flip:function(){return new r(new c.TheoRect(this.bounds.minY,this.bounds.minX,this.bounds.maxY,this.bounds.maxX),this.colorID_,this.opacity_)},copyTo:function(e,t,n){var o,i;return void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=null),new r(e||this.region_,(o=t)||null!=o?o:this.colorID_,(i=n)||null!=i?i:this.opacity_)},symmetricWith:function(e){var t=this.region_,n=e.bounds;if(t.equal(n))return!1;var r=new u.TheoPoint(1-t.center.x,t.center.y),o=new u.TheoPoint(t.center.x,1-t.center.y);return r.distanceTo(n.center)<.01||o.distanceTo(n.center)<.01},mergeableWith:function(e){var t=this.region_.unionWith(e.bounds);return!(this.region_.L1Distance(e.bounds)>.001)&&l.MathUtils.absDouble(t.area-(this.bounds.area+e.bounds.area))<.01},mergeWith:function(e){return s.LegacyCoreAssert.isTrue(this.mergeableWith(e),"cell must be adjacent",void 0,"GridCell.mergeWith","GridCell.swift",140),this.copyTo(this.region_.unionWith(e.bounds))},handlePosition:function(e){return this.region_.eval(r.positionForHandle(e))},encode:function(){return s.LegacyCoreAssert.fail("GridCell: Use encodeJson(), not encode()",void 0,"GridCell.encode","GridCell.swift",251),[]},encodeJson:function(){var e=[];return e.push(this.region_.encodeJson()),s.LegacyCoreAssert.isFalse(isNaN(this.opacity),"Can't persist NaN opacity value",void 0,"GridCell.encodeJson","GridCell.swift",259),e.push(i.as(this.opacity,"AnyObject")),null!=this.colorID_&&e.push(i.as(this.colorID_,"AnyObject")),i.as(e,"AnyObject")},isEqual:function(e){var t;return!!(t=i.as(e,r))&&this.bounds.equalWithAccuracy(t.bounds,r.BOUNDS_ACCURACY)&&this.colorID==t.colorID&&this.opacity==t.opacity}}}),r),o._equality_GridCell_GridCell=function(e,t){return e.isEqual(t)}},txj3:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("fNpk"),s=n("ThKb");o.NNMLPClassifier=(r=function(e,t,n){this._finalSoftmax=!0,void 0===n&&(n=!0),a.LegacyCoreAssert.isTrue(e.length==t.length,"counts of coefficients and intercepts do not match",void 0,"NNMLPClassifier.init","NNMLPClassifier.swift",18),this._coefficients=i.clone(e),this._intercepts=i.clone(t);var r=e.length;this._classNum=e[r-1].rows,this._finalSoftmax=n,i.defctor(this)},i.defineClass({name:"NNMLPClassifier",ctor:r,props:{predict:function(e){return a.LegacyCoreAssert.isTrue(1==e.cols,"can't predict for multi-column input",void 0,"NNMLPClassifier.predict","NNMLPClassifier.swift",28),i.clone(this.forwardPropagate(e)).AL},forwardPropagate:function(e){for(var t={},n=[],r=e,o=this.hiddenLayerNumber(),a=i.iter(i.range(0,o,!1));!a.done;a.next()){var s=a.value,l=r,u=this._coefficients[s],c=this._intercepts[s],d=i.clone(this.linearActivationForward(l,u,c,"relu"));r=d.A,n.push(d.cache)}if(1!=this._classNum&&this._finalSoftmax){var h=i.clone(this.linearActivationForward(r,this._coefficients[o],this._intercepts[o],"softmax"));n.push(h.cache),t.AL=h.A,t.caches=i.clone(n)}else{var p=i.clone(this.linearActivationForward(r,this._coefficients[o],this._intercepts[o],"sigmoid"));n.push(p.cache),t.AL=p.A,t.caches=i.clone(n)}return t},backwardPropagate:function(e,t,n){var r={},o=[],l=[],u=[],c=n.length;a.LegacyCoreAssert.isTrue(e.cols==t.cols&&e.rows==t.rows,"probability vector and output vector dimensions do not match",void 0,"NNMLPClassifier.backwardPropagate","NNMLPClassifier.swift",104);var d=i.clone(n[c-1]);if(1==this._classNum){var h=s.TheoMatrix.ones(t.rows,t.cols),p=t.divide(e).subtract(h.subtract(t).divide(h.subtract(e))).multiplyConstant(-1),f=i.clone(this.linearActivationBackward(p,d,"sigmoid"));o.push(f.dAprev),l.push(f.dW),u.push(f.db)}else{var m=e.subtract(t),g=i.clone(this.linearActivationBackward(m,d,"softmax"));o.push(g.dAprev),l.push(g.dW),u.push(g.db)}for(var y=i.iter(i.range(0,c-2,!0).reversed());!y.done;y.next()){var _=y.value;d=i.clone(n[_]);var T=i.clone(this.linearActivationBackward(o[o.length-1],d,"relu"));o.push(T.dAprev),l.push(T.dW),u.push(T.db)}return r.dAs=i.reverse(o),r.dWs=i.reverse(l),r.dbs=i.reverse(u),r},computeCost:function(e,t){var n=t.cols;if(a.LegacyCoreAssert.isTrue(n>0,"number of columns in output vector must be positive",void 0,"NNMLPClassifier.computeCost","NNMLPClassifier.swift",139),1==this._classNum){var r=s.TheoMatrix.ones(t.rows,t.cols),o=t.multiply(e.matrixLog()),l=r.subtract(t).multiply(r.subtract(e).matrixLog()),u=o.add(l);return i.toDouble(i.toInt(-1/n))*u.sumRows().value(0,0)}return t.transpose().matrixMultiply(e.matrixLog()).value(0,0)*(-1/i.toDouble(n))},linearForward:function(e,t,n){var r={};return r.Z=t.matrixMultiply(e).add(n),r.cache={A:e,W:t,b:n},r},linearActivationForward:function(e,t,n,r){var o={},a={},s=i.clone(this.linearForward(e,t,n)),l=s.Z;return a.linearCache=s.cache,a.activationCache=l,o.cache=i.clone(a),"sigmoid"==r?o.A=l.sigmoid():"relu"==r?o.A=l.relu():"softmax"==r&&(o.A=this.softmaxActivation(l)),o},hiddenLayerNumber:function(){return this._coefficients.length-1},linearBackward:function(e,t,n,r){var o={},s=t.cols,l=e.matrixMultiply(t.transpose()).multiplyConstant(i.toDouble(i.toInt(1/s))),u=e.sumColumns().multiplyConstant(i.toDouble(i.toInt(1/s))),c=n.transpose().matrixMultiply(e);return a.LegacyCoreAssert.isTrue(l.cols==n.cols&&l.rows==n.rows,"weight and gradient matrix dimensions do not match",void 0,"NNMLPClassifier.linearBackward","NNMLPClassifier.swift",223),a.LegacyCoreAssert.isTrue(u.cols==r.cols&&u.rows==r.rows,"bias and gradient matrix dimensions do not match",void 0,"NNMLPClassifier.linearBackward","NNMLPClassifier.swift",224),a.LegacyCoreAssert.isTrue(c.cols==t.cols&&c.rows==t.rows,"activation and gradient matrix dimensions do not match",void 0,"NNMLPClassifier.linearBackward","NNMLPClassifier.swift",225),o.dAprev=c,o.dW=l,o.db=u,o},linearActivationBackward:function(e,t,n){var r=i.clone(t.linearCache),o=r.A,a=r.W,s=r.b,l=t.activationCache,u={};if("sigmoid"==n){var c=this.sigmoidBackward(e,l);u=i.clone(this.linearBackward(c,o,a,s))}else"relu"==n?(c=this.reluBackward(e,l),u=i.clone(this.linearBackward(c,o,a,s))):"softmax"==n&&(c=e,u=i.clone(this.linearBackward(c,o,a,s)));return u},softmaxActivation:function(e){a.LegacyCoreAssert.isTrue(1==e.cols,"can't calculate softmax activation for multi-column input",void 0,"NNMLPClassifier.softmaxActivation","NNMLPClassifier.swift",266);var t=e.exp(),n=t.sum();return t.multiplyConstant(i.toDouble(1/n))},sigmoidBackward:function(e,t){var n=s.TheoMatrix.ones(t.rows,t.cols),r=t.sigmoid(),o=e.multiply(r).multiply(n.subtract(r));return a.LegacyCoreAssert.isTrue(o.cols==t.cols&&o.rows==t.rows,"sigmoid backward result's dimensions incorrect",void 0,"NNMLPClassifier.sigmoidBackward","NNMLPClassifier.swift",277),o},reluBackward:function(e,t){a.LegacyCoreAssert.isTrue(e.cols==t.cols&&e.rows==t.rows,"relu backward input dimensions incorrect",void 0,"NNMLPClassifier.reluBackward","NNMLPClassifier.swift",282);for(var n=[],r=i.iter(i.range(0,e.rows,!1));!r.done;r.next()){for(var o=r.value,l=[],u=i.iter(i.range(0,e.cols,!1));!u.done;u.next()){var c=u.value;t.value(o,c)>=0?l.push(e.value(o,c)):l.push(0)}n.push(l)}var d=new s.TheoMatrix(n);return a.LegacyCoreAssert.isTrue(d.cols==t.cols&&d.rows==t.rows,"relu backward result's dimensions incorrect",void 0,"NNMLPClassifier.reluBackward","NNMLPClassifier.swift",296),d}}}),r)},u2iI:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("QbzR"),l=n("Zifs");o.ShapeStyle=(r=function(){this.deprecatedPrimaryColor=null},i.defineClass({name:"ShapeStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"ShapeStyle"}},KIND:{get:function(){return"ShapeStyle"}},factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},createDefault:function(){return r.init_d41d()},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){var n;i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_866e,e,t),(n=i.as(this.get(s.FormaStyle.PROPERTY_COLORS_DEPRECATED),["Array",l.SolidColor]))&&n.length>=1&&(this.deprecatedPrimaryColor=n[0])},init_d41d:function(){i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,r.KIND,s.FormaStyle.OPACITY_DEFAULT,a.ColorTable.createDefault())},willCommitState:function(){null!=this.deprecatedPrimaryColor&&(this.colors.fieldPrimary=this.deprecatedPrimaryColor,this.deprecatedPrimaryColor=null),s.FormaStyle.prototype.willCommitState.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},colorTableSupportsRole:function(e){return e==a.ColorRole.FieldPrimary}}}),r)},uMFj:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("x0BK"),s=n("9YN4");o.DCXDocumentEncoder=(r=function(e){a.DCXNodeEncoder.call(this,e,e.root);var t=[s.TheoDocument.COMPONENT_RELATIONSHIP_METADATA,s.TheoDocument.COMPONENT_RELATIONSHIP_RENDITION];this.prepareCompositeForSave(t)},i.defineClass({name:"DCXDocumentEncoder",ctor:r,superName:"DCXNodeEncoder",statics:{_implements:function(e){return"IExportDataObject"==e}},props:{finish:function(){a.DCXNodeEncoder.prototype.finish.call(this),this.discardStashedComponents()}}}),r)},uUew:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("fNpk");o.TextRange=(r=function(e,t){this.start=e,this.end=t,s.LegacyCoreAssert.isTrue(t>=e&&e>=0,"TextRange is invalid",{start:e,end:t},"TextRange.init","TextRange.swift",19),a.CoreObject.call(this)},i.defineClass({name:"TextRange",ctor:r,superName:"CoreObject",statics:{makeRangesContiguous:function(e){for(var t=i.iter(i.toSequence(e));!t.done;t.next()){var n=t.value,o=n.offset,a=n.element;o+1<e.length&&(e[o]=new r(a.start,e[o+1].start))}}},props:{length:{get:function(){return this.end-this.start}},asString:{get:function(){return"["+this.start+"-"+this.end+"]"}},contains:function(e){return e.start>=this.start&&e.end<=this.end},unionWith:function(e){return new r(Math.min(this.start,e.start),Math.max(this.end,e.end))}}}),r)},uWOl:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ascj"),s=n("QbzR"),l=n("Qlvz"),u=n("SDdr"),c=n("Zifs");o.ImageStyle=(r=function(){this.firstCommit=!1},i.defineClass({name:"ImageStyle",ctor:r,superName:"FormaStyle",statics:{SCHEMA_CLASS_NAME:{get:function(){return"ImageStyle"}},KIND:{get:function(){return"ImageStyle"}},DEFAULT_NAME:"None",PROPERTY_NAME:"name",PROPERTY_FILTER_NAME_DEPRECATED:"filter-name",NAME_NONE:"None",NAME_GREYSCALE:"Greyscale",NAME_DARKEN:"Darken",NAME_BLUR:"Blur",NAME_OVERLAY:"Overlay",NAME_MULTIPLY:"Multiply",NAME_BLEND:"Blend",NAME_DUOTONE:"DuoTone",NAME_SCREEN:"Screen",NAME_NEWDUOTONE:"NewDuoTone",factory:{get:function(){return function(e,t,n,o){return r.init_866e(n,e)}}},makeSafeName:function(e){if(e.includes("Overlay")||e.includes("DuoTone")||e.includes("Multiply")){var t=e.substr(e.length-1);if(t>="0"&&t<="9")return e.substr(0,e.length-1)}return e},createDefault:function(){return r.init_1265(r.DEFAULT_NAME,a.ColorTable.createDefault())},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e||"ColorTableOwner"==e}},props:{init_866e:function(e,t){this.firstCommit=!0,i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_866e,e,t)},init_a6fe:function(e,t,n,o){void 0===o&&(o=null);var a,l={name:r.makeSafeName(t)};if(a=o)for(var u=i.iter(a);!u.done;u.next()){var c=u.key,d=u.value;l[c]=d}i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,e,s.FormaStyle.OPACITY_DEFAULT,n,null,null,l)},init_1265:function(e,t,n,o){void 0===t&&(t=null),void 0===n&&(n=null),void 0===o&&(o=null);var a,u={name:r.makeSafeName(e)};if(a=o)for(var c=i.iter(a);!c.done;c.next()){var d=c.key,h=c.value;u[d]=h}i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_5afe,r.KIND,s.FormaStyle.OPACITY_DEFAULT,t,n,l.ImageAdjustments.createDefault(),u)},init_dd5d:function(e,t){i.super_init(this,s.FormaStyle,s.FormaStyle.prototype.init_dd5d,e,t)},colors_:{get:function(){var e=this,t=s.FormaStyle._getters.colors_.call(this);return i.opt(t,(function(e){return null==e.library}))&&i.opt(t,(function(t){return t.setColorLibraryWithoutSubscribing(e.colorLibrary)})),t},set:function(e){s.FormaStyle._setters.colors_.call(this,e)}},clone:function(){var e,t=this,n=s.FormaStyle.prototype.clone.call(this);return(e=i.as(i.opt(n,(function(e){return e.filter})),u.AlphaBlendFilter))&&(i.opt(e.filter1,(function(e){return e.style=i.opt(i.opt(i.as(t.filter,u.AlphaBlendFilter),(function(e){return e.filter1})),(function(e){return e.style}))})),i.opt(e.filter2,(function(e){return e.style=i.opt(i.opt(i.as(t.filter,u.AlphaBlendFilter),(function(e){return e.filter2})),(function(e){return e.style}))}))),n},willCommitState:function(){this.firstCommit&&(this.ensureStyleName(),this.updateDeprecatedColorTable(),this.firstCommit=!1),s.FormaStyle.prototype.willCommitState.call(this)},ensureStyleName:function(){var e,t;if(null!=(t=i.as(this.get(r.PROPERTY_NAME),"String"))){var n=t;if(t.includes(r.NAME_OVERLAY)||t.includes(r.NAME_DUOTONE)||t.includes(r.NAME_MULTIPLY)){var o=t.substr(t.length-1);o>="0"&&o<="9"&&(n=t.substr(0,t.length-1))}n!=t&&(this.name=n)}else{var a=i.opt(this.filter,(function(e){return e.name})),s=i.as(this.get(r.PROPERTY_FILTER_NAME_DEPRECATED),"String"),l=(e=s)||null!=e?e:a;if(null!=l)switch(l){case"Greyscale":this.name="Greyscale";break;case"GreyscaleDark":this.name="Darken";break;case"Monochrome":this.name="Greyscale";break;case"Duotone":this.name="DuoTone1";break;case"DesaturateMultiply":this.name="Multiply1";break;case"ReduceContrastOverlay":this.name="Overlay1";break;default:this.name=l}if(null!=s)switch(s){case"Greyscale":this.filter=u.CompositeFilter.init_514f(this,"Greyscale",1,"none",!0);break;case"GreyscaleDark":this.colors.fieldPrimary=c.SolidColor.BLACK,this.filter=u.CompositeFilter.init_514f(this,"Darken",.5,"normal",!1);break;case"Monochrome":this.filter=u.CompositeFilter.init_514f(this,"DesaturateMultiply",1,"multiply",!0,void 0,"offset",.5,1);break;case"Duotone":this.filter=u.CompositeFilter.init_514f(this,"Duotone",1,"normal",void 0,void 0,"duotone");break;case"DesaturateMultiply":this.filter=u.CompositeFilter.init_514f(this,"DesaturateMultiply",1,"multiply",!0,void 0,"offset",.5,1);break;case"ReduceContrastOverlay":this.filter=u.CompositeFilter.init_514f(this,"ReduceContrastOverlay",.5,"overlay",!1,.5,"offset",1,1);break;case"FillColor":this.filter=u.CompositeFilter.init_514f(this,"Normal",.5,"normal",!1);break;default:this.filter=null}}},updateDeprecatedColorTable:function(){var e;(e=i.as(this.get(s.FormaStyle.PROPERTY_COLORS_DEPRECATED),["Array",c.SolidColor]))&&(e.length>=1&&(this.colors.fieldPrimary=e[0]),e.length>=2&&(this.colors.fieldSecondary=e[1]))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},name:{get:function(){var e;return(e=i.as(this.get(r.PROPERTY_NAME),"String"))||null!=e?e:r.DEFAULT_NAME},set:function(e){this.set(r.PROPERTY_NAME,e)}},isColorizedFilter:{get:function(){return!["None","Greyscale","Blur","Darken"].includes(this.name)}},isColorEditable:{get:function(){return this.name==r.NAME_NEWDUOTONE}},isMixableFilter:{get:function(){return this.name==r.NAME_DARKEN}},isShuffleable:{get:function(){return this.isColorizedFilter||this.isMixableFilter}},colorTableSupportsRole:function(e){return e==a.ColorRole.FieldPrimary||e==a.ColorRole.FieldSecondary},equals:function(e){if(null==this.filter&&null!=e.filter||null!=this.filter&&null==e.filter)return!1;var t=null==this.filter&&null==e.filter,n=t||this.filter.equals(e.filter),r=t||this.colors.equalTo(e.colors),o=i.opt(this.adjustments,(function(t){return t.equals(e.adjustments)}));return n&&r&&o},description:{get:function(){if(null!=this.filter&&this.filter instanceof u.CompositeFilter){var e=this.filter,t="Style: "+this.name+", Op: "+e.colorOperation+", Filter: "+e.name,n=", params: (m="+i.toString(e.mix)+", c="+i.toString(e.contrast)+", b="+i.toString(e.blurRadius)+")";return null!=this.colors.fieldPrimary?t+n+this.colors.fieldPrimary.rgbHex:t+n}return this.name}}}}),r)},uZuM:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("QbzR"),l=n("JEzR"),u=n("4mVB"),c=n("iCxV"),d=n("uWOl"),h=n("c+uM"),p=n("2ALn"),f=n("u2iI"),m=n("LCGV"),g=n("QTen");i.FormaStyleFactory=(r=function(){this.lookup_={},this.lookup_[s.FormaStyle.KIND]=function(){return s.FormaStyle.createDefault()},this.lookup_[d.ImageStyle.KIND]=function(){return d.ImageStyle.createDefault()},this.lookup_[m.TextStyle.KIND]=function(){return m.TextStyle.createDefault()},this.lookup_[f.ShapeStyle.KIND]=function(){return f.ShapeStyle.createDefault()},this.lookup_[p.RootStyle.KIND]=function(){return p.RootStyle.createDefault()},this.lookup_[h.LockupStyle.KIND]=function(){return h.LockupStyle.createDefault()},this.lookup_[g.VideoStyle.KIND]=function(){return g.VideoStyle.createDefault()},this.lookup_[u.GridStyle.KIND]=function(){return u.GridStyle.createDefault()},this.lookup_[l.FrameStyle.KIND]=function(){return l.FrameStyle.createDefault()}},o={},a.defineClass({name:"FormaStyleFactory",ctor:r,superName:"CoreObject",statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}}},props:{create:function(e){var t;return null!=(t=this.lookup_[e])?t():(a.opt(c.Host.logging,(function(t){return t.warning("no constructor for forma style kind = "+e)})),null)}}}),r)},uj1m:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("iCxV"),s=n("ThKb");o.MLPModel=(r=function(e,t,n,r,o,a,s,l){this.featureScalingMean=e,this.featureScalingStd=t,this.coefficients=i.clone(n),this.intercepts=i.clone(r),this.shapes=i.clone(o||[]),this.fonts=i.clone(a||[]),this.layouts=i.clone(s||[]),this.roles=i.clone(l||[]),this.fontMap={},this.finalSoftmax=!0},i.defineClass({name:"MLPModel",ctor:r,statics:{cache:{},loadNNModel:function(e){if(null==r.cache[e]){var t,n=null;if(t=i.opt(a.Host.learning,(function(t){return t.loadNNJSON(e)}))){var o,l=new s.TheoMatrix([t.featureScalingMean]),u=new s.TheoMatrix([t.featureScalingStd]);if(o=i.as(t.model,["Dictionary","String","Any"])){for(var c=i.clone(o.coefs),d=[],h=i.iter(c);!h.done;h.next()){var p=h.value;d.push(new s.TheoMatrix(p).transpose())}for(var f=i.clone(o.intercepts),m=[],g=i.iter(f);!g.done;g.next()){var y=g.value;m.push(new s.TheoMatrix([y]).transpose())}for(var _={},T=i.iter(["shapes","fonts","layouts","roles"]);!T.done;T.next()){var v=T.value;null!=o[v]?_[v]=i.clone(o[v]):_[v]=[]}n=new r(l,u,d,m,_.shapes,_.fonts,_.layouts,_.roles)}}r.cache[e]=n}return r.cache[e]}},props:{data:function(){for(var e=[],t=[],n=i.iter(this.coefficients);!n.done;n.next()){var r=n.value;e.push(r.transpose().asArray)}for(var o=i.iter(this.intercepts);!o.done;o.next()){var a=o.value;t.push(a.transpose().asFlatArray)}return i.clone(i.as({model:{coefs:e,intercepts:t,shapes:this.shapes,fonts:this.fonts,layouts:this.layouts,roles:this.roles},featureScalingMean:this.featureScalingMean.asFlatArray,featureScalingStd:this.featureScalingStd.asFlatArray},["Dictionary","String","Any"]))}}}),r)},voyk:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("fNpk");o.TheoJSONEncoder=(r=function(e){this.json_={},this.children=[],this.components=null,this.namespace_="",void 0===e&&(e=""),this.namespace_=e},i.defineClass({name:"TheoJSONEncoder",ctor:r,statics:{_implements:function(e){return"IExportDataObject"==e}},props:{json:function(){for(var e=i.clone(this.json_),t=i.iter(e);!t.done;t.next()){var n,o=t.key,a=t.value;(n=i.as(a,r))&&(e[o]=i.clone(n.json()))}return 0==this.children.length||(e.children=this.children.map((function(e){return e.json()}),this)),e},setPath:function(e){this.json_.path=e},setName:function(e){this.json_.name=e},setType:function(e){this.json_.type=e},setProperty:function(e,t){null!=t&&(this.json_[this.namespace_+e]=t)},setOptionalStringProperty:function(e,t){this.json_[this.namespace_+e]=t},setStringProperty:function(e,t){this.json_[this.namespace_+e]=t},setStringPropertyNoNamespace:function(e,t){this.json_[e]=t},setNumberProperty:function(e,t){a.LegacyCoreAssert.isFalse(isNaN(t),"Can't set NaN for prop.",{property:e},"TheoJSONEncoder.setNumberProperty","TheoJSONEncoder.swift",52),this.json_[this.namespace_+e]=t},setIntProperty:function(e,t){this.json_[this.namespace_+e]=t},setBooleanProperty:function(e,t){this.json_[this.namespace_+e]=t},setOptionalBooleanProperty:function(e,t){this.json_[this.namespace_+e]=t},findChild:function(e){return null},appendChild:function(e){var t=new r(this.namespace_);return t.setStringPropertyNoNamespace("id",e),this.children.push(t),t},appendComponent:function(e,t,n){null==this.components&&(this.components=[]),this.components.push({id:e,url:t,mimeType:n}),this.json_.components=i.clone(this.components)},setCompositeID:function(e){this.json_.id=e},setManifestProperty:function(e,t,n){},setDocumentSize:function(e,t){}}}),r)},"w/+j":function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ko5Z"),s=n("WF+G"),l=n("iCxV"),u=n("SDdr"),c=n("fNpk"),d=n("c+uM"),h=n("tGKA"),p=n("Ird5"),f=n("WjWV"),m=n("Iv44"),g=n("dmHI"),y=n("9MJV"),_=n("jSYS"),T=n("WUDy"),v=n("sJQG"),C=n("PlOi"),P=n("W6ub"),S=n("Ucb9"),D=n("9K9k"),A=n("/eOI"),E=n("bAjp"),R=n("f/aw"),F=n("zW52"),b=n("bJhu"),I=n("mj5y"),O=n("RiZt"),k=n("KQHZ"),N=n("6ftY"),M=n("uYSz"),L=n("VXZl"),x=n("KDc2"),B=n("GOtr"),w=n("ll2+"),G=n("GtBD"),Y=n("sIWg"),U=n("xm77"),j=n("sW6f");o.FormaToPGMUtils=(r=function(){},i.defineClass({name:"FormaToPGMUtils",ctor:r,statics:{cpEnv:"prod",createTimeFunc:function(e,t){var n,r=new v.PGMRange(e.time.seconds,t.time.seconds);switch(t.timingFunction){case"Linear":n=new _.PGMLinearFunction(r,v.PGMRange.UNIT);break;case"Step":case"Step0":case"Step1":n=new _.PGMLinearFunction(r,new v.PGMRange(0,0));break;case"EaseIn":case"EaseOut":case"EaseInOut":var o=e.timingFunction==U.TimingFunctionType.EaseIn?A.PGMEasingType.EaseIn:e.timingFunction==U.TimingFunctionType.EaseOut?A.PGMEasingType.EaseOut:A.PGMEasingType.EaseInAndOut;n=new A.PGMSineEasingFunction(o,r,v.PGMRange.UNIT);break;default:i.opt(l.Host.logging,(function(t){return t.warning("Timing-func not yet converyed to PGM: "+e.timingFunction)})),n=new _.PGMLinearFunction(r,v.PGMRange.UNIT)}return n},determineOpacity:function(e){var t;return(t=i.as(e.style,d.LockupStyle))?t.textOpacity:i.opt(e.style,(function(e){return e.opacity}))},createTransformAnimation:function(e,t,n){var o,i=e.compositing.placement,a=t.placement,s=n.placement;return a.isIdentity&&s.isIdentity||(o=new F.PGMTransformAnimation(r.createTimeFunc(t,n),new F.PGMTransformedBounds(i.concat(a),I.PGMUtils.calcBounds(e.child,h.Matrix2D.Identity)||Y.TheoRect.Zero),new F.PGMTransformedBounds(i.concat(s),I.PGMUtils.calcBounds(e.child,h.Matrix2D.Identity)||Y.TheoRect.Zero))),o},createOpacityAnimation:function(e,t){var n,o=r.determineOpacity(e);if(null==o)return n;var i=r.determineOpacity(t);return null==i?n:n=new T.PGMOpacityAnimation(r.createTimeFunc(e,t),o,i)},createTextAnimation:function(e,t,n){var o,a=i.as(e,E.PGMText);if(null==a)return o;var s=i.opt(t.style,(function(e){return e.colors.fieldPrimary}));if(null==s)return o;var l=i.opt(n.style,(function(e){return e.colors.fieldPrimary}));if(null==l)return o;null==a.style.fillColor&&(s=null,l=null);var u=i.opt(t.style,(function(e){return e.colors.fieldSecondary})),c=i.opt(n.style,(function(e){return e.colors.fieldSecondary}));null==u&&(u=a.style.strokeColor),null==c&&(c=a.style.strokeColor);var d=new b.PGMTextStyle(a.style.font,s,u,a.style.strokeWidth,a.style.tracking),h=new b.PGMTextStyle(a.style.font,l,c,a.style.strokeWidth,a.style.tracking);return o=new R.PGMTextAnimation(r.createTimeFunc(t,n),t.bounds||a.bounds,d,n.bounds||a.bounds,h,P.PGMRenderRuns.init_378c(t.renderRuns),P.PGMRenderRuns.init_378c(n.renderRuns))},createShapeAnimation:function(e,t,n){var o,a=i.as(e,S.PGMShape);if(null==a)return o;var s=i.opt(t.style,(function(e){return e.colors.fieldPrimary}));if(null==s)return o;var l=i.opt(n.style,(function(e){return e.colors.fieldPrimary}));return null==l?o:o=new D.PGMShapeAnimation(r.createTimeFunc(t,n),s,t.bounds||a.bounds,l,n.bounds||a.bounds)},createFilterAnimation:function(e,t,n){var o,a,s,l,c,d;if(a=i.as(e,g.PGMFilter))if((s=i.as(a.spec,m.PGMBlurFilterSpec))&&(l=i.as(i.opt(t.style,(function(e){return e.filter})),u.CompositeFilter))&&(c=i.as(i.opt(n.style,(function(e){return e.filter})),u.CompositeFilter))){var h=new m.PGMBlurFilterSpec(s.edgeClamp,l.blurRadius,s.originalImageEntity),p=new m.PGMBlurFilterSpec(s.edgeClamp,c.blurRadius,s.originalImageEntity);o=new y.PGMFilterAnimation(r.createTimeFunc(t,n),h,p)}else if(d=i.as(a.spec,f.PGMBlendFilterSpec)){var _=d.weights[0],T=d.weights[1],v=new f.PGMBlendFilterSpec([_,T]),C=new f.PGMBlendFilterSpec([T,_]);o=new y.PGMFilterAnimation(r.createTimeFunc(t,n),v,C)}return o},createContentAnimation:function(e,t,n){var o,i=e.child;return i instanceof E.PGMText?o=r.createTextAnimation(i,t,n):i instanceof S.PGMShape?o=r.createShapeAnimation(i,t,n):i instanceof g.PGMFilter&&(o=r.createFilterAnimation(i,t,n)),o},convertAnimation:function(e,t,n,o){void 0===n&&(n=!0),void 0===o&&(o=!0);var a=[];if(!(t.keyFrames.length>1))return a;for(var s=t.keyFrames.length-2,l=i.iter(i.range(0,s,!0));!l.done;l.next()){var u,c,d,h=l.value,p=t.keyFrames[h],f=t.keyFrames[h+1];if(f.time!=p.time)n&&((u=r.createTransformAnimation(e,p,f))&&a.push(u),(c=r.createOpacityAnimation(p,f))&&a.push(c)),o&&(d=r.createContentAnimation(e,p,f))&&a.push(d)}return a},createAnimations:function(e,t){var n,o=[];if(n=t.animation){var a=i.clone(r.convertAnimation(e,n));i.append(o,a)}return p.PGMAnimationList.fromArray(o)},applyAnimations:function(e,t,n){if(!e.asDynamic)return n;var o=r.createAnimations(n,t),i=n.animations.merge(o);return n.withAnimations(i)},createResourceProviderForContentNode:function(e){var t,n,o,l,u=e.type,d=e.localIdentifier,h=i.as(e,j.VideoContentNode);if(null!=d&&null!=h&&h.isForLocalVideo){var p,f=null;null!=(p=h.url)&&p.startsWith("file:")&&(f=new s.CorePath(p.substr("file:".length))),l=new G.StorageSpecLocalIdentifier(d,f)}else if(null!=(p=(t=e.remappedUrl)||null!=t?t:e.url))if(p.startsWith("component:"))(T=p.substr("component:".length).split("/")).length>2&&"logo"==T[2]&&T.splice(2,1),u=T.length>=3?i.replaceAll(T[2],"+","/"):u,T.length>=2?l=new B.StorageSpecLocalComposite(T[1],u):(c.LegacyCoreAssert.fail("unexpected component encoding",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",364),l=new x.StorageSpecInvalid);else if(p.startsWith("cp:")){var m=p.substr("cp:".length),g=(T=m.split("/"))[0];if(T.splice(0,1),"original"==T[0]&&T.splice(0,1),T.length>=1){var y=T.join("/");l=new N.StorageSpecCommunityPlatform(g,new s.CorePath(y),null,r.cpEnv)}else c.LegacyCoreAssert.fail("unexpected component encoding",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",382),l=new x.StorageSpecInvalid}else if(p.startsWith("acp:")){var _=p.substr("acp:".length);l=new O.StorageSpecAdobeContentPlatform(_)}else if(p.startsWith("ac:")){var T;(T=p.substr("ac:".length).split("/")).length>=3&&"logo"==T[2]&&T.splice(2,1);var v=T.length>=3&&null!=["image+","video+","audio+","font+","application+"].find((function(e){return T[2].startsWith(e)}),this),P=T.length>=3&&!v?T[2]:null,S=null==P?2:3;T.length>S&&(u=i.replaceAll(T[S],"+","/")),l=new M.StorageSpecExternalCC(M.StorageSpecExternalCC.BRANDKIT_SYNC_GROUP,T[0],T[1],null,u,null,P)}else if(p.startsWith("file:")){var D=p.substr("file:".length);l=new w.StorageSpecLocalFile(new s.CorePath(D))}else if(p.startsWith("data:")){var A;if(null!=(A=i.indexOf(p,"base64,"))){var E=p.substr(A+"base64,".length),R=p.substr("data:".length,A-"data:".length);R.endsWith(";")&&(u=R.substr(0,R.length-1)),l=new k.StorageSpecContentLiteral(new a.CoreContentBase64(E,(n=u)||null!=n?n:""))}else c.LegacyCoreAssert.fail("data URL is not base64; unsupported",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",437),l=new x.StorageSpecInvalid}else p.startsWith("http:")||p.startsWith("https:")||p.startsWith("blob:")?l=new L.StorageSpecHTTP(p):p.startsWith("/storage/")?l=new w.StorageSpecLocalFile(new s.CorePath(p)):(c.LegacyCoreAssert.fail("URL does not have a known pattern",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",454),l=new x.StorageSpecInvalid);else c.LegacyCoreAssert.fail("no URL to inspect",void 0,"FormaToPGMUtils.createResourceProviderForContentNode","FormaToPGMUtils.swift",458),l=new x.StorageSpecInvalid;return new C.PGMResourceProvider((o=u)||null!=o?o:"",l)}}}),r)},wL85:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("URxh"),s=n("tGKA"),l=n("oKlP"),u=n("RkYL"),c=n("xm77");o.MotionSrcDropIn=(r=function(){},i.defineClass({name:"MotionSrcDropIn",ctor:r,statics:{getSrcKeyframes:function(e){var t=[],n=u.TheoTime.Zero,r=u.TheoTime.fromSeconds(1),o=s.Matrix2D.translation(new l.TheoPoint(0,-400)),i=s.Matrix2D.Identity,d=e.style.clone();return t.push(new a.KeyFrame(n,c.TimingFunctionType.Linear,o,null,d)),t.push(new a.KeyFrame(r,c.TimingFunctionType.Linear,i,null,d)),t}}}),r)},wNKJ:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("quOg"),l=n("FNB+"),u=n("6ZWm"),c=n("cmoc"),d=n("OdB2"),h=n("P83h"),p=n("9Lk3"),f=n("ZK0l"),m=n("pnSN"),g=n("X0GW"),y=n("iCxV"),_=n("fdtz"),T=n("lmwz"),v=n("fNpk"),C=n("tGKA"),P=n("KIfs"),S=n("K0Rh"),D=n("djAF"),A=n("6Tzw"),E=n("T6jX"),R=n("oKlP"),F=n("sIWg");o.DragFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"DragFacade",ctor:r,superName:"CoreObject",statics:{processBeginFormaDrag:function(e){var t=e.dragDelegate.dragController,n=i.opt(t,(function(e){return e.owner.document.firstPage}));i.opt(n,(function(e){return e.publish(new d.BeginFormaDragMessage(n))})),i.opt(t,(function(t){return t.afterProcessBeginFormaDrag(e)}))},processFormaDrag:function(e){var t=e.dragDelegate.dragController;i.opt(t,(function(t){return t.beforeProcessFormaDrag(e)}));var n=[],o=!(1==e.dragDelegate.modifierKeys.control)&&1==e.dragDelegate.draggedFormae.length;return e.dragDelegate.forEachDraggedForma((function(t,i){n=n.concat(r.processOneFormaDrag(e,t,i,o))})),i.opt(t,(function(t){return t.afterProcessFormaDrag(e)})),n},processOneFormaDrag:function(e,t,n,o){var a=[],l=e.drag;if(null==e.dragDelegate.dragController.owner)return a;if(null==t.controller)return a;var u=e.dragDelegate.dragController.owner,c=t.controller,p=u.selection;if(!c.moveable||u.interactionMode==s.InteractionMode.SelectionFocused&&p.selectedCount>0&&!p.isSelected(t))return a;var f=new h.FormaTransformChangedEvent(t);t.beginUpdate(f),r.doMove(l,t,n,p),o&&(a=i.clone(r.doSnap(l,t,n))),t.endUpdate(f);var m=u.document.firstPage;return m.publish(new d.FormaDragMessage(m)),a},doMove:function(e,t,n,r){var o,a=i.opt(t.parent,(function(e){return e.totalPlacement.inverse}))||C.Matrix2D.Identity,s=e.freeMovement(a),l=s.movement;switch(s.rise,s.run,o=t.parent instanceof c.FrameForma?t.parent.bounds.center:C._asterisk_TheoPoint_Matrix2D(t.bounds.center,n),e.dragMode){case 1:l=e.noScale(a,o);break;case 2:l=e.noRotation(a,o)}v.LegacyCoreAssert.isFalse(0==l.determinant,"movement determinant should be non-zero",void 0,"DragFacade.doMove","DragFacade.swift",101),C._asterisk_Matrix2D_Matrix2D(C._asterisk_Matrix2D_Matrix2D(C.Matrix2D.translation(o),l),C.Matrix2D.translation(R._negate_TheoPoint(o))),e.uncommitedMovement=l;var u,d=C._asterisk_Matrix2D_Matrix2D(n,l);(u=t.controller)&&u.place(d)},doSnap:function(e,t,n){var r,o,a=[];o=t.parent instanceof c.FrameForma?t.parent.bounds.center:C._asterisk_TheoPoint_Matrix2D(t.bounds.center,n);var s,u=t.bounds.locatePoint(t.placement.inverse.transformPoint(o)),d=e.dragMode==P.DragMode.NoScaleNoSkew,h=e.activePace();s=!(!(r=i.opt(y.Host.platform,(function(e){return e.isWeb})))&&null==r||!r)||h==P.DragPace.MediumPace||e.currentlySnapped,e.dragMode==P.DragMode.UniformScaleNoRotationNoSkew&&(s=!1);var f,m,g,_=i.clone(t.filterByControllerKind(p.GridController.KIND,l.FormaTraversal.NearestAncestor));if((f=i.as(i.opt(i.first(_),(function(e){return e.controller})),p.GridController))&&f.isChildSwappable(t)&&s&&(s=d),(m=T.ImageFacade.getFrameFormaForForma(t))&&(s=m.controller.floating),g=t.controller){var v=e.currentlySnapped;if(e.currentlySnapped=!1,s){var S,D=g.setSnappedPlacement(d?u:null,8/e.viewportScale,!0);(S=D.snapLines)&&(a=i.clone(S)),null!=D.movement&&(e.currentlySnapped=!0),!v&&e.currentlySnapped&&e.commitDrag()}}return a},processEndFormaDrag:function(e){var t,n,o,a=e.dragDelegate.dragController;if(o=i.as(a,u.FrameController))o.processEndFormaDrag(e);else{var s=e.drag.viewportScale,l=26/s,c=0;e.drag.pointers.length>1&&(c=24/s),A.SelectionFacade.enableAdditionalMultiSelectGestures()&&i.opt(a,(function(t){return t.owner.selection.replaceSelectionWithFormae(e.dragDelegate.draggedFormae)}));var h=!(!(t=i.opt(a,(function(e){return e.owner.selection.inCropMode})))&&null==t)&&t;e.dragDelegate.forEachDraggedForma((function(e,t){r.rescueFormaToPageBounds(e,l,c),h||!(n=i.opt(e.controller,(function(e){return e.userGroupChild})))&&null==n||!n||g.GroupFacade.updateUserGroupHierarchy(e.parent)}));var p=i.opt(a,(function(e){return e.owner.document.firstPage}));i.opt(p,(function(e){return e.publish(new d.EndFormaDragMessage(p))})),e.dragDelegate.forEachDraggedForma((function(e,t){var n;if(n=i.opt(e.root,(function(e){return e.filterWithCallback((function(e){return e instanceof m.GroupForma&&null!=e.controller}))})))for(var r=i.iter(n);!r.done;r.next()){var o,a=r.value;(o=i.as(a.controller,f.GroupController))&&o.canClaimForma(e)&&o.claimForma(e)}else y.Host.logging.error("Error: forma has not root "+e.print())})),i.opt(a,(function(t){return t.afterProcessEndFormaDrag(e)}))}},rescueFormaToPageBounds:function(e,t,n,o){var i;if(void 0===t&&(t=50),void 0===n&&(n=50),void 0===o&&(o=new R.TheoPoint(.5,.5)),i=e.root){var a=i.bounds,s=C.Matrix2D.Identity;r.rescueToArbitraryBounds(e,a,s,t,n,o)}},rescueToArbitraryBounds:function(e,t,n,r,o,a){var s;if(void 0===a&&(a=new R.TheoPoint(.5,.5)),s=e.parent){var l=e.totalPlacement,u=e.bounds,c=r*Math.sqrt(Math.abs(n.determinant)),d=t.insetXY(c,c),h=u.maximumSpan(l);if(h<o){v.LegacyCoreAssert.isTrue(h>0,"forma's span is not positive",void 0,"DragFacade.rescueToArbitraryBounds","DragFacade.swift",264);var p=u.eval(a),f=l.transformPoint(p),m=C.Matrix2D.translation(f.multiply(-1)).concat(C.Matrix2D.uniformScaling(o/h).concat(C.Matrix2D.translation(f))),g=(y=s.totalPlacement).concat(m.concat(y.inverse));i.opt(e.controller,(function(e){return e.move(g)}))}if(l=e.totalPlacement,!F.TheoRect.PointInCommon(u,C._asterisk_Matrix2D_Matrix2D(l,n.inverse),t)){var y,_=F.TheoRect.JustTouch(u,l,d,n);g=(y=s.totalPlacement).concat(_.concat(y.inverse)),i.opt(e.controller,(function(e){return e.move(g)}))}}},getSwappableFormae:function(e){var t=i.first(e.dragDelegate.draggedFormae);i.opt(t,(function(e){return e.kind==_.ImageForma.KIND}))&&(t=i.opt(t,(function(e){return e.parent})));var n=e.dragDelegate.dragController,o=i.opt(i.opt(n,(function(e){return e.owner})),(function(e){return e.document})),a=[];return null==t||null==o||o.firstPage.root.visitAll(l.FormaTraversal.PreOrder,(function(e){r.isFormaSwappable(e,o)&&a.push(e)})),a},getSwapState:function(e,t,n,o,a){var s=r.getSwapTargetForma(e,t,n),l=o;(l||null!=s)&&(l=!0,null!=a&&i.opt(i.first(e.dragDelegate.draggedFormae),(function(e){return e.placement=a})));var u=e.drag.pointers[0].currentLocation,c=i.opt(i.opt(e.dragDelegate.dragController.owner,(function(e){return e.document})),(function(e){return e.firstPage.formaAtPoint(u)})),d=null!=c&&c.kind==S.RootForma.KIND;return null==s&&d&&(s=n,l=o),[l,s]},getSwapTargetForma:function(e,t,n){var o=e.drag;if(1!=e.dragDelegate.draggedFormae.length)return null;var a=i.first(e.dragDelegate.draggedFormae);i.opt(a,(function(e){return e.kind==_.ImageForma.KIND}))&&(a=i.opt(a,(function(e){return e.parent})));var s=e.dragDelegate.dragController,u=i.opt(i.opt(s,(function(e){return e.owner})),(function(e){return e.document}));if(1!=o.pointers.length||null==a||null==u)return null;if(!r.isFormaSwappable(a,u))return null;var c=o.pointers[0].currentLocation,d=u.firstPage.pageSize;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;for(var h=null,p=i.iter(t);!p.done;p.next()){var f=p.value;if(f.finalFrame.containsPoint(c)&&r.inSwappableRegion(a,f,c,u)){h=f;break}}return null==n&&i.eq(l._equality_Forma_Forma,h,a)&&(h=null),h},isFormaSwappable:function(e,t){return!(e.kind==S.RootForma.KIND||e.kind==m.GroupForma.KIND||null!=e.controller&&e.controller.moveable||!e.isGridCell()||null==r.getGridForma(t)||(n=i.as(e,D.ShapeForma))&&null!=E.TheoDocumentUtils.getCellBackgroundImage(n));var n},getGridForma:function(e){var t=i.clone(e.firstPage.root.filterByControllerKind(p.GridController.KIND));return t.length>0?t[0]:null},inSwappableRegion:function(e,t,n,o){var i=r.getGridForma(o),a=0;if(null!=i&&(a=i.controller.spacing),null==e.finalFrame||null==t.finalFrame)return!1;var s=e.finalFrame.minY==t.finalFrame.maxY+a,l=e.finalFrame.maxY==t.finalFrame.minY-a,u=e.finalFrame.minX==t.finalFrame.maxX+a,c=e.finalFrame.maxX==t.finalFrame.minX-a,d=s&&u||s&&c||l&&u||l&&c,h=e.finalFrame.minY>=t.finalFrame.minY&&e.finalFrame.minY<=t.finalFrame.maxY||t.finalFrame.minY>=e.finalFrame.minY&&t.finalFrame.minY<=e.finalFrame.maxY||d,p=e.finalFrame.minX>=t.finalFrame.minX&&e.finalFrame.minX<=t.finalFrame.maxX||t.finalFrame.minX>=e.finalFrame.minX&&t.finalFrame.minX<=e.finalFrame.maxX||d,f=s&&h,m=l&&h,g=u&&p,y=c&&p;if(f||m||g||y){var _=t.finalFrame.minY,T=t.finalFrame.maxY,v=t.finalFrame.minX,C=t.finalFrame.maxX,P=T-_,S=C-v;return f&&(T-=.2*P),m&&(_+=.2*P),g&&(C-=.2*S),y&&(v+=.2*S),n.x>=v&&n.y>=_&&n.x<=C&&n.y<=T}return!0}}}),r)},wc1n:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("Bqrm"),l=n("c3Vl"),u=n("pnSN"),c=n("cbNz"),d=n("KsJe"),h=n("Yudi"),p=n("pFDI");i.FeatureExtractorProtocol=a.defineProtocol("FeatureExtractorProtocol",{features:"Dictionary<String>",numericalFeatures:"Dictionary<String>",categoricalFeatures:"Dictionary<String>"}),i.FeatureExtractor=(r=function(){this.numericalFeatures_={},this.categoricalFeatures_={},this.complexFeatures_={},this.allFeatures_={}},a.defineClass({name:"FeatureExtractor",ctor:r,statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{setFeature:function(e,t,n){n==i.FeatureType.Categorical?this.categoricalFeatures_[e]=a.as(t,"String"):n==i.FeatureType.Numerical?this.numericalFeatures_[e]=a.as(t,"Double"):this.complexFeatures_[e]=t,this.allFeatures_[e]=t},getFeature:function(e){return this.allFeatures_[e]},features:{get:function(){return this.allFeatures_}},numericalFeatures:{get:function(){return this.numericalFeatures_}},categoricalFeatures:{get:function(){return this.categoricalFeatures_}},featureForKey:function(e){return null!=this.features[e]?this.features[e]:null},numericFeatureForKey:function(e){return null!=this.numericalFeatures[e]?this.numericalFeatures[e]:null},categoricalFeatureForKey:function(e){return null!=this.categoricalFeatures_[e]?this.categoricalFeatures_[e]:null}}}),r),i.FeatureExtractorFactory=(o=function(){},a.defineClass({name:"FeatureExtractorFactory",ctor:o,statics:{getFeatureExtractor:function(e,t,n){switch(void 0===n&&(n=[]),e){case 0:return new l.DesignStyleFeatureExtractor(t,n);case 1:return new d.LockupStyleFeatureExtractor(t,n);case 2:return new c.GridStyleFeatureExtractor(a.as(t,u.GroupForma),void 0,void 0,void 0,void 0,void 0,n);case 3:return new s.DesignConstraintFeatureExtractor(t,n);case 4:return new p.ShapeFeatureExtractor(t,n);case 5:return new h.RetargetFeatureExtractor(t,!1,n);case 6:return new h.RetargetFeatureExtractor(t,!0,n)}}}}),o),i.FeatureExtractorType=a.defineEnum("FeatureExtractorType",{DesignStyle:0,LockupStyle:1,GridStyle:2,DesignConstraint:3,Shape:4,Retarget:5,RetargetTemplate:6}),i.FeatureType=a.defineEnum("FeatureType",{Numerical:0,Categorical:1,Complex:2})},x0BK:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("ytEx"),s=n("iCxV"),l=n("8vXU"),u=n("rxGp");o.DCXNodeEncoder=(r=function(e,t){this.node_=t,a.BaseNodeEncoder.call(this,e,t)},i.defineClass({name:"DCXNodeEncoder",ctor:r,superName:"BaseNodeEncoder",statics:{_implements:function(e){return"IExportDataObject"==e}},props:{getPropertyOnNode:function(e){return i.as(this.node_.getValue(e),"AnyObject")},setPropertyOnNode:function(e,t){s.Host.logging.logForCategory(u.LogCategories.kEncode,i.toString(this.id)+" setPropertyOnNode "+e+" "+i.toString(t),l.LogLevelEnum.INFO_LEVEL),null!=t?this.node_.setValue(e,t):this.node_.removeValue(e)},createChildEncoder:function(e){var t=this.branch_.appendNode(e,null,this.node_);return new r(this.branch_,t)},findChild:function(e){return null==e?null:(t=this.branch_.getChildrenOfNode(this.node_).find((function(t){return i.as(t.getValue(a.PROPERTY_KEY_PATH),"String")==e}),this))?(s.Host.logging.logForCategory(u.LogCategories.kEncode,i.toString(this.id)+" foundChild "+t.nodeId,l.LogLevelEnum.INFO_LEVEL),new r(this.branch_,t)):a.BaseNodeEncoder.prototype.findChild.call(this,e);var t}}}),r)},x35w:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("ascj"),l=n("FNB+"),u=n("9Lk3"),c=n("fNpk"),d=n("uxH+");o.GridFacade=(r=function(){a.CoreObject.call(this)},i.defineClass({name:"GridFacade",ctor:r,superName:"CoreObject",statics:{getPageGrid:function(e,t){var n=i.clone(e.root.filterByControllerKind(u.GridController.KIND));return n.length>0?i.as(n[0].controller,u.GridController):t?i.opt(i.as(e.root.controller,d.RootController),(function(e){return e.createGridControllerIfNone()})):null},createPaddedCollage:function(e){var t;return(t=r.getPageGrid(e,!0))?(t.setMarginAndSpacing(10,10),t.forma.root.style.colors.setColorId(s.ColorRole.FieldPrimary,"white"),t.forma):(c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.createPaddedCollage","GridFacade.swift",45),null)},setPageGridParameters:function(e,t,n){var o;(o=r.getPageGrid(e,!0))?isNaN(t)||isNaN(n)?isNaN(t)?isNaN(n)||(o.margin=n):o.spacing=t:o.setMarginAndSpacing(t,n):c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.setPageGridParameters","GridFacade.swift",67)},isChildSwappable:function(e){var t,n=i.clone(e.filterByControllerKind(u.GridController.KIND,l.FormaTraversal.NearestAncestor));return!!(t=i.as(i.opt(i.first(n),(function(e){return e.controller})),u.GridController))&&t.isChildSwappable(e)},swapChildren:function(e,t){var n,o=i.clone(e.filterByControllerKind(u.GridController.KIND,l.FormaTraversal.NearestAncestor));(n=i.as(i.opt(i.first(o),(function(e){return e.controller})),u.GridController))&&r.isChildSwappable(e)&&r.isChildSwappable(t)&&n.swapGridChildren(e,t)},setMoveableShift:function(e,t){e.moveableShift=t},getMoveableShift:function(e){return e.moveableShift},applyGridStyle:function(e,t,n){var o;(o=r.getPageGrid(n,!1))?o.applyStyle(e,t):c.LegacyCoreAssert.fail("couldn't get a grid controller",void 0,"GridFacade.applyGridStyle","GridFacade.swift",127)}}}),r)},x4Gy:function(e,t,n){var r,o,i,a,s,l,u,c=t,d=n("oAGj"),h=n("SpAV"),p=n("gXiO"),f=n("dJuF"),m=n("QgZx"),g=n("ZhwN"),y=n("iCxV"),_=n("fNpk"),T=n("c+uM"),v=n("Quhx"),C=n("Zifs"),P=n("a9ow"),S=n("enh0"),D=n("90dd");c.SolidColorRun=(r=function(e,t){this.attr=e,this.range=t},d.defineClass({name:"SolidColorRun",ctor:r}),r),c.SolidColorRuns=(o=function(){this.runArrays_=[],p.CoreObject.call(this)},d.defineClass({name:"SolidColorRuns",ctor:o,superName:"CoreObject",props:{apply:function(e,t){0!=t.length&&this.runArrays_.push(new c.SolidColorRun(e,t))},clear:function(){this.runArrays_.splice(0)},applyNewAlpha:function(e,t){for(var n=d.iter(e.runArrays);!n.done;n.next()){var r=n.value,o=(1-t)*r.attr.alpha+1*t,i=new C.SolidColor(r.attr.red,r.attr.green,r.attr.blue,o);this.apply(i,r.range)}},runArrays:{get:function(){return this.runArrays_}},clone:function(){for(var e=new o,t=d.iter(this.runArrays_);!t.done;t.next()){var n=t.value;e.apply(n.attr,n.range)}return e},asString:{get:function(){for(var e="",t=d.iter(this.runArrays_);!t.done;t.next()){var n=t.value;e=e+" "+n.range.asString+" "+n.attr.asString}return e}}}}),o),c.RenderRuns=(i=function(){this.fillColors=new c.SolidColorRuns,this.strokeColors=new c.SolidColorRuns,p.CoreObject.call(this)},d.defineClass({name:"RenderRuns",ctor:i,superName:"CoreObject",props:{applyColors:function(e,t,n){0!=n.length&&(this.fillColors.apply(e,n),this.strokeColors.apply(t,n))},copyColorAlpha:function(e,t){for(var n=e.fontColor,r=e.fontStrokeColor,o=d.iter(t.fillColors.runArrays);!o.done;o.next()){var i=o.value,a=new C.SolidColor(n.red,n.green,n.blue,i.attr.alpha);this.fillColors.apply(a,i.range)}for(var s=d.iter(t.strokeColors.runArrays);!s.done;s.next()){var l=s.value,u=new C.SolidColor(r.red,r.green,r.blue,l.attr.alpha);this.strokeColors.apply(u,l.range)}},setAlphaFromAnimation:function(e,t,n){this.clear(),this.fillColors.applyNewAlpha(e.fillColors,n),this.strokeColors.applyNewAlpha(e.strokeColors,n)},clear:function(){this.fillColors.clear(),this.strokeColors.clear()},clone:function(){var e=new i;return e.fillColors=this.fillColors.clone(),e.strokeColors=this.strokeColors.clone(),e},asString:{get:function(){return"Fill:"+this.fillColors.asString+" Stroke:"+this.strokeColors.asString}}}}),i),c.ContentTextModel=(a=function(){},d.defineClass({name:"ContentTextModel",ctor:a,superName:"TextModel",statics:{SCHEMA_CLASS_NAME:{get:function(){return"ContentTextModel"}},codec:{get:function(){return f.DBPropertyCodec.registerCodec(a.SCHEMA_CLASS_NAME,f.DBPropertyCodec.directObjectCodec(a.SCHEMA_CLASS_NAME))}},factory:{get:function(){return function(e,t,n,r){return a.init_866e(n,e)}}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_d41d:function(){var e={text:[new P.UTF16Attribute("")]};d.super_init(this,c.TextModel,c.TextModel.prototype.init_dd5d,{},e)},init_5aae:function(e){var t={},n={};if(null!=e)t=d.clone(e.state.allProperties);else{var r=[new P.UTF16Attribute("")];n[c.TextModel.PROPERTY_UTF16_NAME]=d.clone(r)}d.super_init(this,c.TextModel,c.TextModel.prototype.init_dd5d,t,n)},init_866e:function(e,t){d.super_init(this,c.TextModel,c.TextModel.prototype.init_866e,e,t);for(var n=d.iter(c.TextModel.allAttributeNames_);!n.done;n.next()){var r=n.value;r!=c.TextModel.PROPERTY_UTF16_NAME&&d.opt(this.getProperty(r),(function(e){return e.shouldWrite=!1}))}},className:{get:function(){return a.SCHEMA_CLASS_NAME}},clone:function(){return a.init_5aae(this)},match:function(e){this.set(c.TextModel.PROPERTY_UTF16_NAME,e.get(c.TextModel.PROPERTY_UTF16_NAME)),this.publish(new c.TextModelDidInsertMessage(this,0,this.text))},isEqual:function(e){var t;return!!(t=d.as(e,c.TextModel))&&this.text==t.text}}}),a),c.TextModel=(s=function(){},l={},d.defineClass({name:"TextModel",ctor:s,superName:"PostPublishingObject",statics:{PROPERTY_UTF16_NAME:"text",PROPERTY_FONT_NAME:"font-name",PROPERTY_FONT_SIZE:"font-size",PROPERTY_FONT_COLOR:"font-color",PROPERTY_FONT_STROKE_COLOR:"font-strokecolor",PROPERTY_FONT_STROKE_WIDTH:"font-strokewidth",PROPERTY_TEXT_LOOK:"text-look",PROPERTY_TRACKING:"tracking",SCHEMA_CLASS_NAME:{get:function(){return"TextModel"}},codec:{get:function(){return f.DBPropertyCodec.registerCodec(s.SCHEMA_CLASS_NAME,f.DBPropertyCodec.directObjectCodec(s.SCHEMA_CLASS_NAME))}},factory:{get:function(){return function(e,t,n,r){return s.init_866e(n,e)}}},defaultText:{get:function(){return null==s.defaultText_&&(s.defaultText_=new P.UTF16Attribute("")),s.defaultText_}},defaultFontColor:{get:function(){return null==s.defaultFontColor_&&(s.defaultFontColor_=new P.FontColorAttribute(y.Host.textModelUtils.defaultColor())),s.defaultFontColor_}},defaultFontName:{get:function(){return null==s.defaultFontName_&&(s.defaultFontName_=new P.FontDescriptorAttribute(y.Host.textModelUtils.defaultFont())),s.defaultFontName_}},defaultFontSize:{get:function(){return null==s.defaultFontSize_&&(s.defaultFontSize_=new P.FontSizeAttribute(y.Host.textModelUtils.defaultFontSize())),s.defaultFontSize_}},defaultFontStrokeColor:{get:function(){return null==s.defaultFontStrokeColor_&&(s.defaultFontStrokeColor_=new P.FontStrokeColorAttribute(y.Host.textModelUtils.defaultColor())),s.defaultFontStrokeColor_}},defaultFontStrokeWidth:{get:function(){return null==s.defaultFontStrokeWidth_&&(s.defaultFontStrokeWidth_=new P.FontStrokeWidthAttribute(S.TextForma.STROKEWIDTH_ZERO)),s.defaultFontStrokeWidth_}},defaultTextLook:{get:function(){return null==s.defaultTextLook_&&(s.defaultTextLook_=new P.TextLookAttribute(T.LockupTextLook.Fill)),s.defaultTextLook_}},defaultTracking:{get:function(){return null==s.defaultTracking_&&(s.defaultTracking_=new P.TrackingAttribute(S.TextForma.TRACKING_ZERO)),s.defaultTracking_}},allAttributeNames_:{get:function(){return void 0===l.allAttributeNames_&&(l.allAttributeNames_=[s.PROPERTY_UTF16_NAME,s.PROPERTY_FONT_COLOR,s.PROPERTY_FONT_NAME,s.PROPERTY_FONT_SIZE,s.PROPERTY_FONT_STROKE_COLOR,s.PROPERTY_FONT_STROKE_WIDTH,s.PROPERTY_TEXT_LOOK,s.PROPERTY_TRACKING]),l.allAttributeNames_}},defaultAttribute:function(e){switch(e){case"text":return s.defaultText;case"font-color":return s.defaultFontColor;case"font-name":return s.defaultFontName;case"font-size":return s.defaultFontSize;case"font-strokecolor":return s.defaultFontStrokeColor;case"font-strokewidth":return s.defaultFontStrokeWidth;case"text-look":return s.defaultTextLook;case"tracking":return s.defaultTracking;default:return null}},_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_d41d:function(){d.super_init(this,v.PostPublishingObject,v.PostPublishingObject.prototype.init_dd5d,{},{})},init_dd5d:function(e,t){d.super_init(this,v.PostPublishingObject,v.PostPublishingObject.prototype.init_dd5d,e,t)},init_36cd:function(e){d.super_init(this,v.PostPublishingObject,v.PostPublishingObject.prototype.init_dd5d,d.opt(e,(function(e){return e.state.allProperties}))||{},{})},init_866e:function(e,t){d.super_init(this,v.PostPublishingObject,v.PostPublishingObject.prototype.init_866e,e,t)},className:{get:function(){return s.SCHEMA_CLASS_NAME}},textAttr:{get:function(){var e;return(e=d.as(d.opt(d.as(this.get(s.PROPERTY_UTF16_NAME),["Array",P.TextAttribute]),(function(e){return e[0]})),P.UTF16Attribute))||null!=e?e:s.defaultText},set:function(e){this.set(s.PROPERTY_UTF16_NAME,[e])}},fontColor:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_COLOR),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontColorAttribute):null}},fontName:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_NAME),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontDescriptorAttribute):null}},fontSize:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_SIZE),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontSizeAttribute):null}},fontStrokeColor:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_STROKE_COLOR),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontStrokeColorAttribute):null}},fontStrokeWidth:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_FONT_STROKE_WIDTH),["Array",P.TextAttribute]))?d.as(d.first(e),P.FontStrokeWidthAttribute):null}},textLook:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_TEXT_LOOK),["Array",P.TextAttribute]))?d.as(d.first(e),P.TextLookAttribute):null}},tracking:{get:function(){var e;return(e=d.as(this.get(s.PROPERTY_TRACKING),["Array",P.TextAttribute]))?d.as(d.first(e),P.TrackingAttribute):null}},description:{get:function(){for(var e,t="TextModel: ",n=d.iter(s.allAttributeNames_);!n.done;n.next()){var r=n.value;t+=r+": "+((e=d.opt(d.first(d.as(this.get(r),["Array",P.TextAttribute])),(function(e){return e.description})))||null!=e?e:"<unset>")+" | "}return t}},runArraysByAttrName:{get:function(){for(var e={},t=d.iter(s.allAttributeNames_);!t.done;t.next()){var n=t.value,r=d.clone(d.as(this.get(n),["Array",P.TextAttribute]));if(null!=r)e[n]=d.clone(r);else{var o=s.defaultAttribute(n);null!=o&&(e[n]=[o])}}return e}},text:{get:function(){return this.textAttr.value},set:function(e){e!=this.textAttr.value&&(this.textAttr=new P.UTF16Attribute(e))}},isEqual:function(e){var t;if(t=d.as(e,s)){var n=d.clone(this.runArraysByAttrName),r=d.clone(t.runArraysByAttrName);if(d.count(r)!=d.count(n))return!1;for(var o=d.iter(n);!o.done;o.next()){var i,a=o.key,l=o.value;if(!(i=r[a]))return!1;if(i[0]!=l[0])return!1}return!0}return!1},hash:{get:function(){return d.hashValue(this.text)}},setAttr:function(e,t){var n;if(null!=e)if(t!=s.PROPERTY_UTF16_NAME)if(t==s.PROPERTY_FONT_NAME)(n=d.as(e,m.FontDescriptor))&&(d.eq(m._equality_FontDescriptor_FontDescriptor,n,d.opt(this.fontName,(function(e){return e.value})))||this.set(t,[new P.FontDescriptorAttribute(n)]));else if(t==s.PROPERTY_FONT_SIZE){var r;if(null!=(r=d.as(e,"Double"))){if(r==d.opt(this.fontSize,(function(e){return e.value})))return;if(0==r){_.LegacyCoreAssert.fail("attempted to set font size to 0.0",void 0,"TextModel.setAttr","TextModel.swift",476);var o=new P.FontSizeAttribute(1);this.set(t,[o])}else this.set(t,[new P.FontSizeAttribute(r)])}}else if(t==s.PROPERTY_FONT_COLOR)(i=d.as(e,C.SolidColor))&&(d.eq(C._equality_SolidColor_SolidColor,i,d.opt(this.fontColor,(function(e){return e.value})))||this.set(t,[new P.FontColorAttribute(i)]));else if(t==s.PROPERTY_FONT_STROKE_COLOR){var i;(i=d.as(e,C.SolidColor))&&(d.eq(C._equality_SolidColor_SolidColor,i,d.opt(this.fontStrokeColor,(function(e){return e.value})))||this.set(t,[new P.FontStrokeColorAttribute(i)]))}else if(t==s.PROPERTY_FONT_STROKE_WIDTH){var a;null!=(a=d.as(e,"Double"))&&a!=d.opt(this.fontStrokeWidth,(function(e){return e.value}))&&this.set(t,[new P.FontStrokeWidthAttribute(a)])}else if(t==s.PROPERTY_TEXT_LOOK){var l;null!=(l=d.as(e,T.LockupTextLook))&&l!=d.opt(this.textLook,(function(e){return e.value}))&&this.set(t,[new P.TextLookAttribute(l)])}else if(t==s.PROPERTY_TRACKING){var u;null!=(u=d.as(e,"Double"))&&u!=d.opt(this.tracking,(function(e){return e.value}))&&this.set(t,[new P.TrackingAttribute(u)])}else h.CoreAssert.fail("Missing setAttr code for "+t,void 0,"TextModel.setAttr","TextModel.swift",521);else h.CoreAssert.fail("Attempted to set text through apply!",void 0,"TextModel.setAttr","TextModel.swift",459);else null!=this.get(t)&&this.set(t,null)},match:function(e){for(var t=d.iter(s.allAttributeNames_);!t.done;t.next()){var n=t.value;this.set(n,e.get(n))}this.publish(new c.TextModelDidInsertMessage(this,0,this.text))},clone:function(){return this.fork(g.GUIDUtils.makeGUID())},insertTextUsingSubstring:function(e){var t=e+this.text.substr(0);this.text=t,this.publish(new c.TextModelDidInsertMessage(this,0,e))},replaceText:function(e){this.text=e,this.publish(new c.TextModelDidInsertMessage(this,0,e))}}}),s),c.TextModelDidInsertMessage=(u=function e(t,n,r){this.model=t,this.index=n,this.text=r,D.TheoMessage.call(this,e.TYPE,t)},d.defineClass({name:"TextModelDidInsertMessage",ctor:u,superName:"TheoMessage",statics:{TYPE:{get:function(){return"TextModelDidInsertMessage"}}}}),u)},y8UA:function(e,t,n){var r=t,o=n("oAGj");r.DocumentEvaluationScore=o.defineProtocol("DocumentEvaluationScore",{evaluateDocument:"() -> Void",reject:"() -> Boolean",print:"() -> String",evalScore:"() -> Double"})},yGNn:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("gXiO"),l=n("ZhwN"),u=n("iCxV"),c=n("fNpk");i.CorePromise=(r=function(e,t,n){this.chainingFn=null,this.finishFns=[],this.dependentPromises=[],this.finalized=!1,this.resolved=!1,this.finalValue=null,void 0===t&&(t=null),void 0===n&&(n=null);var r,o=this;if(this.guid=l.GUIDUtils.makeGUID(),s.CoreObject.call(this),null!=(r=e))a.opt(u.Host.exception,(function(e){return e.executeWithExceptionHandler((function(){return r((function(e){o.finalized?c.LegacyCoreAssert.fail("can't resolve a resolved/rejected promise",void 0,"CorePromise.init","CorePromise.swift",61):o.finalize(e,!0)}),(function(e){o.finalized?c.LegacyCoreAssert.fail("can't reject a resolved/rejected promise",void 0,"CorePromise.init","CorePromise.swift",68):o.finalize(e,!1)}))}),(function(e){return o.finalize(e,!1)}))}));else if(null!=t||null!=n){var i=this;this.chainingFn=function(e,r){var o;(o=i)&&a.opt(u.Host.exception,(function(i){return i.executeWithExceptionHandler((function(){if(r)if(null!=t){var i=t(e);o.handleChainResult(i,!0)}else o.finalize(e,!0);else null!=n?(i=n(e),o.handleChainResult(i,!0)):o.finalize(e,!1)}),(function(e){return o.finalize(e,!1)}))}))}}else c.LegacyCoreAssert.fail("no origin, resolve, or reject specified; this promise is useless",void 0,"CorePromise.init","CorePromise.swift",113)},a.defineClass({name:"CorePromise",ctor:r,superName:"CoreObject",statics:{make:function(e){return new r(e)},resolve:function(e){return new r((function(t,n){return t(e)}))},reject:function(e){return new r((function(t,n){return n(e)}))},deferred:function(){return new i.DeferredPromise},all:function(e){for(var t=r.resolve(null),n=a.repeat(null,e.length),o=function(e,t){return function(r){return e.then((function(e){return n[t]=e,e}))}},i=a.iter(a.range(0,e.length,!1));!i.done;i.next()){var s=i.value,l=e[s];t=t.then(o(l,s))}return t.then((function(e){return n}))},fromCoreError:function(e){return null==e?r.resolve(null):r.reject(e)}},props:{finalize:function(e,t){this.finalized=!0,this.finalValue=e,this.resolved=t,c.LegacyCoreAssert.isFalse(e instanceof r,"Should never finalize with a promise as value",void 0,"CorePromise.finalize","CorePromise.swift",171);for(var n=a.iter(this.dependentPromises);!n.done;n.next())n.value.handleUpstreamFinal(this);for(var o=a.iter(this.finishFns);!o.done;o.next())(0,o.value)(e,t)},handleUpstreamFinal:function(e){var t;null!=(t=this.chainingFn)?(t(e.finalValue,e.resolved),this.chainingFn=null):c.LegacyCoreAssert.fail("why is an origin promise being called by an upstream promise?",void 0,"CorePromise.handleUpstreamFinal","CorePromise.swift",193)},handleChainResult:function(e,t){var n,o=this;(n=a.as(e,r))?n.chainPromise((function(e){return o.handleChainResult(e,!0)}),(function(e){return o.handleChainResult(e,!1)})):this.finalize(e,t)},chainPromise:function(e,t){var n=new r(null,e,t);return this.dependentPromises.push(n),this.finalized&&n.handleUpstreamFinal(this),n},then:function(e){return this.chainPromise(e,null)},fail:function(e){return this.chainPromise(null,e)},thenReturn:function(e){return this.then((function(t){return e}))},finished:function(e){this.finalized?e(this.finalValue,this.resolved):this.finishFns.push(e)}}}),r),i.DeferredPromise=(o=function(){this.resolver=null,this.rejector=null,this.promise_=null;var e=this;s.CoreObject.call(this),this.promise_=new i.CorePromise((function(t,n){e.resolver=t,e.rejector=n}))},a.defineClass({name:"DeferredPromise",ctor:o,superName:"CoreObject",props:{promise:{get:function(){return this.promise_}},resolve:function(e){this.promise.finalized||a.opt(this.resolver,(function(t){return t(e)}))},reject:function(e){this.promise.finalized||a.opt(this.rejector,(function(t){return t(e)}))}}}),o)},ylxa:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("fWxZ"),l=n("fNpk"),u=n("1NAc");i.PageExportFormat=a.defineEnum("PageExportFormat",{PIXELS:0,MILLIMETERS:1,INCHES:2}),i.describePageExportFormat=function(e){switch(e){case 0:return"pixels";case 1:return"millimeters";case 2:return"inches"}},i.FormaPageExportData=(r=function(e,t,n){void 0===n&&(n=null),this.dimensions_=e,this.format_=t,this.ppi_=n,null!=n||t!=i.PageExportFormat.MILLIMETERS&&t!=i.PageExportFormat.INCHES||l.LegacyCoreAssert.fail("Must specify ppi for mm or inches",void 0,"FormaPageExportData.init","FormaPageExportData.swift",49)},o={},a.defineClass({name:"FormaPageExportData",ctor:r,superName:"CoreObject",statics:{PROPERTY_DIMENSIONS:"dimensions",PROPERTY_FORMAT:"format",PROPERTY_PPI:"ppi",MM_TO_INCHES:{get:function(){return void 0===o.MM_TO_INCHES&&(o.MM_TO_INCHES=1/25.4),o.MM_TO_INCHES}},POINTS_PER_INCH:72,DEFAULT_PPI:300,exportPixels:function(e){return new r(e,i.PageExportFormat.PIXELS,null)},exportInches:function(e,t){return new r(e,i.PageExportFormat.INCHES,t)},exportMillimeters:function(e,t){return new r(e,i.PageExportFormat.MILLIMETERS,t)},decodeJson:function(e){var t;if(null==e)return null;var n=a.as(e,["Dictionary","String","Any"]);if(null==n)return l.LegacyCoreAssert.fail("FormaPageExportData.decodeJSON : object passed isn't a dictionary",void 0,"FormaPageExportData.decodeJson","FormaPageExportData.swift",128),null;var o,s,c,d=null,h=i.PageExportFormat.PIXELS,p=u.TheoSize.Zero;return(o=u.TheoSize.decodeJson(a.as(n[r.PROPERTY_DIMENSIONS],"AnyObject")))&&(p=o),null!=(s=a.as(n[r.PROPERTY_FORMAT],"Int"))?h=(t=i.PageExportFormat.toCaseValue(s))||null!=t?t:i.PageExportFormat.PIXELS:l.LegacyCoreAssert.fail("Must have format encoded",void 0,"FormaPageExportData.decodeJson","FormaPageExportData.swift",144),null!=(c=a.as(n[r.PROPERTY_PPI],"Double"))&&(d=c),new r(p,h,d)}},props:{dimensions:{get:function(){return this.dimensions_}},format:{get:function(){return this.format_}},PPI:{get:function(){return null==this.ppi?s.FormaPage.DEFAULT_CUSTOM_SIZE_PPI:this.ppi_}},ppi:{get:function(){return this.ppi_}},pixelDimensions:{get:function(){return this.format_==i.PageExportFormat.MILLIMETERS?this.dimensions_.multiply(r.MM_TO_INCHES*this.ppi_):this.format_==i.PageExportFormat.INCHES?this.dimensions_.multiply(this.ppi_):(l.LegacyCoreAssert.isTrue(this.format_==i.PageExportFormat.PIXELS,"unexpected page export format",{format:this.format_},"FormaPageExportData","FormaPageExportData.swift",87),this.dimensions_)}},pointDimensions:{get:function(){return this.format_==i.PageExportFormat.MILLIMETERS?this.dimensions_.multiply(r.MM_TO_INCHES*r.POINTS_PER_INCH):this.format_==i.PageExportFormat.INCHES?this.dimensions_.multiply(r.POINTS_PER_INCH):(l.LegacyCoreAssert.isTrue(this.format_==i.PageExportFormat.PIXELS,"unexpected page export format",{format:this.format_},"FormaPageExportData","FormaPageExportData.swift",104),this.dimensions_)}},encodeJson:function(){var e={};return e[r.PROPERTY_DIMENSIONS]=this.dimensions_.encodeJson(),e[r.PROPERTY_FORMAT]=this.format_,null!=this.ppi_&&(e[r.PROPERTY_PPI]=this.ppi_),e}}}),r)},ytEx:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("gXiO"),s=n("3OP7"),l=n("iCxV"),u=n("fNpk");o.PROPERTY_KEY_ID="id",o.PROPERTY_KEY_TYPE="type",o.PROPERTY_KEY_NAME="name",o.PROPERTY_KEY_PATH="path",o.PROPERTY_KEY_MIMETYPE="mimeType",o.PROPERTY_KEY_ETAG="etag",o.PROPERTY_KEY_URL="url",o.PROPERTY_KEY_RELATIONSHIP="rel",o.ASSETS_PATH="assets",o.BaseNodeEncoder=(r=function(e,t){this.childNodeEncoders_=[],this.branch_=e,this.componentNode_=t,a.CoreObject.call(this)},i.defineClass({name:"BaseNodeEncoder",ctor:r,superName:"CoreObject",statics:{_implements:function(e){return"IExportDataObject"==e}},props:{prepareCompositeForSave:function(e){u.LegacyCoreAssert.isTrue(null==this.stashNode_,"creating a stashNode when we already have one?",void 0,"BaseNodeEncoder.prepareCompositeForSave","BaseNodeEncoder.swift",35),this.stashNode_=this.createTempNode(this.branch_.root);for(var t=i.iter(this.branch_.allComponents);!t.done;t.next()){var n=t.value;null!=n.relationship&&e.includes(n.relationship)||this.branch_.moveComponent(n,this.createTempNode(this.stashNode_))}for(var r=i.iter(this.branch_.getChildrenOfNode(this.branch_.root));!r.done;r.next()){var a=r.value,s=i.as(a.getValue(o.PROPERTY_KEY_RELATIONSHIP),"String");null!=s&&e.includes(s)||a.nodeId!=this.stashNode_.nodeId&&a.path!=o.ASSETS_PATH&&this.branch_.removeNode(a)}},createTempNode:function(e){var t=i.opt(l.Host.resourceUtils,(function(e){return e.makeGUID()}));return this.branch_.appendNode(t,t,e)},discardStashedComponents:function(){this.branch_.removeNode(this.stashNode_)},getPropertyOnNode:function(e){return u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeEncoder.getPropertyOnNode","BaseNodeEncoder.swift",80),null},setPropertyOnNode:function(e,t){u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeEncoder.setPropertyOnNode","BaseNodeEncoder.swift",85)},id:{get:function(){return i.as(this.getPropertyOnNode(o.PROPERTY_KEY_ID),"String")}},path:{get:function(){return i.as(this.getPropertyOnNode(o.PROPERTY_KEY_PATH),"String")}},setName:function(e){this.setPropertyOnNode(o.PROPERTY_KEY_NAME,i.as(e,"AnyObject"))},setType:function(e){this.setPropertyOnNode(o.PROPERTY_KEY_TYPE,i.as(e,"AnyObject"))},setPath:function(e){this.setPropertyOnNode(o.PROPERTY_KEY_PATH,i.as(e,"AnyObject"))},setProperty:function(e,t){var n=s.DocumentPersistenceFactory.namespacedPropertyName(e);this.setPropertyOnNode(n,t)},setOptionalStringProperty:function(e,t){this.setProperty(e,i.as(t,"AnyObject"))},setStringProperty:function(e,t){this.setProperty(e,i.as(t,"AnyObject"))},setNumberProperty:function(e,t){u.LegacyCoreAssert.isFalse(isNaN(t),"Can't set NaN for prop.",{property:e},"BaseNodeEncoder.setNumberProperty","BaseNodeEncoder.swift",122),this.setProperty(e,i.as(t,"AnyObject"))},setIntProperty:function(e,t){this.setProperty(e,i.as(t,"AnyObject"))},setBooleanProperty:function(e,t){this.setProperty(e,i.as(t,"AnyObject"))},setOptionalBooleanProperty:function(e,t){this.setProperty(e,i.as(t,"AnyObject"))},createChildEncoder:function(e){return u.LegacyCoreAssert.fail("must be overridden",void 0,"BaseNodeEncoder.createChildEncoder","BaseNodeEncoder.swift",139),new r(this.branch_,this.componentNode_)},findChild:function(e){return null==e?null:this.childNodeEncoders_.find((function(t){return t.path==e}),this)},appendChild:function(e){var t=this.createChildEncoder(e);return this.childNodeEncoders_.push(t),t},appendComponent:function(e,t,n){var r,o=i.opt(l.Host.pathUtils,(function(e){return e.absolutePathFromURL(t)})),a=e,s=i.clone(i.opt(i.opt(l.Host.pathUtils,(function(e){return e.lastPathComponentFromURL(t)})),(function(e){return e.split(".")})));if(null!=s&&s.length>1){var u=i.last(s);i.isEmpty(u)||(a+="."+u)}if(r=this.branch_.getComponentWithId(e)){if(this.nodeHasComponentWithPath(r.path)||i.opt(r.path,(function(e){return 1==e.includes("/")}))){var c=r.mutableCopy;c.path=a,r=this.branch_.updateComponent(c,null,!1)}this.branch_.moveComponent(r,this.componentNode_)}else i.opt(o,(function(e){return 1==e.startsWith("shapes/")}))||this.branch_.addComponent(e,e,n,null,a,this.componentNode_,o,!0,null)},nodeHasComponentWithPath:function(e){if(null!=e)for(var t=i.iter(this.branch_.getComponentsOfNode(this.componentNode_));!t.done;t.next())if(t.value.path==e)return!0;return!1},setCompositeID:function(e){},setDocumentSize:function(e,t){},setManifestProperty:function(e,t,n){n?this.getManifestEncoder().setProperty(e,t):this.getManifestEncoder().setPropertyOnNode(e,t)},getManifestEncoder:function(){return this},finish:function(){for(var e=i.iter(this.childNodeEncoders_);!e.done;e.next())e.value.finish()}}}),r)},yumk:function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("iCxV"),l=n("SDdr");i.ImageFilterFactory=(r=function(){this.lookup_={},this.lookup_[l.ImageFilter.KIND]=function(){return l.ImageFilter.createDefault()},this.lookup_[l.AlphaBlendFilter.KIND]=function(){return l.AlphaBlendFilter.createDefault()},this.lookup_[l.CompositeFilter.KIND]=function(){return l.CompositeFilter.createDefault()}},o={},a.defineClass({name:"ImageFilterFactory",ctor:r,superName:"CoreObject",statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}}},props:{create:function(e){var t;return null!=(t=this.lookup_[e])?t():(a.opt(s.Host.logging,(function(t){return t.warning("no constructor for filter kind = "+e)})),null)}}}),r)},"zW/s":function(e,t,n){var r,o,i=t,a=n("oAGj"),s=n("7Pku"),l=n("w/+j"),u=n("fNpk"),c=n("Ird5"),d=n("jfma"),h=n("yjxF"),p=n("Aj79"),f=n("ZA1K"),m=n("WWR6");i.VectorFormaToPGMMapper=(r=function e(){s.FormaToPGMMapper.call(this,e.FORMA_KIND)},o={},a.defineClass({name:"VectorFormaToPGMMapper",ctor:r,superName:"FormaToPGMMapper",statics:{FORMA_KIND:{get:function(){return void 0===o.FORMA_KIND&&(o.FORMA_KIND=m.VectorForma.KIND),o.FORMA_KIND}},instance:{get:function(){return void 0===o.instance&&(o.instance=new r),o.instance}},createMapper:function(e){return r.instance}},props:{makePGMRef:function(e,t,n,r){var o;return(o=a.as(e,m.VectorForma))?l.FormaToPGMUtils.applyAnimations(t,e,new p.PGMReference(new f.PGMSVG(o.formaID,new h.PGMNodeMetadata(o.formaID,"VectorForma"),c.PGMAnimationList.EMPTY,o.bounds,o.contentNode.url),new d.PGMCompositingParams(o.placement,o.style.opacity))):(u.LegacyCoreAssert.fail("VectorFormaToPGMMapper called for something that's not a VectorForma",void 0,"VectorFormaToPGMMapper.makePGMRef","VectorFormaToPGMMapper.swift",49),null)}}}),r)},zjY7:function(e,t,n){var r,o,i,a,s,l=t,u=n("oAGj"),c=n("cZuM"),d=n("gXiO"),h=n("FNB+"),p=n("6ZWm"),f=n("pnSN"),m=n("ZhwN"),g=n("iCxV"),y=n("fNpk"),_=n("c+uM"),T=n("uj1m"),v=n("3DEm"),C=n("txj3"),P=n("7Ta2"),S=n("djAF"),D=n("T6jX"),A=n("8t9B"),E=n("ThKb"),R=n("oKlP"),F=n("sIWg"),b=n("qSCS");l.PairingFeatures=u.defineEnum("PairingFeatures",{BOUNDARY_DISTANCE:"boundary_distance",CENTER_DISTANCE:"center_distance",X_ALIGNED:"x_aligned",Y_ALIGNED:"y_aligned",LEFT_ALIGNED:"left_aligned",CENTER_X_ALIGNED:"center_x_aligned",RIGHT_ALIGNED:"right_aligned",TOP_ALIGNED:"top_aligned",CENTER_Y_ALIGNED:"center_y_aligned",BOTTOM_ALIGNED:"bottom_aligned",HEIGHT_DIFF:"height_diff",WIDTH_DIFF:"width_diff",AREA_DIFF:"area_diff",CONTAINMENT_MISMATCH:"containment_mismatch",INTERSECTION:"intersection",CONTAINMENT_CHILD_COUNT:"containment_child_count",CHILD_COUNT_MATCH:"child_count_match",UNION_POSITION_X:"union_position_x",UNION_POSITION_Y:"union_position_y",UNION_NUM_NON_INTERSECT:"union_num_non_intersect",UNION_AREA:"union_area",UNION_EMPTY_SPACE:"union_empty_space",OUT_OF_BOUNDS_MISMATCH:"out_of_bounds_mismatch",OPACITY_DIFFERENCE:"opacity_difference",COLOR_DISTANCE:"color_distance",FONT_SIZE_DISTANCE:"font_size_distance",POSITION_X_FIRST:"position_x_first",POSITION_Y_FIRST:"position_y_first",POSITION_X_SECOND:"position_x_second",POSITION_Y_SECOND:"position_y_second",AREA_FIRST:"area_first",AREA_SECOND:"area_second",IS_SHAPE_FIRST:"is_shape_first",IS_TEXT_FIRST:"is_text_first",IS_IMAGE_FIRST:"is_image_first",IS_SHAPE_SECOND:"is_shape_second",IS_TEXT_SECOND:"is_text_second",IS_IMAGE_SECOND:"is_image_second",TYPE_MISMATCH:"type_mismatch"}),l.GroupLayoutStrategy=u.defineEnum("GroupLayoutStrategy",{Default:0,VerticalFlow:1,HorizontalFlow:2}),l.VisualNode=(r=function(){this.origNode=null,this.constraintLeft=!1,this.constraintRight=!1,this.constraintWidth=!1,this.constraintTop=!1,this.constraintBottom=!1,this.constraintHeight=!1,this.bgConstraint=!1,this.id=m.GUIDUtils.makeGUID()},u.defineClass({name:"VisualNode",ctor:r,superName:"CoreObject",props:{frame:{get:function(){return this.frame_},set:function(e){null==this.frame_&&(this.initFrame=e),this.frame_=e}},root:{get:function(){for(var e=this.parent;null!=e&&null!=e.parent;)e=e.parent;return e}},shortID:{get:function(){return this.id.substr(0,4)}},maintainAspectRatio:{get:function(){return!1}},clone:function(){var e=new r;return e.frame=this.frame,e.initFrame=this.initFrame,e.origNode=this,e.bgConstraint=this.bgConstraint,e},description:{get:function(){return"???: "+this.shortID+" "+this.frameString}},frameString:{get:function(){var e=u.toString(Math.round(this.frame.minX)),t=u.toString(Math.round(this.frame.maxX)),n=u.toString(Math.round(this.frame.minY)),r=u.toString(Math.round(this.frame.maxY));return" x: "+e+" "+t+" ("+u.toString(Math.round(this.frame.width))+"), y:"+n+" "+r+" ("+u.toString(Math.round(this.frame.height))+")"}},resetConstraints:function(e){void 0===e&&(e=null),null!=e&&e||this.resetXConstraints(),(null==e||e)&&this.resetYConstraints()},resetXConstraints:function(){this.constraintLeft=!1,this.constraintRight=!1,this.constraintWidth=!1},resetYConstraints:function(){this.constraintTop=!1,this.constraintBottom=!1,this.constraintHeight=!1},print:function(){for(var e="",t=[this];t.length>0;){var n,r=t[0];t.splice(0,1),(n=u.as(r,l.VisualNodeGroup))&&(t=n.children.concat(t));for(var o=r.parent;null!=o;)o=u.opt(o,(function(e){return e.parent})),e+="\t";e+=r.description+"\n"}return e}}}),r),l.VisualNodeLeaf=(o=function(e,t){this.hasForegroundRole_=null,this.hasBackgroundRole_=null,void 0===t&&(t=null),this.forma=e,l.VisualNode.call(this),this.frame=null!=t?t:e.frame},u.defineClass({name:"VisualNodeLeaf",ctor:o,superName:"VisualNode",props:{maintainAspectRatio:{get:function(){return this.forma.controller.maintainAspectRatio}},clone:function(){var e=new o(this.forma,this.frame);return e.origNode=this,e},hasForegroundRole:{get:function(){if(null!=this.hasForegroundRole_)return this.hasForegroundRole_;if(this.forma.isTypeLockup())return this.hasForegroundRole_=!0,!0;var e=u.clone((new P.RoleSuggester).getRole(this.forma));return e.role!=P.InferredRoleType.Seperator&&e.role!=P.InferredRoleType.GraphicContent||!this.forma.isTypeLockup()?(this.hasForegroundRole_=!1,!1):(this.hasForegroundRole_=!0,!0)}},hasBackgroundRole:{get:function(){if(null!=this.hasBackgroundRole_)return this.hasBackgroundRole_;var e=u.clone((new P.RoleSuggester).getRole(this.forma));return e.role==P.InferredRoleType.Background&&e.confidence>.5||e.secondaryRole==P.InferredRoleType.Background&&e.secondaryConfidence>.5?(this.hasBackgroundRole_=!0,!0):(this.hasBackgroundRole_=!1,!1)}},description:{get:function(){var e,t,n="";if(e=u.as(this.forma.controller,A.TypeLockupController)){var r=u.replaceAll(e.text.substr(0,6),"\n","");n="T: "+this.shortID+" "+r}else if(t=u.as(this.forma,S.ShapeForma)){var o,i;n="S: "+this.shortID+" ",(o=u.opt(u.as(t.contentNode,b.URLBasedContentNode),(function(e){return e.mediaMetadata})))&&null!=(i=o.searchTerm)&&(n+=i)}else n=this.forma.controller instanceof p.FrameController?"I: "+this.shortID+" ":"???: "+this.shortID+" "+this.forma.controller.kind;return n+=this.frameString}}}}),o),l.VisualNodeGroup=(i=function(e,t){if(this.alignments=[],void 0===t&&(t=null),this.children=u.clone(e),this.maintainAspectRatio_=!1,l.VisualNode.call(this),null==t){if(this.frame=F.TheoRect.Zero,e.length>0){this.frame=e[0].frame;for(var n=u.iter(e);!n.done;n.next()){var r=n.value;this.frame=this.frame.unionWith(r.frame)}}}else this.frame=t;for(var o=u.iter(e);!o.done;o.next()){var i;(i=(r=o.value).parent)&&i.removeChildren([r]),r.parent=this}this.setMaintainAspectRatio()},u.defineClass({name:"VisualNodeGroup",ctor:i,superName:"VisualNode",statics:{extractNodeInfo:function(e){var t,n,r={};if(t=u.as(e,i)){r.type=u.as("Group","AnyObject"),r.frame=t.frame.encodeJson(),r.layoutStrategy=u.as(t.layoutStrategyString,"AnyObject");for(var o=[],a=u.iter(t.children);!a.done;a.next()){var s=a.value;o.push(i.extractNodeInfo(s))}r.children=u.as(o,"AnyObject")}return(n=u.as(e,l.VisualNodeLeaf))&&(r.type=u.as(n.forma.controller.kind,"AnyObject"),r.formaId=u.as(n.forma.formaID,"AnyObject"),r.frame=n.forma.finalFrame.encodeJson(),r.role=u.as((new P.RoleSuggester).getRole(n.forma).role,"AnyObject")),r}},props:{maintainAspectRatio:{get:function(){return this.maintainAspectRatio_},set:function(e){this.maintainAspectRatio_=e}},layoutStrategyString:{get:function(){var e;if(null!=(e=this.layoutStrategy)){if(e==l.GroupLayoutStrategy.Default)return"default";if(e==l.GroupLayoutStrategy.VerticalFlow)return"vertical";if(e==l.GroupLayoutStrategy.HorizontalFlow)return"horizontal"}return"None"}},setMaintainAspectRatio:function(){this.maintainAspectRatio_=!1;for(var e=u.iter(this.children);!e.done;e.next()){var t,n=e.value;if((t=this.frame.intersectionWith(n.frame))&&Math.abs(t.area-this.frame.area)/this.frame.area<.1)return void(this.maintainAspectRatio_=n.maintainAspectRatio)}for(var r=0,o=u.iter(this.children);!o.done;o.next()){var i;n=o.value,(i=u.as(n,l.VisualNodeLeaf))&&i.maintainAspectRatio&&(r+=1)}r==this.children.length&&this.children.length>0&&(this.maintainAspectRatio_=!0)},clone:function(){for(var e=[],t=u.iter(this.children);!t.done;t.next()){var n=t.value;e.push(n.clone())}var r=new i(e,this.frame);r.origNode=this,r.layoutStrategy=this.layoutStrategy,r.alignments=u.clone(this.alignments),r.bgConstraint=this.bgConstraint;for(var o=u.iter(e);!o.done;o.next())(n=o.value).parent=r;return r},addChildren:function(e){for(var t={},n=[],r=u.iter(e);!r.done;r.next()){var o=r.value;n.push(o.id),t[o.id]=o}for(var i=u.iter(n);!i.done;i.next()){var a;(a=(o=t[i.value]).parent)&&a.removeChildren([o]),this.children.push(o),o.parent=this}},removeChildren:function(e){for(var t=u.iter(e);!t.done;t.next()){var n=t.value;this.children.includes(n)&&u.remove(this.children,n)}},descendents:{get:function(){for(var e=[],t=u.iter(this.children);!t.done;t.next()){var n,r=t.value;e.push(r),(n=u.as(r,i))&&(e=e.concat(n.descendents))}return e}},leafDescendents:{get:function(){for(var e=[],t=u.iter(this.children);!t.done;t.next()){var n,r,o=t.value;(n=u.as(o,l.VisualNodeLeaf))&&e.push(n),(r=u.as(o,i))&&(e=e.concat(r.leafDescendents))}return e}},filledGroup:{get:function(){for(var e=u.iter(this.leafDescendents);!e.done;e.next())if(e.value.frame.equalWithAccuracy(this.frame,1))return!0;return!1}},description:{get:function(){var e=this.bgConstraint?" bg":"";return"G: "+this.shortID+" "+this.layoutStrategyString+e+" "+this.frameString}},encodeToJson:function(){return u.clone(i.extractNodeInfo(this))}}}),i),l.VisualNodeData=(a=function(){this.formae=[],this.fontSize=[],this.opacities=[],this.colors=[],this.unionIntersections={},this.nodeDistances={},this.alignments={},this.intersections=[],this.parentContainment=[],this.childContainment=[]},u.defineClass({name:"VisualNodeData",ctor:a,props:{frame:{get:function(){return this.node.frame}},init_d79d:function(e){this.node=e},init_b16c:function(e,t,n){this.node=e,this.formae=t.formae.concat(n.formae),this.fontSize=t.fontSize.concat(n.fontSize),this.opacities=t.opacities.concat(n.opacities),this.colors=t.colors.concat(n.colors);for(var r=u.iter(t.alignments);!r.done;r.next())for(var o=r.key,i=r.value,a=u.iter(n.alignments);!a.done;a.next()){var s=a.key,l=a.value;o==s&&(this.alignments[o]=i.concat(l))}},init_ff0a:function(e,t){this.node=e;var n,r,o=e.forma;this.formae.push(o),(n=o.style.colors.fieldPrimary)&&this.colors.push(n),(n=o.style.colors.fieldSecondary)&&this.colors.push(n),this.opacities.push(o.style.opacity),(r=u.as(o.controller,A.TypeLockupController))&&this.fontSize.push(r.getCurrentFontSize());for(var i=c.AlignmentDetector.init_a00d(o,t),a=u.iter(i.detectFormaAlignments(c.AlignmentDetector.DISTANCE_THRESHOLD,void 0,!1));!a.done;a.next()){var s=a.value;if(u.containsEq(t,s.forma,h._equality_Forma_Forma)){var l=s.forma.formaID;null==this.alignments[l]&&(this.alignments[l]=[]),this.alignments[l].push(s)}}},nodeIntersection:function(e,t){for(var n=[],r=u.iter(e);!r.done;r.next()){var o=r.value;t.includes(o)&&n.push(o)}return n},setPairwiseDistanceTerms:function(e){if(this.intersections=u.clone(this.nodeIntersection(this.intersections,e)),this.parentContainment=u.clone(this.nodeIntersection(this.parentContainment,e)),this.childContainment=u.clone(this.nodeIntersection(this.childContainment,e)),null==this.node||u.opt(this.node,(function(e){return null==e.frame})))u.info("ERROR: in setPairwiseDistanceTerms");else for(var t=u.iter(e);!t.done;t.next()){var n=t.value,r=n.id;if(n!=this.node&&null==this.nodeDistances[r]){if(null!=n.inferenceData)for(var o=u.iter(n.inferenceData.formae);!o.done;o.next()){var i=o.value,a=u.clone(this.alignments[i.formaID]);null!=a&&(this.alignments[r]=u.clone(a))}if(null==n.frame)return void u.info("ERROR: in setPairwiseDistanceTerms");var s,l=n.frame;(s=l.intersectionWith(this.node.frame))&&(s.area/this.frame.area>.95?this.parentContainment.push(n):s.area/l.area>.95&&this.childContainment.push(n),this.intersections.push(n)),this.nodeDistances[r]=this.frame.L1Distance(l),this.unionIntersections[r]=[];for(var c=this.frame.unionWith(l),d=u.iter(e);!d.done;d.next()){var h=d.value;h!=n&&this.node!=h&&h.frame.intersects(c)&&this.unionIntersections[r].push(h)}}}}}}),a),l.VisualStructureDetector=(s=function(e,t){this.SPACING_REL_MERGE_THRESHOLD=.25,this.SPACING_ABS_MERGE_THRESHOLD=20,this.nodes_=[],this.pairwiseGroupScores_={},this.fastDetection_=!1;var n,r,o=this;this.parentForma_=t,this.fastDetection_=e.length>D.TheoDocumentUtils.DESIGN_COMPLEXITY_HEURISTIC_THRESHOLD;for(var i=u.iter(e);!i.done;i.next()){var a=i.value,s=new l.VisualNodeLeaf(a),c=l.VisualNodeData.init_ff0a(s,this.fastDetection_?[]:e);s.inferenceData=c,s.frame=u.opt(s.frame,(function(e){return e.intersectionWith(o.parentForma_.bounds)})),null!=s.frame?this.nodes_.push(s):u.opt(g.Host.logging,(function(e){return e.info("node.frame == nil in VisualStructureDetector")}))}for(var h=u.iter(this.nodes_);!h.done;h.next())(s=h.value).inferenceData.node=s,s.inferenceData.setPairwiseDistanceTerms(this.nodes_);if(this.bgFrames_=[],(n=t.finalFrame)&&(r=u.opt(this.parentForma_.root,(function(e){return e.filterWithCallback((function(e){return null!=e.controller&&e.isGridCell()}))})))){for(var p=u.iter(r);!p.done;p.next()){var f;if((f=(a=p.value).finalFrame)&&n.contains(f)){var m=a.bounds.transform(a.totalPlacement.concat(t.totalPlacement.inverse));n.equal(f)&&y.LegacyCoreAssert.isTrue(t.bounds.equal(m),"Expected parent bounds to match transformed bounds of bg forma (because final frames match)",void 0,"VisualStructureDetector.init","VisualStructureDetector.swift",808),this.bgFrames_.push(m)}}if(this.bgFrames_.length>0)for(var _=u.iter(u.range(0,4,!1));!_.done;_.next()){for(var T=null,v=[new R.TheoPoint(.5,0),new R.TheoPoint(0,.5),new R.TheoPoint(.5,1),new R.TheoPoint(1,.5)],C=u.iter(v);!C.done;C.next()){for(var P=C.value,S=t.bounds.eval(P),A=null,E=1/0,b=u.iter(this.bgFrames_);!b.done;b.next()){var I=(m=b.value).eval(P),O=.5==P.x?Math.abs(S.y-I.y):Math.abs(S.x-I.x);E>O&&(E=O,A=m)}if(null!=A&&E>0){var k=.5==P.x?t.bounds.horizontalLine(P.y):t.bounds.verticalLine(P.x),N=.5==P.x?A.horizontalLine(P.y):A.verticalLine(P.x),M=F.TheoRect.boundsOfPoints([k.p1,k.p2,N.p1,N.p2]);(null==T||T.area<M.area)&&(T=M)}}if(null==T)break;this.bgFrames_.push(T)}}d.CoreObject.call(this)},u.defineClass({name:"VisualStructureDetector",ctor:s,superName:"CoreObject",props:{inferVisualStructure:function(){if(0==this.nodes_.length)return null;for(var e=[],t=[],n=u.iter(this.nodes_);!n.done;n.next()){var r=n.value;this.isBackgroundElement(r)?e.push(r):t.push(r)}var o=this.groupNodes(e),i=this.groupNodes(t);return null==o?i:(null==i||o.addChildren(i.children),o)},groupNodes:function(e){if(0==e.length)return null;var t=u.clone(this.fastDetection_?this.fastMergeNodes(e):this.mergeNodes(e)),n=u.clone(this.createBackgroundGroupNodes(t));return new l.VisualNodeGroup(n,this.parentForma_.bounds)},scoreNodeGrouping:function(e,t){var n,r,o,i={};if((n=e.inferenceData)&&(r=t.inferenceData)&&(o=u.opt(r.formae[0].parent,(function(e){return e.bounds})))){var a,s=e.frame.unionWith(t.frame);if(a=n.unionIntersections[t.id]){for(var d=u.clone(n.intersections),h=u.clone(r.intersections),p=0,f=u.iter(a);!f.done;f.next()){var m=f.value;d.includes(m)||h.includes(m)||(p+=1)}i[l.PairingFeatures.UNION_NUM_NON_INTERSECT]=u.toDouble(p)}var g=u.clone(n.parentContainment),y=u.clone(r.parentContainment);n.childContainment.includes(t)?i[l.PairingFeatures.CONTAINMENT_CHILD_COUNT]=u.toDouble(n.childContainment.length-1):r.childContainment.includes(e)&&(i[l.PairingFeatures.CONTAINMENT_CHILD_COUNT]=u.toDouble(r.childContainment.length-1)),g.includes(t)&&u.remove(g,t),y.includes(e)&&u.remove(y,e);for(var _=0,v=u.iter(g.concat(y));!v.done;v.next()){var P=v.value;g.includes(P)&&y.includes(P)||(_+=1)}i[l.PairingFeatures.CONTAINMENT_MISMATCH]=_,i[l.PairingFeatures.BOUNDARY_DISTANCE]=n.nodeDistances[t.id],i[l.PairingFeatures.CENTER_DISTANCE]=n.frame.center.distanceTo(r.frame.center);var S,D=u.clone(n.alignments[t.id]),A=u.clone(r.alignments[e.id]);if(null!=D&&null!=A)for(var R=u.iter(D);!R.done;R.next())for(var F=R.value,b=u.iter(A);!b.done;b.next()){var I=b.value;F.line.type==I.line.type&&(F.line.type==c.AlignmentType.CenterX?i[l.PairingFeatures.CENTER_X_ALIGNED]=1:F.line.type==c.AlignmentType.Left?i[l.PairingFeatures.LEFT_ALIGNED]=1:F.line.type==c.AlignmentType.Right?i[l.PairingFeatures.RIGHT_ALIGNED]=1:F.line.type==c.AlignmentType.Top?i[l.PairingFeatures.TOP_ALIGNED]=1:F.line.type==c.AlignmentType.CenterY?i[l.PairingFeatures.CENTER_Y_ALIGNED]=1:F.line.type==c.AlignmentType.Bottom&&(i[l.PairingFeatures.BOTTOM_ALIGNED]=1),F.line.type==c.AlignmentType.CenterX||F.line.type==c.AlignmentType.Left||F.line.type==c.AlignmentType.Right?i[l.PairingFeatures.X_ALIGNED]=1:i[l.PairingFeatures.Y_ALIGNED]=1)}if(S=n.frame.intersectionWith(r.frame)){var O=S.area/Math.max(n.frame.area,r.frame.area);i[l.PairingFeatures.INTERSECTION]=O}for(var k=0,N=u.iter(n.formae);!N.done;N.next()){for(var M=N.value,L=!1,x=u.iter(r.formae);!x.done;x.next())((G=x.value).isTypeLockup()&&M.isTypeLockup()||G.isGraphic()&&M.isGraphic())&&(L=!0);L||(k=1)}for(var B=u.iter(r.formae);!B.done;B.next()){M=B.value,L=!1;for(var w=u.iter(n.formae);!w.done;w.next()){var G;((G=w.value).isTypeLockup()&&M.isTypeLockup()||G.isGraphic()&&M.isGraphic())&&(L=!0)}L||(k=1)}i[l.PairingFeatures.TYPE_MISMATCH]=k;for(var Y=null,U=u.iter(n.colors);!U.done;U.next())for(var j=U.value,V=u.iter(r.colors);!V.done;V.next()){var H=V.value;Y=null==Y?j.distanceTo(H):Math.min(Y,j.distanceTo(H))}i[l.PairingFeatures.COLOR_DISTANCE]=null!=Y?Y:0;for(var K=null,W=u.iter(n.opacities);!W.done;W.next())for(var X=W.value,z=u.iter(r.opacities);!z.done;z.next()){var q=z.value;K=null==K?Math.abs(X-q):Math.min(K,Math.abs(X-q))}i[l.PairingFeatures.OPACITY_DIFFERENCE]=null!=K?K:0;for(var Z=null,J=u.iter(n.fontSize);!J.done;J.next())for(var Q=J.value,$=u.iter(r.fontSize);!$.done;$.next()){var ee=$.value;Z=null==Z?Math.abs(Q-ee):Math.min(Z,Math.abs(Q-ee))}i[l.PairingFeatures.FONT_SIZE_DISTANCE]=null!=Z?Z:0;var te=!o.contains(n.frame)&&o.contains(r.frame)||o.contains(n.frame)&&!o.contains(r.frame);i[l.PairingFeatures.OUT_OF_BOUNDS_MISMATCH]=te?1:0;var ne=n,re=r;n.frame.center.y>r.frame.center.y&&(ne=r,re=n),i[l.PairingFeatures.POSITION_X_FIRST]=ne.frame.center.x/o.width,i[l.PairingFeatures.POSITION_Y_FIRST]=ne.frame.center.y/o.height,i[l.PairingFeatures.AREA_FIRST]=ne.frame.area,i[l.PairingFeatures.POSITION_X_SECOND]=re.frame.center.x/o.width,i[l.PairingFeatures.POSITION_Y_SECOND]=re.frame.center.y/o.height,i[l.PairingFeatures.AREA_SECOND]=re.frame.area;for(var oe=u.iter(ne.formae);!oe.done;oe.next())(M=oe.value).isTypeLockup()?i[l.PairingFeatures.IS_TEXT_FIRST]=1:M.isShape()?i[l.PairingFeatures.IS_SHAPE_FIRST]=1:M.isImage()&&(i[l.PairingFeatures.IS_IMAGE_FIRST]=1);for(var ie=u.iter(re.formae);!ie.done;ie.next())(M=ie.value).isTypeLockup()?i[l.PairingFeatures.IS_TEXT_SECOND]=1:M.isShape()?i[l.PairingFeatures.IS_SHAPE_SECOND]=1:M.isImage()&&(i[l.PairingFeatures.IS_IMAGE_SECOND]=1);i[l.PairingFeatures.UNION_EMPTY_SPACE]=Math.max(0,s.area-n.frame.area-r.frame.area),i[l.PairingFeatures.UNION_AREA]=s.area,i[l.PairingFeatures.UNION_POSITION_X]=s.center.x/o.height,i[l.PairingFeatures.UNION_POSITION_Y]=s.center.y/o.width,i[l.PairingFeatures.HEIGHT_DIFF]=Math.abs(n.frame.height-r.frame.height),i[l.PairingFeatures.WIDTH_DIFF]=Math.abs(n.frame.width-r.frame.width),i[l.PairingFeatures.AREA_DIFF]=Math.abs(n.frame.area-r.frame.area);for(var ae,se=[],le=u.iter(["union_position_x","y_aligned","is_text_second","right_aligned","is_shape_first","containment_child_count","is_image_first","is_image_second","type_mismatch","position_x_second","containment_mismatch","height_diff","union_area","union_empty_space","area_first","top_aligned","area_second","bottom_aligned","center_y_aligned","center_distance","union_position_y","is_text_first","opacity_difference","intersection","out_of_bounds_mismatch","position_y_first","is_shape_second","position_x_first","width_diff","union_num_non_intersect","left_aligned","color_distance","center_x_aligned","boundary_distance","position_y_second","x_aligned","area_diff","font_size_distance"]);!le.done;le.next()){var ue;null!=(ue=i[le.value])?se.push(ue):se.push(0)}if(ae=T.MLPModel.loadNNModel("VisualGrouping")){var ce=u.clone(se),de=new E.TheoMatrix([ce]).subtract(ae.featureScalingMean).divide(ae.featureScalingStd);return{score:1-new C.NNMLPClassifier(ae.coefficients,ae.intercepts,ae.finalSoftmax).predict(de.transpose()).transpose().asArray[0][0],features:i}}}return{score:1/0,features:{}}},mergeWithParentIfPossible:function(e,t){var n,r,o,i;if(void 0===t&&(t=!1),(n=u.as(e,l.VisualNodeGroup))&&null!=(r=n.spacing)&&(o=n.parent)&&null!=(i=o.spacing)){if(n.layoutStrategy!=o.layoutStrategy)return;if(n.layoutStrategy==l.GroupLayoutStrategy.Default)return u.remove(o.children,n),void o.addChildren(n.children);for(var a=[],s=u.iter(o.alignments);!s.done;s.next())for(var c=s.value,d=u.iter(n.alignments);!d.done;d.next())c==d.value&&(a.includes(c)||a.push(c));(a.length>0||!t)&&(o.alignments=u.clone(a),o.spacing=(r+i)/2,u.remove(o.children,n),o.addChildren(n.children))}},getNodeForForma:function(e){for(var t=u.iter(this.nodes_);!t.done;t.next()){var n=t.value;if(u.containsEq(n.inferenceData.formae,e,h._equality_Forma_Forma))return n}return null},getScoreNodeFeatures:function(e,t){return this.scoreNodeGrouping(this.getNodeForForma(e),this.getNodeForForma(t))},isBackgroundElement:function(e){var t,n;if((t=u.as(e,l.VisualNodeLeaf))&&(n=t.forma.finalFrame)){if(t.forma.isBackgroundImage())return!0;if(t.forma.isGridCell())return!0;if(n.contains(this.parentForma_.finalFrame)||t.forma.isGraphic()&&!this.parentForma_.finalFrame.contains(n.insetRel(.1,.1,.1,.1)))return!0;var r;if(r=u.as(t.forma.controller,A.TypeLockupController)){var o=r.getAverageFontSize();return 1==r.text.length&&o>1e3}return t.hasBackgroundRole}return!1},nodesMergeable:function(e,t){return this.isBackgroundElement(e)!=this.isBackgroundElement(t)},getPairwiseScore:function(e,t){var n,r=e.id+t.id;if(null!=(n=this.pairwiseGroupScores_[r]))return n;var o=this.scoreNodeGrouping(e,t);return this.pairwiseGroupScores_[r]=o.score,o.score},scoreVisualGroupMerge:function(e,t,n){if(e==t)return y.LegacyCoreAssert.fail("probably an error if we're trying to merge something with outself",void 0,"VisualStructureDetector.scoreVisualGroupMerge","VisualStructureDetector.swift",1347),1;var r,o;if((r=u.as(e,l.VisualNodeLeaf))&&(o=u.as(t,l.VisualNodeLeaf)))return this.getPairwiseScore(r,o);var i,a=[e];(i=u.as(e,l.VisualNodeGroup))&&(a=u.clone(i.children));var s,c=[t];(s=u.as(t,l.VisualNodeGroup))&&(c=u.clone(s.children));for(var d=0,h=u.iter(a);!h.done;h.next())for(var p=h.value,f=u.iter(c);!f.done;f.next()){var m=f.value;d=Math.max(d,this.scoreVisualGroupMerge(p,m,n))}for(var g=u.iter(n);!g.done;g.next()){var _=g.value;if(_!=e&&_!=t){var T=e.frame.unionWith(t.frame).intersectionWith(_.frame);if(!e.frame.intersects(_.frame)&&!t.frame.intersects(_.frame)&&null!=T&&T.area/_.frame.area>.25)return 0}}return d},scoreRegionMerge:function(e,t,n,r){void 0===r&&(r=0);var o=e.frame.yDistance(t.frame,!1),i=e.frame.xDistance(t.frame,!1);if(o>0&&i>0)return-1/0;for(var a=u.iter(n);!a.done;a.next()){var s,c=a.value;if(c!=e&&c!=t&&(s=e.frame.unionWith(t.frame).intersectionWith(c.frame))&&s.area/c.frame.area>.1)return-1/0}if(o<r&&i<r)return-1/0;var d=i<o,h=Math.max(o,i),p=Math.max(-1*Math.min(o,i),0);if(h>200)return-1/0;for(var f=p/(d?Math.max(e.frame.width,t.frame.width):Math.max(e.frame.height,t.frame.height)),m=h/Math.max(this.parentForma_.bounds.width,this.parentForma_.bounds.height),g=0,y=u.iter([e,t]);!y.done;y.next()){var _,T=y.value;(_=u.as(T,l.VisualNodeGroup))&&(_.layoutStrategy==l.GroupLayoutStrategy.VerticalFlow&&d&&(g+=1),_.layoutStrategy!=l.GroupLayoutStrategy.HorizontalFlow||d||(g+=1))}var v,C,P=d?F.TheoRect.ONE_BY_ONE.scaleXY(1e3,1):F.TheoRect.ONE_BY_ONE.scaleXY(1,1e3),S=.5*(1-P.similarity(e.frame))+.5*(1-P.similarity(t.frame));return(v=this.getBackgroundFrame(e))&&(C=this.getBackgroundFrame(t))&&(f=p/(d?Math.min(e.frame.width,t.frame.width):Math.min(e.frame.height,t.frame.height)),!v.equal(C)&&f<.9)?0:.5+(f+10*(1-m)+.1*g+.5*S)},getContainingGraphicNode:function(e,t){for(var n=u.iter(t);!n.done;n.next()){var r,o=n.value;if((r=u.as(o,l.VisualNodeLeaf))&&r.forma.isGraphic()&&r.frame.contains(e.frame))return r}return null},createBackgroundGroupNodes:function(e){for(var t=[],n=u.iter(e);!n.done;n.next()){var r=n.value,o=u.as(r,l.VisualNodeLeaf),i=u.as(r,l.VisualNodeGroup),a=this.getBackgroundFrame(r),s=null!=a&&a.equal(this.parentForma_.bounds);if(null!=o||null!=i&&i.filledGroup||!s){var c=r.parent,d=new l.VisualNodeGroup([r]);if(u.opt(c,(function(e){return e.addChildren([d])})),t.push(d),d.layoutStrategy=l.GroupLayoutStrategy.Default,null!=o){var h=l.VisualNodeData.init_ff0a(o,[o.forma]);d.inferenceData=h}else d.inferenceData=r.inferenceData;s||(d.frame=a,d.bgConstraint=!0)}else t.push(r)}return t=u.sort(t,(function(e,t){return e.frame.center.y<t.frame.center.y}))},fastMergeNodes:function(e){for(var t=u.clone(e),n=[];t.length>0;){for(var r=t[0],o=r.frame||F.TheoRect.Zero,i=[],a=u.iter(t);!a.done;a.next()){var s,c,d=a.value;(s=d.frame)&&(c=o.intersectionWith(s))&&c.area/s.area>.05&&(i.push(d),o=o.unionWith(s))}if(i.length>1){var h=new l.VisualNodeGroup(i,o);t.push(h);for(var p=u.iter(i);!p.done;p.next()){var f=p.value;u.remove(t,f),this.mergeWithParentIfPossible(f,!1)}}else n.push(r),u.remove(t,r)}return this.mergeNodes(n)},mergeNodes:function(e){for(var t=this,n=u.clone(e),r=u.iter(n);!r.done;r.next()){var o=r.value;u.opt(o.inferenceData,(function(e){return e.setPairwiseDistanceTerms(n)}))}for(var i=0,a=u.iter([!0,!1]);!a.done;a.next())for(var s=a.value,c=u.iter([!0,!1]);!c.done;c.next())for(var d=c.value;n.length>1||i>100;){i+=1;for(var h=0,p=null,f=u.iter(u.range(0,n.length,!1));!f.done;f.next())for(var m=f.value,g=u.sort(n,(function(e,t){return e.frame.L1Distance(n[m].frame)<t.frame.L1Distance(n[m].frame)})),y=u.iter(u.range(0,Math.min(5,g.length),!1));!y.done;y.next()){var _=y.value;if(n[m]!=g[_]){if(d){var T=this.getContainingGraphicNode(n[m],e),C=this.getContainingGraphicNode(g[_],e);if(T==g[_]||C==n[m])continue;if(null!=T&&T!=C||null!=C&&T!=C)continue}var P=s?this.scoreVisualGroupMerge(n[m],g[_],n):this.scoreRegionMerge(n[m],g[_],n);P>.5&&P>h&&(p={nodeA:n[m],nodeB:g[_]},h=P)}}if(null==p)break;var S=new l.VisualNodeGroup([p.nodeA,p.nodeB]);S.frame=u.opt(S.frame,(function(e){return e.intersectionWith(t.parentForma_.bounds)}));var D=-1*v.MathUtils.minDouble(p.nodeA.frame.maxX-p.nodeB.frame.minX,p.nodeB.frame.maxX-p.nodeA.frame.minX),A=-1*v.MathUtils.minDouble(p.nodeA.frame.maxY-p.nodeB.frame.minY,p.nodeB.frame.maxY-p.nodeA.frame.minY);S.layoutStrategy=D<0&&A>=0?l.GroupLayoutStrategy.VerticalFlow:A<0&&D>=0?l.GroupLayoutStrategy.HorizontalFlow:l.GroupLayoutStrategy.Default,S.bgConstraint=p.nodeA.bgConstraint&&p.nodeB.bgConstraint;var E,R,F=u.clone(u.opt(p.nodeA.inferenceData,(function(e){return e.alignments[p.nodeB.id]})));if(null!=F){var b=u.sort(F,(function(e,t){return e.offset.length()<t.offset.length()}));S.alignments.includes(b[0].line.type)||S.alignments.push(b[0].line.type)}if(S.spacing=p.nodeA.frame.L1Distance(p.nodeB.frame),(E=p.nodeA.inferenceData)&&(R=p.nodeB.inferenceData)){var I=l.VisualNodeData.init_b16c(S,E,R);S.inferenceData=I,s&&(S.spacing=u.opt(p.nodeA.inferenceData,(function(e){return e.nodeDistances[p.nodeB.id]})))}n.push(S),this.mergeWithParentIfPossible(p.nodeA,!1),this.mergeWithParentIfPossible(p.nodeB,!1),u.remove(n,p.nodeA),u.remove(n,p.nodeB);for(var O=u.iter(n);!O.done;O.next())o=O.value,u.opt(o.inferenceData,(function(e){return e.setPairwiseDistanceTerms(n)}))}return n},getBackgroundFrame:function(e){if(!this.parentForma_.bounds.contains(e.frame))return null;var t,n=[];(t=u.as(e,l.VisualNodeGroup))?n=u.clone(t.leafDescendents):null!=(i=u.as(e,l.VisualNodeLeaf))&&(n=[i]);for(var r=null,o=u.iter(n);!o.done;o.next()){var i,a,s,c=(i=o.value).frame;(a=u.as(i.forma.controller,A.TypeLockupController))&&null!=(s=u.opt(a.lockupStyle,(function(e){return e.backing})))&&(s!=_.LockupBacking.BannerHorizontal&&s!=_.LockupBacking.BannerVertical&&s!=_.LockupBacking.Banner||(c=u.opt(u.as(i.forma,f.GroupForma),(function(e){return e.childrenFrame}))));var d,h=!1;if(d=c)for(var p=u.iter(this.bgFrames_);!p.done;p.next()){var m=p.value;m.contains(d)&&(h=!0,r=u.opt(r,(function(e){return e.unionWith(m)}))||m)}h||(r=this.parentForma_.bounds)}return r||this.parentForma_.bounds}}}),s)},zjod:function(e,t,n){var r,o=t,i=n("oAGj"),a=n("fWxZ"),s=n("P83h"),l=n("pnSN"),u=n("Qlvz"),c=n("fdtz"),d=n("uWOl"),h=n("fNpk"),p=n("9YN4"),f=n("RkYL"),m=n("fGVU"),g=n("sW6f"),y=n("QTen");o.VideoPlayerStatus=i.defineEnum("VideoPlayerStatus",{stopped:0,playing:1}),o.VideoMode=i.defineEnum("VideoMode",{stillImage:0,playback:1,publish:2,trim:3}),o.VideoForma=(r=function(){this.cachedVideoContent_=null,this.currentTime_=f.TheoTime.Zero,this.playerStatus_=o.VideoPlayerStatus.stopped,this.mode_=o.VideoMode.stillImage},i.defineClass({name:"VideoForma",ctor:r,superName:"ImageForma",statics:{KIND:{get:function(){return"Video"}},PROPERTY_VIDEO_CONTENTID:"video-content-id",SCHEMA_CLASS_NAME:{get:function(){return"VideoForma"}},factory:{get:function(){return function(e,t,n,o){if(null!=t){var s=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),l.GroupForma),u=i.as(i.opt(i.opt(o,(function(e){return e.backLink})),(function(e){return e.dereference()})),a.FormaPage);return h.LegacyCoreAssert.isTrue(null!=s||null!=u,"VideoForma needs a parent group or page",void 0,"VideoForma","VideoForma.swift",45),null!=s?r.init_3144(e,t,n,s):r.init_7dbd(e,t,n,u)}return r.init_d1c9(e,n)}}},_implements:function(e){return"IDBObject"==e||"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{init_3144:function(e,t,n,r){i.super_init(this,c.ImageForma,c.ImageForma.prototype.init_3144,e,t,n,r)},init_7dbd:function(e,t,n,r){i.super_init(this,c.ImageForma,c.ImageForma.prototype.init_7dbd,e,t,n,r)},init_812f:function(e,t){for(var n={kind:function(){return r.KIND},style:function(){return y.VideoStyle.createDefault()}},o=i.clone(t),a=i.iter(n);!a.done;a.next()){var s=a.key,l=a.value;null==t[s]&&(o[s]=l())}i.super_init(this,c.ImageForma,c.ImageForma.prototype.init_812f,e,o)},init_7186:function(e){var t={kind:r.KIND,style:y.VideoStyle.createDefault()};this.init_812f(e,t)},init_d1c9:function(e,t){i.super_init(this,c.ImageForma,c.ImageForma.prototype.init_d1c9,e,t)},getFrameForTime:function(e){var t;if(t=this.videoContentNode){if(0==t.times.length)return 0;var n=i.opt(this.animation,(function(e){return e.startTime}))||t.times[0],r=t.times[t.times.length-1],o=i.opt(this.animation,(function(e){return e.endTime}))||r;if(e.seconds>o.seconds)return t.times.length-1;if(e.seconds-n.seconds<=0)return 0;var a=e.subtract(n),s=new f.TheoTime(i.toInt(a.seconds*i.toDouble(r.timescale))%r.value,r.timescale);if(s.value<t.times[0].value)return 0;for(var l=i.iter(i.range(0,t.times.length-1,!1));!l.done;l.next()){var u=l.value;if(s.value>=t.times[u].value&&s.value<t.times[u+1].value)return u+1}return t.times.length-1}return 0},decodeController:function(){var e;null==this.controller&&(e=i.opt(this.page.document,(function(e){return e.controller})))&&(this.controller=e.controllerFactory.createController(m.VideoController.KIND,this)),c.ImageForma.prototype.decodeController.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(e){return e==r.PROPERTY_VIDEO_CONTENTID?new s.FormaContentChangedEvent(this):c.ImageForma.prototype.updateEventForProperty.call(this,e)},isVideo:function(){return!0},isSticker:function(){var e,t;return!!((e=this.videoContentNode)&&(t=i.opt(this.parent,(function(e){return e.controller})))&&e.isGIF&&t.moveable)},videoContentNode:{get:function(){var e,t;null!=(e=this.videoContentID)&&((!(t=this.cachedVideoContent_)||t.id!=e)&&(this.cachedVideoContent_=i.as(i.opt(this.page.document,(function(t){return t.content.nodeByID(e)})),g.VideoContentNode)));return this.cachedVideoContent_},set:function(e){var t=new s.FormaContentChangedEvent(this);this.beginUpdate(t),this.cachedVideoContent_=e,this.set(r.PROPERTY_VIDEO_CONTENTID,i.opt(e,(function(e){return e.id}))),this.endUpdate(t)}},videoContentID:{get:function(){return i.as(this.get(r.PROPERTY_VIDEO_CONTENTID),"String")}},currentTime:{get:function(){return this.currentTime_},set:function(e){if(e!=this.currentTime_){var t=new s.FormaVideoTimeChangedEvent(this);this.beginUpdate(t),this.currentTime_=e,this.endUpdate(t)}}},videoPlayerStatus:{get:function(){return this.playerStatus_},set:function(e){if(e!=this.playerStatus_){var t=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(t),this.playerStatus_=e,this.endUpdate(t)}}},mode:{get:function(){return this.mode_},set:function(e){if(e!=this.mode_){var t=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(t),this.mode_=e,this.endUpdate(t)}}},setVideoPlayerStatusAndMode:function(e,t,n){if(n||e!=this.playerStatus_||t!=this.mode_){var r=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(r),this.mode_=t,this.playerStatus_=e,this.endUpdate(r)}},forceStateChange:function(){var e=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(e),this.endUpdate(e)},postDecode:function(){var e,t,n=this;if(c.ImageForma.prototype.postDecode.call(this),t=i.as(this.style,d.ImageStyle)){if(!(this.style instanceof y.VideoStyle)){var r=(e=i.opt(this.page.document,(function(e){return e.versionDecoded.vers})))||null!=e?e:0;h.LegacyCoreAssert.isTrue(r<p.TheoDocumentVersion.VideoSupport,"Why is there no VideoStyle for VideoForma",{version:i.toString(r)},"VideoForma.postDecode","VideoForma.swift",277);var o,a,s=y.VideoStyle.createDefault();(o=this.videoContentNode)&&(s.duration=o.duration),(a=s.mergeWithImageStyle(t))&&this.protectedSetStyle(a),i.opt(this.videoContentNode,(function(e){return null==e.mediaMetadata&&i.opt(n.contentNode,(function(e){return null!=e.mediaMetadata}))}))&&i.opt(this.videoContentNode,(function(e){return e.mediaMetadata=i.opt(n.contentNode,(function(e){return e.mediaMetadata}))}))}t.filter=null,t.adjustments=u.ImageAdjustments.createDefault(),t.name=d.ImageStyle.DEFAULT_NAME}},canApplyStyle:function(e){return c.ImageForma.prototype.canApplyStyle.call(this,e)&&e instanceof y.VideoStyle},applyStyle:function(e){var t,n,r;(t=i.as(e,d.ImageStyle))&&(n=i.as(this.style,y.VideoStyle))&&(r=n.mergeWithImageStyle(t))&&(r.filter=null,r.adjustments=u.ImageAdjustments.createDefault(),r.name=d.ImageStyle.DEFAULT_NAME,this.internalSetStyle(r))},resetToStartTime:function(){var e;if(e=i.as(this.style,y.VideoStyle)){var t=e.startTime;if(t!=this.currentTime_){var n=new s.FormaVideoStateChangedEvent(this);this.beginUpdate(n),this.currentTime_=t,this.endUpdate(n)}}}}}),r)}}]);
//# sourceMappingURL=theo-core-model-ecea01e4.js.map